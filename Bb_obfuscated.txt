loadstring(game:HttpGet((Z2V0Z2VudigpLkdHID0gewogICAgTGFuZ3VhZ2UgPSB7CiAgICAgICAgQ2hlY2tib3hFbmFibGVkID0gIkVuYWJsZWQiLAogICAgICAgIENoZWNrYm94RGlzYWJsZWQgPSAiRGlzYWJsZWQiLAogICAgICAgIFNsaWRlclZhbHVlID0gIlZhbHVlIiwKICAgICAgICBEcm9wZG93blNlbGVjdCA9ICJTZWxlY3QiLAogICAgICAgIERyb3Bkb3duTm9uZSA9ICJOb25lIiwKICAgICAgICBEcm9wZG93blNlbGVjdGVkID0gIlNlbGVjdGVkIiwKICAgICAgICBCdXR0b25DbGljayA9ICJDbGljayIsCiAgICAgICAgVGV4dGJveEVudGVyID0gIkVudGVyIiwKICAgICAgICBNb2R1bGVFbmFibGVkID0gIkVuYWJsZWQiLAogICAgICAgIE1vZHVsZURpc2FibGVkID0gIkRpc2FibGVkIiwKICAgICAgICBUYWJHZW5lcmFsID0gIkdlbmVyYWwiLAogICAgICAgIFRhYlNldHRpbmdzID0gIlNldHRpbmdzIiwKICAgICAgICBMb2FkaW5nID0gIkxvYWRpbmcuLi4iLAogICAgICAgIEVycm9yID0gIkVycm9yIiwKICAgICAgICBTdWNjZXNzID0gIlN1Y2Nlc3MiCiAgICB9Cn0KCmxvY2FsIFNlbGVjdGVkTGFuZ3VhZ2UgPSBHRy5MYW5ndWFnZQoKZnVuY3Rpb24gY29udmVydFN0cmluZ1RvVGFibGUoaW5wdXRTdHJpbmcpCiAgICBsb2NhbCByZXN1bHQgPSB7fQogICAgZm9yIHZhbHVlIGluIHN0cmluZy5nbWF0Y2goaW5wdXRTdHJpbmcsICIoW14sXSspIikgZG8KICAgICAgICBsb2NhbCB0cmltbWVkVmFsdWUgPSB2YWx1ZTptYXRjaCgiXiVzKiguLSklcyokIikKICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0LCB0cmltbWVkVmFsdWUpCiAgICBlbmQKCiAgICByZXR1cm4gcmVzdWx0CmVuZAoKZnVuY3Rpb24gY29udmVydFRhYmxlVG9TdHJpbmcoaW5wdXRUYWJsZSkKICAgIHJldHVybiB0YWJsZS5jb25jYXQoaW5wdXRUYWJsZSwgIiwgIikKZW5kCgpsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdVc2VySW5wdXRTZXJ2aWNlJykpCmxvY2FsIENvbnRlbnRQcm92aWRlciA9IGNsb25lcmVmKGdhbWU6R2V0U2VydmljZSgnQ29udGVudFByb3ZpZGVyJykpCmxvY2FsIFR3ZWVuU2VydmljZSA9IGNsb25lcmVmKGdhbWU6R2V0U2VydmljZSgnVHdlZW5TZXJ2aWNlJykpCmxvY2FsIEh0dHBTZXJ2aWNlID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdIdHRwU2VydmljZScpKQpsb2NhbCBUZXh0U2VydmljZSA9IGNsb25lcmVmKGdhbWU6R2V0U2VydmljZSgnVGV4dFNlcnZpY2UnKSkKbG9jYWwgUnVuU2VydmljZSA9IGNsb25lcmVmKGdhbWU6R2V0U2VydmljZSgnUnVuU2VydmljZScpKQpsb2NhbCBMaWdodGluZyA9IGNsb25lcmVmKGdhbWU6R2V0U2VydmljZSgnTGlnaHRpbmcnKSkKbG9jYWwgUGxheWVycyA9IGNsb25lcmVmKGdhbWU6R2V0U2VydmljZSgnUGxheWVycycpKQpsb2NhbCBDb3JlR3VpID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdDb3JlR3VpJykpCmxvY2FsIERlYnJpcyA9IGNsb25lcmVmKGdhbWU6R2V0U2VydmljZSgnRGVicmlzJykpCgpsb2NhbCBtb3VzZSA9IFBsYXllcnMuTG9jYWxQbGF5ZXI6R2V0TW91c2UoKQpsb2NhbCBvbGRfQmFsbHMgPSBDb3JlR3VpOkZpbmRGaXJzdENoaWxkKCdCYWxscycpCgppZiBvbGRfQmFsbHMgdGhlbgogICAgRGVicmlzOkFkZEl0ZW0ob2xkX0JhbGxzLCAwKQplbmQKCmlmIG5vdCBpc2ZvbGRlcigiaW52IikgdGhlbgogICAgbWFrZWZvbGRlcigiaW52IikKZW5kCgoKbG9jYWwgQ29ubmVjdGlvbnMgPSBzZXRtZXRhdGFibGUoewogICAgZGlzY29ubmVjdCA9IGZ1bmN0aW9uKHNlbGYsIGNvbm5lY3Rpb24pCiAgICAgICAgaWYgbm90IHNlbGZbY29ubmVjdGlvbl0gdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgIAogICAgICAgIHNlbGZbY29ubmVjdGlvbl06RGlzY29ubmVjdCgpCiAgICAgICAgc2VsZltjb25uZWN0aW9uXSA9IG5pbAogICAgZW5kLAogICAgZGlzY29ubmVjdF9hbGwgPSBmdW5jdGlvbihzZWxmKQogICAgICAgIGZvciBfLCB2YWx1ZSBpbiBzZWxmIGRvCiAgICAgICAgICAgIGlmIHR5cGVvZih2YWx1ZSkgPT0gJ2Z1bmN0aW9uJyB0aGVuCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICB2YWx1ZTpEaXNjb25uZWN0KCkKICAgICAgICBlbmQKICAgIGVuZAp9LCBDb25uZWN0aW9ucykKCgpsb2NhbCBVdGlsID0gc2V0bWV0YXRhYmxlKHsKICAgIG1hcCA9IGZ1bmN0aW9uKHNlbGY6IGFueSwgdmFsdWU6IG51bWJlciwgaW5fbWluaW11bTogbnVtYmVyLCBpbl9tYXhpbXVtOiBudW1iZXIsIG91dF9taW5pbXVtOiBudW1iZXIsIG91dF9tYXhpbXVtOiBudW1iZXIpCiAgICAgICAgcmV0dXJuICh2YWx1ZSAtIGluX21pbmltdW0pICogKG91dF9tYXhpbXVtIC0gb3V0X21pbmltdW0pIC8gKGluX21heGltdW0gLSBpbl9taW5pbXVtKSArIG91dF9taW5pbXVtCiAgICBlbmQsCiAgICB2aWV3cG9ydF9wb2ludF90b193b3JsZCA9IGZ1bmN0aW9uKHNlbGY6IGFueSwgbG9jYXRpb246IGFueSwgZGlzdGFuY2U6IG51bWJlcikKICAgICAgICBsb2NhbCB1bml0X3JheSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhOlNjcmVlblBvaW50VG9SYXkobG9jYXRpb24uWCwgbG9jYXRpb24uWSkKCiAgICAgICAgcmV0dXJuIHVuaXRfcmF5Lk9yaWdpbiArIHVuaXRfcmF5LkRpcmVjdGlvbiAqIGRpc3RhbmNlCiAgICBlbmQsCiAgICBnZXRfb2Zmc2V0ID0gZnVuY3Rpb24oc2VsZjogYW55KQogICAgICAgIGxvY2FsIHZpZXdwb3J0X3NpemVfWSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLlZpZXdwb3J0U2l6ZS5ZCgogICAgICAgIHJldHVybiBzZWxmOm1hcCh2aWV3cG9ydF9zaXplX1ksIDAsIDI1NjAsIDgsIDU2KQogICAgZW5kCn0sIFV0aWwpCgoKbG9jYWwgQWNyeWxpY0JsdXIgPSB7fQpBY3J5bGljQmx1ci5fX2luZGV4ID0gQWNyeWxpY0JsdXIKCgpmdW5jdGlvbiBBY3J5bGljQmx1ci5uZXcob2JqZWN0OiBHdWlPYmplY3QpCiAgICBsb2NhbCBzZWxmID0gc2V0bWV0YXRhYmxlKHsKICAgICAgICBfb2JqZWN0ID0gb2JqZWN0LAogICAgICAgIF9mb2xkZXIgPSBuaWwsCiAgICAgICAgX2ZyYW1lID0gbmlsLAogICAgICAgIF9yb290ID0gbmlsCiAgICB9LCBBY3J5bGljQmx1cikKCiAgICBzZWxmOnNldHVwKCkKCiAgICByZXR1cm4gc2VsZgplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpjcmVhdGVfZm9sZGVyKCkKICAgIGxvY2FsIG9sZF9mb2xkZXIgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYTpGaW5kRmlyc3RDaGlsZCgnQWNyeWxpY0JsdXInKQoKICAgIGlmIG9sZF9mb2xkZXIgdGhlbgogICAgICAgIERlYnJpczpBZGRJdGVtKG9sZF9mb2xkZXIsIDApCiAgICBlbmQKCiAgICBsb2NhbCBmb2xkZXIgPSBJbnN0YW5jZS5uZXcoJ0ZvbGRlcicpCiAgICBmb2xkZXIuTmFtZSA9ICdBY3J5bGljQmx1cicKICAgIGZvbGRlci5QYXJlbnQgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYQoKICAgIHNlbGYuX2ZvbGRlciA9IGZvbGRlcgplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpjcmVhdGVfZGVwdGhfb2ZfZmllbGRzKCkKICAgIGxvY2FsIGRlcHRoX29mX2ZpZWxkcyA9IExpZ2h0aW5nOkZpbmRGaXJzdENoaWxkKCdBY3J5bGljQmx1cicpIG9yIEluc3RhbmNlLm5ldygnRGVwdGhPZkZpZWxkRWZmZWN0JykKICAgIGRlcHRoX29mX2ZpZWxkcy5GYXJJbnRlbnNpdHkgPSAwCiAgICBkZXB0aF9vZl9maWVsZHMuRm9jdXNEaXN0YW5jZSA9IDAuMDUKICAgIGRlcHRoX29mX2ZpZWxkcy5JbkZvY3VzUmFkaXVzID0gMC4xCiAgICBkZXB0aF9vZl9maWVsZHMuTmVhckludGVuc2l0eSA9IDEKICAgIGRlcHRoX29mX2ZpZWxkcy5OYW1lID0gJ0FjcnlsaWNCbHVyJwogICAgZGVwdGhfb2ZfZmllbGRzLlBhcmVudCA9IExpZ2h0aW5nCgogICAgZm9yIF8sIG9iamVjdCBpbiBMaWdodGluZzpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgaWYgbm90IG9iamVjdDpJc0EoJ0RlcHRoT2ZGaWVsZEVmZmVjdCcpIHRoZW4KICAgICAgICAgICAgY29udGludWUKICAgICAgICBlbmQKCiAgICAgICAgaWYgb2JqZWN0ID09IGRlcHRoX29mX2ZpZWxkcyB0aGVuCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZW5kCgogICAgICAgIENvbm5lY3Rpb25zW29iamVjdF0gPSBvYmplY3Q6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdGYXJJbnRlbnNpdHknKTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgb2JqZWN0LkZhckludGVuc2l0eSA9IDAKICAgICAgICBlbmQpCgogICAgICAgIG9iamVjdC5GYXJJbnRlbnNpdHkgPSAwCiAgICBlbmQKZW5kCgoKZnVuY3Rpb24gQWNyeWxpY0JsdXI6Y3JlYXRlX2ZyYW1lKCkKICAgIGxvY2FsIGZyYW1lID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICBmcmFtZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDEsIDApCiAgICBmcmFtZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAuNSwgMCkKICAgIGZyYW1lLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwLjUpCiAgICBmcmFtZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgZnJhbWUuUGFyZW50ID0gc2VsZi5fb2JqZWN0CgogICAgc2VsZi5fZnJhbWUgPSBmcmFtZQplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpjcmVhdGVfcm9vdCgpCiAgICBsb2NhbCBwYXJ0ID0gSW5zdGFuY2UubmV3KCdQYXJ0JykKICAgIHBhcnQuTmFtZSA9ICdSb290JwogICAgcGFydC5Db2xvciA9IENvbG9yMy5uZXcoMCwgMCwgMCkKICAgIHBhcnQuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsLkdsYXNzCiAgICBwYXJ0LlNpemUgPSBWZWN0b3IzLm5ldygxLCAxLCAwKSAKICAgIHBhcnQuQW5jaG9yZWQgPSB0cnVlCiAgICBwYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgcGFydC5DYW5RdWVyeSA9IGZhbHNlCiAgICBwYXJ0LkxvY2tlZCA9IHRydWUKICAgIHBhcnQuQ2FzdFNoYWRvdyA9IGZhbHNlCiAgICBwYXJ0LlRyYW5zcGFyZW5jeSA9IDAuOTgKICAgIHBhcnQuUGFyZW50ID0gc2VsZi5fZm9sZGVyCgoKICAgIGxvY2FsIHNwZWNpYWxNZXNoID0gSW5zdGFuY2UubmV3KCdTcGVjaWFsTWVzaCcpCiAgICBzcGVjaWFsTWVzaC5NZXNoVHlwZSA9IEVudW0uTWVzaFR5cGUuQnJpY2sgIAogICAgc3BlY2lhbE1lc2guT2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwgMCwgLTAuMDAwMDAxKSAgCiAgICBzcGVjaWFsTWVzaC5QYXJlbnQgPSBwYXJ0CgogICAgc2VsZi5fcm9vdCA9IHBhcnQgCmVuZAoKCmZ1bmN0aW9uIEFjcnlsaWNCbHVyOnNldHVwKCkKICAgIHNlbGY6Y3JlYXRlX2RlcHRoX29mX2ZpZWxkcygpCiAgICBzZWxmOmNyZWF0ZV9mb2xkZXIoKQogICAgc2VsZjpjcmVhdGVfcm9vdCgpCiAgICAKICAgIHNlbGY6Y3JlYXRlX2ZyYW1lKCkKICAgIHNlbGY6cmVuZGVyKDAuMDAxKQoKICAgIHNlbGY6Y2hlY2tfcXVhbGl0eV9sZXZlbCgpCmVuZAoKCmZ1bmN0aW9uIEFjcnlsaWNCbHVyOnJlbmRlcihkaXN0YW5jZTogbnVtYmVyKQogICAgbG9jYWwgcG9zaXRpb25zID0gewogICAgICAgIHRvcF9sZWZ0ID0gVmVjdG9yMi5uZXcoKSwKICAgICAgICB0b3BfcmlnaHQgPSBWZWN0b3IyLm5ldygpLAogICAgICAgIGJvdHRvbV9yaWdodCA9IFZlY3RvcjIubmV3KCksCiAgICB9CgogICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX3Bvc2l0aW9ucyhzaXplOiBhbnksIHBvc2l0aW9uOiBhbnkpCiAgICAgICAgcG9zaXRpb25zLnRvcF9sZWZ0ID0gcG9zaXRpb24KICAgICAgICBwb3NpdGlvbnMudG9wX3JpZ2h0ID0gcG9zaXRpb24gKyBWZWN0b3IyLm5ldyhzaXplLlgsIDApCiAgICAgICAgcG9zaXRpb25zLmJvdHRvbV9yaWdodCA9IHBvc2l0aW9uICsgc2l6ZQogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlKCkKICAgICAgICBsb2NhbCB0b3BfbGVmdCA9IHBvc2l0aW9ucy50b3BfbGVmdAogICAgICAgIGxvY2FsIHRvcF9yaWdodCA9IHBvc2l0aW9ucy50b3BfcmlnaHQKICAgICAgICBsb2NhbCBib3R0b21fcmlnaHQgPSBwb3NpdGlvbnMuYm90dG9tX3JpZ2h0CgogICAgICAgIGxvY2FsIHRvcF9sZWZ0M0QgPSBVdGlsOnZpZXdwb3J0X3BvaW50X3RvX3dvcmxkKHRvcF9sZWZ0LCBkaXN0YW5jZSkKICAgICAgICBsb2NhbCB0b3BfcmlnaHQzRCA9IFV0aWw6dmlld3BvcnRfcG9pbnRfdG9fd29ybGQodG9wX3JpZ2h0LCBkaXN0YW5jZSkKICAgICAgICBsb2NhbCBib3R0b21fcmlnaHQzRCA9IFV0aWw6dmlld3BvcnRfcG9pbnRfdG9fd29ybGQoYm90dG9tX3JpZ2h0LCBkaXN0YW5jZSkKCiAgICAgICAgbG9jYWwgd2lkdGggPSAodG9wX3JpZ2h0M0QgLSB0b3BfbGVmdDNEKS5NYWduaXR1ZGUKICAgICAgICBsb2NhbCBoZWlnaHQgPSAodG9wX3JpZ2h0M0QgLSBib3R0b21fcmlnaHQzRCkuTWFnbml0dWRlCgogICAgICAgIGlmIG5vdCBzZWxmLl9yb290IHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIHNlbGYuX3Jvb3QuQ0ZyYW1lID0gQ0ZyYW1lLmZyb21NYXRyaXgoKHRvcF9sZWZ0M0QgKyBib3R0b21fcmlnaHQzRCkgLyAyLCB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUuWFZlY3Rvciwgd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lLllWZWN0b3IsIHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5aVmVjdG9yKQogICAgICAgIHNlbGYuX3Jvb3QuTWVzaC5TY2FsZSA9IFZlY3RvcjMubmV3KHdpZHRoLCBoZWlnaHQsIDApCiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBvbl9jaGFuZ2UoKQogICAgICAgIGxvY2FsIG9mZnNldCA9IFV0aWw6Z2V0X29mZnNldCgpCiAgICAgICAgbG9jYWwgc2l6ZSA9IHNlbGYuX2ZyYW1lLkFic29sdXRlU2l6ZSAtIFZlY3RvcjIubmV3KG9mZnNldCwgb2Zmc2V0KQogICAgICAgIGxvY2FsIHBvc2l0aW9uID0gc2VsZi5fZnJhbWUuQWJzb2x1dGVQb3NpdGlvbiArIFZlY3RvcjIubmV3KG9mZnNldCAvIDIsIG9mZnNldCAvIDIpCgogICAgICAgIHVwZGF0ZV9wb3NpdGlvbnMoc2l6ZSwgcG9zaXRpb24pCiAgICAgICAgdGFzay5zcGF3bih1cGRhdGUpCiAgICBlbmQKCiAgICBDb25uZWN0aW9uc1snY2ZyYW1lX3VwZGF0ZSddID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmE6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdDRnJhbWUnKTpDb25uZWN0KHVwZGF0ZSkKICAgIENvbm5lY3Rpb25zWyd2aWV3cG9ydF9zaXplX3VwZGF0ZSddID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmE6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdWaWV3cG9ydFNpemUnKTpDb25uZWN0KHVwZGF0ZSkKICAgIENvbm5lY3Rpb25zWydmaWVsZF9vZl92aWV3X3VwZGF0ZSddID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmE6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdGaWVsZE9mVmlldycpOkNvbm5lY3QodXBkYXRlKQoKICAgIENvbm5lY3Rpb25zWydmcmFtZV9hYnNvbHV0ZV9wb3NpdGlvbiddID0gc2VsZi5fZnJhbWU6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdBYnNvbHV0ZVBvc2l0aW9uJyk6Q29ubmVjdChvbl9jaGFuZ2UpCiAgICBDb25uZWN0aW9uc1snZnJhbWVfYWJzb2x1dGVfc2l6ZSddID0gc2VsZi5fZnJhbWU6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdBYnNvbHV0ZVNpemUnKTpDb25uZWN0KG9uX2NoYW5nZSkKICAgIAogICAgdGFzay5zcGF3bih1cGRhdGUpCmVuZAoKCmZ1bmN0aW9uIEFjcnlsaWNCbHVyOmNoZWNrX3F1YWxpdHlfbGV2ZWwoKQogICAgbG9jYWwgZ2FtZV9zZXR0aW5ncyA9IFVzZXJTZXR0aW5ncygpLkdhbWVTZXR0aW5ncwogICAgbG9jYWwgcXVhbGl0eV9sZXZlbCA9IGdhbWVfc2V0dGluZ3MuU2F2ZWRRdWFsaXR5TGV2ZWwuVmFsdWUKCiAgICBpZiBxdWFsaXR5X2xldmVsIDwgOCB0aGVuCiAgICAgICAgc2VsZjpjaGFuZ2VfdmlzaWJsaXR5KGZhbHNlKQogICAgZW5kCgogICAgQ29ubmVjdGlvbnNbJ3F1YWxpdHlfbGV2ZWwnXSA9IGdhbWVfc2V0dGluZ3M6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdTYXZlZFF1YWxpdHlMZXZlbCcpOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIGdhbWVfc2V0dGluZ3MgPSBVc2VyU2V0dGluZ3MoKS5HYW1lU2V0dGluZ3MKICAgICAgICBsb2NhbCBxdWFsaXR5X2xldmVsID0gZ2FtZV9zZXR0aW5ncy5TYXZlZFF1YWxpdHlMZXZlbC5WYWx1ZQoKICAgICAgICBzZWxmOmNoYW5nZV92aXNpYmxpdHkocXVhbGl0eV9sZXZlbCA+PSA4KQogICAgZW5kKQplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpjaGFuZ2VfdmlzaWJsaXR5KHN0YXRlOiBib29sZWFuKQogICAgc2VsZi5fcm9vdC5UcmFuc3BhcmVuY3kgPSBzdGF0ZSBhbmQgMC45OCBvciAxCmVuZAoKCmxvY2FsIENvbmZpZyA9IHNldG1ldGF0YWJsZSh7CiAgICBzYXZlID0gZnVuY3Rpb24oc2VsZjogYW55LCBmaWxlX25hbWU6IGFueSwgY29uZmlnOiBhbnkpCiAgICAgICAgbG9jYWwgc3VjY2Vzc19zYXZlLCByZXN1bHQgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGxvY2FsIGZsYWdzID0gSHR0cFNlcnZpY2U6SlNPTkVuY29kZShjb25maWcpCiAgICAgICAgICAgIHdyaXRlZmlsZSgnQmFsbHMvJy4uZmlsZV9uYW1lLi4nLmpzb24nLCBmbGFncykKICAgICAgICBlbmQpCiAgICAKICAgICAgICBpZiBub3Qgc3VjY2Vzc19zYXZlIHRoZW4KICAgICAgICAgICAgd2FybignZmFpbGVkIHRvIHNhdmUgY29uZmlnJywgcmVzdWx0KQogICAgICAgIGVuZAogICAgZW5kLAogICAgbG9hZCA9IGZ1bmN0aW9uKHNlbGY6IGFueSwgZmlsZV9uYW1lOiBhbnksIGNvbmZpZzogYW55KQogICAgICAgIGxvY2FsIHN1Y2Nlc3NfbG9hZCwgcmVzdWx0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBub3QgaXNmaWxlKCdCYWxscy8nLi5maWxlX25hbWUuLicuanNvbicpIHRoZW4KICAgICAgICAgICAgICAgIHNlbGY6c2F2ZShmaWxlX25hbWUsIGNvbmZpZykKICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgZmxhZ3MgPSByZWFkZmlsZSgnQmFsbHMvJy4uZmlsZV9uYW1lLi4nLmpzb24nKQogICAgICAgIAogICAgICAgICAgICBpZiBub3QgZmxhZ3MgdGhlbgogICAgICAgICAgICAgICAgc2VsZjpzYXZlKGZpbGVfbmFtZSwgY29uZmlnKQogICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIEh0dHBTZXJ2aWNlOkpTT05EZWNvZGUoZmxhZ3MpCiAgICAgICAgZW5kKQogICAgCiAgICAgICAgaWYgbm90IHN1Y2Nlc3NfbG9hZCB0aGVuCiAgICAgICAgICAgIHdhcm4oJ2ZhaWxlZCB0byBsb2FkIGNvbmZpZycsIHJlc3VsdCkKICAgICAgICBlbmQKICAgIAogICAgICAgIGlmIG5vdCByZXN1bHQgdGhlbgogICAgICAgICAgICByZXN1bHQgPSB7CiAgICAgICAgICAgICAgICBfZmxhZ3MgPSB7fSwKICAgICAgICAgICAgICAgIF9rZXliaW5kcyA9IHt9LAogICAgICAgICAgICAgICAgX2xpYnJhcnkgPSB7fQogICAgICAgICAgICB9CiAgICAgICAgZW5kCiAgICAKICAgICAgICByZXR1cm4gcmVzdWx0CiAgICBlbmQKfSwgQ29uZmlnKQoKCmxvY2FsIExpYnJhcnkgPSB7CiAgICBfY29uZmlnID0gQ29uZmlnOmxvYWQoZ2FtZS5HYW1lSWQpLAoKICAgIF9jaG9vc2luZ19rZXliaW5kID0gZmFsc2UsCiAgICBfZGV2aWNlID0gbmlsLAoKICAgIF91aV9vcGVuID0gdHJ1ZSwKICAgIF91aV9zY2FsZSA9IDEsCiAgICBfdWlfbG9hZGVkID0gZmFsc2UsCiAgICBfdWkgPSBuaWwsCgogICAgX2RyYWdnaW5nID0gZmFsc2UsCiAgICBfZHJhZ19zdGFydCA9IG5pbCwKICAgIF9jb250YWluZXJfcG9zaXRpb24gPSBuaWwKfQpMaWJyYXJ5Ll9faW5kZXggPSBMaWJyYXJ5CgoKZnVuY3Rpb24gTGlicmFyeS5uZXcoKQogICAgbG9jYWwgc2VsZiA9IHNldG1ldGF0YWJsZSh7CiAgICAgICAgX2xvYWRlZCA9IGZhbHNlLAogICAgICAgIF90YWIgPSAwLAogICAgfSwgTGlicmFyeSkKICAgIAogICAgc2VsZjpjcmVhdGVfdWkoKQoKICAgIHJldHVybiBzZWxmCmVuZAoKCmxvY2FsIE5vdGlmaWNhdGlvbkNvbnRhaW5lciA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQpOb3RpZmljYXRpb25Db250YWluZXIuTmFtZSA9ICJSb2Jsb3hDb3JlR3VpcyIKTm90aWZpY2F0aW9uQ29udGFpbmVyLlNpemUgPSBVRGltMi5uZXcoMCwgMzAwLCAwLCAwKSAgCk5vdGlmaWNhdGlvbkNvbnRhaW5lci5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjgsIDAsIDAsIDEwKSAgCk5vdGlmaWNhdGlvbkNvbnRhaW5lci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQpOb3RpZmljYXRpb25Db250YWluZXIuQ2xpcHNEZXNjZW5kYW50cyA9IGZhbHNlOwpOb3RpZmljYXRpb25Db250YWluZXIuUGFyZW50ID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuUm9ibG94R3VpOkZpbmRGaXJzdENoaWxkKCJSb2Jsb3hDb3JlR3VpcyIpIG9yIEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIiwgZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuUm9ibG94R3VpKQpOb3RpZmljYXRpb25Db250YWluZXIuQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZCgoKbG9jYWwgVUlMaXN0TGF5b3V0ID0gSW5zdGFuY2UubmV3KCJVSUxpc3RMYXlvdXQiKQpVSUxpc3RMYXlvdXQuRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5WZXJ0aWNhbApVSUxpc3RMYXlvdXQuU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKVUlMaXN0TGF5b3V0LlBhZGRpbmcgPSBVRGltLm5ldygwLCAxMCkKVUlMaXN0TGF5b3V0LlBhcmVudCA9IE5vdGlmaWNhdGlvbkNvbnRhaW5lcgoKCmZ1bmN0aW9uIExpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbihzZXR0aW5ncykKICAKICAgIGxvY2FsIE5vdGlmaWNhdGlvbiA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgTm90aWZpY2F0aW9uLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMCwgNjApICAKICAgIE5vdGlmaWNhdGlvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSAgCiAgICBOb3RpZmljYXRpb24uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgTm90aWZpY2F0aW9uLk5hbWUgPSAiTm90aWZpY2F0aW9uIgogICAgTm90aWZpY2F0aW9uLlBhcmVudCA9IE5vdGlmaWNhdGlvbkNvbnRhaW5lciAgCiAgICBOb3RpZmljYXRpb24uQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZICAKCiAgIAogICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIikKICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDQpCiAgICBVSUNvcm5lci5QYXJlbnQgPSBOb3RpZmljYXRpb24KCiAgIAogICAgbG9jYWwgSW5uZXJGcmFtZSA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgSW5uZXJGcmFtZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDAsIDYwKSAgCiAgICBJbm5lckZyYW1lLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDApICAKICAgIElubmVyRnJhbWUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICBJbm5lckZyYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjMKICAgIElubmVyRnJhbWUuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgSW5uZXJGcmFtZS5OYW1lID0gIklubmVyRnJhbWUiCiAgICBJbm5lckZyYW1lLlBhcmVudCA9IE5vdGlmaWNhdGlvbgogICAgSW5uZXJGcmFtZS5BdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlkgIAoKICAgIAogICAgbG9jYWwgSW5uZXJVSUNvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQogICAgSW5uZXJVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA0KQogICAgSW5uZXJVSUNvcm5lci5QYXJlbnQgPSBJbm5lckZyYW1lCgogICAKICAgIGxvY2FsIFRpdGxlID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQogICAgVGl0bGUuVGV4dCA9IHNldHRpbmdzLnRpdGxlIG9yICJOb3RpZmljYXRpb24gVGl0bGUiCiAgICBUaXRsZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgIFRpdGxlLkZvbnRGYWNlID0gRm9udC5uZXcoJ3JieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvR290aGFtU1NtLmpzb24nLCBFbnVtLkZvbnRXZWlnaHQuU2VtaUJvbGQsIEVudW0uRm9udFN0eWxlLk5vcm1hbCkKICAgIFRpdGxlLlRleHRTaXplID0gMTQKICAgIFRpdGxlLlNpemUgPSBVRGltMi5uZXcoMSwgLTEwLCAwLCAyMCkgIAogICAgVGl0bGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgNSwgMCwgNSkKICAgIFRpdGxlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICBUaXRsZS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgVGl0bGUuVGV4dFlBbGlnbm1lbnQgPSBFbnVtLlRleHRZQWxpZ25tZW50LkNlbnRlcgogICAgVGl0bGUuVGV4dFdyYXBwZWQgPSB0cnVlCiAgICBUaXRsZS5BdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlkgCiAgICBUaXRsZS5QYXJlbnQgPSBJbm5lckZyYW1lCgogICAgCiAgICBsb2NhbCBCb2R5ID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQogICAgQm9keS5UZXh0ID0gc2V0dGluZ3MudGV4dCBvciAiVGhpcyBpcyB0aGUgYm9keSBvZiB0aGUgbm90aWZpY2F0aW9uLiIKICAgIEJvZHkuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICBCb2R5LkZvbnRGYWNlID0gRm9udC5uZXcoJ3JieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvR290aGFtU1NtLmpzb24nLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgQm9keS5UZXh0U2l6ZSA9IDEyCiAgICBCb2R5LlNpemUgPSBVRGltMi5uZXcoMSwgLTEwLCAwLCAzMCkgCiAgICBCb2R5LlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDUsIDAsIDI1KQogICAgQm9keS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgQm9keS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgQm9keS5UZXh0WUFsaWdubWVudCA9IEVudW0uVGV4dFlBbGlnbm1lbnQuVG9wCiAgICBCb2R5LlRleHRXcmFwcGVkID0gdHJ1ZSAgCiAgICBCb2R5LkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWSAgCiAgICBCb2R5LlBhcmVudCA9IElubmVyRnJhbWUKCiAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2FpdCgwLjEpIAogICAgICAgIAogICAgICAgIGxvY2FsIHRvdGFsSGVpZ2h0ID0gVGl0bGUuVGV4dEJvdW5kcy5ZICsgQm9keS5UZXh0Qm91bmRzLlkgKyAxMCAgCiAgICAgICAgSW5uZXJGcmFtZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDAsIHRvdGFsSGVpZ2h0KSAgCiAgICBlbmQpCgogICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgCiAgICAgICAgbG9jYWwgdHdlZW5JbiA9IFR3ZWVuU2VydmljZTpDcmVhdGUoSW5uZXJGcmFtZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMCwgMTAgKyBOb3RpZmljYXRpb25Db250YWluZXIuU2l6ZS5ZLk9mZnNldCkKICAgICAgICB9KQogICAgICAgIHR3ZWVuSW46UGxheSgpCgogICAgICAgIAogICAgICAgIGxvY2FsIGR1cmF0aW9uID0gc2V0dGluZ3MuZHVyYXRpb24gb3IgNSAgCiAgICAgICAgd2FpdChkdXJhdGlvbikKCiAgICAgICAgCiAgICAgICAgbG9jYWwgdHdlZW5PdXQgPSBUd2VlblNlcnZpY2U6Q3JlYXRlKElubmVyRnJhbWUsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5JbiksIHsKICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgMzEwLCAwLCAxMCArIE5vdGlmaWNhdGlvbkNvbnRhaW5lci5TaXplLlkuT2Zmc2V0KSAKICAgICAgICB9KQogICAgICAgIHR3ZWVuT3V0OlBsYXkoKQoKICAgICAgICAKICAgICAgICB0d2Vlbk91dC5Db21wbGV0ZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIE5vdGlmaWNhdGlvbjpEZXN0cm95KCkKICAgICAgICBlbmQpCiAgICBlbmQpCmVuZAoKZnVuY3Rpb24gTGlicmFyeTpnZXRfc2NyZWVuX3NjYWxlKCkKICAgIGxvY2FsIHZpZXdwb3J0X3NpemVfeCA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLlZpZXdwb3J0U2l6ZS5YCgogICAgc2VsZi5fdWlfc2NhbGUgPSB2aWV3cG9ydF9zaXplX3ggLyAxNDAwCmVuZAoKCmZ1bmN0aW9uIExpYnJhcnk6Z2V0X2RldmljZSgpCiAgICBsb2NhbCBkZXZpY2UgPSAnVW5rbm93bicKCiAgICBpZiBub3QgVXNlcklucHV0U2VydmljZS5Ub3VjaEVuYWJsZWQgYW5kIFVzZXJJbnB1dFNlcnZpY2UuS2V5Ym9hcmRFbmFibGVkIGFuZCBVc2VySW5wdXRTZXJ2aWNlLk1vdXNlRW5hYmxlZCB0aGVuCiAgICAgICAgZGV2aWNlID0gJ1BDJwogICAgZWxzZWlmIFVzZXJJbnB1dFNlcnZpY2UuVG91Y2hFbmFibGVkIHRoZW4KICAgICAgICBkZXZpY2UgPSAnTW9iaWxlJwogICAgZWxzZWlmIFVzZXJJbnB1dFNlcnZpY2UuR2FtZXBhZEVuYWJsZWQgdGhlbgogICAgICAgIGRldmljZSA9ICdDb25zb2xlJwogICAgZW5kCgogICAgc2VsZi5fZGV2aWNlID0gZGV2aWNlCmVuZAoKCmZ1bmN0aW9uIExpYnJhcnk6cmVtb3ZlZChhY3Rpb246IGFueSkKICAgIHNlbGYuX3VpLkFuY2VzdHJ5Q2hhbmdlZDpPbmNlKGFjdGlvbikKZW5kCgoKZnVuY3Rpb24gTGlicmFyeTpmbGFnX3R5cGUoZmxhZzogYW55LCBmbGFnX3R5cGU6IGFueSkKICAgIGlmIG5vdCBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW2ZsYWddIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIHJldHVybiB0eXBlb2YoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tmbGFnXSkgPT0gZmxhZ190eXBlCmVuZAoKCmZ1bmN0aW9uIExpYnJhcnk6cmVtb3ZlX3RhYmxlX3ZhbHVlKF9fdGFibGU6IGFueSwgdGFibGVfdmFsdWU6IHN0cmluZykKICAgIGZvciBpbmRleCwgdmFsdWUgaW4gX190YWJsZSBkbwogICAgICAgIGlmIHZhbHVlIH49IHRhYmxlX3ZhbHVlIHRoZW4KICAgICAgICAgICAgY29udGludWUKICAgICAgICBlbmQKCiAgICAgICAgdGFibGUucmVtb3ZlKF9fdGFibGUsIGluZGV4KQogICAgZW5kCmVuZAoKCmZ1bmN0aW9uIExpYnJhcnk6Y3JlYXRlX3VpKCkKICAgIGxvY2FsIG9sZF9CYWxscyA9IENvcmVHdWk6RmluZEZpcnN0Q2hpbGQoJ0JhbGxzJykKCiAgICBpZiBvbGRfQmFsbHMgdGhlbgogICAgICAgIERlYnJpczpBZGRJdGVtKG9sZF9CYWxscywgMCkKICAgIGVuZAoKICAgIGxvY2FsIEJhbGxzID0gSW5zdGFuY2UubmV3KCdTY3JlZW5HdWknKQogICAgQmFsbHMuUmVzZXRPblNwYXduID0gZmFsc2UKICAgIEJhbGxzLk5hbWUgPSAnQmFsbHMnCiAgICBCYWxscy5aSW5kZXhCZWhhdmlvciA9IEVudW0uWkluZGV4QmVoYXZpb3IuU2libGluZwogICAgQmFsbHMuUGFyZW50ID0gQ29yZUd1aQogICAgCiAgICBsb2NhbCBDb250YWluZXIgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgIENvbnRhaW5lci5DbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZQogICAgQ29udGFpbmVyLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICBDb250YWluZXIuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDAuNSkKICAgIENvbnRhaW5lci5OYW1lID0gJ0NvbnRhaW5lcicKICAgIENvbnRhaW5lci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC40CiAgICBDb250YWluZXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICBDb250YWluZXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLjUsIDApCiAgICBDb250YWluZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCAwLCAwLCAwKQogICAgQ29udGFpbmVyLkFjdGl2ZSA9IHRydWUKICAgIENvbnRhaW5lci5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBDb250YWluZXIuUGFyZW50ID0gQmFsbHMKICAgIAogICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDEwKQogICAgVUlDb3JuZXIuUGFyZW50ID0gQ29udGFpbmVyCiAgICAKICAgIGxvY2FsIFVJU3Ryb2tlID0gSW5zdGFuY2UubmV3KCdVSVN0cm9rZScpCiAgICBVSVN0cm9rZS5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICBVSVN0cm9rZS5UcmFuc3BhcmVuY3kgPSAwLjUKICAgIFVJU3Ryb2tlLkFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgVUlTdHJva2UuUGFyZW50ID0gQ29udGFpbmVyCiAgICAKICAgIGxvY2FsIEhhbmRsZXIgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgIEhhbmRsZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgIEhhbmRsZXIuTmFtZSA9ICdIYW5kbGVyJwogICAgSGFuZGxlci5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgSGFuZGxlci5TaXplID0gVURpbTIubmV3KDAsIDY5OCwgMCwgNDc5KQogICAgSGFuZGxlci5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBIYW5kbGVyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgSGFuZGxlci5QYXJlbnQgPSBDb250YWluZXIKICAgIAogICAgbG9jYWwgVGFicyA9IEluc3RhbmNlLm5ldygnU2Nyb2xsaW5nRnJhbWUnKQogICAgVGFicy5TY3JvbGxCYXJJbWFnZVRyYW5zcGFyZW5jeSA9IDEKICAgIFRhYnMuU2Nyb2xsQmFyVGhpY2tuZXNzID0gMAogICAgVGFicy5OYW1lID0gJ1RhYnMnCiAgICBUYWJzLlNpemUgPSBVRGltMi5uZXcoMCwgMTI5LCAwLCA0MDEpCiAgICBUYWJzLlNlbGVjdGFibGUgPSBmYWxzZQogICAgVGFicy5BdXRvbWF0aWNDYW52YXNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZCiAgICBUYWJzLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICBUYWJzLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMDI2MDk3MjcxNTkxNDI0OTQyLCAwLCAwLjExMTExMTExMTkzODk1MzQsIDApCiAgICBUYWJzLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICBUYWJzLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgVGFicy5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBUYWJzLkNhbnZhc1NpemUgPSBVRGltMi5uZXcoMCwgMCwgMC41LCAwKQogICAgVGFicy5QYXJlbnQgPSBIYW5kbGVyCiAgICAKICAgIGxvY2FsIFVJTGlzdExheW91dCA9IEluc3RhbmNlLm5ldygnVUlMaXN0TGF5b3V0JykKICAgIFVJTGlzdExheW91dC5QYWRkaW5nID0gVURpbS5uZXcoMCwgNCkKICAgIFVJTGlzdExheW91dC5Tb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgVUlMaXN0TGF5b3V0LlBhcmVudCA9IFRhYnMKICAgIAogICAgbG9jYWwgQ2xpZW50TmFtZSA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgIENsaWVudE5hbWUuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgQ2xpZW50TmFtZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxNTAsIDE1MCkKICAgIENsaWVudE5hbWUuVGV4dFRyYW5zcGFyZW5jeSA9IDAuMjAwMDAwMDAyOTgwMjMyMjQKICAgIENsaWVudE5hbWUuVGV4dCA9ICdCYWxscy5sb2wnCiAgICBDbGllbnROYW1lLk5hbWUgPSAnQ2xpZW50TmFtZScKICAgIENsaWVudE5hbWUuU2l6ZSA9IFVEaW0yLm5ldygwLCAzMSwgMCwgMTMpCiAgICBDbGllbnROYW1lLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgQ2xpZW50TmFtZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjA1NjAwMDAwMTcyODUzNDcsIDAsIDAuMDU0OTk5OTk5NzAxOTc2Nzc2LCAwKQogICAgQ2xpZW50TmFtZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgQ2xpZW50TmFtZS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgQ2xpZW50TmFtZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBDbGllbnROYW1lLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICBDbGllbnROYW1lLlRleHRTaXplID0gMTMKICAgIENsaWVudE5hbWUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICBDbGllbnROYW1lLlBhcmVudCA9IEhhbmRsZXIKICAgIAogICAgbG9jYWwgVUlHcmFkaWVudCA9IEluc3RhbmNlLm5ldygnVUlHcmFkaWVudCcpCiAgICBVSUdyYWRpZW50LkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7CiAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKSksCiAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKSkKICAgIH0KICAgIFVJR3JhZGllbnQuUGFyZW50ID0gQ2xpZW50TmFtZQogICAgCiAgICBsb2NhbCBQaW4gPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgIFBpbi5OYW1lID0gJ1BpbicKICAgIFBpbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjAyNjAwMDAwMDUzNjQ0MTgwMywgMCwgMC4xMzYwMDAwMDczOTA5NzU5NSwgMCkKICAgIFBpbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgUGluLlNpemUgPSBVRGltMi5uZXcoMCwgMiwgMCwgMTYpCiAgICBQaW4uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgUGluLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQogICAgUGluLlBhcmVudCA9IEhhbmRsZXIKICAgIAogICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDEsIDApCiAgICBVSUNvcm5lci5QYXJlbnQgPSBQaW4KICAgIAogICAgbG9jYWwgSWNvbiA9IEluc3RhbmNlLm5ldygnSW1hZ2VMYWJlbCcpCiAgICBJY29uLkltYWdlQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgIEljb24uU2NhbGVUeXBlID0gRW51bS5TY2FsZVR5cGUuRml0CiAgICBJY29uLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICBJY29uLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgSWNvbi5JbWFnZSA9ICdyYnhhc3NldGlkOi8vOTc0MDUyMjk0OTgxOTEnCiAgICBJY29uLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICBJY29uLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMDIxLCAwLDAuMDUzLCAwKQogICAgSWNvbi5OYW1lID0gJ0ljb24nCiAgICBJY29uLlNpemUgPSBVRGltMi5uZXcoMCwgMjcsMCwgMjYpCiAgICBJY29uLkJvcmRlclNpemVQaXhlbCA9IDAKICAgIEljb24uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICBJY29uLlBhcmVudCA9IEhhbmRsZXIKICAgIAogICAgbG9jYWwgRGl2aWRlciA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgRGl2aWRlci5OYW1lID0gJ0RpdmlkZXInCiAgICBEaXZpZGVyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjUKICAgIERpdmlkZXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4yMzQ5OTk5OTk0MDM5NTM1NSwgMCwgMCwgMCkKICAgIERpdmlkZXIuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgIERpdmlkZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCAxLCAwLCA0NzkpCiAgICBEaXZpZGVyLkJvcmRlclNpemVQaXhlbCA9IDAKICAgIERpdmlkZXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICBEaXZpZGVyLlBhcmVudCA9IEhhbmRsZXIKICAgIAogICAgbG9jYWwgU2VjdGlvbnMgPSBJbnN0YW5jZS5uZXcoJ0ZvbGRlcicpCiAgICBTZWN0aW9ucy5OYW1lID0gJ1NlY3Rpb25zJwogICAgU2VjdGlvbnMuUGFyZW50ID0gSGFuZGxlcgogICAgCiAgICBsb2NhbCBNaW5pbWl6ZSA9IEluc3RhbmNlLm5ldygnVGV4dEJ1dHRvbicpCiAgICBNaW5pbWl6ZS5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL1NvdXJjZVNhbnNQcm8uanNvbicsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICBNaW5pbWl6ZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgIE1pbmltaXplLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICBNaW5pbWl6ZS5UZXh0ID0gJycKICAgIE1pbmltaXplLkF1dG9CdXR0b25Db2xvciA9IGZhbHNlCiAgICBNaW5pbWl6ZS5OYW1lID0gJ01pbmltaXplJwogICAgTWluaW1pemUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgIE1pbmltaXplLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMDIwMDU3MzA1NjkzNjI2NDA0LCAwLCAwLjAyOTIyNzU1NjY2MDc3MTM3LCAwKQogICAgTWluaW1pemUuU2l6ZSA9IFVEaW0yLm5ldygwLCAyNCwgMCwgMjQpCiAgICBNaW5pbWl6ZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBNaW5pbWl6ZS5UZXh0U2l6ZSA9IDE0CiAgICBNaW5pbWl6ZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgIE1pbmltaXplLlBhcmVudCA9IEhhbmRsZXIKICAgIAogICAgbG9jYWwgVUlTY2FsZSA9IEluc3RhbmNlLm5ldygnVUlTY2FsZScpCiAgICBVSVNjYWxlLlBhcmVudCA9IENvbnRhaW5lciAgICAKICAgIAogICAgc2VsZi5fdWkgPSBCYWxscwoKICAgIGxvY2FsIGZ1bmN0aW9uIG9uX2RyYWcoaW5wdXQ6IElucHV0T2JqZWN0LCBwcm9jZXNzOiBib29sZWFuKQogICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSBvciBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuIAogICAgICAgICAgICBzZWxmLl9kcmFnZ2luZyA9IHRydWUKICAgICAgICAgICAgc2VsZi5fZHJhZ19zdGFydCA9IGlucHV0LlBvc2l0aW9uCiAgICAgICAgICAgIHNlbGYuX2NvbnRhaW5lcl9wb3NpdGlvbiA9IENvbnRhaW5lci5Qb3NpdGlvbgoKICAgICAgICAgICAgQ29ubmVjdGlvbnNbJ2NvbnRhaW5lcl9pbnB1dF9lbmRlZCddID0gaW5wdXQuQ2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFN0YXRlIH49IEVudW0uVXNlcklucHV0U3RhdGUuRW5kIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zOmRpc2Nvbm5lY3QoJ2NvbnRhaW5lcl9pbnB1dF9lbmRlZCcpCiAgICAgICAgICAgICAgICBzZWxmLl9kcmFnZ2luZyA9IGZhbHNlCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9kcmFnKGlucHV0OiBhbnkpCiAgICAgICAgbG9jYWwgZGVsdGEgPSBpbnB1dC5Qb3NpdGlvbiAtIHNlbGYuX2RyYWdfc3RhcnQKICAgICAgICBsb2NhbCBwb3NpdGlvbiA9IFVEaW0yLm5ldyhzZWxmLl9jb250YWluZXJfcG9zaXRpb24uWC5TY2FsZSwgc2VsZi5fY29udGFpbmVyX3Bvc2l0aW9uLlguT2Zmc2V0ICsgZGVsdGEuWCwgc2VsZi5fY29udGFpbmVyX3Bvc2l0aW9uLlkuU2NhbGUsIHNlbGYuX2NvbnRhaW5lcl9wb3NpdGlvbi5ZLk9mZnNldCArIGRlbHRhLlkpCgogICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQ29udGFpbmVyLCBUd2VlbkluZm8ubmV3KDAuMiksIHsKICAgICAgICAgICAgUG9zaXRpb24gPSBwb3NpdGlvbgogICAgICAgIH0pOlBsYXkoKQogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gZHJhZyhpbnB1dDogSW5wdXRPYmplY3QsIHByb2Nlc3M6IGJvb2xlYW4pCiAgICAgICAgaWYgbm90IHNlbGYuX2RyYWdnaW5nIHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlTW92ZW1lbnQgb3IgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICB1cGRhdGVfZHJhZyhpbnB1dCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIENvbm5lY3Rpb25zWydjb250YWluZXJfaW5wdXRfYmVnYW4nXSA9IENvbnRhaW5lci5JbnB1dEJlZ2FuOkNvbm5lY3Qob25fZHJhZykKICAgIENvbm5lY3Rpb25zWydpbnB1dF9jaGFuZ2VkJ10gPSBVc2VySW5wdXRTZXJ2aWNlLklucHV0Q2hhbmdlZDpDb25uZWN0KGRyYWcpCgogICAgc2VsZjpyZW1vdmVkKGZ1bmN0aW9uKCkKICAgICAgICBzZWxmLl91aSA9IG5pbAogICAgICAgIENvbm5lY3Rpb25zOmRpc2Nvbm5lY3RfYWxsKCkKICAgIGVuZCkKCiAgICBmdW5jdGlvbiBzZWxmOlVwZGF0ZTFSdW4oYSkKICAgICAgICBpZiBhID09ICJuaWwiIHRoZW4KICAgICAgICAgICAgQ29udGFpbmVyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjQ7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBDb250YWluZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IHRvbnVtYmVyKGEpOwogICAgICAgICAgICBlbmQpOwogICAgICAgIGVuZDsKICAgIGVuZDsKCiAgICBmdW5jdGlvbiBzZWxmOlVJVmlzaWJsaXR5KCkKICAgICAgICBCYWxscy5FbmFibGVkID0gbm90IEJhbGxzLkVuYWJsZWQ7CiAgICBlbmQ7CgogICAgZnVuY3Rpb24gc2VsZjpjaGFuZ2VfdmlzaWJsaXR5KHN0YXRlOiBib29sZWFuKQogICAgICAgIGlmIHN0YXRlIHRoZW4KICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShDb250YWluZXIsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCg2OTgsIDQ3OSkKICAgICAgICAgICAgfSk6UGxheSgpCiAgICAgICAgZWxzZQogICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKENvbnRhaW5lciwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDEwNC41LCA1MikKICAgICAgICAgICAgfSk6UGxheSgpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAoKICAgIGZ1bmN0aW9uIHNlbGY6bG9hZCgpCiAgICAgICAgbG9jYWwgY29udGVudCA9IHt9CiAgICAKICAgICAgICBmb3IgXywgb2JqZWN0IGluIEJhbGxzOkdldERlc2NlbmRhbnRzKCkgZG8KICAgICAgICAgICAgaWYgbm90IG9iamVjdDpJc0EoJ0ltYWdlTGFiZWwnKSB0aGVuCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICB0YWJsZS5pbnNlcnQoY29udGVudCwgb2JqZWN0KQogICAgICAgIGVuZAogICAgCiAgICAgICAgQ29udGVudFByb3ZpZGVyOlByZWxvYWRBc3luYyhjb250ZW50KQogICAgICAgIHNlbGY6Z2V0X2RldmljZSgpCgogICAgICAgIGlmIHNlbGYuX2RldmljZSA9PSAnTW9iaWxlJyBvciBzZWxmLl9kZXZpY2UgPT0gJ1Vua25vd24nIHRoZW4KICAgICAgICAgICAgc2VsZjpnZXRfc2NyZWVuX3NjYWxlKCkKICAgICAgICAgICAgVUlTY2FsZS5TY2FsZSA9IHNlbGYuX3VpX3NjYWxlCiAgICAKICAgICAgICAgICAgQ29ubmVjdGlvbnNbJ3VpX3NjYWxlJ10gPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYTpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoJ1ZpZXdwb3J0U2l6ZScpOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgc2VsZjpnZXRfc2NyZWVuX3NjYWxlKCkKICAgICAgICAgICAgICAgIFVJU2NhbGUuU2NhbGUgPSBzZWxmLl91aV9zY2FsZQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICAKICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKENvbnRhaW5lciwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoNjk4LCA0NzkpCiAgICAgICAgfSk6UGxheSgpCgogICAgICAgIEFjcnlsaWNCbHVyLm5ldyhDb250YWluZXIpCiAgICAgICAgc2VsZi5fdWlfbG9hZGVkID0gdHJ1ZQogICAgZW5kCgogICAgZnVuY3Rpb24gc2VsZjp1cGRhdGVfdGFicyh0YWI6IFRleHRCdXR0b24pCiAgICAgICAgZm9yIGluZGV4LCBvYmplY3QgaW4gVGFiczpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgIGlmIG9iamVjdC5OYW1lIH49ICdUYWInIHRoZW4KICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgb2JqZWN0ID09IHRhYiB0aGVuCiAgICAgICAgICAgICAgICBpZiBvYmplY3QuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSB+PSAwLjUgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IG9iamVjdC5MYXlvdXRPcmRlciAqICgwLjExMyAvIDEuMykKCiAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShQaW4sIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTIuZnJvbVNjYWxlKDAuMDI2LCAwLjEzNSArIG9mZnNldCkKICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkgICAgCgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUob2JqZWN0LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUob2JqZWN0LlRleHRMYWJlbCwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFRyYW5zcGFyZW5jeSA9IDAuMiwKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUob2JqZWN0LlRleHRMYWJlbC5VSUdyYWRpZW50LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBPZmZzZXQgPSBWZWN0b3IyLm5ldygxLCAwKQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQoKICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKG9iamVjdC5JY29uLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBJbWFnZVRyYW5zcGFyZW5jeSA9IDAuMiwKICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBvYmplY3QuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSB+PSAxIHRoZW4KICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUob2JqZWN0LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShvYmplY3QuVGV4dExhYmVsLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgIFRleHRUcmFuc3BhcmVuY3kgPSAwLjcsCiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKG9iamVjdC5UZXh0TGFiZWwuVUlHcmFkaWVudCwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICBPZmZzZXQgPSBWZWN0b3IyLm5ldygwLCAwKQogICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShvYmplY3QuSWNvbiwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICBJbWFnZVRyYW5zcGFyZW5jeSA9IDAuOCwKICAgICAgICAgICAgICAgICAgICBJbWFnZUNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmdW5jdGlvbiBzZWxmOnVwZGF0ZV9zZWN0aW9ucyhsZWZ0X3NlY3Rpb246IFNjcm9sbGluZ0ZyYW1lLCByaWdodF9zZWN0aW9uOiBTY3JvbGxpbmdGcmFtZSkKICAgICAgICBmb3IgXywgb2JqZWN0IGluIFNlY3Rpb25zOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgaWYgb2JqZWN0ID09IGxlZnRfc2VjdGlvbiBvciBvYmplY3QgPT0gcmlnaHRfc2VjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBvYmplY3QuVmlzaWJsZSA9IHRydWUKCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIG9iamVjdC5WaXNpYmxlID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHNlbGY6Y3JlYXRlX3RhYih0aXRsZTogc3RyaW5nLCBpY29uOiBzdHJpbmcpCiAgICAgICAgbG9jYWwgVGFiTWFuYWdlciA9IHt9CgogICAgICAgIGxvY2FsIExheW91dE9yZGVyID0gMDsKCiAgICAgICAgbG9jYWwgZm9udF9wYXJhbXMgPSBJbnN0YW5jZS5uZXcoJ0dldFRleHRCb3VuZHNQYXJhbXMnKQogICAgICAgIGZvbnRfcGFyYW1zLlRleHQgPSB0aXRsZQogICAgICAgIGZvbnRfcGFyYW1zLkZvbnQgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgIGZvbnRfcGFyYW1zLlNpemUgPSAxMwogICAgICAgIGZvbnRfcGFyYW1zLldpZHRoID0gMTAwMDAKCiAgICAgICAgbG9jYWwgZm9udF9zaXplID0gVGV4dFNlcnZpY2U6R2V0VGV4dEJvdW5kc0FzeW5jKGZvbnRfcGFyYW1zKQogICAgICAgIGxvY2FsIGZpcnN0X3RhYiA9IG5vdCBUYWJzOkZpbmRGaXJzdENoaWxkKCdUYWInKQoKICAgICAgICBsb2NhbCBUYWIgPSBJbnN0YW5jZS5uZXcoJ1RleHRCdXR0b24nKQogICAgICAgIFRhYi5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL1NvdXJjZVNhbnNQcm8uanNvbicsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgVGFiLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgIFRhYi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgIFRhYi5UZXh0ID0gJycKICAgICAgICBUYWIuQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UKICAgICAgICBUYWIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICBUYWIuTmFtZSA9ICdUYWInCiAgICAgICAgVGFiLlNpemUgPSBVRGltMi5uZXcoMCwgMTI5LCAwLCAzOCkKICAgICAgICBUYWIuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgIFRhYi5UZXh0U2l6ZSA9IDE0CiAgICAgICAgVGFiLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgIFRhYi5QYXJlbnQgPSBUYWJzCiAgICAgICAgVGFiLkxheW91dE9yZGVyID0gc2VsZi5fdGFiCiAgICAgICAgCiAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA1KQogICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IFRhYgogICAgICAgIAogICAgICAgIGxvY2FsIFRleHRMYWJlbCA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgICAgICBUZXh0TGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgIFRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICBUZXh0TGFiZWwuVGV4dFRyYW5zcGFyZW5jeSA9IDAuNyAKICAgICAgICBUZXh0TGFiZWwuVGV4dCA9IHRpdGxlCiAgICAgICAgVGV4dExhYmVsLlNpemUgPSBVRGltMi5uZXcoMCwgZm9udF9zaXplLlgsIDAsIDE2KQogICAgICAgIFRleHRMYWJlbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICBUZXh0TGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4yNDAwMDAxNzM0NDk1MTYzLCAwLCAwLjUsIDApCiAgICAgICAgVGV4dExhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgVGV4dExhYmVsLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgVGV4dExhYmVsLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICBUZXh0TGFiZWwuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICBUZXh0TGFiZWwuVGV4dFNpemUgPSAxMwogICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICBUZXh0TGFiZWwuUGFyZW50ID0gVGFiCiAgICAgICAgCiAgICAgICAgbG9jYWwgVUlHcmFkaWVudCA9IEluc3RhbmNlLm5ldygnVUlHcmFkaWVudCcpCiAgICAgICAgVUlHcmFkaWVudC5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3ewogICAgICAgICAgICBDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApKSwKICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLjcsIENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApKSwKICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKSkKICAgICAgICB9CiAgICAgICAgVUlHcmFkaWVudC5QYXJlbnQgPSBUZXh0TGFiZWwKICAgICAgICAKICAgICAgICBsb2NhbCBJY29uID0gSW5zdGFuY2UubmV3KCdJbWFnZUxhYmVsJykKICAgICAgICBJY29uLlNjYWxlVHlwZSA9IEVudW0uU2NhbGVUeXBlLkZpdAogICAgICAgIEljb24uSW1hZ2VUcmFuc3BhcmVuY3kgPSAwLjgwMDAwMDAxMTkyMDkyOQogICAgICAgIEljb24uQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICBJY29uLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgIEljb24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICBJY29uLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMTAwMDAwMDAxNDkwMTE2MTIsIDAsIDAuNSwgMCkKICAgICAgICBJY29uLk5hbWUgPSAnSWNvbicKICAgICAgICBJY29uLkltYWdlID0gaWNvbgogICAgICAgIEljb24uU2l6ZSA9IFVEaW0yLm5ldygwLCAxMiwgMCwgMTIpCiAgICAgICAgSWNvbi5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgSWNvbi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICBJY29uLlBhcmVudCA9IFRhYgoKICAgICAgICBsb2NhbCBMZWZ0U2VjdGlvbiA9IEluc3RhbmNlLm5ldygnU2Nyb2xsaW5nRnJhbWUnKQogICAgICAgIExlZnRTZWN0aW9uLk5hbWUgPSAnTGVmdFNlY3Rpb24nCiAgICAgICAgTGVmdFNlY3Rpb24uQXV0b21hdGljQ2FudmFzU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWQogICAgICAgIExlZnRTZWN0aW9uLlNjcm9sbEJhclRoaWNrbmVzcyA9IDAKICAgICAgICBMZWZ0U2VjdGlvbi5TaXplID0gVURpbTIubmV3KDAsIDI0MywgMCwgNDQ1KQogICAgICAgIExlZnRTZWN0aW9uLlNlbGVjdGFibGUgPSBmYWxzZQogICAgICAgIExlZnRTZWN0aW9uLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgIExlZnRTZWN0aW9uLlNjcm9sbEJhckltYWdlVHJhbnNwYXJlbmN5ID0gMQogICAgICAgIExlZnRTZWN0aW9uLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgTGVmdFNlY3Rpb24uUG9zaXRpb24gPSBVRGltMi5uZXcoMC4yNTk0MzI2NDM2NTE5NjIzLCAwLCAwLjUsIDApCiAgICAgICAgTGVmdFNlY3Rpb24uQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICBMZWZ0U2VjdGlvbi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICBMZWZ0U2VjdGlvbi5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgTGVmdFNlY3Rpb24uQ2FudmFzU2l6ZSA9IFVEaW0yLm5ldygwLCAwLCAwLjUsIDApCiAgICAgICAgTGVmdFNlY3Rpb24uVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgTGVmdFNlY3Rpb24uUGFyZW50ID0gU2VjdGlvbnMKICAgICAgICAKICAgICAgICBsb2NhbCBVSUxpc3RMYXlvdXQgPSBJbnN0YW5jZS5uZXcoJ1VJTGlzdExheW91dCcpCiAgICAgICAgVUlMaXN0TGF5b3V0LlBhZGRpbmcgPSBVRGltLm5ldygwLCAxMSkKICAgICAgICBVSUxpc3RMYXlvdXQuSG9yaXpvbnRhbEFsaWdubWVudCA9IEVudW0uSG9yaXpvbnRhbEFsaWdubWVudC5DZW50ZXIKICAgICAgICBVSUxpc3RMYXlvdXQuU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICBVSUxpc3RMYXlvdXQuUGFyZW50ID0gTGVmdFNlY3Rpb24KICAgICAgICAKICAgICAgICBsb2NhbCBVSVBhZGRpbmcgPSBJbnN0YW5jZS5uZXcoJ1VJUGFkZGluZycpCiAgICAgICAgVUlQYWRkaW5nLlBhZGRpbmdUb3AgPSBVRGltLm5ldygwLCAxKQogICAgICAgIFVJUGFkZGluZy5QYXJlbnQgPSBMZWZ0U2VjdGlvbgoKICAgICAgICBsb2NhbCBSaWdodFNlY3Rpb24gPSBJbnN0YW5jZS5uZXcoJ1Njcm9sbGluZ0ZyYW1lJykKICAgICAgICBSaWdodFNlY3Rpb24uTmFtZSA9ICdSaWdodFNlY3Rpb24nCiAgICAgICAgUmlnaHRTZWN0aW9uLkF1dG9tYXRpY0NhbnZhc1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFkKICAgICAgICBSaWdodFNlY3Rpb24uU2Nyb2xsQmFyVGhpY2tuZXNzID0gMAogICAgICAgIFJpZ2h0U2VjdGlvbi5TaXplID0gVURpbTIubmV3KDAsIDI0MywgMCwgNDQ1KQogICAgICAgIFJpZ2h0U2VjdGlvbi5TZWxlY3RhYmxlID0gZmFsc2UKICAgICAgICBSaWdodFNlY3Rpb24uQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLCAwLjUpCiAgICAgICAgUmlnaHRTZWN0aW9uLlNjcm9sbEJhckltYWdlVHJhbnNwYXJlbmN5ID0gMQogICAgICAgIFJpZ2h0U2VjdGlvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgIFJpZ2h0U2VjdGlvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjYyOTAwMDAwODEwNjIzMTcsIDAsIDAuNSwgMCkKICAgICAgICBSaWdodFNlY3Rpb24uQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICBSaWdodFNlY3Rpb24uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgUmlnaHRTZWN0aW9uLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICBSaWdodFNlY3Rpb24uQ2FudmFzU2l6ZSA9IFVEaW0yLm5ldygwLCAwLCAwLjUsIDApCiAgICAgICAgUmlnaHRTZWN0aW9uLlZpc2libGUgPSBmYWxzZQogICAgICAgIFJpZ2h0U2VjdGlvbi5QYXJlbnQgPSBTZWN0aW9ucwogICAgICAgIAogICAgICAgIGxvY2FsIFVJTGlzdExheW91dCA9IEluc3RhbmNlLm5ldygnVUlMaXN0TGF5b3V0JykKICAgICAgICBVSUxpc3RMYXlvdXQuUGFkZGluZyA9IFVEaW0ubmV3KDAsIDExKQogICAgICAgIFVJTGlzdExheW91dC5Ib3Jpem9udGFsQWxpZ25tZW50ID0gRW51bS5Ib3Jpem9udGFsQWxpZ25tZW50LkNlbnRlcgogICAgICAgIFVJTGlzdExheW91dC5Tb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgIFVJTGlzdExheW91dC5QYXJlbnQgPSBSaWdodFNlY3Rpb24KICAgICAgICAKICAgICAgICBsb2NhbCBVSVBhZGRpbmcgPSBJbnN0YW5jZS5uZXcoJ1VJUGFkZGluZycpCiAgICAgICAgVUlQYWRkaW5nLlBhZGRpbmdUb3AgPSBVRGltLm5ldygwLCAxKQogICAgICAgIFVJUGFkZGluZy5QYXJlbnQgPSBSaWdodFNlY3Rpb24KCiAgICAgICAgc2VsZi5fdGFiICs9IDEKCiAgICAgICAgaWYgZmlyc3RfdGFiIHRoZW4KICAgICAgICAgICAgc2VsZjp1cGRhdGVfdGFicyhUYWIsIExlZnRTZWN0aW9uLCBSaWdodFNlY3Rpb24pCiAgICAgICAgICAgIHNlbGY6dXBkYXRlX3NlY3Rpb25zKExlZnRTZWN0aW9uLCBSaWdodFNlY3Rpb24pCiAgICAgICAgZW5kCgogICAgICAgIFRhYi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgc2VsZjp1cGRhdGVfdGFicyhUYWIsIExlZnRTZWN0aW9uLCBSaWdodFNlY3Rpb24pCiAgICAgICAgICAgIHNlbGY6dXBkYXRlX3NlY3Rpb25zKExlZnRTZWN0aW9uLCBSaWdodFNlY3Rpb24pCiAgICAgICAgZW5kKQoKICAgICAgICBmdW5jdGlvbiBUYWJNYW5hZ2VyOmNyZWF0ZV9tb2R1bGUoc2V0dGluZ3M6IGFueSkKCiAgICAgICAgICAgIGxvY2FsIExheW91dE9yZGVyTW9kdWxlID0gMDsKCiAgICAgICAgICAgIGxvY2FsIE1vZHVsZU1hbmFnZXIgPSB7CiAgICAgICAgICAgICAgICBfc3RhdGUgPSBmYWxzZSwKICAgICAgICAgICAgICAgIF9zaXplID0gMCwKICAgICAgICAgICAgICAgIF9tdWx0aXBsaWVyID0gMAogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiBzZXR0aW5ncy5zZWN0aW9uID09ICdyaWdodCcgdGhlbgogICAgICAgICAgICAgICAgc2V0dGluZ3Muc2VjdGlvbiA9IFJpZ2h0U2VjdGlvbgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZXR0aW5ncy5zZWN0aW9uID0gTGVmdFNlY3Rpb24KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBNb2R1bGUgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgTW9kdWxlLkNsaXBzRGVzY2VuZGFudHMgPSB0cnVlCiAgICAgICAgICAgIE1vZHVsZS5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICBNb2R1bGUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNQogICAgICAgICAgICBNb2R1bGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4wMDQxMTUyMjYyMTI4ODg5NTYsIDAsIDAsIDApCiAgICAgICAgICAgIE1vZHVsZS5OYW1lID0gJ01vZHVsZScKICAgICAgICAgICAgTW9kdWxlLlNpemUgPSBVRGltMi5uZXcoMCwgMjQxLCAwLCA5MykKICAgICAgICAgICAgTW9kdWxlLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgTW9kdWxlLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICBNb2R1bGUuUGFyZW50ID0gc2V0dGluZ3Muc2VjdGlvbgoKICAgICAgICAgICAgbG9jYWwgVUlMaXN0TGF5b3V0ID0gSW5zdGFuY2UubmV3KCdVSUxpc3RMYXlvdXQnKQogICAgICAgICAgICBVSUxpc3RMYXlvdXQuU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgVUlMaXN0TGF5b3V0LlBhcmVudCA9IE1vZHVsZQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgICAgICAgICAgVUlDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgNSkKICAgICAgICAgICAgVUlDb3JuZXIuUGFyZW50ID0gTW9kdWxlCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBVSVN0cm9rZSA9IEluc3RhbmNlLm5ldygnVUlTdHJva2UnKQogICAgICAgICAgICBVSVN0cm9rZS5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgIFVJU3Ryb2tlLlRyYW5zcGFyZW5jeSA9IDAuNQogICAgICAgICAgICBVSVN0cm9rZS5BcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgVUlTdHJva2UuUGFyZW50ID0gTW9kdWxlCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBIZWFkZXIgPSBJbnN0YW5jZS5uZXcoJ1RleHRCdXR0b24nKQogICAgICAgICAgICBIZWFkZXIuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Tb3VyY2VTYW5zUHJvLmpzb24nLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICBIZWFkZXIuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgIEhlYWRlci5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICBIZWFkZXIuVGV4dCA9ICcnCiAgICAgICAgICAgIEhlYWRlci5BdXRvQnV0dG9uQ29sb3IgPSBmYWxzZQogICAgICAgICAgICBIZWFkZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgSGVhZGVyLk5hbWUgPSAnSGVhZGVyJwogICAgICAgICAgICBIZWFkZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCAyNDEsIDAsIDkzKQogICAgICAgICAgICBIZWFkZXIuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBIZWFkZXIuVGV4dFNpemUgPSAxNAogICAgICAgICAgICBIZWFkZXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgIEhlYWRlci5QYXJlbnQgPSBNb2R1bGUKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIEljb24gPSBJbnN0YW5jZS5uZXcoJ0ltYWdlTGFiZWwnKQogICAgICAgICAgICBJY29uLkltYWdlQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxNTAsIDE1MCkKICAgICAgICAgICAgSWNvbi5TY2FsZVR5cGUgPSBFbnVtLlNjYWxlVHlwZS5GaXQKICAgICAgICAgICAgSWNvbi5JbWFnZVRyYW5zcGFyZW5jeSA9IDAuNjk5OTk5OTg4MDc5MDcxCiAgICAgICAgICAgIEljb24uQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgSWNvbi5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICAgICAgSWNvbi5JbWFnZSA9ICdyYnhhc3NldGlkOi8vNzkwOTU5MzQ0MzgwNDUnCiAgICAgICAgICAgIEljb24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgSWNvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjA3MTAwMDAwMjMyNDU4MTE1LCAwLCAwLjgxOTk5OTk5Mjg0NzQ0MjYsIDApCiAgICAgICAgICAgIEljb24uTmFtZSA9ICdJY29uJwogICAgICAgICAgICBJY29uLlNpemUgPSBVRGltMi5uZXcoMCwgMTUsIDAsIDE1KQogICAgICAgICAgICBJY29uLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgSWNvbi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICAgICAgSWNvbi5QYXJlbnQgPSBIZWFkZXIKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIE1vZHVsZU5hbWUgPSBJbnN0YW5jZS5uZXcoJ1RleHRMYWJlbCcpCiAgICAgICAgICAgIE1vZHVsZU5hbWUuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICBNb2R1bGVOYW1lLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQogICAgICAgICAgICBNb2R1bGVOYW1lLlRleHRUcmFuc3BhcmVuY3kgPSAwLjIwMDAwMDAwMjk4MDIzMjI0CiAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy5yaWNoIHRoZW4KICAgICAgICAgICAgICAgIE1vZHVsZU5hbWUuVGV4dCA9IHNldHRpbmdzLnRpdGxlIG9yICJTa2liaWRpIgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBNb2R1bGVOYW1lLlJpY2hUZXh0ID0gdHJ1ZQogICAgICAgICAgICAgICAgTW9kdWxlTmFtZS5UZXh0ID0gc2V0dGluZ3MucmljaHRleHQgb3IgIjxmb250IGNvbG9yPSdyZ2IoMjU1LDAsMCknPkJhbGxzPC9mb250PiB1c2VyIgogICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIE1vZHVsZU5hbWUuTmFtZSA9ICdNb2R1bGVOYW1lJwogICAgICAgICAgICBNb2R1bGVOYW1lLlNpemUgPSBVRGltMi5uZXcoMCwgMjA1LCAwLCAxMykKICAgICAgICAgICAgTW9kdWxlTmFtZS5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICAgICAgTW9kdWxlTmFtZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjA3Mjk5OTk5ODkyNzExNjQsIDAsIDAuMjM5OTk5OTk0NjM1NTgxOTcsIDApCiAgICAgICAgICAgIE1vZHVsZU5hbWUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgTW9kdWxlTmFtZS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICBNb2R1bGVOYW1lLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgTW9kdWxlTmFtZS5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICBNb2R1bGVOYW1lLlRleHRTaXplID0gMTMKICAgICAgICAgICAgTW9kdWxlTmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICAgICAgTW9kdWxlTmFtZS5QYXJlbnQgPSBIZWFkZXIKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIERlc2NyaXB0aW9uID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICBEZXNjcmlwdGlvbi5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlNlbWlCb2xkLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgIERlc2NyaXB0aW9uLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQogICAgICAgICAgICBEZXNjcmlwdGlvbi5UZXh0VHJhbnNwYXJlbmN5ID0gMC42OTk5OTk5ODgwNzkwNzEKICAgICAgICAgICAgRGVzY3JpcHRpb24uVGV4dCA9IHNldHRpbmdzLmRlc2NyaXB0aW9uCiAgICAgICAgICAgIERlc2NyaXB0aW9uLk5hbWUgPSAnRGVzY3JpcHRpb24nCiAgICAgICAgICAgIERlc2NyaXB0aW9uLlNpemUgPSBVRGltMi5uZXcoMCwgMjA1LCAwLCAxMykKICAgICAgICAgICAgRGVzY3JpcHRpb24uQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLCAwLjUpCiAgICAgICAgICAgIERlc2NyaXB0aW9uLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMDcyOTk5OTk4OTI3MTE2NCwgMCwgMC40MTk5OTk5ODY4ODY5NzgxNSwgMCkKICAgICAgICAgICAgRGVzY3JpcHRpb24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgRGVzY3JpcHRpb24uVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQKICAgICAgICAgICAgRGVzY3JpcHRpb24uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBEZXNjcmlwdGlvbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICBEZXNjcmlwdGlvbi5UZXh0U2l6ZSA9IDEwCiAgICAgICAgICAgIERlc2NyaXB0aW9uLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICBEZXNjcmlwdGlvbi5QYXJlbnQgPSBIZWFkZXIKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIFRvZ2dsZSA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgICAgICAgICBUb2dnbGUuTmFtZSA9ICdUb2dnbGUnCiAgICAgICAgICAgIFRvZ2dsZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC42OTk5OTk5ODgwNzkwNzEKICAgICAgICAgICAgVG9nZ2xlLlBvc2l0aW9uID0gVURpbTIubmV3KDAuODE5OTk5OTkyODQ3NDQyNiwgMCwgMC43NTcwMDAwMjkwODcwNjY3LCAwKQogICAgICAgICAgICBUb2dnbGUuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgVG9nZ2xlLlNpemUgPSBVRGltMi5uZXcoMCwgMjUsIDAsIDEyKQogICAgICAgICAgICBUb2dnbGUuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBUb2dnbGUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgIFRvZ2dsZS5QYXJlbnQgPSBIZWFkZXIKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCdVSUNvcm5lcicpCiAgICAgICAgICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDEsIDApCiAgICAgICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IFRvZ2dsZQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgQ2lyY2xlID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgIENpcmNsZS5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICBDaXJjbGUuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLCAwLjUpCiAgICAgICAgICAgIENpcmNsZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC40MDAwMDAwMDI5ODAyMzIyNAogICAgICAgICAgICBDaXJjbGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMC41LCAwKQogICAgICAgICAgICBDaXJjbGUuTmFtZSA9ICdDaXJjbGUnCiAgICAgICAgICAgIENpcmNsZS5TaXplID0gVURpbTIubmV3KDAsIDEyLCAwLCAxMikKICAgICAgICAgICAgQ2lyY2xlLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgQ2lyY2xlLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICBDaXJjbGUuUGFyZW50ID0gVG9nZ2xlCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygnVUlDb3JuZXInKQogICAgICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKQogICAgICAgICAgICBVSUNvcm5lci5QYXJlbnQgPSBDaXJjbGUKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIEtleWJpbmQgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgS2V5YmluZC5OYW1lID0gJ0tleWJpbmQnCiAgICAgICAgICAgIEtleWJpbmQuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNjk5OTk5OTg4MDc5MDcxCiAgICAgICAgICAgIEtleWJpbmQuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4xNTAwMDAwMDU5NjA0NjQ0OCwgMCwgMC43MzUwMDAwMTQzMDUxMTQ3LCAwKQogICAgICAgICAgICBLZXliaW5kLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgIEtleWJpbmQuU2l6ZSA9IFVEaW0yLm5ldygwLCAzMywgMCwgMTUpCiAgICAgICAgICAgIEtleWJpbmQuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBLZXliaW5kLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQogICAgICAgICAgICBLZXliaW5kLlBhcmVudCA9IEhlYWRlcgogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgICAgICAgICAgVUlDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMykKICAgICAgICAgICAgVUlDb3JuZXIuUGFyZW50ID0gS2V5YmluZAogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgVGV4dExhYmVsID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICBUZXh0TGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICBUZXh0TGFiZWwuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgIFRleHRMYWJlbC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICBUZXh0TGFiZWwuVGV4dCA9ICdOb25lJwogICAgICAgICAgICBUZXh0TGFiZWwuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDAuNSkKICAgICAgICAgICAgVGV4dExhYmVsLlNpemUgPSBVRGltMi5uZXcoMCwgMjUsIDAsIDEzKQogICAgICAgICAgICBUZXh0TGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgVGV4dExhYmVsLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgICAgIFRleHRMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAuNSwgMCkKICAgICAgICAgICAgVGV4dExhYmVsLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgVGV4dExhYmVsLlRleHRTaXplID0gMTAKICAgICAgICAgICAgVGV4dExhYmVsLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICBUZXh0TGFiZWwuUGFyZW50ID0gS2V5YmluZAogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgRGl2aWRlciA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgICAgICAgICBEaXZpZGVyLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgIERpdmlkZXIuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDApCiAgICAgICAgICAgIERpdmlkZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNQogICAgICAgICAgICBEaXZpZGVyLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMC42MjAwMDAwMDQ3NjgzNzE2LCAwKQogICAgICAgICAgICBEaXZpZGVyLk5hbWUgPSAnRGl2aWRlcicKICAgICAgICAgICAgRGl2aWRlci5TaXplID0gVURpbTIubmV3KDAsIDI0MSwgMCwgMSkKICAgICAgICAgICAgRGl2aWRlci5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgIERpdmlkZXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgIERpdmlkZXIuUGFyZW50ID0gSGVhZGVyCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBEaXZpZGVyID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgIERpdmlkZXIuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgRGl2aWRlci5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMCkKICAgICAgICAgICAgRGl2aWRlci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgIERpdmlkZXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAxLCAwKQogICAgICAgICAgICBEaXZpZGVyLk5hbWUgPSAnRGl2aWRlcicKICAgICAgICAgICAgRGl2aWRlci5TaXplID0gVURpbTIubmV3KDAsIDI0MSwgMCwgMSkKICAgICAgICAgICAgRGl2aWRlci5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgIERpdmlkZXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgIERpdmlkZXIuUGFyZW50ID0gSGVhZGVyCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBPcHRpb25zID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgIE9wdGlvbnMuTmFtZSA9ICdPcHRpb25zJwogICAgICAgICAgICBPcHRpb25zLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIE9wdGlvbnMuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMSwgMCkKICAgICAgICAgICAgT3B0aW9ucy5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICBPcHRpb25zLlNpemUgPSBVRGltMi5uZXcoMCwgMjQxLCAwLCA4KQogICAgICAgICAgICBPcHRpb25zLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgT3B0aW9ucy5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICAgICAgT3B0aW9ucy5QYXJlbnQgPSBNb2R1bGUKCiAgICAgICAgICAgIGxvY2FsIFVJUGFkZGluZyA9IEluc3RhbmNlLm5ldygnVUlQYWRkaW5nJykKICAgICAgICAgICAgVUlQYWRkaW5nLlBhZGRpbmdUb3AgPSBVRGltLm5ldygwLCA4KQogICAgICAgICAgICBVSVBhZGRpbmcuUGFyZW50ID0gT3B0aW9ucwoKICAgICAgICAgICAgbG9jYWwgVUlMaXN0TGF5b3V0ID0gSW5zdGFuY2UubmV3KCdVSUxpc3RMYXlvdXQnKQogICAgICAgICAgICBVSUxpc3RMYXlvdXQuUGFkZGluZyA9IFVEaW0ubmV3KDAsIDUpCiAgICAgICAgICAgIFVJTGlzdExheW91dC5Ib3Jpem9udGFsQWxpZ25tZW50ID0gRW51bS5Ib3Jpem9udGFsQWxpZ25tZW50LkNlbnRlcgogICAgICAgICAgICBVSUxpc3RMYXlvdXQuU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgVUlMaXN0TGF5b3V0LlBhcmVudCA9IE9wdGlvbnMKCiAgICAgICAgICAgIGZ1bmN0aW9uIE1vZHVsZU1hbmFnZXI6Y2hhbmdlX3N0YXRlKHN0YXRlOiBib29sZWFuKQogICAgICAgICAgICAgICAgc2VsZi5fc3RhdGUgPSBzdGF0ZQoKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3N0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKE1vZHVsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCA5MyArIHNlbGYuX3NpemUgKyBzZWxmLl9tdWx0aXBsaWVyKQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQoKICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQ2lyY2xlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxNTAsIDE1MCksCiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTIuZnJvbVNjYWxlKDAuNTMsIDAuNSkKICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKE1vZHVsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCA5MykKICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShUb2dnbGUsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQoKICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKENpcmNsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApLAogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yLmZyb21TY2FsZSgwLCAwLjUpCiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0gc2VsZi5fc3RhdGUKICAgICAgICAgICAgICAgIENvbmZpZzpzYXZlKGdhbWUuR2FtZUlkLCBMaWJyYXJ5Ll9jb25maWcpCgogICAgICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soc2VsZi5fc3RhdGUpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpjb25uZWN0X2tleWJpbmQoKQogICAgICAgICAgICAgICAgaWYgbm90IExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10gdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZy4uJ19rZXliaW5kJ10gPSBVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dDogSW5wdXRPYmplY3QsIHByb2Nlc3M6IGJvb2xlYW4pCiAgICAgICAgICAgICAgICAgICAgaWYgcHJvY2VzcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHRvc3RyaW5nKGlucHV0LktleUNvZGUpIH49IExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmOmNoYW5nZV9zdGF0ZShub3Qgc2VsZi5fc3RhdGUpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpzY2FsZV9rZXliaW5kKGVtcHR5OiBib29sZWFuKQogICAgICAgICAgICAgICAgaWYgTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSBhbmQgbm90IGVtcHR5IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBrZXliaW5kX3N0cmluZyA9IHN0cmluZy5nc3ViKHRvc3RyaW5nKExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10pLCAnRW51bS5LZXlDb2RlLicsICcnKQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBmb250X3BhcmFtcyA9IEluc3RhbmNlLm5ldygnR2V0VGV4dEJvdW5kc1BhcmFtcycpCiAgICAgICAgICAgICAgICAgICAgZm9udF9wYXJhbXMuVGV4dCA9IGtleWJpbmRfc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgZm9udF9wYXJhbXMuRm9udCA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL01vbnRzZXJyYXQuanNvbicsIEVudW0uRm9udFdlaWdodC5Cb2xkKQogICAgICAgICAgICAgICAgICAgIGZvbnRfcGFyYW1zLlNpemUgPSAxMAogICAgICAgICAgICAgICAgICAgIGZvbnRfcGFyYW1zLldpZHRoID0gMTAwMDAKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZm9udF9zaXplID0gVGV4dFNlcnZpY2U6R2V0VGV4dEJvdW5kc0FzeW5jKGZvbnRfcGFyYW1zKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIEtleWJpbmQuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoZm9udF9zaXplLlggKyA2LCAxNSkKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoZm9udF9zaXplLlgsIDEzKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIEtleWJpbmQuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMzEsIDE1KQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNSwgMTMpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBMaWJyYXJ5OmZsYWdfdHlwZShzZXR0aW5ncy5mbGFnLCAnYm9vbGVhbicpIHRoZW4KICAgICAgICAgICAgICAgIE1vZHVsZU1hbmFnZXIuX3N0YXRlID0gdHJ1ZQogICAgICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soTW9kdWxlTWFuYWdlci5fc3RhdGUpCgogICAgICAgICAgICAgICAgVG9nZ2xlLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQogICAgICAgICAgICAgICAgQ2lyY2xlLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQogICAgICAgICAgICAgICAgQ2lyY2xlLlBvc2l0aW9uID0gVURpbTIuZnJvbVNjYWxlKDAuNTMsIDAuNSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGtleWJpbmRfc3RyaW5nID0gc3RyaW5nLmdzdWIodG9zdHJpbmcoTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSksICdFbnVtLktleUNvZGUuJywgJycpCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dCA9IGtleWJpbmRfc3RyaW5nCgogICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlcjpjb25uZWN0X2tleWJpbmQoKQogICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlcjpzY2FsZV9rZXliaW5kKCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnLi4nX2lucHV0X2JlZ2FuJ10gPSBIZWFkZXIuSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0OiBJbnB1dE9iamVjdCkKICAgICAgICAgICAgICAgIGlmIExpYnJhcnkuX2Nob29zaW5nX2tleWJpbmQgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSB+PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24zIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jaG9vc2luZ19rZXliaW5kID0gdHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1sna2V5YmluZF9jaG9vc2Vfc3RhcnQnXSA9IFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0OiBJbnB1dE9iamVjdCwgcHJvY2VzczogYm9vbGVhbikKICAgICAgICAgICAgICAgICAgICBpZiBwcm9jZXNzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgaW5wdXQgPT0gRW51bS5Vc2VySW5wdXRTdGF0ZSBvciBpbnB1dCA9PSBFbnVtLlVzZXJJbnB1dFR5cGUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgaW5wdXQuS2V5Q29kZSA9PSBFbnVtLktleUNvZGUuVW5rbm93biB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5LZXlDb2RlID09IEVudW0uS2V5Q29kZS5CYWNrc3BhY2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVNYW5hZ2VyOnNjYWxlX2tleWJpbmQodHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10gPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0ID0gJ05vbmUnCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnLi4nX2tleWJpbmQnXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnLi4nX2tleWJpbmQnXTpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zW3NldHRpbmdzLmZsYWcuLidfa2V5YmluZCddID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbJ2tleWJpbmRfY2hvb3NlX3N0YXJ0J106RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zWydrZXliaW5kX2Nob29zZV9zdGFydCddID0gbmlsCgogICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jaG9vc2luZ19rZXliaW5kID0gZmFsc2UKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zWydrZXliaW5kX2Nob29zZV9zdGFydCddOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zWydrZXliaW5kX2Nob29zZV9zdGFydCddID0gbmlsCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSA9IHRvc3RyaW5nKGlucHV0LktleUNvZGUpCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKCiAgICAgICAgICAgICAgICAgICAgaWYgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZy4uJ19rZXliaW5kJ10gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnLi4nX2tleWJpbmQnXTpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZy4uJ19rZXliaW5kJ10gPSBuaWwKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlcjpjb25uZWN0X2tleWJpbmQoKQogICAgICAgICAgICAgICAgICAgIE1vZHVsZU1hbmFnZXI6c2NhbGVfa2V5YmluZCgpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY2hvb3Npbmdfa2V5YmluZCA9IGZhbHNlCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGtleWJpbmRfc3RyaW5nID0gc3RyaW5nLmdzdWIodG9zdHJpbmcoTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSksICdFbnVtLktleUNvZGUuJywgJycpCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHQgPSBrZXliaW5kX3N0cmluZwogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBIZWFkZXIuTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBNb2R1bGVNYW5hZ2VyOmNoYW5nZV9zdGF0ZShub3QgTW9kdWxlTWFuYWdlci5fc3RhdGUpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGZ1bmN0aW9uIE1vZHVsZU1hbmFnZXI6Y3JlYXRlX3BhcmFncmFwaChzZXR0aW5nczogYW55KQogICAgICAgICAgICAgICAgTGF5b3V0T3JkZXJNb2R1bGUgPSBMYXlvdXRPcmRlck1vZHVsZSArIDE7CgogICAgICAgICAgICAgICAgbG9jYWwgUGFyYWdyYXBoTWFuYWdlciA9IHt9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NpemUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IDExCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IHNldHRpbmdzLmN1c3RvbVNjYWxlIG9yIDcwCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgTW9kdWxlTWFuYWdlci5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIE9wdGlvbnMuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCBzZWxmLl9zaXplKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgUGFyYWdyYXBoID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgICAgICBQYXJhZ3JhcGguQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgICAgICBQYXJhZ3JhcGguQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuMwogICAgICAgICAgICAgICAgUGFyYWdyYXBoLlNpemUgPSBVRGltMi5uZXcoMCwgMjA3LCAwLCAzMCkgCiAgICAgICAgICAgICAgICBQYXJhZ3JhcGguQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgUGFyYWdyYXBoLk5hbWUgPSAiUGFyYWdyYXBoIgogICAgICAgICAgICAgICAgUGFyYWdyYXBoLkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWSAKICAgICAgICAgICAgICAgIFBhcmFncmFwaC5QYXJlbnQgPSBPcHRpb25zCiAgICAgICAgICAgICAgICBQYXJhZ3JhcGguTGF5b3V0T3JkZXIgPSBMYXlvdXRPcmRlck1vZHVsZTsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygnVUlDb3JuZXInKQogICAgICAgICAgICAgICAgVUlDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgNCkKICAgICAgICAgICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IFBhcmFncmFwaAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVGl0bGUgPSBJbnN0YW5jZS5uZXcoJ1RleHRMYWJlbCcpCiAgICAgICAgICAgICAgICBUaXRsZS5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlNlbWlCb2xkLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgICAgICBUaXRsZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICAgICAgICAgIFRpdGxlLlRleHQgPSBzZXR0aW5ncy50aXRsZSBvciAiVGl0bGUiCiAgICAgICAgICAgICAgICBUaXRsZS5TaXplID0gVURpbTIubmV3KDEsIC0xMCwgMCwgMjApCiAgICAgICAgICAgICAgICBUaXRsZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCA1LCAwLCA1KQogICAgICAgICAgICAgICAgVGl0bGUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIFRpdGxlLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgICAgICAgICBUaXRsZS5UZXh0WUFsaWdubWVudCA9IEVudW0uVGV4dFlBbGlnbm1lbnQuQ2VudGVyCiAgICAgICAgICAgICAgICBUaXRsZS5UZXh0U2l6ZSA9IDEyCiAgICAgICAgICAgICAgICBUaXRsZS5BdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZCiAgICAgICAgICAgICAgICBUaXRsZS5QYXJlbnQgPSBQYXJhZ3JhcGgKICAgICAgICAgICAgCiAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQm9keSA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgICAgICAgICAgICAgIEJvZHkuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgICAgICBCb2R5LlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MucmljaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgQm9keS5UZXh0ID0gc2V0dGluZ3MudGV4dCBvciAiU2tpYmlkaSIKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBCb2R5LlJpY2hUZXh0ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIEJvZHkuVGV4dCA9IHNldHRpbmdzLnJpY2h0ZXh0IG9yICI8Zm9udCBjb2xvcj0ncmdiKDI1NSwwLDApJz5CYWxsczwvZm9udD4gdXNlciIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBCb2R5LlNpemUgPSBVRGltMi5uZXcoMSwgLTEwLCAwLCAyMCkKICAgICAgICAgICAgICAgIEJvZHkuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgNSwgMCwgMzApCiAgICAgICAgICAgICAgICBCb2R5LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBCb2R5LlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgICAgICAgICBCb2R5LlRleHRZQWxpZ25tZW50ID0gRW51bS5UZXh0WUFsaWdubWVudC5Ub3AKICAgICAgICAgICAgICAgIEJvZHkuVGV4dFNpemUgPSAxMQogICAgICAgICAgICAgICAgQm9keS5UZXh0V3JhcHBlZCA9IHRydWUKICAgICAgICAgICAgICAgIEJvZHkuQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWQogICAgICAgICAgICAgICAgQm9keS5QYXJlbnQgPSBQYXJhZ3JhcGgKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFBhcmFncmFwaC5Nb3VzZUVudGVyOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoUGFyYWdyYXBoLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBQYXJhZ3JhcGguTW91c2VMZWF2ZTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKFBhcmFncmFwaCwgVHdlZW5JbmZvLm5ldygwLjMsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgcmV0dXJuIFBhcmFncmFwaE1hbmFnZXIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBNb2R1bGVNYW5hZ2VyOmNyZWF0ZV90ZXh0KHNldHRpbmdzOiBhbnkpCiAgICAgICAgICAgICAgICBMYXlvdXRPcmRlck1vZHVsZSA9IExheW91dE9yZGVyTW9kdWxlICsgMQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFRleHRNYW5hZ2VyID0ge30KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBzZWxmLl9zaXplID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NpemUgPSAxMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSArPSBzZXR0aW5ncy5jdXN0b21TY2FsZSBvciA1MCAKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBNb2R1bGVNYW5hZ2VyLl9zdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgOTMgKyBzZWxmLl9zaXplKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgT3B0aW9ucy5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIHNlbGYuX3NpemUpCiAgICAgICAgICAgIAogICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVGV4dEZyYW1lID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgICAgICBUZXh0RnJhbWUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgICAgICBUZXh0RnJhbWUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuMwogICAgICAgICAgICAgICAgVGV4dEZyYW1lLlNpemUgPSBVRGltMi5uZXcoMCwgMjA3LCAwLCBzZXR0aW5ncy5DdXN0b21ZU2l6ZSkKICAgICAgICAgICAgICAgIFRleHRGcmFtZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBUZXh0RnJhbWUuTmFtZSA9ICJUZXh0IgogICAgICAgICAgICAgICAgVGV4dEZyYW1lLkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWSAKICAgICAgICAgICAgICAgIFRleHRGcmFtZS5QYXJlbnQgPSBPcHRpb25zCiAgICAgICAgICAgICAgICBUZXh0RnJhbWUuTGF5b3V0T3JkZXIgPSBMYXlvdXRPcmRlck1vZHVsZQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCdVSUNvcm5lcicpCiAgICAgICAgICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA0KQogICAgICAgICAgICAgICAgVUlDb3JuZXIuUGFyZW50ID0gVGV4dEZyYW1lCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBCb2R5ID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgQm9keS5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlJlZ3VsYXIsIEVudW0uRm9udFN0eWxlLk5vcm1hbCkKICAgICAgICAgICAgICAgIEJvZHkuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLnJpY2ggdGhlbgogICAgICAgICAgICAgICAgICAgIEJvZHkuVGV4dCA9IHNldHRpbmdzLnRleHQgb3IgIlNraWJpZGkiIAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIEJvZHkuUmljaFRleHQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgQm9keS5UZXh0ID0gc2V0dGluZ3MucmljaHRleHQgb3IgIjxmb250IGNvbG9yPSdyZ2IoMjU1LDAsMCknPkJhbGxzPC9mb250PiB1c2VyIiAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIEJvZHkuU2l6ZSA9IFVEaW0yLm5ldygxLCAtMTAsIDEsIDApCiAgICAgICAgICAgICAgICBCb2R5LlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDUsIDAsIDUpCiAgICAgICAgICAgICAgICBCb2R5LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBCb2R5LlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgICAgICAgICBCb2R5LlRleHRZQWxpZ25tZW50ID0gRW51bS5UZXh0WUFsaWdubWVudC5Ub3AKICAgICAgICAgICAgICAgIEJvZHkuVGV4dFNpemUgPSAxMAogICAgICAgICAgICAgICAgQm9keS5UZXh0V3JhcHBlZCA9IHRydWUKICAgICAgICAgICAgICAgIEJvZHkuQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWQogICAgICAgICAgICAgICAgQm9keS5QYXJlbnQgPSBUZXh0RnJhbWUKICAgICAgICAgICAgCiAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgVGV4dEZyYW1lLk1vdXNlRW50ZXI6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShUZXh0RnJhbWUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIFRleHRGcmFtZS5Nb3VzZUxlYXZlOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoVGV4dEZyYW1lLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBUZXh0TWFuYWdlcjpTZXQobmV3X3NldHRpbmdzKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBuZXdfc2V0dGluZ3MucmljaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIEJvZHkuVGV4dCA9IG5ld19zZXR0aW5ncy50ZXh0IG9yICJTa2liaWRpIgogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgQm9keS5SaWNoVGV4dCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgQm9keS5UZXh0ID0gbmV3X3NldHRpbmdzLnJpY2h0ZXh0IG9yICI8Zm9udCBjb2xvcj0ncmdiKDI1NSwwLDApJz5CYWxsczwvZm9udD4gdXNlciIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gVGV4dE1hbmFnZXIKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGZ1bmN0aW9uIE1vZHVsZU1hbmFnZXI6Y3JlYXRlX3RleHRib3goc2V0dGluZ3M6IGFueSkKICAgICAgICAgICAgICAgIExheW91dE9yZGVyTW9kdWxlID0gTGF5b3V0T3JkZXJNb2R1bGUgKyAxCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVGV4dGJveE1hbmFnZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgX3RleHQgPSAiIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NpemUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IDExCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IDMyCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgTW9kdWxlTWFuYWdlci5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIE9wdGlvbnMuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCBzZWxmLl9zaXplKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIExhYmVsID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgTGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgTGFiZWwuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgICAgICBMYWJlbC5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yCiAgICAgICAgICAgICAgICBMYWJlbC5UZXh0ID0gc2V0dGluZ3MudGl0bGUgb3IgIkVudGVyIHRleHQiCiAgICAgICAgICAgICAgICBMYWJlbC5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMTMpCiAgICAgICAgICAgICAgICBMYWJlbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDApCiAgICAgICAgICAgICAgICBMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAwLCAwLCAwKQogICAgICAgICAgICAgICAgTGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIExhYmVsLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgICAgICAgICBMYWJlbC5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBMYWJlbC5QYXJlbnQgPSBPcHRpb25zCiAgICAgICAgICAgICAgICBMYWJlbC5UZXh0U2l6ZSA9IDEwOwogICAgICAgICAgICAgICAgTGFiZWwuTGF5b3V0T3JkZXIgPSBMYXlvdXRPcmRlck1vZHVsZQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFRleHRib3ggPSBJbnN0YW5jZS5uZXcoJ1RleHRCb3gnKQogICAgICAgICAgICAgICAgVGV4dGJveC5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL1NvdXJjZVNhbnNQcm8uanNvbicsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgICAgICBUZXh0Ym94LlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICAgICAgVGV4dGJveC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgVGV4dGJveC5QbGFjZWhvbGRlclRleHQgPSBzZXR0aW5ncy5wbGFjZWhvbGRlciBvciAiRW50ZXIgdGV4dC4uLiIKICAgICAgICAgICAgICAgIFRleHRib3guVGV4dCA9IExpYnJhcnkuX2NvbmZpZy5fZmxhZ3Nbc2V0dGluZ3MuZmxhZ10gb3IgIiIKICAgICAgICAgICAgICAgIFRleHRib3guTmFtZSA9ICdUZXh0Ym94JwogICAgICAgICAgICAgICAgVGV4dGJveC5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMTUpCiAgICAgICAgICAgICAgICBUZXh0Ym94LkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIFRleHRib3guVGV4dFNpemUgPSAxMAogICAgICAgICAgICAgICAgVGV4dGJveC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxNTAsIDE1MCkKICAgICAgICAgICAgICAgIFRleHRib3guQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuOQogICAgICAgICAgICAgICAgVGV4dGJveC5DbGVhclRleHRPbkZvY3VzID0gZmFsc2UKICAgICAgICAgICAgICAgIFRleHRib3guUGFyZW50ID0gT3B0aW9ucwogICAgICAgICAgICAgICAgVGV4dGJveC5MYXlvdXRPcmRlciA9IExheW91dE9yZGVyTW9kdWxlCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgICAgICAgICAgICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDQpCiAgICAgICAgICAgICAgICBVSUNvcm5lci5QYXJlbnQgPSBUZXh0Ym94CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZnVuY3Rpb24gVGV4dGJveE1hbmFnZXI6dXBkYXRlX3RleHQodGV4dDogc3RyaW5nKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3RleHQgPSB0ZXh0CiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSA9IHNlbGYuX3RleHQKICAgICAgICAgICAgICAgICAgICBDb25maWc6c2F2ZShnYW1lLkdhbWVJZCwgTGlicmFyeS5fY29uZmlnKQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKHNlbGYuX3RleHQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBMaWJyYXJ5OmZsYWdfdHlwZShzZXR0aW5ncy5mbGFnLCAnc3RyaW5nJykgdGhlbgogICAgICAgICAgICAgICAgICAgIFRleHRib3hNYW5hZ2VyOnVwZGF0ZV90ZXh0KExpYnJhcnkuX2NvbmZpZy5fZmxhZ3Nbc2V0dGluZ3MuZmxhZ10pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBUZXh0Ym94LkZvY3VzTG9zdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBUZXh0Ym94TWFuYWdlcjp1cGRhdGVfdGV4dChUZXh0Ym94LlRleHQpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRleHRib3hNYW5hZ2VyCiAgICAgICAgICAgIGVuZCAgIAoKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpjcmVhdGVfY2hlY2tib3goc2V0dGluZ3M6IGFueSkKICAgICAgICAgICAgICAgIExheW91dE9yZGVyTW9kdWxlID0gTGF5b3V0T3JkZXJNb2R1bGUgKyAxCiAgICAgICAgICAgICAgICBsb2NhbCBDaGVja2JveE1hbmFnZXIgPSB7IF9zdGF0ZSA9IGZhbHNlIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBzZWxmLl9zaXplID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NpemUgPSAxMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IDIwCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgTW9kdWxlTWFuYWdlci5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgT3B0aW9ucy5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIHNlbGYuX3NpemUpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQ2hlY2tib3ggPSBJbnN0YW5jZS5uZXcoIlRleHRCdXR0b24iKQogICAgICAgICAgICAgICAgQ2hlY2tib3guRm9udEZhY2UgPSBGb250Lm5ldygicmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Tb3VyY2VTYW5zUHJvLmpzb24iLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgQ2hlY2tib3guVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgICAgICBDaGVja2JveC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgQ2hlY2tib3guVGV4dCA9ICIiCiAgICAgICAgICAgICAgICBDaGVja2JveC5BdXRvQnV0dG9uQ29sb3IgPSBmYWxzZQogICAgICAgICAgICAgICAgQ2hlY2tib3guQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIENoZWNrYm94Lk5hbWUgPSAiQ2hlY2tib3giCiAgICAgICAgICAgICAgICBDaGVja2JveC5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMTUpCiAgICAgICAgICAgICAgICBDaGVja2JveC5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBDaGVja2JveC5UZXh0U2l6ZSA9IDE0CiAgICAgICAgICAgICAgICBDaGVja2JveC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgIENoZWNrYm94LlBhcmVudCA9IE9wdGlvbnMKICAgICAgICAgICAgICAgIENoZWNrYm94LkxheW91dE9yZGVyID0gTGF5b3V0T3JkZXJNb2R1bGUKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBUaXRsZUxhYmVsID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5OYW1lID0gIlRpdGxlTGFiZWwiCiAgICAgICAgICAgICAgICBpZiBTZWxlY3RlZExhbmd1YWdlID09ICJ0aCIgdGhlbgogICAgICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygicmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Ob3RvU2Fuc1RoYWkuanNvbiIsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuVGV4dFNpemUgPSAxMwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygicmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbiIsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuVGV4dFNpemUgPSAxMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBUaXRsZUxhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yCiAgICAgICAgICAgICAgICBUaXRsZUxhYmVsLlRleHQgPSBzZXR0aW5ncy50aXRsZSBvciAiU2tpYmlkaSIKICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygwLCAxNDIsIDAsIDEzKQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5QYXJlbnQgPSBDaGVja2JveAoKICAgICAgICAgICAgICAgIGxvY2FsIEtleWJpbmRCb3ggPSBJbnN0YW5jZS5uZXcoIkZyYW1lIikKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guTmFtZSA9ICJLZXliaW5kQm94IgogICAgICAgICAgICAgICAgS2V5YmluZEJveC5TaXplID0gVURpbTIuZnJvbU9mZnNldCgxNCwgMTQpCiAgICAgICAgICAgICAgICBLZXliaW5kQm94LlBvc2l0aW9uID0gVURpbTIubmV3KDEsIC0zNSwgMC41LCAwKQogICAgICAgICAgICAgICAgS2V5YmluZEJveC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICAgICAgICAgICAgICBLZXliaW5kQm94LkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guUGFyZW50ID0gQ2hlY2tib3gKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBLZXliaW5kQ29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpCiAgICAgICAgICAgICAgICBLZXliaW5kQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDQpCiAgICAgICAgICAgICAgICBLZXliaW5kQ29ybmVyLlBhcmVudCA9IEtleWJpbmRCb3gKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBLZXliaW5kTGFiZWwgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuTmFtZSA9ICJLZXliaW5kTGFiZWwiCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCAxLCAwKQogICAgICAgICAgICAgICAgS2V5YmluZExhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuVGV4dFNjYWxlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuVGV4dFNpemUgPSAxMAogICAgICAgICAgICAgICAgS2V5YmluZExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuU291cmNlU2FucwogICAgICAgICAgICAgICAgS2V5YmluZExhYmVsLlRleHQgPSBMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddIAogICAgICAgICAgICAgICAgICAgIGFuZCBzdHJpbmcuZ3N1Yih0b3N0cmluZyhMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddKSwgIkVudW0uS2V5Q29kZS4iLCAiIikgCiAgICAgICAgICAgICAgICAgICAgb3IgIi4uLiIKICAgICAgICAgICAgICAgIEtleWJpbmRMYWJlbC5QYXJlbnQgPSBLZXliaW5kQm94CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQm94ID0gSW5zdGFuY2UubmV3KCJGcmFtZSIpCiAgICAgICAgICAgICAgICBCb3guQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgIEJveC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDEsIDAuNSkKICAgICAgICAgICAgICAgIEJveC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC45CiAgICAgICAgICAgICAgICBCb3guUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgQm94Lk5hbWUgPSAiQm94IgogICAgICAgICAgICAgICAgQm94LlNpemUgPSBVRGltMi5uZXcoMCwgMTUsIDAsIDE1KQogICAgICAgICAgICAgICAgQm94LkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIEJveC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxNTAsIDE1MCkKICAgICAgICAgICAgICAgIEJveC5QYXJlbnQgPSBDaGVja2JveAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIEJveENvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQogICAgICAgICAgICAgICAgQm94Q29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDQpCiAgICAgICAgICAgICAgICBCb3hDb3JuZXIuUGFyZW50ID0gQm94CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgRmlsbCA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgICAgICAgICAgICAgRmlsbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KQogICAgICAgICAgICAgICAgRmlsbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC40CiAgICAgICAgICAgICAgICBGaWxsLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgRmlsbC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgRmlsbC5OYW1lID0gIkZpbGwiCiAgICAgICAgICAgICAgICBGaWxsLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIEZpbGwuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICAgICAgICAgICAgICBGaWxsLlBhcmVudCA9IEJveAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIEZpbGxDb3JuZXIgPSBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIikKICAgICAgICAgICAgICAgIEZpbGxDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMykKICAgICAgICAgICAgICAgIEZpbGxDb3JuZXIuUGFyZW50ID0gRmlsbAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIENoZWNrYm94TWFuYWdlcjpjaGFuZ2Vfc3RhdGUoc3RhdGU6IGJvb2xlYW4pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc3RhdGUgPSBzdGF0ZQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX3N0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShCb3gsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC43CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKEZpbGwsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCg5LCA5KQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQm94LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuOQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShGaWxsLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSA9IHNlbGYuX3N0YXRlCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhzZWxmLl9zdGF0ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIExpYnJhcnk6ZmxhZ190eXBlKHNldHRpbmdzLmZsYWcsICJib29sZWFuIikgdGhlbgogICAgICAgICAgICAgICAgICAgIENoZWNrYm94TWFuYWdlcjpjaGFuZ2Vfc3RhdGUoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIENoZWNrYm94Lk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIENoZWNrYm94TWFuYWdlcjpjaGFuZ2Vfc3RhdGUobm90IENoZWNrYm94TWFuYWdlci5fc3RhdGUpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgQ2hlY2tib3guSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0LCBnYW1lUHJvY2Vzc2VkKQogICAgICAgICAgICAgICAgICAgIGlmIGdhbWVQcm9jZXNzZWQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSB+PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24zIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnkuX2Nob29zaW5nX2tleWJpbmQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuX2Nob29zaW5nX2tleWJpbmQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hvb3NlQ29ubmVjdGlvbgogICAgICAgICAgICAgICAgICAgIGNob29zZUNvbm5lY3Rpb24gPSBVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihrZXlJbnB1dCwgcHJvY2Vzc2VkKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBwcm9jZXNzZWQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGtleUlucHV0LlVzZXJJbnB1dFR5cGUgfj0gRW51bS5Vc2VySW5wdXRUeXBlLktleWJvYXJkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBrZXlJbnB1dC5LZXlDb2RlID09IEVudW0uS2V5Q29kZS5Vbmtub3duIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYga2V5SW5wdXQuS2V5Q29kZSA9PSBFbnVtLktleUNvZGUuQmFja3NwYWNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZU1hbmFnZXI6c2NhbGVfa2V5YmluZCh0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmRMYWJlbC5UZXh0ID0gIi4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbm5lY3Rpb25zW3NldHRpbmdzLmZsYWcgLi4gIl9rZXliaW5kIl0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zW3NldHRpbmdzLmZsYWcgLi4gIl9rZXliaW5kIl06RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZyAuLiAiX2tleWJpbmQiXSA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9vc2VDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY2hvb3Npbmdfa2V5YmluZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjaG9vc2VDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddID0gdG9zdHJpbmcoa2V5SW5wdXQuS2V5Q29kZSkKICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZyAuLiAiX2tleWJpbmQiXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnIC4uICJfa2V5YmluZCJdOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZyAuLiAiX2tleWJpbmQiXSA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlcjpjb25uZWN0X2tleWJpbmQoKQogICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVNYW5hZ2VyOnNjYWxlX2tleWJpbmQoKQogICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jaG9vc2luZ19rZXliaW5kID0gZmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGtleWJpbmRfc3RyaW5nID0gc3RyaW5nLmdzdWIodG9zdHJpbmcoTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSksICJFbnVtLktleUNvZGUuIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmRMYWJlbC5UZXh0ID0ga2V5YmluZF9zdHJpbmcKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwga2V5UHJlc3NDb25uZWN0aW9uID0gVXNlcklucHV0U2VydmljZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQsIGdhbWVQcm9jZXNzZWQpCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZVByb2Nlc3NlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5LZXlib2FyZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0b3JlZEtleSA9IExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RvcmVkS2V5IGFuZCB0b3N0cmluZyhpbnB1dC5LZXlDb2RlKSA9PSBzdG9yZWRLZXkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2tib3hNYW5hZ2VyOmNoYW5nZV9zdGF0ZShub3QgQ2hlY2tib3hNYW5hZ2VyLl9zdGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnIC4uICJfa2V5cHJlc3MiXSA9IGtleVByZXNzQ29ubmVjdGlvbgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBDaGVja2JveE1hbmFnZXIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBNb2R1bGVNYW5hZ2VyOmNyZWF0ZV9kaXZpZGVyKHNldHRpbmdzOiBhbnkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIExheW91dE9yZGVyTW9kdWxlID0gTGF5b3V0T3JkZXJNb2R1bGUgKyAxOwogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NpemUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IDExCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IDI3CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgTW9kdWxlTWFuYWdlci5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIGRpdmlkZXJIZWlnaHQgPSAxCiAgICAgICAgICAgICAgICBsb2NhbCBkaXZpZGVyV2lkdGggPSAyMDcgCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIE91dGVyRnJhbWUgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgICAgIE91dGVyRnJhbWUuU2l6ZSA9IFVEaW0yLm5ldygwLCBkaXZpZGVyV2lkdGgsIDAsIDIwKSAKICAgICAgICAgICAgICAgIE91dGVyRnJhbWUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEgCiAgICAgICAgICAgICAgICBPdXRlckZyYW1lLk5hbWUgPSAnT3V0ZXJGcmFtZScKICAgICAgICAgICAgICAgIE91dGVyRnJhbWUuUGFyZW50ID0gT3B0aW9ucwogICAgICAgICAgICAgICAgT3V0ZXJGcmFtZS5MYXlvdXRPcmRlciA9IExheW91dE9yZGVyTW9kdWxlCgogICAgICAgICAgICAgICAgaWYgc2V0dGluZ3MgYW5kIHNldHRpbmdzLnNob3d0b3BpYyB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGV4dExhYmVsID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlNlbWlCb2xkLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKSAKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFRyYW5zcGFyZW5jeSA9IDAKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dCA9IHNldHRpbmdzLnRpdGxlCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLlNpemUgPSBVRGltMi5uZXcoMCwgMTUzLCAwLCAxMykKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLjUwMSwgMCkKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkNlbnRlcgogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LDAuNSkKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFNpemUgPSAxMQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuWkluZGV4ID0gMzsKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDA7CiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLlBhcmVudCA9IE91dGVyRnJhbWUKICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzIG9yIHNldHRpbmdzIGFuZCBub3Qgc2V0dGluZ3MuZGlzYWJsZWxpbmUgdGhlbgogICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGl2aWRlciA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCAwLCBkaXZpZGVySGVpZ2h0KQogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApIAogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuTmFtZSA9ICdEaXZpZGVyJwogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuUGFyZW50ID0gT3V0ZXJGcmFtZQogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuWkluZGV4ID0gMjsKICAgICAgICAgICAgICAgICAgICBEaXZpZGVyLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAuNSwgLWRpdmlkZXJIZWlnaHQgLyAyKSAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgR3JhZGllbnQgPSBJbnN0YW5jZS5uZXcoJ1VJR3JhZGllbnQnKQogICAgICAgICAgICAgICAgICAgIEdyYWRpZW50LlBhcmVudCA9IERpdmlkZXIKICAgICAgICAgICAgICAgICAgICBHcmFkaWVudC5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3KHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKSksICAKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLjUsIENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApKSwgCiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSwgMCkpICAKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIEdyYWRpZW50LlRyYW5zcGFyZW5jeSA9IE51bWJlclNlcXVlbmNlLm5ldyh7CiAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIDEpLCAgIAogICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLjUsIDApLAogICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCAxKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgR3JhZGllbnQuUm90YXRpb24gPSAwIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygnVUlDb3JuZXInKQogICAgICAgICAgICAgICAgICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDIpIAogICAgICAgICAgICAgICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IERpdmlkZXIKCiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpjcmVhdGVfc2xpZGVyKHNldHRpbmdzOiBhbnkpCgogICAgICAgICAgICAgICAgTGF5b3V0T3JkZXJNb2R1bGUgPSBMYXlvdXRPcmRlck1vZHVsZSArIDEKCiAgICAgICAgICAgICAgICBsb2NhbCBTbGlkZXJNYW5hZ2VyID0ge30KCiAgICAgICAgICAgICAgICBpZiBzZWxmLl9zaXplID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NpemUgPSAxMQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSArPSAyNwoKICAgICAgICAgICAgICAgIGlmIE1vZHVsZU1hbmFnZXIuX3N0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICBNb2R1bGUuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCA5MyArIHNlbGYuX3NpemUpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBPcHRpb25zLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgc2VsZi5fc2l6ZSkKCiAgICAgICAgICAgICAgICBsb2NhbCBTbGlkZXIgPSBJbnN0YW5jZS5uZXcoJ1RleHRCdXR0b24nKQogICAgICAgICAgICAgICAgU2xpZGVyLkZvbnRGYWNlID0gRm9udC5uZXcoJ3JieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvU291cmNlU2Fuc1Byby5qc29uJywgRW51bS5Gb250V2VpZ2h0LlJlZ3VsYXIsIEVudW0uRm9udFN0eWxlLk5vcm1hbCk7CiAgICAgICAgICAgICAgICBTbGlkZXIuVGV4dFNpemUgPSAxNDsKICAgICAgICAgICAgICAgIFNsaWRlci5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgIFNsaWRlci5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgU2xpZGVyLlRleHQgPSAnJwogICAgICAgICAgICAgICAgU2xpZGVyLkF1dG9CdXR0b25Db2xvciA9IGZhbHNlCiAgICAgICAgICAgICAgICBTbGlkZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIFNsaWRlci5OYW1lID0gJ1NsaWRlcicKICAgICAgICAgICAgICAgIFNsaWRlci5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMjIpCiAgICAgICAgICAgICAgICBTbGlkZXIuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgU2xpZGVyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgU2xpZGVyLlBhcmVudCA9IE9wdGlvbnMKICAgICAgICAgICAgICAgIFNsaWRlci5MYXlvdXRPcmRlciA9IExheW91dE9yZGVyTW9kdWxlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFRleHRMYWJlbCA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgICAgICAgICAgICAgIGlmIEdHLlNlbGVjdGVkTGFuZ3VhZ2UgPT0gInRoIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLkZvbnRGYWNlID0gRm9udC5uZXcoInJieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvTm90b1NhbnNUaGFpLmpzb24iLCBFbnVtLkZvbnRXZWlnaHQuU2VtaUJvbGQsIEVudW0uRm9udFN0eWxlLk5vcm1hbCkKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFNpemUgPSAxMzsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0U2l6ZSA9IDExOwogICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHRUcmFuc3BhcmVuY3kgPSAwLjIwMDAwMDAwMjk4MDIzMjI0CiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dCA9IHNldHRpbmdzLnRpdGxlCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygwLCAxNTMsIDAsIDEzKQogICAgICAgICAgICAgICAgVGV4dExhYmVsLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAuMDUwMDAwMDAwNzQ1MDU4MDYsIDApCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgVGV4dExhYmVsLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgVGV4dExhYmVsLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICAgICAgVGV4dExhYmVsLlBhcmVudCA9IFNsaWRlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBEcmFnID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgICAgICBEcmFnLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgICAgICBEcmFnLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAxKQogICAgICAgICAgICAgICAgRHJhZy5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC44OTk5OTk5NzYxNTgxNDIxCiAgICAgICAgICAgICAgICBEcmFnLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMC45NDk5OTk5ODgwNzkwNzEsIDApCiAgICAgICAgICAgICAgICBEcmFnLk5hbWUgPSAnRHJhZycKICAgICAgICAgICAgICAgIERyYWcuU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDcsIDAsIDQpCiAgICAgICAgICAgICAgICBEcmFnLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIERyYWcuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICAgICAgICAgICAgICBEcmFnLlBhcmVudCA9IFNsaWRlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygnVUlDb3JuZXInKQogICAgICAgICAgICAgICAgVUlDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMSwgMCkKICAgICAgICAgICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IERyYWcKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgRmlsbCA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgICAgICAgICAgICAgRmlsbC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgRmlsbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICAgICAgICAgIEZpbGwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNQogICAgICAgICAgICAgICAgRmlsbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAwLCAwLjUsIDApCiAgICAgICAgICAgICAgICBGaWxsLk5hbWUgPSAnRmlsbCcKICAgICAgICAgICAgICAgIEZpbGwuU2l6ZSA9IFVEaW0yLm5ldygwLCAxMDMsIDAsIDQpCiAgICAgICAgICAgICAgICBGaWxsLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIEZpbGwuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICAgICAgICAgICAgICBGaWxsLlBhcmVudCA9IERyYWcKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgICAgICAgICAgICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDMpCiAgICAgICAgICAgICAgICBVSUNvcm5lci5QYXJlbnQgPSBGaWxsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJR3JhZGllbnQgPSBJbnN0YW5jZS5uZXcoJ1VJR3JhZGllbnQnKQogICAgICAgICAgICAgICAgVUlHcmFkaWVudC5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3ewogICAgICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkpLAogICAgICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBVSUdyYWRpZW50LlBhcmVudCA9IEZpbGwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQ2lyY2xlID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgICAgICBDaXJjbGUuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygxLCAwLjUpCiAgICAgICAgICAgICAgICBDaXJjbGUuTmFtZSA9ICdDaXJjbGUnCiAgICAgICAgICAgICAgICBDaXJjbGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgQ2lyY2xlLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgICAgICBDaXJjbGUuU2l6ZSA9IFVEaW0yLm5ldygwLCA2LCAwLCA2KQogICAgICAgICAgICAgICAgQ2lyY2xlLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIENpcmNsZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICAgICAgICAgIENpcmNsZS5QYXJlbnQgPSBGaWxsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCdVSUNvcm5lcicpCiAgICAgICAgICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKQogICAgICAgICAgICAgICAgVUlDb3JuZXIuUGFyZW50ID0gQ2lyY2xlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFZhbHVlID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgVmFsdWUuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgVmFsdWUuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgICAgICBWYWx1ZS5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yMDAwMDAwMDI5ODAyMzIyNAogICAgICAgICAgICAgICAgVmFsdWUuVGV4dCA9ICc1MCcKICAgICAgICAgICAgICAgIFZhbHVlLk5hbWUgPSAnVmFsdWUnCiAgICAgICAgICAgICAgICBWYWx1ZS5TaXplID0gVURpbTIubmV3KDAsIDQyLCAwLCAxMykKICAgICAgICAgICAgICAgIFZhbHVlLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMSwgMCkKICAgICAgICAgICAgICAgIFZhbHVlLlBvc2l0aW9uID0gVURpbTIubmV3KDEsIDAsIDAsIDApCiAgICAgICAgICAgICAgICBWYWx1ZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgVmFsdWUuVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LlJpZ2h0CiAgICAgICAgICAgICAgICBWYWx1ZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBWYWx1ZS5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgVmFsdWUuVGV4dFNpemUgPSAxMAogICAgICAgICAgICAgICAgVmFsdWUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgICAgICBWYWx1ZS5QYXJlbnQgPSBTbGlkZXIKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBTbGlkZXJNYW5hZ2VyOnNldF9wZXJjZW50YWdlKHBlcmNlbnRhZ2U6IG51bWJlcikKICAgICAgICAgICAgICAgICAgICBsb2NhbCByb3VuZGVkX251bWJlciA9IDAKCiAgICAgICAgICAgICAgICAgICAgaWYgc2V0dGluZ3Mucm91bmRfbnVtYmVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcm91bmRlZF9udW1iZXIgPSBtYXRoLmZsb29yKHBlcmNlbnRhZ2UpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICByb3VuZGVkX251bWJlciA9IG1hdGguZmxvb3IocGVyY2VudGFnZSAqIDEwKSAvIDEwCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2UgPSAocGVyY2VudGFnZSAtIHNldHRpbmdzLm1pbmltdW1fdmFsdWUpIC8gKHNldHRpbmdzLm1heGltdW1fdmFsdWUgLSBzZXR0aW5ncy5taW5pbXVtX3ZhbHVlKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHNsaWRlcl9zaXplID0gbWF0aC5jbGFtcChwZXJjZW50YWdlLCAwLjAyLCAxKSAqIERyYWcuU2l6ZS5YLk9mZnNldAogICAgICAgICAgICAgICAgICAgIGxvY2FsIG51bWJlcl90aHJlc2hvbGQgPSBtYXRoLmNsYW1wKHJvdW5kZWRfbnVtYmVyLCBzZXR0aW5ncy5taW5pbXVtX3ZhbHVlLCBzZXR0aW5ncy5tYXhpbXVtX3ZhbHVlKQogICAgCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSA9IG51bWJlcl90aHJlc2hvbGQKICAgICAgICAgICAgICAgICAgICBWYWx1ZS5UZXh0ID0gbnVtYmVyX3RocmVzaG9sZAogICAgCiAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShGaWxsLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldChzbGlkZXJfc2l6ZSwgRHJhZy5TaXplLlkuT2Zmc2V0KQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2sobnVtYmVyX3RocmVzaG9sZCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFNsaWRlck1hbmFnZXI6dXBkYXRlKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBtb3VzZV9wb3NpdGlvbiA9IChtb3VzZS5YIC0gRHJhZy5BYnNvbHV0ZVBvc2l0aW9uLlgpIC8gRHJhZy5TaXplLlguT2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGVyY2VudGFnZSA9IHNldHRpbmdzLm1pbmltdW1fdmFsdWUgKyAoc2V0dGluZ3MubWF4aW11bV92YWx1ZSAtIHNldHRpbmdzLm1pbmltdW1fdmFsdWUpICogbW91c2VfcG9zaXRpb24KCiAgICAgICAgICAgICAgICAgICAgc2VsZjpzZXRfcGVyY2VudGFnZShwZXJjZW50YWdlKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gU2xpZGVyTWFuYWdlcjppbnB1dCgpCiAgICAgICAgICAgICAgICAgICAgU2xpZGVyTWFuYWdlcjp1cGRhdGUoKQogICAgCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbJ3NsaWRlcl9kcmFnXycuLnNldHRpbmdzLmZsYWddID0gbW91c2UuTW92ZTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgU2xpZGVyTWFuYWdlcjp1cGRhdGUoKQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1snc2xpZGVyX2lucHV0XycuLnNldHRpbmdzLmZsYWddID0gVXNlcklucHV0U2VydmljZS5JbnB1dEVuZGVkOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQ6IElucHV0T2JqZWN0LCBwcm9jZXNzOiBib29sZWFuKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlIH49IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgYW5kIGlucHV0LlVzZXJJbnB1dFR5cGUgfj0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uczpkaXNjb25uZWN0KCdzbGlkZXJfZHJhZ18nLi5zZXR0aW5ncy5mbGFnKQogICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uczpkaXNjb25uZWN0KCdzbGlkZXJfaW5wdXRfJy4uc2V0dGluZ3MuZmxhZykKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy5pZ25vcmVzYXZlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWc6c2F2ZShnYW1lLkdhbWVJZCwgTGlicmFyeS5fY29uZmlnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAoKCiAgICAgICAgICAgICAgICBpZiBMaWJyYXJ5OmZsYWdfdHlwZShzZXR0aW5ncy5mbGFnLCAnbnVtYmVyJykgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy5pZ25vcmVzYXZlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFNsaWRlck1hbmFnZXI6c2V0X3BlcmNlbnRhZ2UoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBTbGlkZXJNYW5hZ2VyOnNldF9wZXJjZW50YWdlKHNldHRpbmdzLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgU2xpZGVyTWFuYWdlcjpzZXRfcGVyY2VudGFnZShzZXR0aW5ncy52YWx1ZSk7CiAgICAgICAgICAgICAgICBlbmQ7CiAgICAKICAgICAgICAgICAgICAgIFNsaWRlci5Nb3VzZUJ1dHRvbjFEb3duOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIFNsaWRlck1hbmFnZXI6aW5wdXQoKQogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIHJldHVybiBTbGlkZXJNYW5hZ2VyCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpjcmVhdGVfZHJvcGRvd24oc2V0dGluZ3M6IGFueSkKCiAgICAgICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MuT3JkZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIExheW91dE9yZGVyTW9kdWxlID0gTGF5b3V0T3JkZXJNb2R1bGUgKyAxOwogICAgICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgICAgIGxvY2FsIERyb3Bkb3duTWFuYWdlciA9IHsKICAgICAgICAgICAgICAgICAgICBfc3RhdGUgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBfc2l6ZSA9IDAKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MuT3JkZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NpemUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3NpemUgPSAxMQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IDQ0CiAgICAgICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLk9yZGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBNb2R1bGVNYW5hZ2VyLl9zdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBPcHRpb25zLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIERyb3Bkb3duID0gSW5zdGFuY2UubmV3KCdUZXh0QnV0dG9uJykKICAgICAgICAgICAgICAgIERyb3Bkb3duLkZvbnRGYWNlID0gRm9udC5uZXcoJ3JieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvU291cmNlU2Fuc1Byby5qc29uJywgRW51bS5Gb250V2VpZ2h0LlJlZ3VsYXIsIEVudW0uRm9udFN0eWxlLk5vcm1hbCkKICAgICAgICAgICAgICAgIERyb3Bkb3duLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgRHJvcGRvd24uQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgIERyb3Bkb3duLlRleHQgPSAnJwogICAgICAgICAgICAgICAgRHJvcGRvd24uQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UKICAgICAgICAgICAgICAgIERyb3Bkb3duLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBEcm9wZG93bi5OYW1lID0gJ0Ryb3Bkb3duJwogICAgICAgICAgICAgICAgRHJvcGRvd24uU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDcsIDAsIDM5KQogICAgICAgICAgICAgICAgRHJvcGRvd24uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgRHJvcGRvd24uVGV4dFNpemUgPSAxNAogICAgICAgICAgICAgICAgRHJvcGRvd24uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgICAgICBEcm9wZG93bi5QYXJlbnQgPSBPcHRpb25zCgogICAgICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLk9yZGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBEcm9wZG93bi5MYXlvdXRPcmRlciA9IExheW91dE9yZGVyTW9kdWxlOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIERyb3Bkb3duLkxheW91dE9yZGVyID0gc2V0dGluZ3MuT3JkZXJWYWx1ZTsKICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICBpZiBub3QgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSA9IHt9OwogICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBUZXh0TGFiZWwgPSBJbnN0YW5jZS5uZXcoJ1RleHRMYWJlbCcpCiAgICAgICAgICAgICAgICBpZiBHRy5TZWxlY3RlZExhbmd1YWdlID09ICJ0aCIgdGhlbgogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5Gb250RmFjZSA9IEZvbnQubmV3KCJyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL05vdG9TYW5zVGhhaS5qc29uIiwgRW51bS5Gb250V2VpZ2h0LlNlbWlCb2xkLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHRTaXplID0gMTM7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLkZvbnRGYWNlID0gRm9udC5uZXcoJ3JieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvR290aGFtU1NtLmpzb24nLCBFbnVtLkZvbnRXZWlnaHQuU2VtaUJvbGQsIEVudW0uRm9udFN0eWxlLk5vcm1hbCk7CiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHRTaXplID0gMTE7CiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFRyYW5zcGFyZW5jeSA9IDAuMjAwMDAwMDAyOTgwMjMyMjQKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0ID0gc2V0dGluZ3MudGl0bGUKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMTMpCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgVGV4dExhYmVsLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgVGV4dExhYmVsLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICAgICAgVGV4dExhYmVsLlBhcmVudCA9IERyb3Bkb3duCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIEJveCA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgICAgICAgICAgICAgQm94LkNsaXBzRGVzY2VuZGFudHMgPSB0cnVlCiAgICAgICAgICAgICAgICBCb3guQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgIEJveC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMCkKICAgICAgICAgICAgICAgIEJveC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC44OTk5OTk5NzYxNTgxNDIxCiAgICAgICAgICAgICAgICBCb3guUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAxLjIwMDAwMDA0NzY4MzcxNTgsIDApCiAgICAgICAgICAgICAgICBCb3guTmFtZSA9ICdCb3gnCiAgICAgICAgICAgICAgICBCb3guU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDcsIDAsIDIyKQogICAgICAgICAgICAgICAgQm94LkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIEJveC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxNTAsIDE1MCkKICAgICAgICAgICAgICAgIEJveC5QYXJlbnQgPSBUZXh0TGFiZWwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgICAgICAgICAgICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDQpCiAgICAgICAgICAgICAgICBVSUNvcm5lci5QYXJlbnQgPSBCb3gKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgSGVhZGVyID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgICAgICBIZWFkZXIuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgIEhlYWRlci5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMCkKICAgICAgICAgICAgICAgIEhlYWRlci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgSGVhZGVyLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMCwgMCkKICAgICAgICAgICAgICAgIEhlYWRlci5OYW1lID0gJ0hlYWRlcicKICAgICAgICAgICAgICAgIEhlYWRlci5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMjIpCiAgICAgICAgICAgICAgICBIZWFkZXIuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgSGVhZGVyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICAgICAgSGVhZGVyLlBhcmVudCA9IEJveAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBDdXJyZW50T3B0aW9uID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlNlbWlCb2xkLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yMDAwMDAwMDI5ODAyMzIyNAogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5OYW1lID0gJ0N1cnJlbnRPcHRpb24nCiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLlNpemUgPSBVRGltMi5uZXcoMCwgMTYxLCAwLCAxMykKICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLCAwLjUpCiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMDQ5OTk5ODgxNTM1NzY4NTEsIDAsIDAuNSwgMCkKICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQKICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5UZXh0U2l6ZSA9IDEwCiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5QYXJlbnQgPSBIZWFkZXIKICAgICAgICAgICAgICAgIGxvY2FsIFVJR3JhZGllbnQgPSBJbnN0YW5jZS5uZXcoJ1VJR3JhZGllbnQnKQogICAgICAgICAgICAgICAgVUlHcmFkaWVudC5UcmFuc3BhcmVuY3kgPSBOdW1iZXJTZXF1ZW5jZS5uZXd7CiAgICAgICAgICAgICAgICAgICAgTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgMCksCiAgICAgICAgICAgICAgICAgICAgTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMC43MDQsIDApLAogICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAuODcyLCAwLjM2MjUwMDAxMTkyMDkyODk2KSwKICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCAxKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgVUlHcmFkaWVudC5QYXJlbnQgPSBDdXJyZW50T3B0aW9uCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIEFycm93ID0gSW5zdGFuY2UubmV3KCdJbWFnZUxhYmVsJykKICAgICAgICAgICAgICAgIEFycm93LkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDMwLCAzMCwgMzApCiAgICAgICAgICAgICAgICBBcnJvdy5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICAgICAgICAgIEFycm93LkltYWdlID0gJ3JieGFzc2V0aWQ6Ly84NDIzMjQ1MzE4OTMyNCcKICAgICAgICAgICAgICAgIEFycm93LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBBcnJvdy5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjkxMDAwMDAyNjIyNjA0MzcsIDAsIDAuNSwgMCkKICAgICAgICAgICAgICAgIEFycm93Lk5hbWUgPSAnQXJyb3cnCiAgICAgICAgICAgICAgICBBcnJvdy5TaXplID0gVURpbTIubmV3KDAsIDgsIDAsIDgpCiAgICAgICAgICAgICAgICBBcnJvdy5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBBcnJvdy5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICAgICAgICAgIEFycm93LlBhcmVudCA9IEhlYWRlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBPcHRpb25zID0gSW5zdGFuY2UubmV3KCdTY3JvbGxpbmdGcmFtZScpCiAgICAgICAgICAgICAgICBPcHRpb25zLlNjcm9sbEJhckltYWdlQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgIE9wdGlvbnMuQWN0aXZlID0gdHJ1ZQogICAgICAgICAgICAgICAgT3B0aW9ucy5TY3JvbGxCYXJJbWFnZVRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIE9wdGlvbnMuQXV0b21hdGljQ2FudmFzU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWQogICAgICAgICAgICAgICAgT3B0aW9ucy5TY3JvbGxCYXJUaGlja25lc3MgPSAwCiAgICAgICAgICAgICAgICBPcHRpb25zLk5hbWUgPSAnT3B0aW9ucycKICAgICAgICAgICAgICAgIE9wdGlvbnMuU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDcsIDAsIDApCiAgICAgICAgICAgICAgICBPcHRpb25zLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBPcHRpb25zLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDEsIDApCiAgICAgICAgICAgICAgICBPcHRpb25zLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKQogICAgICAgICAgICAgICAgT3B0aW9ucy5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgT3B0aW9ucy5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBPcHRpb25zLkNhbnZhc1NpemUgPSBVRGltMi5uZXcoMCwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgT3B0aW9ucy5QYXJlbnQgPSBCb3gKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVUlMaXN0TGF5b3V0ID0gSW5zdGFuY2UubmV3KCdVSUxpc3RMYXlvdXQnKQogICAgICAgICAgICAgICAgVUlMaXN0TGF5b3V0LlNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICBVSUxpc3RMYXlvdXQuUGFyZW50ID0gT3B0aW9ucwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBVSVBhZGRpbmcgPSBJbnN0YW5jZS5uZXcoJ1VJUGFkZGluZycpCiAgICAgICAgICAgICAgICBVSVBhZGRpbmcuUGFkZGluZ1RvcCA9IFVEaW0ubmV3KDAsIC0xKQogICAgICAgICAgICAgICAgVUlQYWRkaW5nLlBhZGRpbmdMZWZ0ID0gVURpbS5uZXcoMCwgMTApCiAgICAgICAgICAgICAgICBVSVBhZGRpbmcuUGFyZW50ID0gT3B0aW9ucwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBVSUxpc3RMYXlvdXQgPSBJbnN0YW5jZS5uZXcoJ1VJTGlzdExheW91dCcpCiAgICAgICAgICAgICAgICBVSUxpc3RMYXlvdXQuU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIFVJTGlzdExheW91dC5QYXJlbnQgPSBCb3gKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBEcm9wZG93bk1hbmFnZXI6dXBkYXRlKG9wdGlvbjogc3RyaW5nKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHNldHRpbmdzLm11bHRpX2Ryb3Bkb3duIHRoZW4KICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEN1cnJlbnRUYXJnZXRWYWx1ZSA9IG5pbDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICNMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID4gMCB0aGVuCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRhcmdldFZhbHVlID0gY29udmVydFRhYmxlVG9TdHJpbmcoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSk7CgogICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RlZCA9IHt9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiBDdXJyZW50VGFyZ2V0VmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHZhbHVlIGluIHN0cmluZy5nbWF0Y2goQ3VycmVudFRhcmdldFZhbHVlLCAiKFteLF0rKSIpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0cmltbWVkVmFsdWUgPSB2YWx1ZTptYXRjaCgiXiVzKiguLSklcyokIikgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0cmltbWVkVmFsdWUgfj0gIkxhYmVsIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChzZWxlY3RlZCwgdHJpbW1lZFZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB2YWx1ZSBpbiBzdHJpbmcuZ21hdGNoKEN1cnJlbnRPcHRpb24uVGV4dCwgIihbXixdKykiKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRyaW1tZWRWYWx1ZSA9IHZhbHVlOm1hdGNoKCJeJXMqKC4tKSVzKiQiKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0cmltbWVkVmFsdWUgfj0gIkxhYmVsIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChzZWxlY3RlZCwgdHJpbW1lZFZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBDdXJyZW50VGV4dEdldCA9IGNvbnZlcnRTdHJpbmdUb1RhYmxlKEN1cnJlbnRPcHRpb24uVGV4dCk7CgogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25Ta2liaWRpID0gIm5pbCI7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHR5cGVvZihvcHRpb24pIH49ICdzdHJpbmcnIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvblNraWJpZGkgPSBvcHRpb24uTmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uU2tpYmlkaSA9IG9wdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZm91bmQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhDdXJyZW50VGV4dEdldCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHYgPT0gb3B0aW9uU2tpYmlkaSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUucmVtb3ZlKEN1cnJlbnRUZXh0R2V0LCBpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uVGV4dCA9IHRhYmxlLmNvbmNhdChzZWxlY3RlZCwgIiwgIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgT3B0aW9uc0NoaWxkID0ge30KICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIG9iamVjdCBpbiBPcHRpb25zOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9iamVjdC5OYW1lID09ICJPcHRpb24iIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoT3B0aW9uc0NoaWxkLCBvYmplY3QuVGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0YWJsZS5maW5kKHNlbGVjdGVkLCBvYmplY3QuVGV4dCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuVGV4dFRyYW5zcGFyZW5jeSA9IDAuMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LlRleHRUcmFuc3BhcmVuY3kgPSAwLjYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRUYXJnZXRWYWx1ZSA9IGNvbnZlcnRTdHJpbmdUb1RhYmxlKEN1cnJlbnRPcHRpb24uVGV4dCk7CgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBDdXJyZW50VGFyZ2V0VmFsdWUgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0YWJsZS5maW5kKE9wdGlvbnNDaGlsZCwgdikgYW5kIHRhYmxlLmZpbmQoc2VsZWN0ZWQsIHYpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUoc2VsZWN0ZWQsIF8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uVGV4dCA9IHRhYmxlLmNvbmNhdChzZWxlY3RlZCwgIiwgIik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSA9IGNvbnZlcnRTdHJpbmdUb1RhYmxlKEN1cnJlbnRPcHRpb24uVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5UZXh0ID0gKHR5cGVvZihvcHRpb24pID09ICJzdHJpbmciIGFuZCBvcHRpb24pIG9yIG9wdGlvbi5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCBvYmplY3QgaW4gT3B0aW9uczpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvYmplY3QuTmFtZSA9PSAiT3B0aW9uIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb2JqZWN0LlRleHQgPT0gQ3VycmVudE9wdGlvbi5UZXh0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LlRleHRUcmFuc3BhcmVuY3kgPSAwLjIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5UZXh0VHJhbnNwYXJlbmN5ID0gMC42CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnkuX2NvbmZpZy5fZmxhZ3Nbc2V0dGluZ3MuZmxhZ10gPSBvcHRpb24KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhvcHRpb24pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQ3VycmVudERyb3BTaXplU3RhdGUgPSAwOwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duTWFuYWdlcjp1bmZvbGRfc2V0dGluZ3MoKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3N0YXRlID0gbm90IHNlbGYuX3N0YXRlCgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX3N0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlci5fbXVsdGlwbGllciArPSBzZWxmLl9zaXplCgogICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50RHJvcFNpemVTdGF0ZSA9IHNlbGYuX3NpemU7CgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKE1vZHVsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgOTMgKyBNb2R1bGVNYW5hZ2VyLl9zaXplICsgTW9kdWxlTWFuYWdlci5fbXVsdGlwbGllcikKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKE1vZHVsZS5PcHRpb25zLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCBNb2R1bGVNYW5hZ2VyLl9zaXplICsgTW9kdWxlTWFuYWdlci5fbXVsdGlwbGllcikKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjA3LCAzOSArIHNlbGYuX3NpemUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQoKICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShCb3gsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgyMDcsIDIyICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKEFycm93LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSAxODAKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVNYW5hZ2VyLl9tdWx0aXBsaWVyIC09IHNlbGYuX3NpemUKCiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnREcm9wU2l6ZVN0YXRlID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoTW9kdWxlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCA5MyArIE1vZHVsZU1hbmFnZXIuX3NpemUgKyBNb2R1bGVNYW5hZ2VyLl9tdWx0aXBsaWVyKQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoTW9kdWxlLk9wdGlvbnMsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIE1vZHVsZU1hbmFnZXIuX3NpemUgKyBNb2R1bGVNYW5hZ2VyLl9tdWx0aXBsaWVyKQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24sIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgyMDcsIDM5KQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQm94LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjA3LCAyMikKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKEFycm93LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgI3NldHRpbmdzLm9wdGlvbnMgPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBEcm9wZG93bk1hbmFnZXIuX3NpemUgPSAzCgogICAgICAgICAgICAgICAgICAgIGZvciBpbmRleCwgdmFsdWUgaW4gc2V0dGluZ3Mub3B0aW9ucyBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBPcHRpb24gPSBJbnN0YW5jZS5uZXcoJ1RleHRCdXR0b24nKQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uQWN0aXZlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uLlRleHRUcmFuc3BhcmVuY3kgPSAwLjYwMDAwMDAyMzg0MTg1NzkKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uVGV4dFNpemUgPSAxMAogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uU2l6ZSA9IFVEaW0yLm5ldygwLCAxODYsIDAsIDE2KQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uVGV4dCA9ICh0eXBlb2YodmFsdWUpID09ICJzdHJpbmciIGFuZCB2YWx1ZSkgb3IgdmFsdWUuTmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uLkF1dG9CdXR0b25Db2xvciA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5OYW1lID0gJ09wdGlvbicKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uU2VsZWN0YWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjA0OTk5OTg4MTUzNTc2ODUxLCAwLCAwLjM0MjEwNTI2OTQzMjA2Nzg3LCAwKQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5QYXJlbnQgPSBPcHRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBVSUdyYWRpZW50ID0gSW5zdGFuY2UubmV3KCdVSUdyYWRpZW50JykKICAgICAgICAgICAgICAgICAgICAgICAgVUlHcmFkaWVudC5UcmFuc3BhcmVuY3kgPSBOdW1iZXJTZXF1ZW5jZS5uZXd7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAuNzA0LCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAuODcyLCAwLjM2MjUwMDAxMTkyMDkyODk2KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgVUlHcmFkaWVudC5QYXJlbnQgPSBPcHRpb24KCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2V0dGluZ3MubXVsdGlfZHJvcGRvd24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSwgdmFsdWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpyZW1vdmVfdGFibGVfdmFsdWUoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSwgdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSwgdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEcm9wZG93bk1hbmFnZXI6dXBkYXRlKHZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaW5kZXggPiBzZXR0aW5ncy5tYXhpbXVtX29wdGlvbnMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgRHJvcGRvd25NYW5hZ2VyLl9zaXplICs9IDE2CiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbnMuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjA3LCBEcm9wZG93bk1hbmFnZXIuX3NpemUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBEcm9wZG93bk1hbmFnZXI6TmV3KHZhbHVlKQogICAgICAgICAgICAgICAgICAgIERyb3Bkb3duOkRlc3Ryb3kodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUuT3JkZXJWYWx1ZSA9IERyb3Bkb3duLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlci5fbXVsdGlwbGllciAtPSBDdXJyZW50RHJvcFNpemVTdGF0ZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBNb2R1bGVNYW5hZ2VyOmNyZWF0ZV9kcm9wZG93bih2YWx1ZSkKICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICBpZiBMaWJyYXJ5OmZsYWdfdHlwZShzZXR0aW5ncy5mbGFnLCAnc3RyaW5nJykgdGhlbgogICAgICAgICAgICAgICAgICAgIERyb3Bkb3duTWFuYWdlcjp1cGRhdGUoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBEcm9wZG93bk1hbmFnZXI6dXBkYXRlKHNldHRpbmdzLm9wdGlvbnNbMV0pCiAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgRHJvcGRvd24uTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgRHJvcGRvd25NYW5hZ2VyOnVuZm9sZF9zZXR0aW5ncygpCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgcmV0dXJuIERyb3Bkb3duTWFuYWdlcgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIE1vZHVsZU1hbmFnZXI6Y3JlYXRlX2ZlYXR1cmUoc2V0dGluZ3MpCgogICAgICAgICAgICAgICAgbG9jYWwgY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBMYXlvdXRPcmRlck1vZHVsZSA9IExheW91dE9yZGVyTW9kdWxlICsgMQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NpemUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IDExCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IDIwCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgTW9kdWxlTWFuYWdlci5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSk7CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBPcHRpb25zLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgc2VsZi5fc2l6ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgRmVhdHVyZUNvbnRhaW5lciA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgICAgICAgICAgICAgRmVhdHVyZUNvbnRhaW5lci5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMTYpCiAgICAgICAgICAgICAgICBGZWF0dXJlQ29udGFpbmVyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBGZWF0dXJlQ29udGFpbmVyLlBhcmVudCA9IE9wdGlvbnMKICAgICAgICAgICAgICAgIEZlYXR1cmVDb250YWluZXIuTGF5b3V0T3JkZXIgPSBMYXlvdXRPcmRlck1vZHVsZQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJTGlzdExheW91dCA9IEluc3RhbmNlLm5ldygiVUlMaXN0TGF5b3V0IikKICAgICAgICAgICAgICAgIFVJTGlzdExheW91dC5GaWxsRGlyZWN0aW9uID0gRW51bS5GaWxsRGlyZWN0aW9uLkhvcml6b250YWwKICAgICAgICAgICAgICAgIFVJTGlzdExheW91dC5Tb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgVUlMaXN0TGF5b3V0LlBhcmVudCA9IEZlYXR1cmVDb250YWluZXIKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBGZWF0dXJlQnV0dG9uID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIikKICAgICAgICAgICAgICAgIEZlYXR1cmVCdXR0b24uRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgICAgICAgICAgICAgIEZlYXR1cmVCdXR0b24uVGV4dFNpemUgPSAxMTsKICAgICAgICAgICAgICAgIEZlYXR1cmVCdXR0b24uU2l6ZSA9IFVEaW0yLm5ldygxLCAtMzUsIDAsIDE2KQogICAgICAgICAgICAgICAgRmVhdHVyZUJ1dHRvbi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkKICAgICAgICAgICAgICAgIEZlYXR1cmVCdXR0b24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMjAwLCAyMDApCiAgICAgICAgICAgICAgICBGZWF0dXJlQnV0dG9uLlRleHQgPSAiICAgICIgLi4gc2V0dGluZ3MudGl0bGUgb3IgIiAgICAiIC4uICJGZWF0dXJlIgogICAgICAgICAgICAgICAgRmVhdHVyZUJ1dHRvbi5BdXRvQnV0dG9uQ29sb3IgPSBmYWxzZQogICAgICAgICAgICAgICAgRmVhdHVyZUJ1dHRvbi5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgRmVhdHVyZUJ1dHRvbi5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yCiAgICAgICAgICAgICAgICBGZWF0dXJlQnV0dG9uLlBhcmVudCA9IEZlYXR1cmVDb250YWluZXIKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBSaWdodENvbnRhaW5lciA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgICAgICAgICAgICAgUmlnaHRDb250YWluZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCA0NSwgMCwgMTYpCiAgICAgICAgICAgICAgICBSaWdodENvbnRhaW5lci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgUmlnaHRDb250YWluZXIuUGFyZW50ID0gRmVhdHVyZUNvbnRhaW5lcgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFJpZ2h0TGF5b3V0ID0gSW5zdGFuY2UubmV3KCJVSUxpc3RMYXlvdXQiKQogICAgICAgICAgICAgICAgUmlnaHRMYXlvdXQuUGFkZGluZyA9IFVEaW0ubmV3KDAuMSwgMCkKICAgICAgICAgICAgICAgIFJpZ2h0TGF5b3V0LkZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uSG9yaXpvbnRhbAogICAgICAgICAgICAgICAgUmlnaHRMYXlvdXQuSG9yaXpvbnRhbEFsaWdubWVudCA9IEVudW0uSG9yaXpvbnRhbEFsaWdubWVudC5SaWdodAogICAgICAgICAgICAgICAgUmlnaHRMYXlvdXQuU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIFJpZ2h0TGF5b3V0LlBhcmVudCA9IFJpZ2h0Q29udGFpbmVyCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgS2V5YmluZEJveCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guU2l6ZSA9IFVEaW0yLm5ldygwLCAxNSwgMCwgMTUpCiAgICAgICAgICAgICAgICBLZXliaW5kQm94LkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKQogICAgICAgICAgICAgICAgS2V5YmluZEJveC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCkKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guVGV4dFNpemUgPSAxMQogICAgICAgICAgICAgICAgS2V5YmluZEJveC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgS2V5YmluZEJveC5MYXlvdXRPcmRlciA9IDI7CiAgICAgICAgICAgICAgICBLZXliaW5kQm94LlBhcmVudCA9IFJpZ2h0Q29udGFpbmVyCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgS2V5YmluZEJ1dHRvbiA9IEluc3RhbmNlLm5ldygiVGV4dEJ1dHRvbiIpCiAgICAgICAgICAgICAgICBLZXliaW5kQnV0dG9uLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCkKICAgICAgICAgICAgICAgIEtleWJpbmRCdXR0b24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIEtleWJpbmRCdXR0b24uVGV4dFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIEtleWJpbmRCdXR0b24uUGFyZW50ID0gS2V5YmluZEJveAoKICAgICAgICAgICAgICAgIGxvY2FsIENoZWNrYm94Q29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIsIEtleWJpbmRCb3gpCiAgICAgICAgICAgICAgICBDaGVja2JveENvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCAzKQoKICAgICAgICAgICAgICAgIGxvY2FsIFVJU3Ryb2tlID0gSW5zdGFuY2UubmV3KCJVSVN0cm9rZSIsIEtleWJpbmRCb3gpCiAgICAgICAgICAgICAgICBVSVN0cm9rZS5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICAgICAgICAgICAgICBVSVN0cm9rZS5UaGlja25lc3MgPSAxCiAgICAgICAgICAgICAgICBVSVN0cm9rZS5BcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgTGlicmFyeS5fY29uZmlnLl9mbGFncyB0aGVuCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFncyA9IHt9CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZCA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBCSU5EID0gc2V0dGluZ3MuZGVmYXVsdCBvciAiVW5rbm93biIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjaGVja2VkID0gTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXS5jaGVja2VkCiAgICAgICAgICAgICAgICBLZXliaW5kQm94LlRleHQgPSBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddLkJJTkQKCiAgICAgICAgICAgICAgICBpZiBLZXliaW5kQm94LlRleHQgPT0gIlVua25vd24iIHRoZW4KICAgICAgICAgICAgICAgICAgICBLZXliaW5kQm94LlRleHQgPSAiLi4uIgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgVXNlRl9WYXIgPSBuaWw7CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLmRpc2FibGVjaGVjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQ2hlY2tib3ggPSBJbnN0YW5jZS5uZXcoIlRleHRCdXR0b24iKQogICAgICAgICAgICAgICAgICAgIENoZWNrYm94LlNpemUgPSBVRGltMi5uZXcoMCwgMTUsIDAsIDE1KQogICAgICAgICAgICAgICAgICAgIENoZWNrYm94LkJhY2tncm91bmRDb2xvcjMgPSBjaGVja2VkIGFuZCBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKSBvciBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgICAgIENoZWNrYm94LlRleHQgPSAiIgogICAgICAgICAgICAgICAgICAgIENoZWNrYm94LlBhcmVudCA9IFJpZ2h0Q29udGFpbmVyCiAgICAgICAgICAgICAgICAgICAgQ2hlY2tib3guTGF5b3V0T3JkZXIgPSAxOwoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBVSVN0cm9rZSA9IEluc3RhbmNlLm5ldygiVUlTdHJva2UiLCBDaGVja2JveCkKICAgICAgICAgICAgICAgICAgICBVSVN0cm9rZS5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTUwLCAxNTApCiAgICAgICAgICAgICAgICAgICAgVUlTdHJva2UuVGhpY2tuZXNzID0gMQogICAgICAgICAgICAgICAgICAgIFVJU3Ryb2tlLkFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQ2hlY2tib3hDb3JuZXIgPSBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIikKICAgICAgICAgICAgICAgICAgICBDaGVja2JveENvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCAzKQogICAgICAgICAgICAgICAgICAgIENoZWNrYm94Q29ybmVyLlBhcmVudCA9IENoZWNrYm94CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIHRvZ2dsZVN0YXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZCA9IG5vdCBjaGVja2VkCiAgICAgICAgICAgICAgICAgICAgICAgIENoZWNrYm94LkJhY2tncm91bmRDb2xvcjMgPSBjaGVja2VkIGFuZCBDb2xvcjMuZnJvbVJHQigxNTAsIDE1MCwgMTUwKSBvciBDb2xvcjMuZnJvbVJHQigzMCwgMzAsIDMwKQogICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddLmNoZWNrZWQgPSBjaGVja2VkCiAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZzpzYXZlKGdhbWUuR2FtZUlkLCBMaWJyYXJ5Ll9jb25maWcpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNldHRpbmdzLmNhbGxiYWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKGNoZWNrZWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBVc2VGX1ZhciA9IHRvZ2dsZVN0YXRlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBDaGVja2JveC5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KHRvZ2dsZVN0YXRlKQoKICAgICAgICAgICAgICAgIGVsc2UKCiAgICAgICAgICAgICAgICAgICAgVXNlRl9WYXIgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmJ1dHRvbl9jYWxsYmFjaygpOwogICAgICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgS2V5YmluZEJ1dHRvbi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBLZXliaW5kQm94LlRleHQgPSAiLi4uIgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGlucHV0Q29ubmVjdGlvbgogICAgICAgICAgICAgICAgICAgIGlucHV0Q29ubmVjdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dCwgZ2FtZVByb2Nlc3NlZCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZVByb2Nlc3NlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuS2V5Ym9hcmQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmV3S2V5ID0gaW5wdXQuS2V5Q29kZS5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddLkJJTkQgPSBuZXdLZXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5ld0tleSB+PSAiVW5rbm93biIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmRCb3guVGV4dCA9IG5ld0tleTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZzpzYXZlKGdhbWUuR2FtZUlkLCBMaWJyYXJ5Ll9jb25maWcpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24zIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnkuX2NvbmZpZy5fZmxhZ3Nbc2V0dGluZ3MuZmxhZ10uQklORCA9ICJVbmtub3duIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgS2V5YmluZEJveC5UZXh0ID0gIi4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZzpzYXZlKGdhbWUuR2FtZUlkLCBMaWJyYXJ5Ll9jb25maWcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1sia2V5YmluZF9pbnB1dF8iIC4uIHNldHRpbmdzLmZsYWddID0gaW5wdXRDb25uZWN0aW9uCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwga2V5UHJlc3NDb25uZWN0aW9uCiAgICAgICAgICAgICAgICBrZXlQcmVzc0Nvbm5lY3Rpb24gPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQsIGdhbWVQcm9jZXNzZWQpCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZVByb2Nlc3NlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5LZXlib2FyZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlucHV0LktleUNvZGUuTmFtZSA9PSBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddLkJJTkQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlRl9WYXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1sia2V5YmluZF9wcmVzc18iIC4uIHNldHRpbmdzLmZsYWddID0ga2V5UHJlc3NDb25uZWN0aW9uCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgRmVhdHVyZUJ1dHRvbi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiBzZXR0aW5ncy5idXR0b25fY2FsbGJhY2sgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5idXR0b25fY2FsbGJhY2soKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy5kaXNhYmxlY2hlY2sgdGhlbgogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKGNoZWNrZWQpOwogICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBGZWF0dXJlQ29udGFpbmVyCiAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICByZXR1cm4gTW9kdWxlTWFuYWdlcgogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gVGFiTWFuYWdlcgogICAgZW5kCgogICAgQ29ubmVjdGlvbnNbJ2xpYnJhcnlfdmlzaWJsaXR5J10gPSBVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dDogSW5wdXRPYmplY3QsIHByb2Nlc3M6IGJvb2xlYW4pCiAgICAgICAgaWYgaW5wdXQuS2V5Q29kZSB+PSBFbnVtLktleUNvZGUuUmlnaHRDb250cm9sIHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIHNlbGYuX3VpX29wZW4gPSBub3Qgc2VsZi5fdWlfb3BlbgogICAgICAgIHNlbGY6Y2hhbmdlX3Zpc2libGl0eShzZWxmLl91aV9vcGVuKQogICAgZW5kKQoKICAgIHNlbGYuX3VpLkNvbnRhaW5lci5IYW5kbGVyLk1pbmltaXplLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIHNlbGYuX3VpX29wZW4gPSBub3Qgc2VsZi5fdWlfb3BlbgogICAgICAgIHNlbGY6Y2hhbmdlX3Zpc2libGl0eShzZWxmLl91aV9vcGVuKQogICAgZW5kKQoKICAgIHJldHVybiBzZWxmCmVuZAoKbG9jYWwgbWFpbiA9IExpYnJhcnkubmV3KCkKbG9jYWwgcmFnZSA9IG1haW46Y3JlYXRlX3RhYigiQXV0byBQYXJyeSIsICJyYnhhc3NldGlkOi8vNzY0OTkwNDI1OTkxMjciKQpsb2NhbCByYWdlMiA9IG1haW46Y3JlYXRlX3RhYigiVEIgYW5kIEhvdGtleXMiLCAicmJ4YXNzZXRpZDovLzc2NDk5MDQyNTk5MTI3IikKbG9jYWwgZGV0ZWMgPSBtYWluOmNyZWF0ZV90YWIoIkRldGVjdGlvbnMiLCAicmJ4YXNzZXRpZDovLzEzMjI0MzQyOTY0NzQ3OSIpCmxvY2FsIHBsYXllciA9IG1haW46Y3JlYXRlX3RhYigiUGxheWVyIiwgInJieGFzc2V0aWQ6Ly8xMjYwMTc5MDc0Nzc2MjMiKQpsb2NhbCB3b3JsZCA9IG1haW46Y3JlYXRlX3RhYigidmlzdWFscyIsICJyYnhhc3NldGlkOi8vODUxNjg5MDkxMzE5OTAiKQpsb2NhbCBtaXNjID0gbWFpbjpjcmVhdGVfdGFiKCJFeGNsdXNpdmUiLCAicmJ4YXNzZXRpZDovLzU2Mzk4NDA2MDMiKQpyZXBlYXQKCXRhc2sud2FpdCgpCnVudGlsIGdhbWU6SXNMb2FkZWQoKQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBUb3JuYWRvX1RpbWUgPSB0aWNrKCkKbG9jYWwgVXNlcklucHV0U2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpCmxvY2FsIExhc3RfSW5wdXQgPSBVc2VySW5wdXRTZXJ2aWNlOkdldExhc3RJbnB1dFR5cGUoKQpsb2NhbCBEZWJyaXMgPSBnYW1lOkdldFNlcnZpY2UoIkRlYnJpcyIpCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQpsb2NhbCBWZWN0b3IyX01vdXNlX0xvY2F0aW9uID0gbmlsCmxvY2FsIEdyYWJfUGFycnkgPSBuaWwKbG9jYWwgUmVtb3RlcyA9IHt9CmxvY2FsIFBhcnJ5X0tleSA9IG5pbApsb2NhbCBTcGVlZF9EaXZpc29yX011bHRpcGxpZXIgPSAxLjEKbG9jYWwgTG9iYnlBUF9TcGVlZF9EaXZpc29yX011bHRpcGxpZXIgPSAxLjEKbG9jYWwgZmlyc3RQYXJyeUZpcmVkID0gZmFsc2UKbG9jYWwgUGFycnlUaHJlc2hvbGQgPSAxCmxvY2FsIGZpcnN0UGFycnlUeXBlID0gIkZfS2V5Igpsb2NhbCBQcmV2aW91c19Qb3NpdGlvbnMgPSB7fQpsb2NhbCBWaXJ0dWFsSW5wdXRNYW5hZ2VyID0gZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIikKbG9jYWwgVmlydHVhbElucHV0U2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpCmxvY2FsIHBhcnJ5Q29vbGRvd24gPSAwLjAKbG9jYWwgbGFzdFBhcnJ5VGltZSA9IDAKbG9jYWwgR3VpU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiR3VpU2VydmljZSIpCmxvY2FsIGZ1bmN0aW9uIHVwZGF0ZU5hdmlnYXRpb24oZ3VpT2JqZWN0KQoJaWYgZ3VpT2JqZWN0IHRoZW4KCQlHdWlTZXJ2aWNlLlNlbGVjdGVkT2JqZWN0ID0gZ3VpT2JqZWN0CgllbHNlCgkJR3VpU2VydmljZS5TZWxlY3RlZE9iamVjdCA9IG5pbAoJZW5kCmVuZApsb2NhbCBmdW5jdGlvbiBwZXJmb3JtRmlyc3RQcmVzcyhwYXJyeVR5cGUpCglpZiBwYXJyeVR5cGUgPT0gIkZfS2V5IiB0aGVuCgkJVmlydHVhbElucHV0U2VydmljZTpTZW5kS2V5RXZlbnQodHJ1ZSwgRW51bS5LZXlDb2RlLkYsIGZhbHNlLCBuaWwpCgllbHNlaWYgcGFycnlUeXBlID09ICJMZWZ0X0NsaWNrIiB0aGVuCgkJVmlydHVhbElucHV0TWFuYWdlcjpTZW5kTW91c2VCdXR0b25FdmVudCgwLCAwLCAwLCB0cnVlLCBnYW1lLCAwKQoJZWxzZWlmIHBhcnJ5VHlwZSA9PSAiTmF2aWdhdGlvbiIgdGhlbgoJCWxvY2FsIGJ1dHRvbiA9IFBsYXllcnMuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkhvdGJhci5CbG9jawoJCXVwZGF0ZU5hdmlnYXRpb24oYnV0dG9uKQoJCVZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5SZXR1cm4sIGZhbHNlLCBnYW1lKQoJCVZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KGZhbHNlLCBFbnVtLktleUNvZGUuUmV0dXJuLCBmYWxzZSwgZ2FtZSkKCQl0YXNrLndhaXQoMC4wKQoJCXVwZGF0ZU5hdmlnYXRpb24obmlsKQoJZW5kCmVuZAppZiBub3QgTFBIX09CRlVTQ0FURUQgdGhlbgoJZnVuY3Rpb24gTFBIX0pJVChGdW5jdGlvbikKCQlyZXR1cm4gRnVuY3Rpb24KCWVuZAoJZnVuY3Rpb24gTFBIX0pJVF9NQVgoRnVuY3Rpb24pCgkJcmV0dXJuIEZ1bmN0aW9uCgllbmQKCWZ1bmN0aW9uIExQSF9OT19WSVJUVUFMSVpFKEZ1bmN0aW9uKQoJCXJldHVybiBGdW5jdGlvbgoJZW5kCmVuZApsb2NhbCBQcml2YXRlS2V5ID0gbmlsCmxvY2FsIFByb3BlcnR5Q2hhbmdlT3JkZXIgPSB7fQpsb2NhbCBIYXNoT25lCmxvY2FsIEhhc2hUd28KbG9jYWwgSGFzaFRocmVlCkxQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKCWZvciBJbmRleCwgVmFsdWUgaW4gbmV4dCwgZ2V0Z2MoKSBkbwoJCWlmCgkJCXJhd2VxdWFsKHR5cGVvZihWYWx1ZSksICJmdW5jdGlvbiIpCgkJCWFuZCBpc2xjbG9zdXJlKFZhbHVlKQoJCQlhbmQgZ2V0cmVudigpLmRlYnVnLmluZm8oVmFsdWUsICJzIik6ZmluZCgiU3dvcmRzQ29udHJvbGxlciIpCgkJdGhlbgoJCQlpZiByYXdlcXVhbChnZXRyZW52KCkuZGVidWcuaW5mbyhWYWx1ZSwgImwiKSwgMjYzKSB0aGVuCgkJCQlIYXNoT25lID0gZ2V0Y29uc3RhbnQoVmFsdWUsIDYyKQoJCQkJSGFzaFR3byA9IGdldGNvbnN0YW50KFZhbHVlLCA2NCkKCQkJCUhhc2hUaHJlZSA9IGdldGNvbnN0YW50KFZhbHVlLCA2NSkKCQkJZW5kCgkJZW5kCgllbmQKZW5kKSgpCkxQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uKCkKCWZvciBJbmRleCwgT2JqZWN0IGluIG5leHQsIGdhbWU6R2V0RGVzY2VuZGFudHMoKSBkbwoJCWlmIE9iamVjdDpJc0EoIlJlbW90ZUV2ZW50IikgYW5kIHN0cmluZy5maW5kKE9iamVjdC5OYW1lLCAiXG4iKSB0aGVuCgkJCU9iamVjdC5DaGFuZ2VkOk9uY2UoZnVuY3Rpb24oKQoJCQkJdGFibGUuaW5zZXJ0KFByb3BlcnR5Q2hhbmdlT3JkZXIsIE9iamVjdCkKCQkJZW5kKQoJCWVuZAoJZW5kCmVuZCkoKQpyZXBlYXQKCXRhc2sud2FpdCgpCnVudGlsICNQcm9wZXJ0eUNoYW5nZU9yZGVyID09IDMKbG9jYWwgU2hvdWxkUGxheWVySnVtcCA9IFByb3BlcnR5Q2hhbmdlT3JkZXJbMV0KbG9jYWwgTWFpblJlbW90ZSA9IFByb3BlcnR5Q2hhbmdlT3JkZXJbMl0KbG9jYWwgR2V0T3Bwb25lbnRQb3NpdGlvbiA9IFByb3BlcnR5Q2hhbmdlT3JkZXJbM10KbG9jYWwgUmVtb3RlcyA9IHt9CmxvY2FsIFBhcnJ5X0tleSA9IG5pbApsb2NhbCBhY3RpdmVNZXRob2QgPSAiUmVtb3RlIgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCWZvciBfLCBWYWx1ZSBpbiBnZXRnYygpIGRvCgkJaWYgdHlwZShWYWx1ZSkgPT0gImZ1bmN0aW9uIiBhbmQgaXNsY2xvc3VyZShWYWx1ZSkgdGhlbgoJCQlsb2NhbCBQcm90b3MgPSBkZWJ1Zy5nZXRwcm90b3MoVmFsdWUpCgkJCWxvY2FsIFVwdmFsdWVzID0gZGVidWcuZ2V0dXB2YWx1ZXMoVmFsdWUpCgkJCWxvY2FsIENvbnN0YW50cyA9IGRlYnVnLmdldGNvbnN0YW50cyhWYWx1ZSkKCQkJaWYgI1Byb3RvcyA9PSA0IGFuZCAjVXB2YWx1ZXMgPT0gMjQgYW5kICNDb25zdGFudHMgPj0gMTAyIHRoZW4KCQkJCWxvY2FsIGM2MiA9IENvbnN0YW50c1s2Ml0KCQkJCWxvY2FsIGM2NCA9IENvbnN0YW50c1s2NF0KCQkJCWxvY2FsIGM2NSA9IENvbnN0YW50c1s2NV0KCQkJCVJlbW90ZXNbZGVidWcuZ2V0dXB2YWx1ZShWYWx1ZSwgMTYpXSA9IGM2MgoJCQkJUGFycnlfS2V5ID0gZGVidWcuZ2V0dXB2YWx1ZShWYWx1ZSwgMTcpCgkJCQlSZW1vdGVzW2RlYnVnLmdldHVwdmFsdWUoVmFsdWUsIDE4KV0gPSBjNjQKCQkJCVJlbW90ZXNbZGVidWcuZ2V0dXB2YWx1ZShWYWx1ZSwgMTkpXSA9IGM2NQoJCQkJYnJlYWsKCQkJZW5kCgkJZW5kCgllbmQKZW5kKQpsb2NhbCBLZXkgPSBQYXJyeV9LZXkKbG9jYWwgZnVuY3Rpb24gUGFycnkoLi4uKQoJU2hvdWxkUGxheWVySnVtcDpGaXJlU2VydmVyKEhhc2hPbmUsIFBhcnJ5X0tleSwgLi4uKQoJTWFpblJlbW90ZTpGaXJlU2VydmVyKEhhc2hUd28sIFBhcnJ5X0tleSwgLi4uKQoJR2V0T3Bwb25lbnRQb3NpdGlvbjpGaXJlU2VydmVyKEhhc2hUaHJlZSwgUGFycnlfS2V5LCAuLi4pCmVuZAp0eXBlIGZ1bmN0aW9uSW5mbyA9IHsKCXNjcmlwdE5hbWU6IHN0cmluZywKCW5hbWU6IHN0cmluZywKCWxpbmU6IG51bWJlciwKCXVwdmFsdWVDb3VudDogbnVtYmVyLAoJY29uc3RhbnRDb3VudDogbnVtYmVyLAp9CmxvY2FsIGZ1bmN0aW9uIGdldEZ1bmN0aW9uKHQ6IGZ1bmN0aW9uSW5mbykKCXQgPSB0IG9yIHt9Cglsb2NhbCBmdW5jdGlvbnMgPSB7fQoJbG9jYWwgZnVuY3Rpb24gZmluZE1hdGNoZXMoKQoJCVNldHRocmVhZGlkZW50aXR5KDYpCgkJZm9yIGksIHYgaW4gZ2V0Z2MoKSBkbwoJCQlpZiB0eXBlKHYpID09ICJmdW5jdGlvbiIgYW5kIGlzbGNsb3N1cmUodikgdGhlbgoJCQkJbG9jYWwgbWF0Y2ggPSB0cnVlCgkJCQlsb2NhbCBpbmZvID0gZ2V0aW5mbyh2KQoJCQkJaWYgdC5zY3JpcHROYW1lIGFuZCAobm90IHRvc3RyaW5nKGdldGZlbnYodikuc2NyaXB0KTpmaW5kKHQuc2NyaXB0TmFtZSkpIHRoZW4KCQkJCQltYXRjaCA9IGZhbHNlCgkJCQllbmQKCQkJCWlmIHQubmFtZSBhbmQgaW5mby5uYW1lIH49IHQubmFtZSB0aGVuCgkJCQkJbWF0Y2ggPSBmYWxzZQoJCQkJZW5kCgkJCQlpZiB0LmxpbmUgYW5kIGluZm8uY3VycmVudGxpbmUgfj0gdC5saW5lIHRoZW4KCQkJCQltYXRjaCA9IGZhbHNlCgkJCQllbmQKCQkJCWlmIHQudXB2YWx1ZUNvdW50IGFuZCAjZ2V0dXB2YWx1ZXModikgfj0gdC51cHZhbHVlQ291bnQgdGhlbgoJCQkJCW1hdGNoID0gZmFsc2UKCQkJCWVuZAoJCQkJaWYgdC5jb25zdGFudENvdW50IGFuZCAjZ2V0Y29uc3RhbnRzKHYpIH49IHQuY29uc3RhbnRzQ291bnQgdGhlbgoJCQkJCW1hdGNoID0gZmFsc2UKCQkJCWVuZAoJCQkJaWYgbWF0Y2ggdGhlbgoJCQkJCXRhYmxlLmluc2VydChmdW5jdGlvbnMsIHYpCgkJCQllbmQKCQkJZW5kCgkJZW5kCgkJc2V0dGhyZWFkaWRlbnRpdHkoOCkKCWVuZAoJZmluZE1hdGNoZXMoKQoJaWYgI2Z1bmN0aW9ucyA9PSAwIHRoZW4KCQl3aGlsZSB0YXNrLndhaXQoMSkgYW5kICNmdW5jdGlvbnMgPT0gMCBkbwoJCQlmaW5kTWF0Y2hlcygpCgkJZW5kCgllbmQKCWlmICNmdW5jdGlvbnMgPT0gMSB0aGVuCgkJcmV0dXJuIGZ1bmN0aW9uc1sxXQoJZW5kCmVuZAp0eXBlIHRhYmxlSW5mbyA9IHsKCWhpZ2hFbnRyb3B5VGFibGVJbmRleDogc3RyaW5nLAp9CmdldGdlbnYoKS5za2luQ2hhbmdlciA9IGZhbHNlCmdldGdlbnYoKS5zd29yZE1vZGVsID0gIiIKZ2V0Z2VudigpLnN3b3JkQW5pbWF0aW9ucyA9ICIiCmdldGdlbnYoKS5zd29yZEZYID0gIiIKbG9jYWwgcHJpbnQgPSBmdW5jdGlvbigpIGVuZAppZiBnZXRnZW52KCkudXBkYXRlU3dvcmQgYW5kIGdldGdlbnYoKS5za2luQ2hhbmdlciB0aGVuCglnZXRnZW52KCkudXBkYXRlU3dvcmQoKQoJcmV0dXJuCmVuZApsb2NhbCBmdW5jdGlvbiBnZXRUYWJsZSh0OiB0YWJsZUluZm8pCgl0ID0gdCBvciB7fQoJbG9jYWwgdGFibGVzID0ge30KCWxvY2FsIGZ1bmN0aW9uIGZpbmRNYXRjaGVzKCkKCQlmb3IgaSwgdiBpbiBnZXRnYyh0cnVlKSBkbwoJCQlpZiB0eXBlKHYpID09ICJ0YWJsZSIgdGhlbgoJCQkJbG9jYWwgbWF0Y2ggPSB0cnVlCgkJCQlpZiB0LmhpZ2hFbnRyb3B5VGFibGVJbmRleCBhbmQgKG5vdCByYXdnZXQodiwgdC5oaWdoRW50cm9weVRhYmxlSW5kZXgpKSB0aGVuCgkJCQkJbWF0Y2ggPSBmYWxzZQoJCQkJZW5kCgkJCQlpZiBtYXRjaCB0aGVuCgkJCQkJdGFibGUuaW5zZXJ0KHRhYmxlcywgdikKCQkJCWVuZAoJCQllbmQKCQllbmQKCWVuZAoJZmluZE1hdGNoZXMoKQoJaWYgI3RhYmxlcyA9PSAwIHRoZW4KCQl3aGlsZSB0YXNrLndhaXQoMSkgYW5kICN0YWJsZXMgPT0gMCBkbwoJCQlmaW5kTWF0Y2hlcygpCgkJZW5kCgllbmQKCWlmICN0YWJsZXMgPT0gMSB0aGVuCgkJcmV0dXJuIHRhYmxlc1sxXQoJZW5kCmVuZApsb2NhbCBwbHJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgcGxyID0gcGxycy5Mb2NhbFBsYXllcgpsb2NhbCBycyA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBzd29yZEluc3RhbmNlc0luc3RhbmNlID0KCXJzOldhaXRGb3JDaGlsZCgiU2hhcmVkIiwgOWU5KTpXYWl0Rm9yQ2hpbGQoIlJlcGxpY2F0ZWRJbnN0YW5jZXMiLCA5ZTkpOldhaXRGb3JDaGlsZCgiU3dvcmRzIiwgOWU5KQpsb2NhbCBzd29yZEluc3RhbmNlcyA9IHJlcXVpcmUoc3dvcmRJbnN0YW5jZXNJbnN0YW5jZSkKbG9jYWwgc3dvcmRzQ29udHJvbGxlcgp3aGlsZSB0YXNrLndhaXQoKSBhbmQgbm90IHN3b3Jkc0NvbnRyb2xsZXIgZG8KCWZvciBpLCB2IGluIGdldGNvbm5lY3Rpb25zKHJzLlJlbW90ZXMuRmlyZVN3b3JkSW5mby5PbkNsaWVudEV2ZW50KSBkbwoJCWlmIHYuRnVuY3Rpb24gYW5kIGlzbGNsb3N1cmUodi5GdW5jdGlvbikgdGhlbgoJCQlsb2NhbCB1cHZhbHVlcyA9IGdldHVwdmFsdWVzKHYuRnVuY3Rpb24pCgkJCWlmICN1cHZhbHVlcyA9PSAxIGFuZCB0eXBlKHVwdmFsdWVzWzFdKSA9PSAidGFibGUiIHRoZW4KCQkJCXN3b3Jkc0NvbnRyb2xsZXIgPSB1cHZhbHVlc1sxXQoJCQkJYnJlYWsKCQkJZW5kCgkJZW5kCgllbmQKZW5kCmZ1bmN0aW9uIGdldFNsYXNoTmFtZShzd29yZE5hbWUpCglsb2NhbCBzbGFzaE5hbWUgPSBzd29yZEluc3RhbmNlczpHZXRTd29yZChzd29yZE5hbWUpCglyZXR1cm4gKHNsYXNoTmFtZSBhbmQgc2xhc2hOYW1lLlNsYXNoTmFtZSkgb3IgIlNsYXNoRWZmZWN0IgplbmQKZnVuY3Rpb24gc2V0U3dvcmQoKQoJaWYgbm90IGdldGdlbnYoKS5za2luQ2hhbmdlciB0aGVuCgkJcmV0dXJuCgllbmQKCXNldHVwdmFsdWUocmF3Z2V0KHN3b3JkSW5zdGFuY2VzLCAiRXF1aXBTd29yZFRvIiksIDIsIGZhbHNlKQoJc3dvcmRJbnN0YW5jZXM6RXF1aXBTd29yZFRvKHBsci5DaGFyYWN0ZXIsIGdldGdlbnYoKS5zd29yZE1vZGVsKQoJc3dvcmRzQ29udHJvbGxlcjpTZXRTd29yZChnZXRnZW52KCkuc3dvcmRBbmltYXRpb25zKQplbmQKbG9jYWwgcGxheVBhcnJ5RnVuYwpsb2NhbCBwYXJyeVN1Y2Nlc3NBbGxDb25uZWN0aW9uCndoaWxlIHRhc2sud2FpdCgpIGFuZCBub3QgcGFycnlTdWNjZXNzQWxsQ29ubmVjdGlvbiBkbwoJZm9yIGksIHYgaW4gZ2V0Y29ubmVjdGlvbnMocnMuUmVtb3Rlcy5QYXJyeVN1Y2Nlc3NBbGwuT25DbGllbnRFdmVudCkgZG8KCQlpZiB2LkZ1bmN0aW9uIGFuZCBnZXRpbmZvKHYuRnVuY3Rpb24pLm5hbWUgPT0gInBhcnJ5U3VjY2Vzc0FsbCIgdGhlbgoJCQlwYXJyeVN1Y2Nlc3NBbGxDb25uZWN0aW9uID0gdgoJCQlwbGF5UGFycnlGdW5jID0gdi5GdW5jdGlvbgoJCQl2OkRpc2FibGUoKQoJCWVuZAoJZW5kCmVuZApsb2NhbCBwYXJyeVN1Y2Nlc3NDbGllbnRDb25uZWN0aW9uCndoaWxlIHRhc2sud2FpdCgpIGFuZCBub3QgcGFycnlTdWNjZXNzQ2xpZW50Q29ubmVjdGlvbiBkbwoJZm9yIGksIHYgaW4gZ2V0Y29ubmVjdGlvbnMocnMuUmVtb3Rlcy5QYXJyeVN1Y2Nlc3NDbGllbnQuRXZlbnQpIGRvCgkJaWYgdi5GdW5jdGlvbiBhbmQgZ2V0aW5mbyh2LkZ1bmN0aW9uKS5uYW1lID09ICJwYXJyeVN1Y2Nlc3NBbGwiIHRoZW4KCQkJcGFycnlTdWNjZXNzQ2xpZW50Q29ubmVjdGlvbiA9IHYKCQkJdjpEaXNhYmxlKCkKCQllbmQKCWVuZAplbmQKZ2V0Z2VudigpLnNsYXNoTmFtZSA9IGdldFNsYXNoTmFtZShnZXRnZW52KCkuc3dvcmRGWCkKbG9jYWwgbGFzdE90aGVyUGFycnlUaW1lc3RhbXAgPSAwCmxvY2FsIGNsYXNoQ29ubmVjdGlvbnMgPSB7fQpycy5SZW1vdGVzLlBhcnJ5U3VjY2Vzc0FsbC5PbkNsaWVudEV2ZW50OkNvbm5lY3QoZnVuY3Rpb24oLi4uKQoJc2V0dGhyZWFkaWRlbnRpdHkoMikKCWxvY2FsIGFyZ3MgPSB7IC4uLiB9CglpZiB0b3N0cmluZyhhcmdzWzRdKSB+PSBwbHIuTmFtZSB0aGVuCgkJbGFzdE90aGVyUGFycnlUaW1lc3RhbXAgPSB0aWNrKCkKCWVsc2VpZiBnZXRnZW52KCkuc2tpbkNoYW5nZXIgdGhlbgoJCWFyZ3NbMV0gPSBnZXRnZW52KCkuc2xhc2hOYW1lCgkJYXJnc1szXSA9IGdldGdlbnYoKS5zd29yZEZYCgllbmQKCXJldHVybiBwbGF5UGFycnlGdW5jKHVucGFjayhhcmdzKSkKZW5kKQp0YWJsZS5pbnNlcnQoY2xhc2hDb25uZWN0aW9ucywgZ2V0Y29ubmVjdGlvbnMocnMuUmVtb3Rlcy5QYXJyeVN1Y2Nlc3NBbGwuT25DbGllbnRFdmVudClbMV0pCmdldGdlbnYoKS51cGRhdGVTd29yZCA9IGZ1bmN0aW9uKCkKCWdldGdlbnYoKS5zbGFzaE5hbWUgPSBnZXRTbGFzaE5hbWUoZ2V0Z2VudigpLnN3b3JkRlgpCglzZXRTd29yZCgpCmVuZAp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCXdoaWxlIHRhc2sud2FpdCgxKSBkbwoJCWlmIGdldGdlbnYoKS5za2luQ2hhbmdlciB0aGVuCgkJCWxvY2FsIGNoYXIgPSBwbHIuQ2hhcmFjdGVyIG9yIHBsci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCQkJaWYgcGxyOkdldEF0dHJpYnV0ZSgiQ3VycmVudGx5RXF1aXBwZWRTd29yZCIpIH49IGdldGdlbnYoKS5zd29yZE1vZGVsIHRoZW4KCQkJCXNldFN3b3JkKCkKCQkJZW5kCgkJCWlmIGNoYXIgYW5kIChub3QgY2hhcjpGaW5kRmlyc3RDaGlsZChnZXRnZW52KCkuc3dvcmRNb2RlbCkpIHRoZW4KCQkJCXNldFN3b3JkKCkKCQkJZW5kCgkJCWZvciBfLCB2IGluIChjaGFyIGFuZCBjaGFyOkdldENoaWxkcmVuKCkpIG9yIHt9IGRvCgkJCQlpZiB2OklzQSgiTW9kZWwiKSBhbmQgdi5OYW1lIH49IGdldGdlbnYoKS5zd29yZE1vZGVsIHRoZW4KCQkJCQl2OkRlc3Ryb3koKQoJCQkJZW5kCgkJCQl0YXNrLndhaXQoKQoJCQllbmQKCQllbmQKCWVuZAplbmQpCmxvY2FsIFBhcnJpZXMgPSAwCmZ1bmN0aW9uIGNyZWF0ZV9hbmltYXRpb24ob2JqZWN0LCBpbmZvLCB2YWx1ZSkKCWxvY2FsIGFuaW1hdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIik6Q3JlYXRlKG9iamVjdCwgaW5mbywgdmFsdWUpCglhbmltYXRpb246UGxheSgpCgl0YXNrLndhaXQoaW5mby5UaW1lKQoJRGVicmlzOkFkZEl0ZW0oYW5pbWF0aW9uLCAwKQoJYW5pbWF0aW9uOkRlc3Ryb3koKQoJYW5pbWF0aW9uID0gbmlsCmVuZApsb2NhbCBBbmltYXRpb24gPSB7fQpBbmltYXRpb24uc3RvcmFnZSA9IHt9CkFuaW1hdGlvbi5jdXJyZW50ID0gbmlsCkFuaW1hdGlvbi50cmFjayA9IG5pbApmb3IgXywgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuTWlzYy5FbW90ZXM6R2V0Q2hpbGRyZW4oKSkgZG8KCWlmIHY6SXNBKCJBbmltYXRpb24iKSBhbmQgdjpHZXRBdHRyaWJ1dGUoIkVtb3RlTmFtZSIpIHRoZW4KCQlsb2NhbCBFbW90ZV9OYW1lID0gdjpHZXRBdHRyaWJ1dGUoIkVtb3RlTmFtZSIpCgkJQW5pbWF0aW9uLnN0b3JhZ2VbRW1vdGVfTmFtZV0gPSB2CgllbmQKZW5kCmxvY2FsIEVtb3Rlc19EYXRhID0ge30KZm9yIE9iamVjdCBpbiBwYWlycyhBbmltYXRpb24uc3RvcmFnZSkgZG8KCXRhYmxlLmluc2VydChFbW90ZXNfRGF0YSwgT2JqZWN0KQplbmQKdGFibGUuc29ydChFbW90ZXNfRGF0YSkKbG9jYWwgQXV0b19QYXJyeSA9IHt9CmZ1bmN0aW9uIEF1dG9fUGFycnkuUGFycnlfQW5pbWF0aW9uKCkKCWxvY2FsIFBhcnJ5X0FuaW1hdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TaGFyZWQuU3dvcmRBUEkuQ29sbGVjdGlvbi5EZWZhdWx0CgkJOkZpbmRGaXJzdENoaWxkKCJHcmFiUGFycnkiKQoJbG9jYWwgQ3VycmVudF9Td29yZCA9IFBsYXllci5DaGFyYWN0ZXI6R2V0QXR0cmlidXRlKCJDdXJyZW50bHlFcXVpcHBlZFN3b3JkIikKCWlmIG5vdCBDdXJyZW50X1N3b3JkIHRoZW4KCQlyZXR1cm4KCWVuZAoJaWYgbm90IFBhcnJ5X0FuaW1hdGlvbiB0aGVuCgkJcmV0dXJuCgllbmQKCWxvY2FsIFN3b3JkX0RhdGEgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU2hhcmVkLlJlcGxpY2F0ZWRJbnN0YW5jZXMuU3dvcmRzLkdldFN3b3JkCgkJOkludm9rZShDdXJyZW50X1N3b3JkKQoJaWYgbm90IFN3b3JkX0RhdGEgb3Igbm90IFN3b3JkX0RhdGFbIkFuaW1hdGlvblR5cGUiXSB0aGVuCgkJcmV0dXJuCgllbmQKCWZvciBfLCBvYmplY3QgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlNoYXJlZC5Td29yZEFQSS5Db2xsZWN0aW9uOkdldENoaWxkcmVuKCkpIGRvCgkJaWYgb2JqZWN0Lk5hbWUgPT0gU3dvcmRfRGF0YVsiQW5pbWF0aW9uVHlwZSJdIHRoZW4KCQkJaWYgb2JqZWN0OkZpbmRGaXJzdENoaWxkKCJHcmFiUGFycnkiKSBvciBvYmplY3Q6RmluZEZpcnN0Q2hpbGQoIkdyYWIiKSB0aGVuCgkJCQlsb2NhbCBzd29yZF9hbmltYXRpb25fdHlwZSA9ICJHcmFiUGFycnkiCgkJCQlpZiBvYmplY3Q6RmluZEZpcnN0Q2hpbGQoIkdyYWIiKSB0aGVuCgkJCQkJc3dvcmRfYW5pbWF0aW9uX3R5cGUgPSAiR3JhYiIKCQkJCWVuZAoJCQkJUGFycnlfQW5pbWF0aW9uID0gb2JqZWN0W3N3b3JkX2FuaW1hdGlvbl90eXBlXQoJCQllbmQKCQllbmQKCWVuZAoJR3JhYl9QYXJyeSA9IFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuQW5pbWF0b3I6TG9hZEFuaW1hdGlvbihQYXJyeV9BbmltYXRpb24pCglHcmFiX1BhcnJ5OlBsYXkoKQplbmQKZnVuY3Rpb24gQXV0b19QYXJyeS5QbGF5X0FuaW1hdGlvbih2KQoJbG9jYWwgQW5pbWF0aW9ucyA9IEFuaW1hdGlvbi5zdG9yYWdlW3ZdCglpZiBub3QgQW5pbWF0aW9ucyB0aGVuCgkJcmV0dXJuIGZhbHNlCgllbmQKCWxvY2FsIEFuaW1hdG9yID0gUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5BbmltYXRvcgoJaWYgQW5pbWF0aW9uLnRyYWNrIHRoZW4KCQlBbmltYXRpb24udHJhY2s6U3RvcCgpCgllbmQKCUFuaW1hdGlvbi50cmFjayA9IEFuaW1hdG9yOkxvYWRBbmltYXRpb24oQW5pbWF0aW9ucykKCUFuaW1hdGlvbi50cmFjazpQbGF5KCkKCUFuaW1hdGlvbi5jdXJyZW50ID0gdgplbmQKZnVuY3Rpb24gQXV0b19QYXJyeS5HZXRfQmFsbHMoKQoJbG9jYWwgQmFsbHMgPSB7fQoJZm9yIF8sIEluc3RhbmNlIGluIHBhaXJzKHdvcmtzcGFjZS5CYWxsczpHZXRDaGlsZHJlbigpKSBkbwoJCWlmIEluc3RhbmNlOkdldEF0dHJpYnV0ZSgicmVhbEJhbGwiKSB0aGVuCgkJCUluc3RhbmNlLkNhbkNvbGxpZGUgPSBmYWxzZQoJCQl0YWJsZS5pbnNlcnQoQmFsbHMsIEluc3RhbmNlKQoJCWVuZAoJZW5kCglyZXR1cm4gQmFsbHMKZW5kCmZ1bmN0aW9uIEF1dG9fUGFycnkuR2V0X0JhbGwoKQoJZm9yIF8sIEluc3RhbmNlIGluIHBhaXJzKHdvcmtzcGFjZS5CYWxsczpHZXRDaGlsZHJlbigpKSBkbwoJCWlmIEluc3RhbmNlOkdldEF0dHJpYnV0ZSgicmVhbEJhbGwiKSB0aGVuCgkJCUluc3RhbmNlLkNhbkNvbGxpZGUgPSBmYWxzZQoJCQlyZXR1cm4gSW5zdGFuY2UKCQllbmQKCWVuZAplbmQKZnVuY3Rpb24gQXV0b19QYXJyeS5Mb2JieV9CYWxscygpCglmb3IgXywgSW5zdGFuY2UgaW4gcGFpcnMod29ya3NwYWNlLlRyYWluaW5nQmFsbHM6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiBJbnN0YW5jZTpHZXRBdHRyaWJ1dGUoInJlYWxCYWxsIikgdGhlbgoJCQlyZXR1cm4gSW5zdGFuY2UKCQllbmQKCWVuZAplbmQKbG9jYWwgQ2xvc2VzdF9FbnRpdHkgPSBuaWwKZnVuY3Rpb24gQXV0b19QYXJyeS5DbG9zZXN0X1BsYXllcigpCglsb2NhbCBNYXhfRGlzdGFuY2UgPSBtYXRoLmh1Z2UKCWxvY2FsIEZvdW5kX0VudGl0eSA9IG5pbAoJZm9yIF8sIEVudGl0eSBpbiBwYWlycyh3b3Jrc3BhY2UuQWxpdmU6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiB0b3N0cmluZyhFbnRpdHkpIH49IHRvc3RyaW5nKFBsYXllcikgdGhlbgoJCQlpZiBFbnRpdHkuUHJpbWFyeVBhcnQgdGhlbgoJCQkJbG9jYWwgRGlzdGFuY2UgPSBQbGF5ZXI6RGlzdGFuY2VGcm9tQ2hhcmFjdGVyKEVudGl0eS5QcmltYXJ5UGFydC5Qb3NpdGlvbikKCQkJCWlmIERpc3RhbmNlIDwgTWF4X0Rpc3RhbmNlIHRoZW4KCQkJCQlNYXhfRGlzdGFuY2UgPSBEaXN0YW5jZQoJCQkJCUZvdW5kX0VudGl0eSA9IEVudGl0eQoJCQkJZW5kCgkJCWVuZAoJCWVuZAoJZW5kCglDbG9zZXN0X0VudGl0eSA9IEZvdW5kX0VudGl0eQoJcmV0dXJuIEZvdW5kX0VudGl0eQplbmQKZnVuY3Rpb24gQXV0b19QYXJyeTpHZXRfRW50aXR5X1Byb3BlcnRpZXMoKQoJQXV0b19QYXJyeS5DbG9zZXN0X1BsYXllcigpCglpZiBub3QgQ2xvc2VzdF9FbnRpdHkgdGhlbgoJCXJldHVybiBmYWxzZQoJZW5kCglsb2NhbCBFbnRpdHlfVmVsb2NpdHkgPSBDbG9zZXN0X0VudGl0eS5QcmltYXJ5UGFydC5WZWxvY2l0eQoJbG9jYWwgRW50aXR5X0RpcmVjdGlvbiA9IChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uIC0gQ2xvc2VzdF9FbnRpdHkuUHJpbWFyeVBhcnQuUG9zaXRpb24pLlVuaXQKCWxvY2FsIEVudGl0eV9EaXN0YW5jZSA9IChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uIC0gQ2xvc2VzdF9FbnRpdHkuUHJpbWFyeVBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQoJcmV0dXJuIHsKCQlWZWxvY2l0eSA9IEVudGl0eV9WZWxvY2l0eSwKCQlEaXJlY3Rpb24gPSBFbnRpdHlfRGlyZWN0aW9uLAoJCURpc3RhbmNlID0gRW50aXR5X0Rpc3RhbmNlLAoJfQplbmQKbG9jYWwgaXNNb2JpbGUgPSBVc2VySW5wdXRTZXJ2aWNlLlRvdWNoRW5hYmxlZCBhbmQgbm90IFVzZXJJbnB1dFNlcnZpY2UuTW91c2VFbmFibGVkCmZ1bmN0aW9uIEF1dG9fUGFycnkuUGFycnlfRGF0YShQYXJyeV9UeXBlKQoJQXV0b19QYXJyeS5DbG9zZXN0X1BsYXllcigpCglsb2NhbCBFdmVudHMgPSB7fQoJbG9jYWwgQ2FtZXJhID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKCWxvY2FsIFZlY3RvcjJfTW91c2VfTG9jYXRpb24KCWlmCgkJTGFzdF9JbnB1dCA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xCgkJb3IgKEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjIgb3IgTGFzdF9JbnB1dCA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuS2V5Ym9hcmQpCgl0aGVuCgkJbG9jYWwgTW91c2VfTG9jYXRpb24gPSBVc2VySW5wdXRTZXJ2aWNlOkdldE1vdXNlTG9jYXRpb24oKQoJCVZlY3RvcjJfTW91c2VfTG9jYXRpb24gPSB7IE1vdXNlX0xvY2F0aW9uLlgsIE1vdXNlX0xvY2F0aW9uLlkgfQoJZWxzZQoJCVZlY3RvcjJfTW91c2VfTG9jYXRpb24gPSB7IENhbWVyYS5WaWV3cG9ydFNpemUuWCAvIDIsIENhbWVyYS5WaWV3cG9ydFNpemUuWSAvIDIgfQoJZW5kCglpZiBpc01vYmlsZSB0aGVuCgkJVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbiA9IHsgQ2FtZXJhLlZpZXdwb3J0U2l6ZS5YIC8gMiwgQ2FtZXJhLlZpZXdwb3J0U2l6ZS5ZIC8gMiB9CgllbmQKCWxvY2FsIFBsYXllcnNfU2NyZWVuX1Bvc2l0aW9ucyA9IHt9Cglmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2UuQWxpdmU6R2V0Q2hpbGRyZW4oKSkgZG8KCQlpZiB2IH49IFBsYXllci5DaGFyYWN0ZXIgdGhlbgoJCQlsb2NhbCB3b3JsZFBvcyA9IHYuUHJpbWFyeVBhcnQuUG9zaXRpb24KCQkJbG9jYWwgc2NyZWVuUG9zLCBpc09uU2NyZWVuID0gQ2FtZXJhOldvcmxkVG9TY3JlZW5Qb2ludCh3b3JsZFBvcykKCQkJaWYgaXNPblNjcmVlbiB0aGVuCgkJCQlQbGF5ZXJzX1NjcmVlbl9Qb3NpdGlvbnNbdl0gPSBWZWN0b3IyLm5ldyhzY3JlZW5Qb3MuWCwgc2NyZWVuUG9zLlkpCgkJCWVuZAoJCQlFdmVudHNbdG9zdHJpbmcodildID0gc2NyZWVuUG9zCgkJZW5kCgllbmQKCWlmIFBhcnJ5X1R5cGUgPT0gIkNhbWVyYSIgdGhlbgoJCXJldHVybiB7IDAsIENhbWVyYS5DRnJhbWUsIEV2ZW50cywgVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbiB9CgllbmQKCWlmIFBhcnJ5X1R5cGUgPT0gIkJhY2t3YXJkcyIgdGhlbgoJCWxvY2FsIEJhY2t3YXJkc19EaXJlY3Rpb24gPSBDYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IgKiAtMTAwMDAKCQlCYWNrd2FyZHNfRGlyZWN0aW9uID0gVmVjdG9yMy5uZXcoQmFja3dhcmRzX0RpcmVjdGlvbi5YLCAwLCBCYWNrd2FyZHNfRGlyZWN0aW9uLlopCgkJcmV0dXJuIHsKCQkJMCwKCQkJQ0ZyYW1lLm5ldyhDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uLCBDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uICsgQmFja3dhcmRzX0RpcmVjdGlvbiksCgkJCUV2ZW50cywKCQkJVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbiwKCQl9CgllbmQKCWlmIFBhcnJ5X1R5cGUgPT0gIlN0cmFpZ2h0IiB0aGVuCgkJbG9jYWwgQWltZWRfUGxheWVyID0gbmlsCgkJbG9jYWwgQ2xvc2VzdF9EaXN0YW5jZSA9IG1hdGguaHVnZQoJCWxvY2FsIE1vdXNlX1ZlY3RvciA9IFZlY3RvcjIubmV3KFZlY3RvcjJfTW91c2VfTG9jYXRpb25bMV0sIFZlY3RvcjJfTW91c2VfTG9jYXRpb25bMl0pCgkJZm9yIF8sIHYgaW4gcGFpcnMod29ya3NwYWNlLkFsaXZlOkdldENoaWxkcmVuKCkpIGRvCgkJCWlmIHYgfj0gUGxheWVyLkNoYXJhY3RlciB0aGVuCgkJCQlsb2NhbCB3b3JsZFBvcyA9IHYuUHJpbWFyeVBhcnQuUG9zaXRpb24KCQkJCWxvY2FsIHNjcmVlblBvcywgaXNPblNjcmVlbiA9IENhbWVyYTpXb3JsZFRvU2NyZWVuUG9pbnQod29ybGRQb3MpCgkJCQlpZiBpc09uU2NyZWVuIHRoZW4KCQkJCQlsb2NhbCBwbGF5ZXJTY3JlZW5Qb3MgPSBWZWN0b3IyLm5ldyhzY3JlZW5Qb3MuWCwgc2NyZWVuUG9zLlkpCgkJCQkJbG9jYWwgZGlzdGFuY2UgPSAoTW91c2VfVmVjdG9yIC0gcGxheWVyU2NyZWVuUG9zKS5NYWduaXR1ZGUKCQkJCQlpZiBkaXN0YW5jZSA8IENsb3Nlc3RfRGlzdGFuY2UgdGhlbgoJCQkJCQlDbG9zZXN0X0Rpc3RhbmNlID0gZGlzdGFuY2UKCQkJCQkJQWltZWRfUGxheWVyID0gdgoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCWVuZAoJCWlmIEFpbWVkX1BsYXllciB0aGVuCgkJCXJldHVybiB7CgkJCQkwLAoJCQkJQ0ZyYW1lLm5ldyhQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uLCBBaW1lZF9QbGF5ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24pLAoJCQkJRXZlbnRzLAoJCQkJVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbiwKCQkJfQoJCWVsc2UKCQkJcmV0dXJuIHsKCQkJCTAsCgkJCQlDRnJhbWUubmV3KFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24sIENsb3Nlc3RfRW50aXR5LlByaW1hcnlQYXJ0LlBvc2l0aW9uKSwKCQkJCUV2ZW50cywKCQkJCVZlY3RvcjJfTW91c2VfTG9jYXRpb24sCgkJCX0KCQllbmQKCWVuZAoJaWYgUGFycnlfVHlwZSA9PSAiUmFuZG9tIiB0aGVuCgkJcmV0dXJuIHsKCQkJMCwKCQkJQ0ZyYW1lLm5ldygKCQkJCUNhbWVyYS5DRnJhbWUuUG9zaXRpb24sCgkJCQlWZWN0b3IzLm5ldyhtYXRoLnJhbmRvbSgtNDAwMCwgNDAwMCksIG1hdGgucmFuZG9tKC00MDAwLCA0MDAwKSwgbWF0aC5yYW5kb20oLTQwMDAsIDQwMDApKQoJCQkpLAoJCQlFdmVudHMsCgkJCVZlY3RvcjJfTW91c2VfTG9jYXRpb24sCgkJfQoJZW5kCglpZiBQYXJyeV9UeXBlID09ICJIaWdoIiB0aGVuCgkJbG9jYWwgSGlnaF9EaXJlY3Rpb24gPSBDYW1lcmEuQ0ZyYW1lLlVwVmVjdG9yICogMTAwMDAKCQlyZXR1cm4gewoJCQkwLAoJCQlDRnJhbWUubmV3KENhbWVyYS5DRnJhbWUuUG9zaXRpb24sIENhbWVyYS5DRnJhbWUuUG9zaXRpb24gKyBIaWdoX0RpcmVjdGlvbiksCgkJCUV2ZW50cywKCQkJVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbiwKCQl9CgllbmQKCWlmIFBhcnJ5X1R5cGUgPT0gIkhpZ2giIHRoZW4KCQlsb2NhbCBIaWdoX0RpcmVjdGlvbiA9IFZlY3RvcjMubmV3KDAsIC0xLCAwKSAqIDEwMDAwCgkJcmV0dXJuIHsKCQkJMCwKCQkJQ0ZyYW1lLm5ldyhDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uLCBDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uICsgSGlnaF9EaXJlY3Rpb24pLAoJCQlFdmVudHMsCgkJCVZlY3RvcjJfTW91c2VfTG9jYXRpb24sCgkJfQoJZW5kCglpZiBQYXJyeV9UeXBlID09ICJTbG93YmFsbCIgdGhlbgoJCWxvY2FsIFNsb3diYWxsX0RpcmVjdGlvbiA9IFZlY3RvcjMubmV3KDAsIC0xLCAwKSAqIDk5OTk5CgkJcmV0dXJuIHsKCQkJMCwKCQkJQ0ZyYW1lLm5ldyhDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uLCBDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uICsgU2xvd2JhbGxfRGlyZWN0aW9uKSwKCQkJRXZlbnRzLAoJCQlWZWN0b3IyX01vdXNlX0xvY2F0aW9uLAoJCX0KCWVuZAogICAgaWYgUGFycnlfVHlwZSA9PSAiRmFzdGJhbGwiIHRoZW4KCQlsb2NhbCBGYXN0YmFsbF9EaXJlY3Rpb24gPSBDYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IgKiAxMCArIFZlY3RvcjMubmV3KDAsIDcsIDApCgkJcmV0dXJuIHsKCQkJMCwKCQkJQ0ZyYW1lLm5ldyhDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uLCBDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uICsgRmFzdGJhbGxfRGlyZWN0aW9uKSwKCQkJRXZlbnRzLAoJCQlWZWN0b3IyX01vdXNlX0xvY2F0aW9uLAoJCX0KICAgIGVuZAoJaWYgUGFycnlfVHlwZSA9PSAiTGVmdCIgdGhlbgoJCWxvY2FsIExlZnRfRGlyZWN0aW9uID0gQ2FtZXJhLkNGcmFtZS5SaWdodFZlY3RvciAqIDEwMDAwCgkJcmV0dXJuIHsKCQkJMCwKCQkJQ0ZyYW1lLm5ldyhDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uLCBDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uIC0gTGVmdF9EaXJlY3Rpb24pLAoJCQlFdmVudHMsCgkJCVZlY3RvcjJfTW91c2VfTG9jYXRpb24sCgkJfQoJZW5kCglpZiBQYXJyeV9UeXBlID09ICJSaWdodCIgdGhlbgoJCWxvY2FsIFJpZ2h0X0RpcmVjdGlvbiA9IENhbWVyYS5DRnJhbWUuUmlnaHRWZWN0b3IgKiAxMDAwMAoJCXJldHVybiB7CgkJCTAsCgkJCUNGcmFtZS5uZXcoQ2FtZXJhLkNGcmFtZS5Qb3NpdGlvbiwgQ2FtZXJhLkNGcmFtZS5Qb3NpdGlvbiArIFJpZ2h0X0RpcmVjdGlvbiksCgkJCUV2ZW50cywKCQkJVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbiwKCQl9CgllbmQKCWlmIFBhcnJ5X1R5cGUgPT0gIlJhbmRvbVRhcmdldCIgdGhlbgoJCWxvY2FsIGNhbmRpZGF0ZXMgPSB7fQoJCWZvciBfLCB2IGluIHBhaXJzKHdvcmtzcGFjZS5BbGl2ZTpHZXRDaGlsZHJlbigpKSBkbwoJCQlpZiB2IH49IFBsYXllci5DaGFyYWN0ZXIgYW5kIHYuUHJpbWFyeVBhcnQgdGhlbgoJCQkJbG9jYWwgc2NyZWVuUG9zLCBpc09uU2NyZWVuID0gQ2FtZXJhOldvcmxkVG9TY3JlZW5Qb2ludCh2LlByaW1hcnlQYXJ0LlBvc2l0aW9uKQoJCQkJaWYgaXNPblNjcmVlbiB0aGVuCgkJCQkJdGFibGUuaW5zZXJ0KGNhbmRpZGF0ZXMsIHsKCQkJCQkJY2hhcmFjdGVyID0gdiwKCQkJCQkJc2NyZWVuWFkgPSB7IHNjcmVlblBvcy5YLCBzY3JlZW5Qb3MuWSB9LAoJCQkJCX0pCgkJCQllbmQKCQkJZW5kCgkJZW5kCgkJaWYgI2NhbmRpZGF0ZXMgPiAwIHRoZW4KCQkJbG9jYWwgcGljayA9IGNhbmRpZGF0ZXNbbWF0aC5yYW5kb20oMSwgI2NhbmRpZGF0ZXMpXQoJCQlsb2NhbCBsb29rQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uLCBwaWNrLmNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbikKCQkJcmV0dXJuIHsgMCwgbG9va0NGcmFtZSwgRXZlbnRzLCBwaWNrLnNjcmVlblhZIH0KCQllbHNlCgkJCXJldHVybiB7IDAsIENhbWVyYS5DRnJhbWUsIEV2ZW50cywgeyBDYW1lcmEuVmlld3BvcnRTaXplLlggLyAyLCBDYW1lcmEuVmlld3BvcnRTaXplLlkgLyAyIH0gfQoJCWVuZAoJZW5kCglyZXR1cm4gUGFycnlfVHlwZQplbmQKZnVuY3Rpb24gQXV0b19QYXJyeS5QYXJyeShQYXJyeV9UeXBlKQoJaWYgdGljaygpIC0gbGFzdFBhcnJ5VGltZSA8IHBhcnJ5Q29vbGRvd24gdGhlbgoJCXJldHVybiBmYWxzZQoJZW5kCglsYXN0UGFycnlUaW1lID0gdGljaygpCglsb2NhbCBwcmVzc2VzID0gaXNTcGFtIGFuZCBzcGFtU3BlZWQgb3IgMQoJaWYgYWN0aXZlTWV0aG9kID09ICJGIEtleSIgdGhlbgoJCWZvciBpID0gMSwgcHJlc3NlcyBkbwoJCQlWaXJ0dWFsSW5wdXQ6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5GLCBmYWxzZSwgZ2FtZSkKCQkJVmlydHVhbElucHV0OlNlbmRLZXlFdmVudChmYWxzZSwgRW51bS5LZXlDb2RlLkYsIGZhbHNlLCBnYW1lKQoJCWVuZAoJZWxzZQoJCWxvY2FsIGZvdW5kRmFrZSA9IGZhbHNlCgkJZm9yIF8sIEFyZ3MgaW4gcGFpcnMoUmVtb3RlcykgZG8KCQkJaWYgQXJncyA9PSAiUEFSUllfSEFTSF9GQUtFXzEiIG9yIEFyZ3MgPT0gIl9HIiB0aGVuCgkJCQlmb3VuZEZha2UgPSB0cnVlCgkJCQlicmVhawoJCQllbmQKCQllbmQKCQlsb2NhbCBQYXJyeV9EYXRhID0gQXV0b19QYXJyeS5QYXJyeV9EYXRhKFBhcnJ5X1R5cGUpCgkJZm9yIGkgPSAxLCBwcmVzc2VzIGRvCgkJCWZvciBSZW1vdGUsIEFyZ3MgaW4gcGFpcnMoUmVtb3RlcykgZG8KCQkJCWxvY2FsIEhhc2gKCQkJCWlmIGZvdW5kRmFrZSB0aGVuCgkJCQkJSGFzaCA9IG5pbAoJCQkJZWxzZQoJCQkJCUhhc2ggPSBBcmdzCgkJCQllbmQKCQkJCVJlbW90ZTpGaXJlU2VydmVyKEhhc2gsIFBhcnJ5X0tleSwgUGFycnlfRGF0YVsxXSwgUGFycnlfRGF0YVsyXSwgUGFycnlfRGF0YVszXSwgUGFycnlfRGF0YVs0XSkKCQkJZW5kCgkJZW5kCgllbmQKCWlmIFBhcnJpZXMgPiA3IHRoZW4KCQlyZXR1cm4gZmFsc2UKCWVuZAoJUGFycmllcyArPSAxCgl0YXNrLmRlbGF5KDAuNSwgZnVuY3Rpb24oKQoJCWlmIFBhcnJpZXMgPiAwIHRoZW4KCQkJUGFycmllcyAtPSAxCgkJZW5kCgllbmQpCmVuZApsb2NhbCBMZXJwX1JhZGlhbnMgPSAwCmxvY2FsIExhc3RfV2FycGluZyA9IHRpY2soKQpmdW5jdGlvbiBBdXRvX1BhcnJ5LkxpbmVhcl9JbnRlcnBvbGF0aW9uKGEsIGIsIHRpbWVfdm9sdW1lKQoJcmV0dXJuIGEgKyAoYiAtIGEpICogdGltZV92b2x1bWUKZW5kCmxvY2FsIFByZXZpb3VzX1ZlbG9jaXR5ID0ge30KbG9jYWwgQ3VydmluZyA9IHRpY2soKQpsb2NhbCBSdW50aW1lID0gd29ya3NwYWNlLlJ1bnRpbWUKZnVuY3Rpb24gQXV0b19QYXJyeS5Jc19DdXJ2ZWQoKQoJbG9jYWwgQmFsbCA9IEF1dG9fUGFycnkuR2V0X0JhbGwoKQoJaWYgbm90IEJhbGwgdGhlbgoJCXJldHVybiBmYWxzZQoJZW5kCglsb2NhbCBab29taWVzID0gQmFsbDpGaW5kRmlyc3RDaGlsZCgiem9vbWllcyIpCglpZiBub3QgWm9vbWllcyB0aGVuCgkJcmV0dXJuIGZhbHNlCgllbmQKCWxvY2FsIFBpbmcgPSBnYW1lOkdldFNlcnZpY2UoIlN0YXRzIikuTmV0d29yay5TZXJ2ZXJTdGF0c0l0ZW1bIkRhdGEgUGluZyJdOkdldFZhbHVlKCkKCWxvY2FsIFZlbG9jaXR5ID0gWm9vbWllcy5WZWN0b3JWZWxvY2l0eQoJbG9jYWwgQmFsbF9EaXJlY3Rpb24gPSBWZWxvY2l0eS5Vbml0Cglsb2NhbCBwbGF5ZXJQb3MgPSBQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uCglsb2NhbCBiYWxsUG9zID0gQmFsbC5Qb3NpdGlvbgoJbG9jYWwgRGlyZWN0aW9uID0gKHBsYXllclBvcyAtIGJhbGxQb3MpLlVuaXQKCWxvY2FsIERvdCA9IERpcmVjdGlvbjpEb3QoQmFsbF9EaXJlY3Rpb24pCglsb2NhbCBTcGVlZCA9IFZlbG9jaXR5Lk1hZ25pdHVkZQoJbG9jYWwgU3BlZWRfVGhyZXNob2xkID0gbWF0aC5taW4oU3BlZWQgLyAxMDAsIDQwKQoJbG9jYWwgQW5nbGVfVGhyZXNob2xkID0gNDAgKiBtYXRoLm1heChEb3QsIDApCglsb2NhbCBEaXN0YW5jZSA9IChwbGF5ZXJQb3MgLSBiYWxsUG9zKS5NYWduaXR1ZGUKCWxvY2FsIFJlYWNoX1RpbWUgPSBEaXN0YW5jZSAvIFNwZWVkIC0gKFBpbmcgLyAxMDAwKQoJbG9jYWwgQmFsbF9EaXN0YW5jZV9UaHJlc2hvbGQgPSAxNSAtIG1hdGgubWluKERpc3RhbmNlIC8gMTAwMCwgMTUpICsgU3BlZWRfVGhyZXNob2xkCgl0YWJsZS5pbnNlcnQoUHJldmlvdXNfVmVsb2NpdHksIFZlbG9jaXR5KQoJaWYgI1ByZXZpb3VzX1ZlbG9jaXR5ID4gNCB0aGVuCgkJdGFibGUucmVtb3ZlKFByZXZpb3VzX1ZlbG9jaXR5LCAxKQoJZW5kCglpZiBCYWxsOkZpbmRGaXJzdENoaWxkKCJBZXJvRHluYW1pY1NsYXNoVkZYIikgdGhlbgoJCURlYnJpczpBZGRJdGVtKEJhbGwuQWVyb0R5bmFtaWNTbGFzaFZGWCwgMCkKCQlUb3JuYWRvX1RpbWUgPSB0aWNrKCkKCWVuZAoJaWYgUnVudGltZTpGaW5kRmlyc3RDaGlsZCgiVG9ybmFkbyIpIHRoZW4KCQlpZiAodGljaygpIC0gVG9ybmFkb19UaW1lKSA8ICgoUnVudGltZS5Ub3JuYWRvOkdldEF0dHJpYnV0ZSgiVG9ybmFkb1RpbWUiKSBvciAxKSArIDAuMzE0MTU5KSB0aGVuCgkJCXJldHVybiB0cnVlCgkJZW5kCgllbmQKCWxvY2FsIEVub3VnaF9TcGVlZCA9IFNwZWVkID4gMTYwCglpZiBFbm91Z2hfU3BlZWQgYW5kIFJlYWNoX1RpbWUgPiAoUGluZyAvIDEwICsgMC4wMykgdGhlbgoJCWlmIFNwZWVkIDwgMzAwIHRoZW4KCQkJQmFsbF9EaXN0YW5jZV9UaHJlc2hvbGQgPSBtYXRoLm1heChCYWxsX0Rpc3RhbmNlX1RocmVzaG9sZCAtIDE1LCAxNSkKCQllbHNlaWYgU3BlZWQgPD0gNjAwIHRoZW4KCQkJQmFsbF9EaXN0YW5jZV9UaHJlc2hvbGQgPSBtYXRoLm1heChCYWxsX0Rpc3RhbmNlX1RocmVzaG9sZCAtIDE3LCAxNykKCQllbHNlaWYgU3BlZWQgPD0gMTAwMCB0aGVuCgkJCUJhbGxfRGlzdGFuY2VfVGhyZXNob2xkID0gbWF0aC5tYXgoQmFsbF9EaXN0YW5jZV9UaHJlc2hvbGQgLSAxOSwgMTkpCgkJZWxzZQoJCQlCYWxsX0Rpc3RhbmNlX1RocmVzaG9sZCA9IG1hdGgubWF4KEJhbGxfRGlzdGFuY2VfVGhyZXNob2xkIC0gMjAsIDIwKQoJCWVuZAoJZW5kCglpZiBEaXN0YW5jZSA8IEJhbGxfRGlzdGFuY2VfVGhyZXNob2xkIHRoZW4KCQlyZXR1cm4gZmFsc2UKCWVuZAoJbG9jYWwgYWRqdXN0ZWRSZWFjaFRpbWUgPSBSZWFjaF9UaW1lICsgMC4wMwoJaWYgU3BlZWQgPCAzMDAgdGhlbgoJCWlmICh0aWNrKCkgLSBDdXJ2aW5nKSA8IChhZGp1c3RlZFJlYWNoVGltZSAvIDEuMikgdGhlbgoJCQlyZXR1cm4gdHJ1ZQoJCWVuZAoJZWxzZWlmIFNwZWVkIDwgNDUwIHRoZW4KCQlpZiAodGljaygpIC0gQ3VydmluZykgPCAoYWRqdXN0ZWRSZWFjaFRpbWUgLyAxLjIxKSB0aGVuCgkJCXJldHVybiB0cnVlCgkJZW5kCgllbHNlaWYgU3BlZWQgPCA2MDAgdGhlbgoJCWlmICh0aWNrKCkgLSBDdXJ2aW5nKSA8IChhZGp1c3RlZFJlYWNoVGltZSAvIDEuMzM1KSB0aGVuCgkJCXJldHVybiB0cnVlCgkJZW5kCgllbHNlCgkJaWYgKHRpY2soKSAtIEN1cnZpbmcpIDwgKGFkanVzdGVkUmVhY2hUaW1lIC8gMS41KSB0aGVuCgkJCXJldHVybiB0cnVlCgkJZW5kCgllbmQKCWxvY2FsIERvdF9UaHJlc2hvbGQgPSAoMCAtIFBpbmcgLyAxMDAwKQoJbG9jYWwgRGlyZWN0aW9uX0RpZmZlcmVuY2UgPSAoQmFsbF9EaXJlY3Rpb24gLSBWZWxvY2l0eS5Vbml0KQoJbG9jYWwgRGlyZWN0aW9uX1NpbWlsYXJpdHkgPSBEaXJlY3Rpb246RG90KERpcmVjdGlvbl9EaWZmZXJlbmNlLlVuaXQpCglsb2NhbCBEb3RfRGlmZmVyZW5jZSA9IERvdCAtIERpcmVjdGlvbl9TaW1pbGFyaXR5CglpZiBEb3RfRGlmZmVyZW5jZSA8IERvdF9UaHJlc2hvbGQgdGhlbgoJCXJldHVybiB0cnVlCgllbmQKCWxvY2FsIENsYW1wZWRfRG90ID0gbWF0aC5jbGFtcChEb3QsIC0xLCAxKQoJbG9jYWwgUmFkaWFucyA9IG1hdGguZGVnKG1hdGguYXNpbihDbGFtcGVkX0RvdCkpCglMZXJwX1JhZGlhbnMgPSBBdXRvX1BhcnJ5LkxpbmVhcl9JbnRlcnBvbGF0aW9uKExlcnBfUmFkaWFucywgUmFkaWFucywgMC44KQoJaWYgU3BlZWQgPCAzMDAgdGhlbgoJCWlmIExlcnBfUmFkaWFucyA8IDAuMDIgdGhlbgoJCQlMYXN0X1dhcnBpbmcgPSB0aWNrKCkKCQllbmQKCQlpZiAodGljaygpIC0gTGFzdF9XYXJwaW5nKSA8IChhZGp1c3RlZFJlYWNoVGltZSAvIDEuMTkpIHRoZW4KCQkJcmV0dXJuIHRydWUKCQllbmQKCWVsc2UKCQlpZiBMZXJwX1JhZGlhbnMgPCAwLjAxOCB0aGVuCgkJCUxhc3RfV2FycGluZyA9IHRpY2soKQoJCWVuZAoJCWlmICh0aWNrKCkgLSBMYXN0X1dhcnBpbmcpIDwgKGFkanVzdGVkUmVhY2hUaW1lIC8gMS41KSB0aGVuCgkJCXJldHVybiB0cnVlCgkJZW5kCgllbmQKCWlmICNQcmV2aW91c19WZWxvY2l0eSA9PSA0IHRoZW4KCQlmb3IgaSA9IDEsIDIgZG8KCQkJbG9jYWwgcHJldkRpciA9IChCYWxsX0RpcmVjdGlvbiAtIFByZXZpb3VzX1ZlbG9jaXR5W2ldLlVuaXQpLlVuaXQKCQkJbG9jYWwgcHJldkRvdCA9IERpcmVjdGlvbjpEb3QocHJldkRpcikKCQkJaWYgKERvdCAtIHByZXZEb3QpIDwgRG90X1RocmVzaG9sZCB0aGVuCgkJCQlyZXR1cm4gdHJ1ZQoJCQllbmQKCQllbmQKCWVuZAoJbG9jYWwgYmFja3dhcmRzQ3VydmVEZXRlY3RlZCA9IGZhbHNlCglsb2NhbCBiYWNrd2FyZHNBbmdsZVRocmVzaG9sZCA9IDYwCglsb2NhbCBob3JpekRpcmVjdGlvbiA9IFZlY3RvcjMubmV3KHBsYXllclBvcy5YIC0gYmFsbFBvcy5YLCAwLCBwbGF5ZXJQb3MuWiAtIGJhbGxQb3MuWikKCWlmIGhvcml6RGlyZWN0aW9uLk1hZ25pdHVkZSA+IDAgdGhlbgoJCWhvcml6RGlyZWN0aW9uID0gaG9yaXpEaXJlY3Rpb24uVW5pdAoJZW5kCglsb2NhbCBhd2F5RnJvbVBsYXllciA9IC1ob3JpekRpcmVjdGlvbgoJbG9jYWwgaG9yaXpCYWxsRGlyID0gVmVjdG9yMy5uZXcoQmFsbF9EaXJlY3Rpb24uWCwgMCwgQmFsbF9EaXJlY3Rpb24uWikKCWlmIGhvcml6QmFsbERpci5NYWduaXR1ZGUgPiAwIHRoZW4KCQlob3JpekJhbGxEaXIgPSBob3JpekJhbGxEaXIuVW5pdAoJCWxvY2FsIGJhY2t3YXJkc0FuZ2xlID0gbWF0aC5kZWcobWF0aC5hY29zKG1hdGguY2xhbXAoYXdheUZyb21QbGF5ZXI6RG90KGhvcml6QmFsbERpciksIC0xLCAxKSkpCgkJaWYgYmFja3dhcmRzQW5nbGUgPCBiYWNrd2FyZHNBbmdsZVRocmVzaG9sZCB0aGVuCgkJCWJhY2t3YXJkc0N1cnZlRGV0ZWN0ZWQgPSB0cnVlCgkJZW5kCgllbmQKCXJldHVybiAoRG90IDwgRG90X1RocmVzaG9sZCkgb3IgYmFja3dhcmRzQ3VydmVEZXRlY3RlZAplbmQKZnVuY3Rpb24gQXV0b19QYXJyeTpHZXRfQmFsbF9Qcm9wZXJ0aWVzKCkKCWxvY2FsIEJhbGwgPSBBdXRvX1BhcnJ5LkdldF9CYWxsKCkKCWxvY2FsIEJhbGxfVmVsb2NpdHkgPSBWZWN0b3IzLnplcm8KCWxvY2FsIEJhbGxfT3JpZ2luID0gQmFsbAoJbG9jYWwgQmFsbF9EaXJlY3Rpb24gPSAoUGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbiAtIEJhbGxfT3JpZ2luLlBvc2l0aW9uKS5Vbml0Cglsb2NhbCBCYWxsX0Rpc3RhbmNlID0gKFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24gLSBCYWxsLlBvc2l0aW9uKS5NYWduaXR1ZGUKCWxvY2FsIEJhbGxfRG90ID0gQmFsbF9EaXJlY3Rpb246RG90KEJhbGxfVmVsb2NpdHkuVW5pdCkKCXJldHVybiB7CgkJVmVsb2NpdHkgPSBCYWxsX1ZlbG9jaXR5LAoJCURpcmVjdGlvbiA9IEJhbGxfRGlyZWN0aW9uLAoJCURpc3RhbmNlID0gQmFsbF9EaXN0YW5jZSwKCQlEb3QgPSBCYWxsX0RvdCwKCX0KZW5kCmZ1bmN0aW9uIEF1dG9fUGFycnkuU3BhbV9TZXJ2aWNlKHNlbGYpCglsb2NhbCBCYWxsID0gQXV0b19QYXJyeS5HZXRfQmFsbCgpCglsb2NhbCBFbnRpdHkgPSBBdXRvX1BhcnJ5LkNsb3Nlc3RfUGxheWVyKCkKCWlmIG5vdCBCYWxsIHRoZW4KCQlyZXR1cm4gZmFsc2UKCWVuZAoJaWYgbm90IEVudGl0eSBvciBub3QgRW50aXR5LlByaW1hcnlQYXJ0IHRoZW4KCQlyZXR1cm4gZmFsc2UKCWVuZAoJbG9jYWwgU3BhbV9BY2N1cmFjeSA9IDUKCWxvY2FsIFZlbG9jaXR5ID0gQmFsbC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5Cglsb2NhbCBTcGVlZCA9IFZlbG9jaXR5Lk1hZ25pdHVkZQoJbG9jYWwgRGlyZWN0aW9uID0gKFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24gLSBCYWxsLlBvc2l0aW9uKS5Vbml0Cglsb2NhbCBEb3QgPSBEaXJlY3Rpb246RG90KFZlbG9jaXR5LlVuaXQpCglsb2NhbCBUYXJnZXRfUG9zaXRpb24gPSBFbnRpdHkuUHJpbWFyeVBhcnQuUG9zaXRpb24KCWxvY2FsIFRhcmdldF9EaXN0YW5jZSA9IFBsYXllcjpEaXN0YW5jZUZyb21DaGFyYWN0ZXIoVGFyZ2V0X1Bvc2l0aW9uKQoJbG9jYWwgTW92ZW1lbnRfRmFjdG9yID0gMQoJbG9jYWwgTW92ZURpciA9IFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuTW92ZURpcmVjdGlvbgoJbG9jYWwgVGFyZ2V0RGlyID0gKFRhcmdldF9Qb3NpdGlvbiAtIFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24pLlVuaXQKCWxvY2FsIFRhcmdldE1vdmVEaXIgPSBFbnRpdHkuSHVtYW5vaWQuTW92ZURpcmVjdGlvbgoJX0cuTGFzdF9DbG9zZV9Db250YWN0ID0gX0cuTGFzdF9DbG9zZV9Db250YWN0IG9yIDAKCV9HLkluX0Nsb3NlX0NvbnRhY3QgPSBfRy5Jbl9DbG9zZV9Db250YWN0IG9yIGZhbHNlCglsb2NhbCBub3cgPSB0aWNrKCkKCWlmIFRhcmdldF9EaXN0YW5jZSA8PSAzIHRoZW4KCQlfRy5Jbl9DbG9zZV9Db250YWN0ID0gdHJ1ZQoJZW5kCglpZiBfRy5Jbl9DbG9zZV9Db250YWN0IGFuZCBUYXJnZXRfRGlzdGFuY2UgPiAzLjMgdGhlbgoJCV9HLkluX0Nsb3NlX0NvbnRhY3QgPSBmYWxzZQoJCV9HLkxhc3RfQ2xvc2VfQ29udGFjdCA9IG5vdwoJZW5kCglsb2NhbCBjYW5fdXNlX2RpdjEwID0gKG5vdCBfRy5Jbl9DbG9zZV9Db250YWN0KSBhbmQgKChub3cgLSBfRy5MYXN0X0Nsb3NlX0NvbnRhY3QpID49IDEuNSkKCWlmIGNhbl91c2VfZGl2MTAgYW5kIE1vdmVEaXIuTWFnbml0dWRlID4gMC4yIGFuZCBNb3ZlRGlyOkRvdChUYXJnZXREaXIpIDwgLTAuNCB0aGVuCgkJTW92ZW1lbnRfRmFjdG9yID0gMTAKCWVuZAoJaWYgY2FuX3VzZV9kaXYxMCBhbmQgVGFyZ2V0TW92ZURpci5NYWduaXR1ZGUgPiAwLjIgYW5kIFRhcmdldE1vdmVEaXI6RG90KC1UYXJnZXREaXIpIDwgLTAuNCB0aGVuCgkJTW92ZW1lbnRfRmFjdG9yID0gMTAKCWVuZAoJbG9jYWwgTWF4aW11bV9TcGFtX0Rpc3RhbmNlID0gc2VsZi5QaW5nICogMC43ICsgbWF0aC5taW4oU3BlZWQgLyAoTW92ZW1lbnRfRmFjdG9yICogMS4yKSwgODApCglpZiBzZWxmLkVudGl0eV9Qcm9wZXJ0aWVzLkRpc3RhbmNlID4gTWF4aW11bV9TcGFtX0Rpc3RhbmNlIHRoZW4KCQlyZXR1cm4gU3BhbV9BY2N1cmFjeQoJZW5kCglpZiBzZWxmLkJhbGxfUHJvcGVydGllcy5EaXN0YW5jZSA+IE1heGltdW1fU3BhbV9EaXN0YW5jZSB0aGVuCgkJcmV0dXJuIFNwYW1fQWNjdXJhY3kKCWVuZAoJaWYgVGFyZ2V0X0Rpc3RhbmNlID4gTWF4aW11bV9TcGFtX0Rpc3RhbmNlIHRoZW4KCQlyZXR1cm4gU3BhbV9BY2N1cmFjeQoJZW5kCglsb2NhbCBEb3RfUmVkdWN0aW9uID0gbWF0aC5jbGFtcCgtRG90LCAwLCAxKQoJbG9jYWwgRG90X0ltcGFjdCA9IG1hdGguY2xhbXAoRG90X1JlZHVjdGlvbiAqIChTcGVlZCAvIDQwKSwgMCwgNCkKCVNwYW1fQWNjdXJhY3kgPSBNYXhpbXVtX1NwYW1fRGlzdGFuY2UgLSBEb3RfSW1wYWN0CglyZXR1cm4gU3BhbV9BY2N1cmFjeQplbmQKbG9jYWwgQ29ubmVjdGlvbnNfTWFuYWdlciA9IHt9CmxvY2FsIFNlbGVjdGVkX1BhcnJ5X1R5cGUgPSBuaWwKbG9jYWwgUGFycmllZCA9IGZhbHNlCmxvY2FsIExhc3RfUGFycnkgPSAwCmxvY2FsIGRlYXRoc2hpdCA9IGZhbHNlClJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuRGVhdGhCYWxsLk9uQ2xpZW50RXZlbnQ6Q29ubmVjdChmdW5jdGlvbihjLCBkKQoJaWYgZCB0aGVuCgkJZGVhdGhzaGl0ID0gdHJ1ZQoJZWxzZQoJCWRlYXRoc2hpdCA9IGZhbHNlCgllbmQKZW5kKQpsb2NhbCBJbmZpbml0eSA9IGZhbHNlClJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuSW5maW5pdHlCYWxsLk9uQ2xpZW50RXZlbnQ6Q29ubmVjdChmdW5jdGlvbihhLCBiKQoJaWYgYiB0aGVuCgkJSW5maW5pdHkgPSB0cnVlCgllbHNlCgkJSW5maW5pdHkgPSBmYWxzZQoJZW5kCmVuZCkKbG9jYWwgdGltZWhvbGUgPSBmYWxzZQpSZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLlRpbWVIb2xlSG9sZEJhbGwuT25DbGllbnRFdmVudDpDb25uZWN0KGZ1bmN0aW9uKGUsIGYpCglpZiBmIHRoZW4KCQl0aW1laG9sZSA9IHRydWUKCWVsc2UKCQl0aW1laG9sZSA9IGZhbHNlCgllbmQKZW5kKQpsb2NhbCBBdXRvUGFycnkgPSB0cnVlCmxvY2FsIEJhbGxzID0gd29ya3NwYWNlOldhaXRGb3JDaGlsZCgiQmFsbHMiKQpsb2NhbCBDdXJyZW50QmFsbCA9IG5pbApsb2NhbCBJbnB1dFRhc2sgPSBuaWwKbG9jYWwgQ29vbGRvd24gPSAwCmxvY2FsIFJ1blRpbWUgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIlJ1bnRpbWUiKQpsb2NhbCBmdW5jdGlvbiBHZXRCYWxsKCkKCWZvciBfLCBCYWxsIGluIGlwYWlycyhCYWxsczpHZXRDaGlsZHJlbigpKSBkbwoJCWlmIEJhbGw6RmluZEZpcnN0Q2hpbGQoImZmIikgdGhlbgoJCQlyZXR1cm4gQmFsbAoJCWVuZAoJZW5kCglyZXR1cm4gbmlsCmVuZApsb2NhbCBmdW5jdGlvbiBTcGFtSW5wdXQoTGFiZWwpCglpZiBJbnB1dFRhc2sgdGhlbgoJCXJldHVybgoJZW5kCglJbnB1dFRhc2sgPSB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQl3aGlsZSBBdXRvUGFycnkgZG8KCQkJQXV0b19QYXJyeS5QYXJyeShTZWxlY3RlZF9QYXJyeV9UeXBlKQoJCQl0YXNrLndhaXQoQ29vbGRvd24pCgkJZW5kCgkJSW5wdXRUYXNrID0gbmlsCgllbmQpCmVuZApCYWxscy5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oVmFsdWUpCglWYWx1ZS5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oQ2hpbGQpCgkJaWYgZ2V0Z2VudigpLlNsYXNoT2ZGdXJ5RGV0ZWN0aW9uIGFuZCBDaGlsZC5OYW1lID09ICJDb21ib0NvdW50ZXIiIHRoZW4KCQkJbG9jYWwgU29mX0xhYmVsID0gQ2hpbGQ6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUZXh0TGFiZWwiKQoJCQlpZiBTb2ZfTGFiZWwgdGhlbgoJCQkJcmVwZWF0CgkJCQkJbG9jYWwgU2xhc2hlc19Db3VudGVyID0gdG9udW1iZXIoU29mX0xhYmVsLlRleHQpCgkJCQkJaWYgU2xhc2hlc19Db3VudGVyIGFuZCBTbGFzaGVzX0NvdW50ZXIgPCAzMiB0aGVuCgkJCQkJCUF1dG9fUGFycnkuUGFycnkoU2VsZWN0ZWRfUGFycnlfVHlwZSkKCQkJCQllbmQKCQkJCQl0YXNrLndhaXQoKQoJCQkJdW50aWwgbm90IFNvZl9MYWJlbC5QYXJlbnQgb3Igbm90IFNvZl9MYWJlbAoJCQllbmQKCQllbmQKCWVuZCkKZW5kKQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgcGxheWVyMTAyMzkxMjMgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQppZiBub3QgcGxheWVyMTAyMzkxMjMgdGhlbgoJcmV0dXJuCmVuZApSdW5UaW1lLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihPYmplY3QpCglsb2NhbCBOYW1lID0gT2JqZWN0Lk5hbWUKCWlmIGdldGdlbnYoKS5QaGFudG9tVjJEZXRlY3Rpb24gdGhlbgoJCWlmIE5hbWUgPT0gIm1heFRyYW5zbWlzc2lvbiIgb3IgTmFtZSA9PSAidHJhbnNtaXNzaW9ucGFydCIgdGhlbgoJCQlsb2NhbCBXZWxkID0gT2JqZWN0OkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIldlbGRDb25zdHJhaW50IikKCQkJaWYgV2VsZCB0aGVuCgkJCQlsb2NhbCBDaGFyYWN0ZXIgPSBwbGF5ZXIxMDIzOTEyMy5DaGFyYWN0ZXIgb3IgcGxheWVyMTAyMzkxMjMuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgkJCQlpZiBDaGFyYWN0ZXIgYW5kIFdlbGQuUGFydDEgPT0gQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQgdGhlbgoJCQkJCUN1cnJlbnRCYWxsID0gR2V0QmFsbCgpCgkJCQkJV2VsZDpEZXN0cm95KCkKCQkJCQlpZiBDdXJyZW50QmFsbCB0aGVuCgkJCQkJCWxvY2FsIEZvY3VzQ29ubmVjdGlvbgoJCQkJCQlGb2N1c0Nvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJCQlsb2NhbCBIaWdobGlnaHRlZCA9IEN1cnJlbnRCYWxsOkdldEF0dHJpYnV0ZSgiaGlnaGxpZ2h0ZWQiKQoJCQkJCQkJaWYgSGlnaGxpZ2h0ZWQgPT0gdHJ1ZSB0aGVuCgkJCQkJCQkJZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQgPSAzNgoJCQkJCQkJCWxvY2FsIEh1bWFub2lkUm9vdFBhcnQgPSBDaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQoJCQkJCQkJCWlmIEh1bWFub2lkUm9vdFBhcnQgdGhlbgoJCQkJCQkJCQlsb2NhbCBQbGF5ZXJQb3NpdGlvbiA9IEh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24KCQkJCQkJCQkJbG9jYWwgQmFsbFBvc2l0aW9uID0gQ3VycmVudEJhbGwuUG9zaXRpb24KCQkJCQkJCQkJbG9jYWwgUGxheWVyVG9CYWxsID0gKEJhbGxQb3NpdGlvbiAtIFBsYXllclBvc2l0aW9uKS5Vbml0CgkJCQkJCQkJCWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZShQbGF5ZXJUb0JhbGwsIGZhbHNlKQoJCQkJCQkJCWVuZAoJCQkJCQkJZWxzZWlmIEhpZ2hsaWdodGVkID09IGZhbHNlIHRoZW4KCQkJCQkJCQlGb2N1c0Nvbm5lY3Rpb246RGlzY29ubmVjdCgpCgkJCQkJCQkJZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQgPSAxMAoJCQkJCQkJCWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZShWZWN0b3IzLm5ldygwLCAwLCAwKSwgZmFsc2UpCgkJCQkJCQkJdGFzay5kZWxheSgzLCBmdW5jdGlvbigpCgkJCQkJCQkJCWdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMzYKCQkJCQkJCQllbmQpCgkJCQkJCQkJQ3VycmVudEJhbGwgPSBuaWwKCQkJCQkJCWVuZAoJCQkJCQllbmQpCgkJCQkJCXRhc2suZGVsYXkoMywgZnVuY3Rpb24oKQoJCQkJCQkJaWYgRm9jdXNDb25uZWN0aW9uIGFuZCBGb2N1c0Nvbm5lY3Rpb24uQ29ubmVjdGVkIHRoZW4KCQkJCQkJCQlGb2N1c0Nvbm5lY3Rpb246RGlzY29ubmVjdCgpCgkJCQkJCQkJZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlKFZlY3RvcjMubmV3KDAsIDAsIDApLCBmYWxzZSkKCQkJCQkJCQlnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLldhbGtTcGVlZCA9IDM2CgkJCQkJCQkJQ3VycmVudEJhbGwgPSBuaWwKCQkJCQkJCWVuZAoJCQkJCQllbmQpCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgkJZW5kCgllbmQKZW5kKQpsb2NhbCBwbGF5ZXIxMSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBQbGF5ZXJHdWkgPSBwbGF5ZXIxMTpXYWl0Rm9yQ2hpbGQoIlBsYXllckd1aSIpCmxvY2FsIHBsYXllckd1aSA9IHBsYXllcjExOldhaXRGb3JDaGlsZCgiUGxheWVyR3VpIikKbG9jYWwgSG90YmFyID0gUGxheWVyR3VpOldhaXRGb3JDaGlsZCgiSG90YmFyIikKbG9jYWwgUGFycnlDRCA9IHBsYXllckd1aS5Ib3RiYXIuQmxvY2suVUlHcmFkaWVudApsb2NhbCBBYmlsaXR5Q0QgPSBwbGF5ZXJHdWkuSG90YmFyLkFiaWxpdHkuVUlHcmFkaWVudApsb2NhbCBmdW5jdGlvbiBpc0Nvb2xkb3duSW5FZmZlY3QxKHVpZ3JhZGllbnQpCglyZXR1cm4gdWlncmFkaWVudC5PZmZzZXQuWSA8IDAuNAplbmQKbG9jYWwgZnVuY3Rpb24gaXNDb29sZG93bkluRWZmZWN0Mih1aWdyYWRpZW50KQoJcmV0dXJuIHVpZ3JhZGllbnQuT2Zmc2V0LlkgPT0gMC41CmVuZApsb2NhbCBmdW5jdGlvbiBjb29sZG93blByb3RlY3Rpb24oKQoJaWYgaXNDb29sZG93bkluRWZmZWN0MShQYXJyeUNEKSB0aGVuCgkJZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQWJpbGl0eUJ1dHRvblByZXNzOkZpcmUoKQoJCXJldHVybiB0cnVlCgllbmQKCXJldHVybiBmYWxzZQplbmQKbG9jYWwgZnVuY3Rpb24gQXV0b0FiaWxpdHkoKQoJaWYgaXNDb29sZG93bkluRWZmZWN0MihBYmlsaXR5Q0QpIHRoZW4KCQlpZgoJCQlQbGF5ZXIuQ2hhcmFjdGVyLkFiaWxpdGllc1siUmFnaW5nIERlZmxlY3Rpb24iXS5FbmFibGVkCgkJCW9yIFBsYXllci5DaGFyYWN0ZXIuQWJpbGl0aWVzWyJSYXB0dXJlIl0uRW5hYmxlZAoJCQlvciBQbGF5ZXIuQ2hhcmFjdGVyLkFiaWxpdGllc1siQ2FsbWluZyBEZWZsZWN0aW9uIl0uRW5hYmxlZAoJCQlvciBQbGF5ZXIuQ2hhcmFjdGVyLkFiaWxpdGllc1siQWVyb2R5bmFtaWMgU2xhc2giXS5FbmFibGVkCgkJCW9yIFBsYXllci5DaGFyYWN0ZXIuQWJpbGl0aWVzWyJGcmFjdHVyZSJdLkVuYWJsZWQKCQkJb3IgUGxheWVyLkNoYXJhY3Rlci5BYmlsaXRpZXNbIkRlYXRoIFNsYXNoIl0uRW5hYmxlZAoJCXRoZW4KCQkJUGFycmllZCA9IHRydWUKCQkJZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlJlbW90ZXMuQWJpbGl0eUJ1dHRvblByZXNzOkZpcmUoKQoJCQl0YXNrLndhaXQoMi40MzIpCgkJCWdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQoJCQkJOldhaXRGb3JDaGlsZCgiUmVtb3RlcyIpCgkJCQk6V2FpdEZvckNoaWxkKCJEZWF0aFNsYXNoU2hvb3RBY3RpdmF0aW9uIikKCQkJCTpGaXJlU2VydmVyKHRydWUpCgkJCXJldHVybiB0cnVlCgkJZW5kCgllbmQKCXJldHVybiBmYWxzZQplbmQKZG8KCWxvY2FsIG1vZHVsZSA9IHJhZ2U6Y3JlYXRlX21vZHVsZSh7CgkJdGl0bGUgPSAiQXV0byBQYXJyeSIsCgkJZmxhZyA9ICJBdXRvX1BhcnJ5IiwKCQlkZXNjcmlwdGlvbiA9ICJBdXRvbWF0aWNhbGx5IHBhcnJpZXMgYmFsbCIsCgkJc2VjdGlvbiA9ICJsZWZ0IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlpZiBnZXRnZW52KCkuQXV0b1BhcnJ5Tm90aWZ5IHRoZW4KCQkJCWlmIHZhbHVlIHRoZW4KCQkJCQlMaWJyYXJ5LlNlbmROb3RpZmljYXRpb24oewoJCQkJCQl0aXRsZSA9ICJNb2R1bGUgTm90aWZpY2F0aW9uIiwKCQkJCQkJdGV4dCA9ICJBdXRvIFBhcnJ5IGhhcyBiZWVuIHR1cm5lZCBPTiIsCgkJCQkJCWR1cmF0aW9uID0gMywKCQkJCQl9KQoJCQkJZWxzZQoJCQkJCUxpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CgkJCQkJCXRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAoJCQkJCQl0ZXh0ID0gIkF1dG8gUGFycnkgaGFzIGJlZW4gdHVybmVkIE9GRiIsCgkJCQkJCWR1cmF0aW9uID0gMywKCQkJCQl9KQoJCQkJZW5kCgkJCWVuZAoJCQlpZiB2YWx1ZSB0aGVuCgkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJBdXRvIFBhcnJ5Il0gPSBSdW5TZXJ2aWNlLlByZVNpbXVsYXRpb246Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJbG9jYWwgT25lX0JhbGwgPSBBdXRvX1BhcnJ5LkdldF9CYWxsKCkKCQkJCQlsb2NhbCBCYWxscyA9IEF1dG9fUGFycnkuR2V0X0JhbGxzKCkKCQkJCQlmb3IgXywgQmFsbCBpbiBwYWlycyhCYWxscykgZG8KCQkJCQkJaWYgbm90IEJhbGwgdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoJCQkJCQlsb2NhbCBab29taWVzID0gQmFsbDpGaW5kRmlyc3RDaGlsZCgiem9vbWllcyIpCgkJCQkJCWlmIG5vdCBab29taWVzIHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJQmFsbDpHZXRBdHRyaWJ1dGVDaGFuZ2VkU2lnbmFsKCJ0YXJnZXQiKTpPbmNlKGZ1bmN0aW9uKCkKCQkJCQkJCVBhcnJpZWQgPSBmYWxzZQoJCQkJCQllbmQpCgkJCQkJCWlmIFBhcnJpZWQgdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoJCQkJCQlsb2NhbCBCYWxsX1RhcmdldCA9IEJhbGw6R2V0QXR0cmlidXRlKCJ0YXJnZXQiKQoJCQkJCQlsb2NhbCBPbmVfVGFyZ2V0ID0gT25lX0JhbGw6R2V0QXR0cmlidXRlKCJ0YXJnZXQiKQoJCQkJCQlsb2NhbCBWZWxvY2l0eSA9IFpvb21pZXMuVmVjdG9yVmVsb2NpdHkKCQkJCQkJbG9jYWwgRGlzdGFuY2UgPSAoUGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbiAtIEJhbGwuUG9zaXRpb24pLk1hZ25pdHVkZQoJCQkJCQlsb2NhbCBQaW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJTdGF0cyIpLk5ldHdvcmsuU2VydmVyU3RhdHNJdGVtWyJEYXRhIFBpbmciXTpHZXRWYWx1ZSgpIC8gMTAKCQkJCQkJbG9jYWwgUGluZ19UaHJlc2hvbGQgPSBtYXRoLmNsYW1wKFBpbmcgLyAxMCwgNSwgMTcpCgkJCQkJCWxvY2FsIFNwZWVkID0gVmVsb2NpdHkuTWFnbml0dWRlCgkJCQkJCWxvY2FsIGNhcHBlZFNwZWVkRGlmZiA9IG1hdGgubWluKG1hdGgubWF4KFNwZWVkIC0gOS41LCAwKSwgNjUwKQoJCQkJCQlsb2NhbCBzcGVlZF9kaXZpc29yX2Jhc2UgPSAyLjQgKyBjYXBwZWRTcGVlZERpZmYgKiAwLjAwMgoJCQkJCQlsb2NhbCBlZmZlY3RpdmVNdWx0aXBsaWVyID0gU3BlZWRfRGl2aXNvcl9NdWx0aXBsaWVyCgkJCQkJCWlmIGdldGdlbnYoKS5SYW5kb21QYXJyeUFjY3VyYWN5RW5hYmxlZCB0aGVuCgkJCQkJCQlpZiBTcGVlZCA8IDIwMCB0aGVuCgkJCQkJCQkJZWZmZWN0aXZlTXVsdGlwbGllciA9IDAuNyArIChtYXRoLnJhbmRvbSg0MCwgMTAwKSAtIDEpICogKDAuMzUgLyA5OSkKCQkJCQkJCWVsc2UKCQkJCQkJCQllZmZlY3RpdmVNdWx0aXBsaWVyID0gMC43ICsgKG1hdGgucmFuZG9tKDEsIDEwMCkgLSAxKSAqICgwLjM1IC8gOTkpCgkJCQkJCQllbmQKCQkJCQkJZW5kCgkJCQkJCWxvY2FsIHNwZWVkX2Rpdmlzb3IgPSBzcGVlZF9kaXZpc29yX2Jhc2UgKiBlZmZlY3RpdmVNdWx0aXBsaWVyCgkJCQkJCWxvY2FsIFBhcnJ5X0FjY3VyYWN5ID0gUGluZ19UaHJlc2hvbGQgKyBtYXRoLm1heChTcGVlZCAvIHNwZWVkX2Rpdmlzb3IsIDkuNSkKCQkJCQkJbG9jYWwgQ3VydmVkID0gQXV0b19QYXJyeS5Jc19DdXJ2ZWQoKQoJCQkJCQlpZiBCYWxsOkZpbmRGaXJzdENoaWxkKCJBZXJvRHluYW1pY1NsYXNoVkZYIikgdGhlbgoJCQkJCQkJRGVicmlzOkFkZEl0ZW0oQmFsbC5BZXJvRHluYW1pY1NsYXNoVkZYLCAwKQoJCQkJCQkJVG9ybmFkb19UaW1lID0gdGljaygpCgkJCQkJCWVuZAoJCQkJCQlpZiBSdW50aW1lOkZpbmRGaXJzdENoaWxkKCJUb3JuYWRvIikgdGhlbgoJCQkJCQkJaWYKCQkJCQkJCQkodGljaygpIC0gVG9ybmFkb19UaW1lKQoJCQkJCQkJCTwgKFJ1bnRpbWUuVG9ybmFkbzpHZXRBdHRyaWJ1dGUoIlRvcm5hZG9UaW1lIikgb3IgMSkgKyAwLjMxNDE1OQoJCQkJCQkJdGhlbgoJCQkJCQkJCXJldHVybgoJCQkJCQkJZW5kCgkJCQkJCWVuZAoJCQkJCQlpZiBPbmVfVGFyZ2V0ID09IHRvc3RyaW5nKFBsYXllcikgYW5kIEN1cnZlZCB0aGVuCgkJCQkJCQlyZXR1cm4KCQkJCQkJZW5kCgkJCQkJCWlmIEJhbGw6RmluZEZpcnN0Q2hpbGQoIkNvbWJvQ291bnRlciIpIHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJbG9jYWwgU2luZ3VsYXJpdHlfQ2FwZSA9IFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQ6RmluZEZpcnN0Q2hpbGQoIlNpbmd1bGFyaXR5Q2FwZSIpCgkJCQkJCWlmIFNpbmd1bGFyaXR5X0NhcGUgdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoJCQkJCQlpZiBnZXRnZW52KCkuSW5maW5pdHlEZXRlY3Rpb24gYW5kIEluZmluaXR5IHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJaWYgZ2V0Z2VudigpLkRlYXRoU2xhc2hEZXRlY3Rpb24gYW5kIGRlYXRoc2hpdCB0aGVuCgkJCQkJCQlyZXR1cm4KCQkJCQkJZW5kCgkJCQkJCWlmIGdldGdlbnYoKS5UaW1lSG9sZURldGVjdGlvbiBhbmQgdGltZWhvbGUgdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoJCQkJCQlpZiBCYWxsX1RhcmdldCA9PSB0b3N0cmluZyhQbGF5ZXIpIGFuZCBEaXN0YW5jZSA8PSBQYXJyeV9BY2N1cmFjeSB0aGVuCgkJCQkJCQlpZiBnZXRnZW52KCkuQXV0b0FiaWxpdHkgYW5kIEF1dG9BYmlsaXR5KCkgdGhlbgoJCQkJCQkJCXJldHVybgoJCQkJCQkJZW5kCgkJCQkJCWVuZAoJCQkJCQlpZiBCYWxsX1RhcmdldCA9PSB0b3N0cmluZyhQbGF5ZXIpIGFuZCBEaXN0YW5jZSA8PSBQYXJyeV9BY2N1cmFjeSB0aGVuCgkJCQkJCQlpZiBnZXRnZW52KCkuQ29vbGRvd25Qcm90ZWN0aW9uIGFuZCBjb29sZG93blByb3RlY3Rpb24oKSB0aGVuCgkJCQkJCQkJcmV0dXJuCgkJCQkJCQllbmQKCQkJCQkJCWxvY2FsIFBhcnJ5X1RpbWUgPSBvcy5jbG9jaygpCgkJCQkJCQlsb2NhbCBUaW1lX1ZpZXcgPSBQYXJyeV9UaW1lIC0gTGFzdF9QYXJyeQoJCQkJCQkJaWYgVGltZV9WaWV3ID4gMC41IHRoZW4KCQkJCQkJCQlBdXRvX1BhcnJ5LlBhcnJ5X0FuaW1hdGlvbigpCgkJCQkJCQllbmQKCQkJCQkJCWlmIGdldGdlbnYoKS5BdXRvUGFycnlLZXlwcmVzcyB0aGVuCgkJCQkJCQkJVmlydHVhbElucHV0U2VydmljZTpTZW5kS2V5RXZlbnQodHJ1ZSwgRW51bS5LZXlDb2RlLkYsIGZhbHNlLCBuaWwpCgkJCQkJCQllbHNlCgkJCQkJCQkJQXV0b19QYXJyeS5QYXJyeShTZWxlY3RlZF9QYXJyeV9UeXBlKQoJCQkJCQkJZW5kCgkJCQkJCQlMYXN0X1BhcnJ5ID0gUGFycnlfVGltZQoJCQkJCQkJUGFycmllZCA9IHRydWUKCQkJCQkJZW5kCgkJCQkJCWxvY2FsIExhc3RfUGFycnlzID0gdGljaygpCgkJCQkJCXJlcGVhdAoJCQkJCQkJUnVuU2VydmljZS5QcmVTaW11bGF0aW9uOldhaXQoKQoJCQkJCQl1bnRpbCAodGljaygpIC0gTGFzdF9QYXJyeXMpID49IDEgb3Igbm90IFBhcnJpZWQKCQkJCQkJUGFycmllZCA9IGZhbHNlCgkJCQkJZW5kCgkJCQllbmQpCgkJCWVsc2UKCQkJCWlmIENvbm5lY3Rpb25zX01hbmFnZXJbIkF1dG8gUGFycnkiXSB0aGVuCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiQXV0byBQYXJyeSJdOkRpc2Nvbm5lY3QoKQoJCQkJCUNvbm5lY3Rpb25zX01hbmFnZXJbIkF1dG8gUGFycnkiXSA9IG5pbAoJCQkJZW5kCgkJCWVuZAoJCWVuZCwKCX0pCglsb2NhbCBkcm9wZG93bjMgPSBtb2R1bGU6Y3JlYXRlX2Ryb3Bkb3duKHsKCQl0aXRsZSA9ICJGaXJzdCBQYXJyeSBUeXBlIiwKCQlmbGFnID0gIkZpcnN0X1BhcnJ5X1R5cGUiLAoJCW9wdGlvbnMgPSB7CgkJCSJGX0tleSIsCgkJCSJMZWZ0X0NsaWNrIiwKCQkJIk5hdmlnYXRpb24iLAoJCX0sCgkJbXVsdGlfZHJvcGRvd24gPSBmYWxzZSwKCQltYXhpbXVtX29wdGlvbnMgPSAzLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWZpcnN0UGFycnlUeXBlID0gdmFsdWUKCQllbmQsCgl9KQoJbG9jYWwgcGFycnlUeXBlTWFwID0gewoJCVsiQ2FtZXJhIl0gPSAiQ2FtZXJhIiwKCQlbIlNsb3diYWxsIl0gPSAiU2xvd2JhbGwiLAogICAgICAgIFsiRmFzdGJhbGwiXSA9ICJGYXN0YmFsbCIsCgkJWyJSYW5kb20iXSA9ICJSYW5kb20iLAoJCVsiQmFja3dhcmRzIl0gPSAiQmFja3dhcmRzIiwKCQlbIlN0cmFpZ2h0Il0gPSAiU3RyYWlnaHQiLAoJCVsiSGlnaCJdID0gIkhpZ2giLAoJCVsiTGVmdCJdID0gIkxlZnQiLAoJCVsiUmlnaHQiXSA9ICJSaWdodCIsCgkJWyJSYW5kb20gVGFyZ2V0Il0gPSAiUmFuZG9tVGFyZ2V0IiwKCX0KCWxvY2FsIGRyb3Bkb3duID0gbW9kdWxlOmNyZWF0ZV9kcm9wZG93bih7CgkJdGl0bGUgPSAiUGFycnkgVHlwZSIsCgkJZmxhZyA9ICJQYXJyeV9UeXBlIiwKCQlvcHRpb25zID0gewoJCQkiQ2FtZXJhIiwKCQkJIlNsb3diYWxsIiwKICAgICAgICAgICAgIkZhc3RiYWxsIiwKCQkJIlJhbmRvbSIsCgkJCSJCYWNrd2FyZHMiLAoJCQkiU3RyYWlnaHQiLAoJCQkiSGlnaCIsCgkJCSJMZWZ0IiwKCQkJIlJpZ2h0IiwKCQkJIlJhbmRvbSBUYXJnZXQiLAoJCX0sCgkJbXVsdGlfZHJvcGRvd24gPSBmYWxzZSwKCQltYXhpbXVtX29wdGlvbnMgPSA4LAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IHN0cmluZykKCQkJU2VsZWN0ZWRfUGFycnlfVHlwZSA9IHBhcnJ5VHlwZU1hcFt2YWx1ZV0gb3IgdmFsdWUKCQllbmQsCgl9KQoJbG9jYWwgVXNlcklucHV0U2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpCglsb2NhbCBwYXJyeU9wdGlvbnMgPSB7CgkJW0VudW0uS2V5Q29kZS5PbmVdID0gIkNhbWVyYSIsCgkJW0VudW0uS2V5Q29kZS5Ud29dID0gIlJhbmRvbSIsCgkJW0VudW0uS2V5Q29kZS5UaHJlZV0gPSAiQmFja3dhcmRzIiwKCQlbRW51bS5LZXlDb2RlLkZvdXJdID0gIlN0cmFpZ2h0IiwKCQlbRW51bS5LZXlDb2RlLkZpdmVdID0gIkhpZ2giLAoJCVtFbnVtLktleUNvZGUuU2l4XSA9ICJMZWZ0IiwKCQlbRW51bS5LZXlDb2RlLlNldmVuXSA9ICJSaWdodCIsCgkJW0VudW0uS2V5Q29kZS5FaWdodF0gPSAiUmFuZG9tIFRhcmdldCIsCgkJW0VudW0uS2V5Q29kZS5OaW5lXSA9ICJTbG93YmFsbCIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5aZXJvXSA9ICJGYXN0YmFsbCIsCgl9CglVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dCwgZ2FtZVByb2Nlc3NlZCkKCQlpZiBnYW1lUHJvY2Vzc2VkIHRoZW4KCQkJcmV0dXJuCgkJZW5kCgkJaWYgbm90IGdldGdlbnYoKS5Ib3RrZXlQYXJyeVR5cGUgdGhlbgoJCQlyZXR1cm4KCQllbmQKCQlsb2NhbCBuZXdUeXBlID0gcGFycnlPcHRpb25zW2lucHV0LktleUNvZGVdCgkJaWYgbmV3VHlwZSB0aGVuCgkJCVNlbGVjdGVkX1BhcnJ5X1R5cGUgPSBwYXJyeVR5cGVNYXBbbmV3VHlwZV0gb3IgbmV3VHlwZQoJCQlkcm9wZG93bjp1cGRhdGUobmV3VHlwZSkKCQkJaWYgZ2V0Z2VudigpLkhvdGtleVBhcnJ5VHlwZU5vdGlmeSB0aGVuCgkJCQlMaWJyYXJ5LlNlbmROb3RpZmljYXRpb24oewoJCQkJCXRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAoJCQkJCXRleHQgPSAiUGFycnkgVHlwZSBjaGFuZ2VkIHRvICIgLi4gbmV3VHlwZSwKCQkJCQlkdXJhdGlvbiA9IDMsCgkJCQl9KQoJCQllbmQKCQllbmQKCWVuZCkKCW1vZHVsZTpjcmVhdGVfc2xpZGVyKHsKCQl0aXRsZSA9ICJQYXJyeSBBY2N1cmFjeSIsCgkJZmxhZyA9ICJQYXJyeV9BY2N1cmFjeSIsCgkJbWF4aW11bV92YWx1ZSA9IDEwMCwKCQltaW5pbXVtX3ZhbHVlID0gMSwKCQl2YWx1ZSA9IDEwMCwKCQlyb3VuZF9udW1iZXIgPSB0cnVlLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCVNwZWVkX0Rpdmlzb3JfTXVsdGlwbGllciA9IDAuNyArICh2YWx1ZSAtIDEpICogKDAuMzUgLyA5OSkKCQllbmQsCgl9KQoJbW9kdWxlOmNyZWF0ZV9kaXZpZGVyKHt9KQoJbW9kdWxlOmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiUmFuZG9taXplZCBQYXJyeSBBY2N1cmFjeSIsCgkJZmxhZyA9ICJSYW5kb21fUGFycnlfQWNjdXJhY3kiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5SYW5kb21QYXJyeUFjY3VyYWN5RW5hYmxlZCA9IHZhbHVlCgkJCWlmIHZhbHVlIHRoZW4KCQkJCWdldGdlbnYoKS5SYW5kb21QYXJyeUFjY3VyYWN5RW5hYmxlZCA9IHZhbHVlCgkJCWVuZAoJCWVuZCwKCX0pCgltb2R1bGU6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJBbnRpIFBoYW50b20iLAoJCWZsYWcgPSAiQW50aV9QaGFudG9tIiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlnZXRnZW52KCkuUGhhbnRvbVYyRGV0ZWN0aW9uID0gdmFsdWUKCQllbmQsCgl9KQoJbW9kdWxlOmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiQXV0byBBYmlsaXR5IiwKCQlmbGFnID0gIkF1dG9BYmlsaXR5IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlnZXRnZW52KCkuQXV0b0FiaWxpdHkgPSB2YWx1ZQoJCWVuZCwKCX0pCgltb2R1bGU6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJLZXlwcmVzcyIsCgkJZmxhZyA9ICJBdXRvX1BhcnJ5X0tleXByZXNzIiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlnZXRnZW52KCkuQXV0b1BhcnJ5S2V5cHJlc3MgPSB2YWx1ZQoJCWVuZCwKCX0pCgltb2R1bGU6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJOb3RpZnkiLAoJCWZsYWcgPSAiQXV0b19QYXJyeV9Ob3RpZnkiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5BdXRvUGFycnlOb3RpZnkgPSB2YWx1ZQoJCWVuZCwKCX0pCglsb2NhbCBTcGFtUGFycnkgPSByYWdlOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIkF1dG8gU3BhbSBQYXJyeSIsCgkJZmxhZyA9ICJBdXRvX1NwYW1fUGFycnkiLAoJCWRlc2NyaXB0aW9uID0gIkF1dG9tYXRpY2FsbHkgc3BhbSBwYXJyaWVzIGJhbGwiLAoJCXNlY3Rpb24gPSAicmlnaHQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWlmIGdldGdlbnYoKS5BdXRvU3BhbU5vdGlmeSB0aGVuCgkJCQlpZiB2YWx1ZSB0aGVuCgkJCQkJTGlicmFyeS5TZW5kTm90aWZpY2F0aW9uKHsKCQkJCQkJdGl0bGUgPSAiTW9kdWxlIE5vdGlmaWNhdGlvbiIsCgkJCQkJCXRleHQgPSAiQXV0byBTcGFtIFBhcnJ5IHR1cm5lZCBPTiIsCgkJCQkJCWR1cmF0aW9uID0gMywKCQkJCQl9KQoJCQkJZWxzZQoJCQkJCUxpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CgkJCQkJCXRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAoJCQkJCQl0ZXh0ID0gIkF1dG8gU3BhbSBQYXJyeSB0dXJuZWQgT0ZGIiwKCQkJCQkJZHVyYXRpb24gPSAzLAoJCQkJCX0pCgkJCQllbmQKCQkJZW5kCgkJCWlmIHZhbHVlIHRoZW4KCQkJCUNvbm5lY3Rpb25zX01hbmFnZXJbIkF1dG8gU3BhbSJdID0gUnVuU2VydmljZS5QcmVTaW11bGF0aW9uOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJCWxvY2FsIEJhbGwgPSBBdXRvX1BhcnJ5LkdldF9CYWxsKCkKCQkJCQlpZiBub3QgQmFsbCB0aGVuCgkJCQkJCXJldHVybgoJCQkJCWVuZAoJCQkJCWxvY2FsIFpvb21pZXMgPSBCYWxsOkZpbmRGaXJzdENoaWxkKCJ6b29taWVzIikKCQkJCQlpZiBub3QgWm9vbWllcyB0aGVuCgkJCQkJCXJldHVybgoJCQkJCWVuZAoJCQkJCUF1dG9fUGFycnkuQ2xvc2VzdF9QbGF5ZXIoKQoJCQkJCWxvY2FsIFBpbmcgPSBnYW1lOkdldFNlcnZpY2UoIlN0YXRzIikuTmV0d29yay5TZXJ2ZXJTdGF0c0l0ZW1bIkRhdGEgUGluZyJdOkdldFZhbHVlKCkKCQkJCQlsb2NhbCBQaW5nX1RocmVzaG9sZCA9IG1hdGguY2xhbXAoUGluZyAvIDEwLCAxLCAxNikKCQkJCQlsb2NhbCBCYWxsX1RhcmdldCA9IEJhbGw6R2V0QXR0cmlidXRlKCJ0YXJnZXQiKQoJCQkJCWxvY2FsIEJhbGxfUHJvcGVydGllcyA9IEF1dG9fUGFycnk6R2V0X0JhbGxfUHJvcGVydGllcygpCgkJCQkJbG9jYWwgRW50aXR5X1Byb3BlcnRpZXMgPSBBdXRvX1BhcnJ5OkdldF9FbnRpdHlfUHJvcGVydGllcygpCgkJCQkJbG9jYWwgU3BhbV9BY2N1cmFjeSA9IEF1dG9fUGFycnkuU3BhbV9TZXJ2aWNlKHsKCQkJCQkJQmFsbF9Qcm9wZXJ0aWVzID0gQmFsbF9Qcm9wZXJ0aWVzLAoJCQkJCQlFbnRpdHlfUHJvcGVydGllcyA9IEVudGl0eV9Qcm9wZXJ0aWVzLAoJCQkJCQlQaW5nID0gUGluZ19UaHJlc2hvbGQsCgkJCQkJfSkKCQkJCQlsb2NhbCBUYXJnZXRfUG9zaXRpb24gPSBDbG9zZXN0X0VudGl0eS5QcmltYXJ5UGFydC5Qb3NpdGlvbgoJCQkJCWxvY2FsIFRhcmdldF9EaXN0YW5jZSA9IFBsYXllcjpEaXN0YW5jZUZyb21DaGFyYWN0ZXIoVGFyZ2V0X1Bvc2l0aW9uKQoJCQkJCWxvY2FsIERpcmVjdGlvbiA9IChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uIC0gQmFsbC5Qb3NpdGlvbikuVW5pdAoJCQkJCWxvY2FsIEJhbGxfRGlyZWN0aW9uID0gWm9vbWllcy5WZWN0b3JWZWxvY2l0eS5Vbml0CgkJCQkJbG9jYWwgRG90ID0gRGlyZWN0aW9uOkRvdChCYWxsX0RpcmVjdGlvbikKCQkJCQlsb2NhbCBEaXN0YW5jZSA9IFBsYXllcjpEaXN0YW5jZUZyb21DaGFyYWN0ZXIoQmFsbC5Qb3NpdGlvbikKCQkJCQlpZiBub3QgQmFsbF9UYXJnZXQgdGhlbgoJCQkJCQlyZXR1cm4KCQkJCQllbmQKCQkJCQlpZiBUYXJnZXRfRGlzdGFuY2UgPiBTcGFtX0FjY3VyYWN5IG9yIERpc3RhbmNlID4gU3BhbV9BY2N1cmFjeSB0aGVuCgkJCQkJCXJldHVybgoJCQkJCWVuZAoJCQkJCWxvY2FsIFB1bHNlZCA9IFBsYXllci5DaGFyYWN0ZXI6R2V0QXR0cmlidXRlKCJQdWxzZWQiKQoJCQkJCWlmIFB1bHNlZCB0aGVuCgkJCQkJCXJldHVybgoJCQkJCWVuZAoJCQkJCWlmIEJhbGxfVGFyZ2V0ID09IHRvc3RyaW5nKFBsYXllcikgYW5kIFRhcmdldF9EaXN0YW5jZSA+IDMwIGFuZCBEaXN0YW5jZSA+IDMwIHRoZW4KCQkJCQkJcmV0dXJuCgkJCQkJZW5kCgkJCQkJbG9jYWwgdGhyZXNob2xkID0gUGFycnlUaHJlc2hvbGQKCQkJCQlpZiBEaXN0YW5jZSA8PSBTcGFtX0FjY3VyYWN5IGFuZCBQYXJyaWVzID4gdGhyZXNob2xkIHRoZW4KCQkJCQkJaWYgZ2V0Z2VudigpLlNwYW1QYXJyeUtleXByZXNzIHRoZW4KCQkJCQkJCWlmIERpc3RhbmNlID4gU3BhbV9BY2N1cmFjeSBvciBUYXJnZXRfRGlzdGFuY2UgPiBTcGFtX0FjY3VyYWN5IHRoZW4KCQkJCQkJCQlyZXR1cm4KCQkJCQkJCWVuZAoJCQkJCQkJVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQodHJ1ZSwgRW51bS5LZXlDb2RlLkYsIGZhbHNlLCBnYW1lKQoJCQkJCQllbHNlCgkJCQkJCQlBdXRvX1BhcnJ5LlBhcnJ5KFNlbGVjdGVkX1BhcnJ5X1R5cGUpCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kKQoJCQllbHNlCgkJCQlpZiBDb25uZWN0aW9uc19NYW5hZ2VyWyJBdXRvIFNwYW0iXSB0aGVuCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiQXV0byBTcGFtIl06RGlzY29ubmVjdCgpCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiQXV0byBTcGFtIl0gPSBuaWwKCQkJCWVuZAoJCQllbmQKCQllbmQsCgl9KQoJbG9jYWwgZHJvcGRvd24yID0gU3BhbVBhcnJ5OmNyZWF0ZV9kcm9wZG93bih7CgkJdGl0bGUgPSAiUGFycnkgVHlwZSIsCgkJZmxhZyA9ICJTcGFtX1BhcnJ5X1R5cGUiLAoJCW9wdGlvbnMgPSB7CgkJCSJMZWdpdCIsCgkJCSJCbGF0YW50IiwKCQl9LAoJCW11bHRpX2Ryb3Bkb3duID0gZmFsc2UsCgkJbWF4aW11bV9vcHRpb25zID0gMiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBzdHJpbmcpIGVuZCwKCX0pCglTcGFtUGFycnk6Y3JlYXRlX3NsaWRlcih7CgkJdGl0bGUgPSAiUGFycnkgVGhyZXNob2xkIiwKCQlmbGFnID0gIlBhcnJ5X1RocmVzaG9sZCIsCgkJbWF4aW11bV92YWx1ZSA9IDMsCgkJbWluaW11bV92YWx1ZSA9IDEsCgkJdmFsdWUgPSAyLjUsCgkJcm91bmRfbnVtYmVyID0gZmFsc2UsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogbnVtYmVyKQoJCQlQYXJyeVRocmVzaG9sZCA9IHZhbHVlCgkJZW5kLAoJfSkKCVNwYW1QYXJyeTpjcmVhdGVfZGl2aWRlcih7fSkKCWlmIG5vdCBpc01vYmlsZSB0aGVuCgkJbG9jYWwgQW5pbWF0aW9uRml4ID0gU3BhbVBhcnJ5OmNyZWF0ZV9jaGVja2JveCh7CgkJCXRpdGxlID0gIkFuaW1hdGlvbiBGaXgiLAoJCQlmbGFnID0gIkFuaW1hdGlvbkZpeCIsCgkJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCQlpZiB2YWx1ZSB0aGVuCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiQW5pbWF0aW9uIEZpeCJdID0gUnVuU2VydmljZS5QcmVTaW11bGF0aW9uOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJCQlsb2NhbCBCYWxsID0gQXV0b19QYXJyeS5HZXRfQmFsbCgpCgkJCQkJCWlmIG5vdCBCYWxsIHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJbG9jYWwgWm9vbWllcyA9IEJhbGw6RmluZEZpcnN0Q2hpbGQoInpvb21pZXMiKQoJCQkJCQlpZiBub3QgWm9vbWllcyB0aGVuCgkJCQkJCQlyZXR1cm4KCQkJCQkJZW5kCgkJCQkJCUF1dG9fUGFycnkuQ2xvc2VzdF9QbGF5ZXIoKQoJCQkJCQlsb2NhbCBQaW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJTdGF0cyIpLk5ldHdvcmsuU2VydmVyU3RhdHNJdGVtWyJEYXRhIFBpbmciXTpHZXRWYWx1ZSgpCgkJCQkJCWxvY2FsIFBpbmdfVGhyZXNob2xkID0gbWF0aC5jbGFtcChQaW5nIC8gMTAsIDEsIDE2KQoJCQkJCQlsb2NhbCBCYWxsX1RhcmdldCA9IEJhbGw6R2V0QXR0cmlidXRlKCJ0YXJnZXQiKQoJCQkJCQlsb2NhbCBCYWxsX1Byb3BlcnRpZXMgPSBBdXRvX1BhcnJ5OkdldF9CYWxsX1Byb3BlcnRpZXMoKQoJCQkJCQlsb2NhbCBFbnRpdHlfUHJvcGVydGllcyA9IEF1dG9fUGFycnk6R2V0X0VudGl0eV9Qcm9wZXJ0aWVzKCkKCQkJCQkJbG9jYWwgU3BhbV9BY2N1cmFjeSA9IEF1dG9fUGFycnkuU3BhbV9TZXJ2aWNlKHsKCQkJCQkJCUJhbGxfUHJvcGVydGllcyA9IEJhbGxfUHJvcGVydGllcywKCQkJCQkJCUVudGl0eV9Qcm9wZXJ0aWVzID0gRW50aXR5X1Byb3BlcnRpZXMsCgkJCQkJCQlQaW5nID0gUGluZ19UaHJlc2hvbGQsCgkJCQkJCX0pCgkJCQkJCWxvY2FsIFRhcmdldF9Qb3NpdGlvbiA9IENsb3Nlc3RfRW50aXR5LlByaW1hcnlQYXJ0LlBvc2l0aW9uCgkJCQkJCWxvY2FsIFRhcmdldF9EaXN0YW5jZSA9IFBsYXllcjpEaXN0YW5jZUZyb21DaGFyYWN0ZXIoVGFyZ2V0X1Bvc2l0aW9uKQoJCQkJCQlsb2NhbCBEaXJlY3Rpb24gPSAoUGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbiAtIEJhbGwuUG9zaXRpb24pLlVuaXQKCQkJCQkJbG9jYWwgQmFsbF9EaXJlY3Rpb24gPSBab29taWVzLlZlY3RvclZlbG9jaXR5LlVuaXQKCQkJCQkJbG9jYWwgRG90ID0gRGlyZWN0aW9uOkRvdChCYWxsX0RpcmVjdGlvbikKCQkJCQkJbG9jYWwgRGlzdGFuY2UgPSBQbGF5ZXI6RGlzdGFuY2VGcm9tQ2hhcmFjdGVyKEJhbGwuUG9zaXRpb24pCgkJCQkJCWlmIG5vdCBCYWxsX1RhcmdldCB0aGVuCgkJCQkJCQlyZXR1cm4KCQkJCQkJZW5kCgkJCQkJCWlmIFRhcmdldF9EaXN0YW5jZSA+IFNwYW1fQWNjdXJhY3kgb3IgRGlzdGFuY2UgPiBTcGFtX0FjY3VyYWN5IHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJbG9jYWwgUHVsc2VkID0gUGxheWVyLkNoYXJhY3RlcjpHZXRBdHRyaWJ1dGUoIlB1bHNlZCIpCgkJCQkJCWlmIFB1bHNlZCB0aGVuCgkJCQkJCQlyZXR1cm4KCQkJCQkJZW5kCgkJCQkJCWlmIEJhbGxfVGFyZ2V0ID09IHRvc3RyaW5nKFBsYXllcikgYW5kIFRhcmdldF9EaXN0YW5jZSA+IDMwIGFuZCBEaXN0YW5jZSA+IDMwIHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJbG9jYWwgdGhyZXNob2xkID0gUGFycnlUaHJlc2hvbGQKCQkJCQkJaWYgRGlzdGFuY2UgPD0gU3BhbV9BY2N1cmFjeSBhbmQgUGFycmllcyA+IHRocmVzaG9sZCB0aGVuCgkJCQkJCQlpZiBEaXN0YW5jZSA+IFNwYW1fQWNjdXJhY3kgb3IgVGFyZ2V0X0Rpc3RhbmNlID4gU3BhbV9BY2N1cmFjeSB0aGVuCgkJCQkJCQkJcmV0dXJuCgkJCQkJCQllbmQKCQkJCQkJCWlmIHRpY2soKSAtIChMYXN0X1BhcnJ5IG9yIDApIDwgMC4xIHRoZW4KCQkJCQkJCQlyZXR1cm4KCQkJCQkJCWVuZAoJCQkJCQkJTGFzdF9QYXJyeSA9IHRpY2soKQoJCQkJCQkJVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQodHJ1ZSwgRW51bS5LZXlDb2RlLkYsIGZhbHNlLCBnYW1lKQoJCQkJCQllbmQKCQkJCQllbmQpCgkJCQllbHNlCgkJCQkJaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsiQW5pbWF0aW9uIEZpeCJdIHRoZW4KCQkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiQW5pbWF0aW9uIEZpeCJdOkRpc2Nvbm5lY3QoKQoJCQkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJBbmltYXRpb24gRml4Il0gPSBuaWwKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQsCgkJfSkKCQlBbmltYXRpb25GaXg6Y2hhbmdlX3N0YXRlKHRydWUpCgllbmQKCVNwYW1QYXJyeTpjcmVhdGVfY2hlY2tib3goewoJCXRpdGxlID0gIktleXByZXNzIiwKCQlmbGFnID0gIkF1dG9fU3BhbV9QYXJyeV9LZXlwcmVzcyIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKCQkJZ2V0Z2VudigpLlNwYW1QYXJyeUtleXByZXNzID0gdmFsdWUKCQllbmQsCgl9KQoJU3BhbVBhcnJ5OmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiTm90aWZ5IiwKCQlmbGFnID0gIkF1dG9fU3BhbV9QYXJyeV9Ob3RpZnkiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5BdXRvU3BhbU5vdGlmeSA9IHZhbHVlCgkJZW5kLAoJfSkKCWxvY2FsIGluZmluaXR5RGV0ZWN0aW9uTW9kdWxlID0gZGV0ZWM6Y3JlYXRlX21vZHVsZSh7CiAgICB0aXRsZSA9ICJJbmZpbml0eSBEZXRlY3Rpb24iLAogICAgZmxhZyA9ICJJbmZpbml0eURldGVjdGlvbk1vZHVsZSIsCiAgICBkZXNjcmlwdGlvbiA9ICJUb2dnbGUgSW5maW5pdHkgQmFsbCBkZXRlY3Rpb24iLAogICAgc2VjdGlvbiA9ICJsZWZ0IiwKICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgZ2V0Z2VudigpLkluZmluaXR5RGV0ZWN0aW9uID0gdmFsdWUKICAgIGVuZCwKfSkKCmxvY2FsIGRyaWJibGVEZXRlY3Rpb25Nb2R1bGUgPSBkZXRlYzpjcmVhdGVfbW9kdWxlKHsKICAgIHRpdGxlID0gIkRyaWJibGUgRGV0ZWN0aW9uIiwKICAgIGZsYWcgPSAiRHJpYmJsZURldGVjdGlvbk1vZHVsZSIsCiAgICBkZXNjcmlwdGlvbiA9ICJUb2dnbGUgRHJpYmJsZSBCYWxsIGRldGVjdGlvbiIsCiAgICBzZWN0aW9uID0gInJpZ2h0IiwKICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgZ2V0Z2VudigpLkRyaWJibGVEZXRlY3Rpb24gPSB2YWx1ZQogICAgZW5kLAp9KQoKbG9jYWwgZGVhdGhTbGFzaERldGVjdGlvbk1vZHVsZSA9IGRldGVjOmNyZWF0ZV9tb2R1bGUoewogICAgdGl0bGUgPSAiRGVhdGggU2xhc2ggRGV0ZWN0aW9uIiwKICAgIGZsYWcgPSAiRGVhdGhTbGFzaERldGVjdGlvbk1vZHVsZSIsCiAgICBkZXNjcmlwdGlvbiA9ICJUb2dnbGUgRGVhdGggU2xhc2ggZGV0ZWN0aW9uIiwKICAgIHNlY3Rpb24gPSAibGVmdCIsCiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKSAgCiAgICBlbmQKfSkKCmxvY2FsIHRpbWVIb2xlRGV0ZWN0aW9uTW9kdWxlID0gZGV0ZWM6Y3JlYXRlX21vZHVsZSh7CiAgICB0aXRsZSA9ICJUaW1lIEhvbGUgRGV0ZWN0aW9uIiwKICAgIGZsYWcgPSAiVGltZUhvbGVEZXRlY3Rpb25Nb2R1bGUiLAogICAgZGVzY3JpcHRpb24gPSAiVG9nZ2xlIFRpbWUgSG9sZSBkZXRlY3Rpb24iLAogICAgc2VjdGlvbiA9ICJyaWdodCIsCiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgIGdldGdlbnYoKS5UaW1lSG9sZURldGVjdGlvbiA9IHZhbHVlCiAgICBlbmQsCn0pCgpsb2NhbCBzbGFzaE9mRnVyeURldGVjdGlvbk1vZHVsZSA9IGRldGVjOmNyZWF0ZV9tb2R1bGUoewogICAgdGl0bGUgPSAiU2xhc2ggT2YgRnVyeSBEZXRlY3Rpb24iLAogICAgZmxhZyA9ICJTbGFzaE9mRnVyeURldGVjdGlvbk1vZHVsZSIsCiAgICBkZXNjcmlwdGlvbiA9ICJUb2dnbGUgU2xhc2ggT2YgRnVyeSBkZXRlY3Rpb24iLAogICAgc2VjdGlvbiA9ICJsZWZ0IiwKICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgZ2V0Z2VudigpLlNsYXNoT2ZGdXJ5RGV0ZWN0aW9uID0gdmFsdWUKICAgIGVuZCwKfSkKCWxvY2FsIE1hbnVhbFNwYW0gPSByYWdlOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIk1hbnVhbCBTcGFtIFBhcnJ5IiwKCQlmbGFnID0gIk1hbnVhbF9TcGFtX1BhcnJ5IiwKCQlkZXNjcmlwdGlvbiA9ICJNYW51YWxseSBTcGFtcyBQYXJyeSIsCgkJc2VjdGlvbiA9ICJyaWdodCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKCQkJaWYgZ2V0Z2VudigpLk1hbnVhbFNwYW1Ob3RpZnkgdGhlbgoJCQkJaWYgdmFsdWUgdGhlbgoJCQkJCUxpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CgkJCQkJCXRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAoJCQkJCQl0ZXh0ID0gIk1hbnVhbCBTcGFtIFBhcnJ5IHR1cm5lZCBPTiIsCgkJCQkJCWR1cmF0aW9uID0gMywKCQkJCQl9KQoJCQkJZWxzZQoJCQkJCUxpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CgkJCQkJCXRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAoJCQkJCQl0ZXh0ID0gIk1hbnVhbCBTcGFtIFBhcnJ5IHR1cm5lZCBPRkYiLAoJCQkJCQlkdXJhdGlvbiA9IDMsCgkJCQkJfSkKCQkJCWVuZAoJCQllbmQKCQkJaWYgdmFsdWUgdGhlbgoJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiTWFudWFsIFNwYW0iXSA9IFJ1blNlcnZpY2UuUHJlU2ltdWxhdGlvbjpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQlpZiBnZXRnZW52KCkuc3BhbXVpIHRoZW4KCQkJCQkJcmV0dXJuCgkJCQkJZW5kCgkJCQkJaWYgZ2V0Z2VudigpLk1hbnVhbFNwYW1LZXlwcmVzcyB0aGVuCgkJCQkJCVZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5GLCBmYWxzZSwgZ2FtZSkKCQkJCQllbHNlCgkJCQkJCUF1dG9fUGFycnkuUGFycnkoU2VsZWN0ZWRfUGFycnlfVHlwZSkKCQkJCQllbmQKCQkJCWVuZCkKCQkJZWxzZQoJCQkJaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsiTWFudWFsIFNwYW0iXSB0aGVuCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiTWFudWFsIFNwYW0iXTpEaXNjb25uZWN0KCkKCQkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJNYW51YWwgU3BhbSJdID0gbmlsCgkJCQllbmQKCQkJZW5kCgkJZW5kLAoJfSkKCiAgICBNYW51YWxTcGFtOmNyZWF0ZV9jaGVja2JveCh7CiAgICB0aXRsZSA9ICJVSSIsCiAgICBmbGFnID0gIk1hbnVhbF9TcGFtX1VJIiwKICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgZ2V0Z2VudigpLnNwYW11aSA9IHZhbHVlCgogICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIG1hbnVhbCA9IEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIikKICAgICAgICAgICAgbWFudWFsLk5hbWUgPSAiTWFudWFsU3BhbVVJIgogICAgICAgICAgICBtYW51YWwuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiUGxheWVyR3VpIikKICAgICAgICAgICAgbWFudWFsLlpJbmRleEJlaGF2aW9yID0gRW51bS5aSW5kZXhCZWhhdmlvci5TaWJsaW5nCgkJCW1hbnVhbC5SZXNldE9uU3Bhd24gPSB0cnVlCgogICAgICAgICAgICBsb2NhbCBwaWNzID0gSW5zdGFuY2UubmV3KCJGcmFtZSIpCiAgICAgICAgICAgIHBpY3MuTmFtZSA9ICJwaWNzIgogICAgICAgICAgICBwaWNzLlBhcmVudCA9IG1hbnVhbAogICAgICAgICAgICBwaWNzLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICBwaWNzLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgcGljcy5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjQ2LCAwLCAwLjQwNzUsIDApCiAgICAgICAgICAgIHBpY3MuU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDAsIDAsIDEwMCkKCiAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpCiAgICAgICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IHBpY3MKCiAgICAgICAgICAgIGxvY2FsIEltYWdlTGFiZWwgPSBJbnN0YW5jZS5uZXcoIkltYWdlTGFiZWwiKQogICAgICAgICAgICBJbWFnZUxhYmVsLlBhcmVudCA9IHBpY3MKICAgICAgICAgICAgSW1hZ2VMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBJbWFnZUxhYmVsLlNpemUgPSBVRGltMi5uZXcoMCwgMjAwLCAwLCAxMDApCiAgICAgICAgICAgIEltYWdlTGFiZWwuSW1hZ2UgPSAicmJ4YXNzZXRpZDovLzg2OTM1MTQ4NjUxMDIxIgoKICAgICAgICAgICAgbG9jYWwgVUlDb3JuZXJfMiA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQogICAgICAgICAgICBVSUNvcm5lcl8yLlBhcmVudCA9IEltYWdlTGFiZWwKCiAgICAgICAgICAgIGxvY2FsIFRleHRCdXR0b24gPSBJbnN0YW5jZS5uZXcoIlRleHRCdXR0b24iKQogICAgICAgICAgICBUZXh0QnV0dG9uLlBhcmVudCA9IHBpY3MKICAgICAgICAgICAgVGV4dEJ1dHRvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBUZXh0QnV0dG9uLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAuNTUsIDApCiAgICAgICAgICAgIFRleHRCdXR0b24uU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDAsIDAsIDQ4KQogICAgICAgICAgICBUZXh0QnV0dG9uLkZvbnQgPSBFbnVtLkZvbnQuRnJlZG9rYU9uZQogICAgICAgICAgICBUZXh0QnV0dG9uLlRleHQgPSAiTWFudWFsIFNwYW0iCiAgICAgICAgICAgIFRleHRCdXR0b24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgIFRleHRCdXR0b24uVGV4dFNjYWxlZCA9IHRydWUKICAgICAgICAgICAgVGV4dEJ1dHRvbi5UZXh0V3JhcHBlZCA9IHRydWUKCQkJCgkJCWxvY2FsIFR3ZWVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIikKCQkJCWxvY2FsIFVzZXJJbnB1dFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKQoKCQkJCWxvY2FsIGZ1bmN0aW9uIG1ha2VEcmFnZ2FibGUoZnJhbWUpCgkJCQkJbG9jYWwgZHJhZ2dpbmcgPSBmYWxzZQoJCQkJCWxvY2FsIGRyYWdJbnB1dCwgZHJhZ1N0YXJ0LCBzdGFydFBvcwoKCQkJCQlsb2NhbCBmdW5jdGlvbiB1cGRhdGUoaW5wdXQpCgkJCQkJCWxvY2FsIGRlbHRhID0gaW5wdXQuUG9zaXRpb24gLSBkcmFnU3RhcnQKCQkJCQkJbG9jYWwgbmV3UG9zID0gVURpbTIubmV3KAoJCQkJCQkJc3RhcnRQb3MuWC5TY2FsZSwKCQkJCQkJCXN0YXJ0UG9zLlguT2Zmc2V0ICsgZGVsdGEuWCwKCQkJCQkJCXN0YXJ0UG9zLlkuU2NhbGUsCgkJCQkJCQlzdGFydFBvcy5ZLk9mZnNldCArIGRlbHRhLlkKCQkJCQkJKQoJCQkJCQkKCQkJCQkJVHdlZW5TZXJ2aWNlOkNyZWF0ZShmcmFtZSwgVHdlZW5JbmZvLm5ldygwLjIsIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewoJCQkJCQkJUG9zaXRpb24gPSBuZXdQb3MKCQkJCQkJfSk6UGxheSgpCgkJCQkJZW5kCgoJCQkJCWZyYW1lLkFjdGl2ZSA9IHRydWUKCQkJCQlmcmFtZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCgkJCQkJCWlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSB0aGVuCgkJCQkJCQlkcmFnZ2luZyA9IHRydWUKCQkJCQkJCWRyYWdTdGFydCA9IGlucHV0LlBvc2l0aW9uCgkJCQkJCQlzdGFydFBvcyA9IGZyYW1lLlBvc2l0aW9uCgoJCQkJCQkJaW5wdXQuQ2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQkJCQlpZiBpbnB1dC5Vc2VySW5wdXRTdGF0ZSA9PSBFbnVtLlVzZXJJbnB1dFN0YXRlLkVuZCB0aGVuCgkJCQkJCQkJCWRyYWdnaW5nID0gZmFsc2UKCQkJCQkJCQllbmQKCQkJCQkJCWVuZCkKCQkJCQkJZW5kCgkJCQkJZW5kKQoKCQkJCQlmcmFtZS5JbnB1dENoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihpbnB1dCkKCQkJCQkJaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VNb3ZlbWVudCB0aGVuCgkJCQkJCQlkcmFnSW5wdXQgPSBpbnB1dAoJCQkJCQllbmQKCQkJCQllbmQpCgoJCQkJCVVzZXJJbnB1dFNlcnZpY2UuSW5wdXRDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCgkJCQkJCWlmIGlucHV0ID09IGRyYWdJbnB1dCBhbmQgZHJhZ2dpbmcgdGhlbgoJCQkJCQkJdXBkYXRlKGlucHV0KQoJCQkJCQllbmQKCQkJCQllbmQpCgkJCQllbmQKCgkJCQkKCQkJCW1ha2VEcmFnZ2FibGUocGljcykKICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBhY3RpdmF0ZWQgPSBmYWxzZQogICAgICAgICAgICBsb2NhbCBmdW5jdGlvbiB0b2dnbGUoKQogICAgICAgICAgICAgICAgYWN0aXZhdGVkID0gbm90IGFjdGl2YXRlZAogICAgICAgICAgICAgICAgVGV4dEJ1dHRvbi5UZXh0ID0gYWN0aXZhdGVkIGFuZCAiU3RvcCIgb3IgIkNsYXNoIE1vZGUiCiAgICAgICAgICAgICAgICBpZiBhY3RpdmF0ZWQgdGhlbgogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbIk1hbnVhbCBTcGFtIFVJIl0gPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9fUGFycnkuUGFycnkoU2VsZWN0ZWRfUGFycnlfVHlwZSkKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsiTWFudWFsIFNwYW0gVUkiXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbIk1hbnVhbCBTcGFtIFVJIl06RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbIk1hbnVhbCBTcGFtIFVJIl0gPSBuaWwKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgVGV4dEJ1dHRvbi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KHRvZ2dsZSkKCiAgICAgICAgZWxzZQogIAogICAgICAgICAgICBsb2NhbCBleGlzdGluZ1VJID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiTWFudWFsU3BhbVVJIikKICAgICAgICAgICAgaWYgZXhpc3RpbmdVSSB0aGVuCiAgICAgICAgICAgICAgICBleGlzdGluZ1VJOkRlc3Ryb3koKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsiTWFudWFsIFNwYW0gVUkiXSB0aGVuCiAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWyJNYW51YWwgU3BhbSBVSSJdOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsiTWFudWFsIFNwYW0gVUkiXSA9IG5pbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCwKfSkKCglpZiBub3QgaXNNb2JpbGUgdGhlbgoJCWxvY2FsIEFuaW1hdGlvbkZpeCA9IE1hbnVhbFNwYW06Y3JlYXRlX2NoZWNrYm94KHsKCQkJdGl0bGUgPSAiQW5pbWF0aW9uIEZpeCIsCgkJCWZsYWcgPSAiQW5pbWF0aW9uRml4IiwKCQkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKCQkJCWlmIHZhbHVlIHRoZW4KCQkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJBbmltYXRpb24gRml4Il0gPSBSdW5TZXJ2aWNlLlByZVNpbXVsYXRpb246Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJCWxvY2FsIEJhbGwgPSBBdXRvX1BhcnJ5LkdldF9CYWxsKCkKCQkJCQkJaWYgbm90IEJhbGwgdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoJCQkJCQlsb2NhbCBab29taWVzID0gQmFsbDpGaW5kRmlyc3RDaGlsZCgiem9vbWllcyIpCgkJCQkJCWlmIG5vdCBab29taWVzIHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJQXV0b19QYXJyeS5DbG9zZXN0X1BsYXllcigpCgkJCQkJCWxvY2FsIFBpbmcgPSBnYW1lOkdldFNlcnZpY2UoIlN0YXRzIikuTmV0d29yay5TZXJ2ZXJTdGF0c0l0ZW1bIkRhdGEgUGluZyJdOkdldFZhbHVlKCkKCQkJCQkJbG9jYWwgUGluZ19UaHJlc2hvbGQgPSBtYXRoLmNsYW1wKFBpbmcgLyAxMCwgMSwgMTYpCgkJCQkJCWxvY2FsIEJhbGxfVGFyZ2V0ID0gQmFsbDpHZXRBdHRyaWJ1dGUoInRhcmdldCIpCgkJCQkJCWxvY2FsIEJhbGxfUHJvcGVydGllcyA9IEF1dG9fUGFycnk6R2V0X0JhbGxfUHJvcGVydGllcygpCgkJCQkJCWxvY2FsIEVudGl0eV9Qcm9wZXJ0aWVzID0gQXV0b19QYXJyeTpHZXRfRW50aXR5X1Byb3BlcnRpZXMoKQoJCQkJCQlsb2NhbCBTcGFtX0FjY3VyYWN5ID0gQXV0b19QYXJyeS5TcGFtX1NlcnZpY2UoewoJCQkJCQkJQmFsbF9Qcm9wZXJ0aWVzID0gQmFsbF9Qcm9wZXJ0aWVzLAoJCQkJCQkJRW50aXR5X1Byb3BlcnRpZXMgPSBFbnRpdHlfUHJvcGVydGllcywKCQkJCQkJCVBpbmcgPSBQaW5nX1RocmVzaG9sZCwKCQkJCQkJfSkKCQkJCQkJbG9jYWwgVGFyZ2V0X1Bvc2l0aW9uID0gQ2xvc2VzdF9FbnRpdHkuUHJpbWFyeVBhcnQuUG9zaXRpb24KCQkJCQkJbG9jYWwgVGFyZ2V0X0Rpc3RhbmNlID0gUGxheWVyOkRpc3RhbmNlRnJvbUNoYXJhY3RlcihUYXJnZXRfUG9zaXRpb24pCgkJCQkJCWxvY2FsIERpcmVjdGlvbiA9IChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uIC0gQmFsbC5Qb3NpdGlvbikuVW5pdAoJCQkJCQlsb2NhbCBCYWxsX0RpcmVjdGlvbiA9IFpvb21pZXMuVmVjdG9yVmVsb2NpdHkuVW5pdAoJCQkJCQlsb2NhbCBEb3QgPSBEaXJlY3Rpb246RG90KEJhbGxfRGlyZWN0aW9uKQoJCQkJCQlsb2NhbCBEaXN0YW5jZSA9IFBsYXllcjpEaXN0YW5jZUZyb21DaGFyYWN0ZXIoQmFsbC5Qb3NpdGlvbikKCQkJCQkJaWYgbm90IEJhbGxfVGFyZ2V0IHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJaWYgVGFyZ2V0X0Rpc3RhbmNlID4gU3BhbV9BY2N1cmFjeSBvciBEaXN0YW5jZSA+IFNwYW1fQWNjdXJhY3kgdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoJCQkJCQlsb2NhbCBQdWxzZWQgPSBQbGF5ZXIuQ2hhcmFjdGVyOkdldEF0dHJpYnV0ZSgiUHVsc2VkIikKCQkJCQkJaWYgUHVsc2VkIHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJaWYgQmFsbF9UYXJnZXQgPT0gdG9zdHJpbmcoUGxheWVyKSBhbmQgVGFyZ2V0X0Rpc3RhbmNlID4gMzAgYW5kIERpc3RhbmNlID4gMzAgdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoJCQkJCQlsb2NhbCB0aHJlc2hvbGQgPSBQYXJyeVRocmVzaG9sZAoJCQkJCQlpZiBEaXN0YW5jZSA8PSBTcGFtX0FjY3VyYWN5IGFuZCBQYXJyaWVzID4gdGhyZXNob2xkIHRoZW4KCQkJCQkJCWlmIERpc3RhbmNlID4gU3BhbV9BY2N1cmFjeSBvciBUYXJnZXRfRGlzdGFuY2UgPiBTcGFtX0FjY3VyYWN5IHRoZW4KCQkJCQkJCQlyZXR1cm4KCQkJCQkJCWVuZAoJCQkJCQkJaWYgdGljaygpIC0gKExhc3RfUGFycnkgb3IgMCkgPCAwLjEgdGhlbgoJCQkJCQkJCXJldHVybgoJCQkJCQkJZW5kCgkJCQkJCQlMYXN0X1BhcnJ5ID0gdGljaygpCgkJCQkJCQlWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudCh0cnVlLCBFbnVtLktleUNvZGUuRiwgZmFsc2UsIGdhbWUpCgkJCQkJCWVuZAoJCQkJCWVuZCkKCQkJCWVsc2UKCQkJCQlpZiBDb25uZWN0aW9uc19NYW5hZ2VyWyJBbmltYXRpb24gRml4Il0gdGhlbgoJCQkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJBbmltYXRpb24gRml4Il06RGlzY29ubmVjdCgpCgkJCQkJCUNvbm5lY3Rpb25zX01hbmFnZXJbIkFuaW1hdGlvbiBGaXgiXSA9IG5pbAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZCwKCQl9KQoJCUFuaW1hdGlvbkZpeDpjaGFuZ2Vfc3RhdGUodHJ1ZSkKCWVuZAoJTWFudWFsU3BhbTpjcmVhdGVfY2hlY2tib3goewoJCXRpdGxlID0gIktleXByZXNzIiwKCQlmbGFnID0gIk1hbnVhbF9TcGFtX0tleXByZXNzIiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlnZXRnZW52KCkuTWFudWFsU3BhbUtleXByZXNzID0gdmFsdWUKCQllbmQsCgl9KQoJTWFudWFsU3BhbTpjcmVhdGVfY2hlY2tib3goewoJCXRpdGxlID0gIk5vdGlmeSIsCgkJZmxhZyA9ICJNYW51YWxfU3BhbV9QYXJyeV9Ob3RpZnkiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5NYW51YWxTcGFtTm90aWZ5ID0gdmFsdWUKCQllbmQsCgl9KQoJbG9jYWwgVHJpZ2dlcmJvdCA9IHJhZ2UyOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIlRyaWdnZXJib3QiLAoJCWZsYWcgPSAiVHJpZ2dlcmJvdCIsCgkJZGVzY3JpcHRpb24gPSAiSW5zdGFudGx5IGhpdHMgYmFsbCB3aGVuIHRhcmdldGVkIiwKCQlzZWN0aW9uID0gImxlZnQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWlmIGdldGdlbnYoKS5UcmlnZ2VyYm90Tm90aWZ5IHRoZW4KCQkJCWlmIHZhbHVlIHRoZW4KCQkJCQlMaWJyYXJ5LlNlbmROb3RpZmljYXRpb24oewoJCQkJCQl0aXRsZSA9ICJNb2R1bGUgTm90aWZpY2F0aW9uIiwKCQkJCQkJdGV4dCA9ICJUcmlnZ2VyYm90IHR1cm5lZCBPTiIsCgkJCQkJCWR1cmF0aW9uID0gMywKCQkJCQl9KQoJCQkJZWxzZQoJCQkJCUxpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CgkJCQkJCXRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAoJCQkJCQl0ZXh0ID0gIlRyaWdnZXJib3QgdHVybmVkIE9GRiIsCgkJCQkJCWR1cmF0aW9uID0gMywKCQkJCQl9KQoJCQkJZW5kCgkJCWVuZAoJCQlpZiB2YWx1ZSB0aGVuCgkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJUcmlnZ2VyYm90Il0gPSBSdW5TZXJ2aWNlLlByZVNpbXVsYXRpb246Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJbG9jYWwgQmFsbHMgPSBBdXRvX1BhcnJ5LkdldF9CYWxscygpCgkJCQkJZm9yIF8sIEJhbGwgaW4gcGFpcnMoQmFsbHMpIGRvCgkJCQkJCWlmIG5vdCBCYWxsIHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJQmFsbDpHZXRBdHRyaWJ1dGVDaGFuZ2VkU2lnbmFsKCJ0YXJnZXQiKTpPbmNlKGZ1bmN0aW9uKCkKCQkJCQkJCVRyaWdnZXJib3RQYXJyaWVkID0gZmFsc2UKCQkJCQkJZW5kKQoJCQkJCQlpZiBUcmlnZ2VyYm90UGFycmllZCB0aGVuCgkJCQkJCQlyZXR1cm4KCQkJCQkJZW5kCgkJCQkJCWxvY2FsIEJhbGxfVGFyZ2V0ID0gQmFsbDpHZXRBdHRyaWJ1dGUoInRhcmdldCIpCgkJCQkJCWxvY2FsIFNpbmd1bGFyaXR5X0NhcGUgPSBQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0OkZpbmRGaXJzdENoaWxkKCJTaW5ndWxhcml0eUNhcGUiKQoJCQkJCQlpZiBTaW5ndWxhcml0eV9DYXBlIHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCQkJCQkJaWYgZ2V0Z2VudigpLlRyaWdnZXJib3RJbmZpbml0eURldGVjdGlvbiBhbmQgSW5maW5pdHkgdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoJCQkJCQlpZiBCYWxsX1RhcmdldCA9PSB0b3N0cmluZyhQbGF5ZXIpIHRoZW4KCQkJCQkJCWlmIGdldGdlbnYoKS5UcmlnZ2VyYm90S2V5cHJlc3MgdGhlbgoJCQkJCQkJCVZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5GLCBmYWxzZSwgZ2FtZSkKCQkJCQkJCWVsc2UKCQkJCQkJCQlBdXRvX1BhcnJ5LlBhcnJ5KFNlbGVjdGVkX1BhcnJ5X1R5cGUpCgkJCQkJCQllbmQKCQkJCQkJCVRyaWdnZXJib3RQYXJyaWVkID0gdHJ1ZQoJCQkJCQllbmQKCQkJCQkJbG9jYWwgVHJpZ2dlcmJvdF9MYXN0X1BhcnJ5cyA9IHRpY2soKQoJCQkJCQlyZXBlYXQKCQkJCQkJCVJ1blNlcnZpY2UuUHJlU2ltdWxhdGlvbjpXYWl0KCkKCQkJCQkJdW50aWwgKHRpY2soKSAtIFRyaWdnZXJib3RfTGFzdF9QYXJyeXMpID49IDEgb3Igbm90IFRyaWdnZXJib3RQYXJyaWVkCgkJCQkJCVRyaWdnZXJib3RQYXJyaWVkID0gZmFsc2UKCQkJCQllbmQKCQkJCWVuZCkKCQkJZWxzZQoJCQkJaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsiVHJpZ2dlcmJvdCJdIHRoZW4KCQkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJUcmlnZ2VyYm90Il06RGlzY29ubmVjdCgpCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiVHJpZ2dlcmJvdCJdID0gbmlsCgkJCQllbmQKCQkJZW5kCgkJZW5kLAoJfSkKCVRyaWdnZXJib3Q6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJLZXlwcmVzcyIsCgkJZmxhZyA9ICJUcmlnZ2VyYm90X0tleXByZXNzIiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlnZXRnZW52KCkuVHJpZ2dlcmJvdEtleXByZXNzID0gdmFsdWUKCQllbmQsCgl9KQoJVHJpZ2dlcmJvdDpjcmVhdGVfY2hlY2tib3goewoJCXRpdGxlID0gIk5vdGlmeSIsCgkJZmxhZyA9ICJUcmlnZ2VyYm90Tm90aWZ5IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlnZXRnZW52KCkuVHJpZ2dlcmJvdE5vdGlmeSA9IHZhbHVlCgkJZW5kLAoJfSkKCWxvY2FsIHBhcnJ5VHlwZUxpc3QgPSB7CgkJIkNhbWVyYSIsCgkJIlJhbmRvbSIsCgkJIkJhY2t3YXJkcyIsCgkJIlN0cmFpZ2h0IiwKCQkiSGlnaCIsCgkJIkxlZnQiLAoJCSJSaWdodCIsCgkJIlJhbmRvbSBUYXJnZXQiLAoJCSJTbG93YmFsbCIsCgkJIkZhc3RiYWxsIiwKCX0KCWxvY2FsIGN1cnJlbnRJbmRleCA9IDEKCWxvY2FsIEhvdGtleVBhcnJ5VHlwZSA9IHJhZ2UyOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIkhvdGtleSBQYXJyeSBUeXBlIFtQQ10iLAoJCWZsYWcgPSAiSG90a2V5UGFycnlUeXBlIiwKCQlkZXNjcmlwdGlvbiA9ICJBbGxvd3MgSG90a2V5IFBhcnJ5IFR5cGUiLAoJCXNlY3Rpb24gPSAicmlnaHQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5Ib3RrZXlQYXJyeVR5cGUgPSB2YWx1ZQoJCWVuZCwKCX0pCglIb3RrZXlQYXJyeVR5cGU6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJOb3RpZnkiLAoJCWZsYWcgPSAiSG90a2V5UGFycnlUeXBlTm90aWZ5IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlnZXRnZW52KCkuSG90a2V5UGFycnlUeXBlTm90aWZ5ID0gdmFsdWUKCQllbmQsCgl9KQoJbG9jYWwgU2V0Q3VydmVNb2R1bGUgPSByYWdlMjpjcmVhdGVfbW9kdWxlKHsKCQl0aXRsZSA9ICJCdXR0b24gc2VsZWN0IGN1cnZlIiwKCQlmbGFnID0gIlNldEN1cnZlTW9kdWxlIiwKCQlkZXNjcmlwdGlvbiA9ICJFbmFibGUgVUkgdG8gY2xpY2sgYW5kIGNoYW5nZSBwYXJyeSB0eXBlIiwKCQlzZWN0aW9uID0gImxlZnQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWlmIHZhbHVlIHRoZW4KCQkJCWxvY2FsIGd1aSA9IEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIikKCQkJCWd1aS5OYW1lID0gIlNldEN1cnZlVUkiCgkJCQlndWkuUmVzZXRPblNwYXduID0gZmFsc2UKCQkJCWd1aS5QYXJlbnQgPSBnYW1lLkNvcmVHdWkKCQkJCWxvY2FsIGZyYW1lID0gSW5zdGFuY2UubmV3KCJGcmFtZSIpCgkJCQlmcmFtZS5OYW1lID0gIk1haW5GcmFtZSIKCQkJCWZyYW1lLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDIwLCAwLCAyMCkKCQkJCWZyYW1lLlNpemUgPSBVRGltMi5uZXcoMCwgMjAwLCAwLCAxMDApCgkJCQlmcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoOTAsIDYwLCAxODApCgkJCQlmcmFtZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC4yNQoJCQkJZnJhbWUuQm9yZGVyU2l6ZVBpeGVsID0gMAoJCQkJZnJhbWUuQWN0aXZlID0gdHJ1ZQoJCQkJZnJhbWUuRHJhZ2dhYmxlID0gdHJ1ZQoJCQkJZnJhbWUuUGFyZW50ID0gZ3VpCgkJCQlsb2NhbCB1aUNvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQoJCQkJdWlDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMTIpCgkJCQl1aUNvcm5lci5QYXJlbnQgPSBmcmFtZQoJCQkJbG9jYWwgdWlTdHJva2UgPSBJbnN0YW5jZS5uZXcoIlVJU3Ryb2tlIikKCQkJCXVpU3Ryb2tlLlRoaWNrbmVzcyA9IDIKCQkJCXVpU3Ryb2tlLkNvbG9yID0gQ29sb3IzLmZyb21SR0IoMTkwLCAxNTAsIDI1NSkKCQkJCXVpU3Ryb2tlLlRyYW5zcGFyZW5jeSA9IDAuMgoJCQkJdWlTdHJva2UuQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCgkJCQl1aVN0cm9rZS5QYXJlbnQgPSBmcmFtZQoJCQkJbG9jYWwgdWlHcmFkaWVudCA9IEluc3RhbmNlLm5ldygiVUlHcmFkaWVudCIpCgkJCQl1aUdyYWRpZW50LkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXcoewoJCQkJCUNvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgQ29sb3IzLmZyb21SR0IoOTAsIDYwLCAxODApKSwKCQkJCQlDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIENvbG9yMy5mcm9tUkdCKDE1LCAxMCwgMjUpKSwKCQkJCX0pCgkJCQl1aUdyYWRpZW50LlJvdGF0aW9uID0gMAoJCQkJdWlHcmFkaWVudC5QYXJlbnQgPSBmcmFtZQoJCQkJbG9jYWwgYnV0dG9uID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIikKCQkJCWJ1dHRvbi5OYW1lID0gIlNldEN1cnZlQnV0dG9uIgoJCQkJYnV0dG9uLlRleHQgPSAiU2V0IEN1cnZlIgoJCQkJYnV0dG9uLlNpemUgPSBVRGltMi5uZXcoMCwgMTYwLCAwLCA0MCkKCQkJCWJ1dHRvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIC04MCwgMC41LCAtMjApCgkJCQlidXR0b24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKCQkJCWJ1dHRvbi5Cb3JkZXJTaXplUGl4ZWwgPSAwCgkJCQlidXR0b24uRm9udCA9IEVudW0uRm9udC5Hb3RoYW1TZW1pYm9sZAoJCQkJYnV0dG9uLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMzUsIDIxNSwgMjU1KQoJCQkJYnV0dG9uLlRleHRTaXplID0gMjIKCQkJCWJ1dHRvbi5QYXJlbnQgPSBmcmFtZQoJCQkJYnV0dG9uLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJCWN1cnJlbnRJbmRleCArPSAxCgkJCQkJaWYgY3VycmVudEluZGV4ID4gI3BhcnJ5VHlwZUxpc3QgdGhlbgoJCQkJCQljdXJyZW50SW5kZXggPSAxCgkJCQkJZW5kCgkJCQkJbG9jYWwgbmV3VHlwZSA9IHBhcnJ5VHlwZUxpc3RbY3VycmVudEluZGV4XQoJCQkJCVNlbGVjdGVkX1BhcnJ5X1R5cGUgPSBwYXJyeVR5cGVNYXAgYW5kIHBhcnJ5VHlwZU1hcFtuZXdUeXBlXSBvciBuZXdUeXBlCgkJCQkJaWYgZHJvcGRvd24gYW5kIGRyb3Bkb3duLnVwZGF0ZSB0aGVuCgkJCQkJCWRyb3Bkb3duOnVwZGF0ZShuZXdUeXBlKQoJCQkJCWVuZAoJCQkJCWJ1dHRvbi5UZXh0ID0gbmV3VHlwZQoJCQkJCWlmIGdldGdlbnYoKS5Ib3RrZXlQYXJyeVR5cGVOb3RpZnkgdGhlbgoJCQkJCQlMaWJyYXJ5LlNlbmROb3RpZmljYXRpb24oewoJCQkJCQkJdGl0bGUgPSAiTW9kdWxlIE5vdGlmaWNhdGlvbiIsCgkJCQkJCQl0ZXh0ID0gIlBhcnJ5IFR5cGUgY2hhbmdlZCB0byAiIC4uIG5ld1R5cGUsCgkJCQkJCQlkdXJhdGlvbiA9IDMsCgkJCQkJCX0pCgkJCQkJZW5kCgkJCQllbmQpCgkJCWVsc2UKCQkJCWxvY2FsIGV4aXN0aW5nID0gZ2FtZS5Db3JlR3VpOkZpbmRGaXJzdENoaWxkKCJTZXRDdXJ2ZVVJIikKCQkJCWlmIGV4aXN0aW5nIHRoZW4KCQkJCQlleGlzdGluZzpEZXN0cm95KCkKCQkJCWVuZAoJCQllbmQKCQllbmQsCgl9KQoJbG9jYWwgTG9iYnlBUCA9IHJhZ2U6Y3JlYXRlX21vZHVsZSh7CgkJdGl0bGUgPSAiTG9iYnkgQVAiLAoJCWZsYWcgPSAiTG9iYnlfQVAiLAoJCWRlc2NyaXB0aW9uID0gIkF1dG8gcGFycmllcyBiYWxsIGluIGxvYmJ5IiwKCQlzZWN0aW9uID0gInJpZ2h0IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQoJCQlpZiBnZXRnZW52KCkuTG9iYnlBUE5vdGlmeSB0aGVuCgkJCQlpZiBzdGF0ZSB0aGVuCgkJCQkJTGlicmFyeS5TZW5kTm90aWZpY2F0aW9uKHsKCQkJCQkJdGl0bGUgPSAiTW9kdWxlIE5vdGlmaWNhdGlvbiIsCgkJCQkJCXRleHQgPSAiTG9iYnkgQVAgaGFzIGJlZW4gdHVybmVkIE9OIiwKCQkJCQkJZHVyYXRpb24gPSAzLAoJCQkJCX0pCgkJCQllbHNlCgkJCQkJTGlicmFyeS5TZW5kTm90aWZpY2F0aW9uKHsKCQkJCQkJdGl0bGUgPSAiTW9kdWxlIE5vdGlmaWNhdGlvbiIsCgkJCQkJCXRleHQgPSAiTG9iYnkgQVAgaGFzIGJlZW4gdHVybmVkIE9GRiIsCgkJCQkJCWR1cmF0aW9uID0gMywKCQkJCQl9KQoJCQkJZW5kCgkJCWVuZAoJCQlpZiBzdGF0ZSB0aGVuCgkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJMb2JieSBBUCJdID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJbG9jYWwgQmFsbCA9IEF1dG9fUGFycnkuTG9iYnlfQmFsbHMoKQoJCQkJCWlmIG5vdCBCYWxsIHRoZW4KCQkJCQkJcmV0dXJuCgkJCQkJZW5kCgkJCQkJbG9jYWwgWm9vbWllcyA9IEJhbGw6RmluZEZpcnN0Q2hpbGQoInpvb21pZXMiKQoJCQkJCWlmIG5vdCBab29taWVzIHRoZW4KCQkJCQkJcmV0dXJuCgkJCQkJZW5kCgkJCQkJQmFsbDpHZXRBdHRyaWJ1dGVDaGFuZ2VkU2lnbmFsKCJ0YXJnZXQiKTpPbmNlKGZ1bmN0aW9uKCkKCQkJCQkJVHJhaW5pbmdfUGFycmllZCA9IGZhbHNlCgkJCQkJZW5kKQoJCQkJCWlmIFRyYWluaW5nX1BhcnJpZWQgdGhlbgoJCQkJCQlyZXR1cm4KCQkJCQllbmQKCQkJCQlsb2NhbCBCYWxsX1RhcmdldCA9IEJhbGw6R2V0QXR0cmlidXRlKCJ0YXJnZXQiKQoJCQkJCWxvY2FsIFZlbG9jaXR5ID0gWm9vbWllcy5WZWN0b3JWZWxvY2l0eQoJCQkJCWxvY2FsIERpc3RhbmNlID0gUGxheWVyOkRpc3RhbmNlRnJvbUNoYXJhY3RlcihCYWxsLlBvc2l0aW9uKQoJCQkJCWxvY2FsIFNwZWVkID0gVmVsb2NpdHkuTWFnbml0dWRlCgkJCQkJbG9jYWwgUGluZyA9IGdhbWU6R2V0U2VydmljZSgiU3RhdHMiKS5OZXR3b3JrLlNlcnZlclN0YXRzSXRlbVsiRGF0YSBQaW5nIl06R2V0VmFsdWUoKSAvIDEwCgkJCQkJbG9jYWwgTG9iYnlBUGNhcHBlZFNwZWVkRGlmZiA9IG1hdGgubWluKG1hdGgubWF4KFNwZWVkIC0gOS41LCAwKSwgNjUwKQoJCQkJCWxvY2FsIExvYmJ5QVBzcGVlZF9kaXZpc29yX2Jhc2UgPSAyLjQgKyBMb2JieUFQY2FwcGVkU3BlZWREaWZmICogMC4wMDIKCQkJCQlsb2NhbCBMb2JieUFQZWZmZWN0aXZlTXVsdGlwbGllciA9IExvYmJ5QVBfU3BlZWRfRGl2aXNvcl9NdWx0aXBsaWVyCgkJCQkJaWYgZ2V0Z2VudigpLkxvYmJ5QVBSYW5kb21QYXJyeUFjY3VyYWN5RW5hYmxlZCB0aGVuCgkJCQkJCUxvYmJ5QVBlZmZlY3RpdmVNdWx0aXBsaWVyID0gMC43ICsgKG1hdGgucmFuZG9tKDEsIDEwMCkgLSAxKSAqICgwLjM1IC8gOTkpCgkJCQkJZW5kCgkJCQkJbG9jYWwgTG9iYnlBUHNwZWVkX2Rpdmlzb3IgPSBMb2JieUFQc3BlZWRfZGl2aXNvcl9iYXNlICogTG9iYnlBUGVmZmVjdGl2ZU11bHRpcGxpZXIKCQkJCQlsb2NhbCBMb2JieUFQUGFycnlfQWNjdXJhY3lzID0gUGluZyArIG1hdGgubWF4KFNwZWVkIC8gTG9iYnlBUHNwZWVkX2Rpdmlzb3IsIDkuNSkKCQkJCQlpZiBCYWxsX1RhcmdldCA9PSB0b3N0cmluZyhQbGF5ZXIpIGFuZCBEaXN0YW5jZSA8PSBMb2JieUFQUGFycnlfQWNjdXJhY3lzIHRoZW4KCQkJCQkJaWYgZ2V0Z2VudigpLkxvYmJ5QVBLZXlwcmVzcyB0aGVuCgkJCQkJCQlWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudCh0cnVlLCBFbnVtLktleUNvZGUuRiwgZmFsc2UsIGdhbWUpCgkJCQkJCWVsc2UKCQkJCQkJCUF1dG9fUGFycnkuUGFycnkoU2VsZWN0ZWRfUGFycnlfVHlwZSkKCQkJCQkJZW5kCgkJCQkJCVRyYWluaW5nX1BhcnJpZWQgPSB0cnVlCgkJCQkJZW5kCgkJCQkJbG9jYWwgTGFzdF9QYXJyeXMgPSB0aWNrKCkKCQkJCQlyZXBlYXQKCQkJCQkJUnVuU2VydmljZS5QcmVTaW11bGF0aW9uOldhaXQoKQoJCQkJCXVudGlsICh0aWNrKCkgLSBMYXN0X1BhcnJ5cykgPj0gMSBvciBub3QgVHJhaW5pbmdfUGFycmllZAoJCQkJCVRyYWluaW5nX1BhcnJpZWQgPSBmYWxzZQoJCQkJZW5kKQoJCQllbHNlCgkJCQlpZiBDb25uZWN0aW9uc19NYW5hZ2VyWyJMb2JieSBBUCJdIHRoZW4KCQkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJMb2JieSBBUCJdOkRpc2Nvbm5lY3QoKQoJCQkJCUNvbm5lY3Rpb25zX01hbmFnZXJbIkxvYmJ5IEFQIl0gPSBuaWwKCQkJCWVuZAoJCQllbmQKCQllbmQsCgl9KQoJTG9iYnlBUDpjcmVhdGVfc2xpZGVyKHsKCQl0aXRsZSA9ICJQYXJyeSBBY2N1cmFjeSIsCgkJZmxhZyA9ICJQYXJyeV9BY2N1cmFjeSIsCgkJbWF4aW11bV92YWx1ZSA9IDEwMCwKCQltaW5pbXVtX3ZhbHVlID0gMSwKCQl2YWx1ZSA9IDEwMCwKCQlyb3VuZF9udW1iZXIgPSB0cnVlLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IG51bWJlcikKCQkJTG9iYnlBUF9TcGVlZF9EaXZpc29yX011bHRpcGxpZXIgPSAwLjcgKyAodmFsdWUgLSAxKSAqICgwLjM1IC8gOTkpCgkJZW5kLAoJfSkKCUxvYmJ5QVA6Y3JlYXRlX2RpdmlkZXIoe30pCglMb2JieUFQOmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiUmFuZG9taXplZCBQYXJyeSBBY2N1cmFjeSIsCgkJZmxhZyA9ICJSYW5kb21fUGFycnlfQWNjdXJhY3kiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5Mb2JieUFQUmFuZG9tUGFycnlBY2N1cmFjeUVuYWJsZWQgPSB2YWx1ZQoJCWVuZCwKCX0pCglMb2JieUFQOmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiS2V5cHJlc3MiLAoJCWZsYWcgPSAiTG9iYnlfQVBfS2V5cHJlc3MiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5Mb2JieUFQS2V5cHJlc3MgPSB2YWx1ZQoJCWVuZCwKCX0pCglMb2JieUFQOmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiTm90aWZ5IiwKCQlmbGFnID0gIkxvYmJ5X0FQX05vdGlmeSIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKCQkJZ2V0Z2VudigpLkxvYmJ5QVBOb3RpZnkgPSB2YWx1ZQoJCWVuZCwKCX0pCglsb2NhbCBTdHJhZmVTcGVlZCA9IDM2Cglsb2NhbCBTdHJhZmUgPSBwbGF5ZXI6Y3JlYXRlX21vZHVsZSh7CgkJdGl0bGUgPSAiU3BlZWQiLAoJCWZsYWcgPSAiU3BlZWQiLAoJCWRlc2NyaXB0aW9uID0gIkNoYW5nZXMgY2hhcmFjdGVyIHNwZWVkIiwKCQlzZWN0aW9uID0gImxlZnQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWlmIHZhbHVlIHRoZW4KCQkJCUNvbm5lY3Rpb25zX01hbmFnZXJbIlN0cmFmZSJdID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuUHJlU2ltdWxhdGlvbjpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQlsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJCQkJaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgoJCQkJCQljaGFyYWN0ZXIuSHVtYW5vaWQuV2Fsa1NwZWVkID0gU3RyYWZlU3BlZWQKCQkJCQllbmQKCQkJCWVuZCkKCQkJZWxzZQoJCQkJbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQkJaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgoJCQkJCWNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQgPSAzNgoJCQkJZW5kCgkJCQlpZiBDb25uZWN0aW9uc19NYW5hZ2VyWyJTdHJhZmUiXSB0aGVuCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiU3RyYWZlIl06RGlzY29ubmVjdCgpCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiU3RyYWZlIl0gPSBuaWwKCQkJCWVuZAoJCQllbmQKCQllbmQsCgl9KQoJU3RyYWZlOmNyZWF0ZV9zbGlkZXIoewoJCXRpdGxlID0gIlN0cmFmZSBTcGVlZCIsCgkJZmxhZyA9ICJTdHJhZmVfU3BlZWQiLAoJCW1pbmltdW1fdmFsdWUgPSAzNiwKCQltYXhpbXVtX3ZhbHVlID0gMjAwLAoJCXZhbHVlID0gMzYsCgkJcm91bmRfbnVtYmVyID0gdHJ1ZSwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlTdHJhZmVTcGVlZCA9IHZhbHVlCgkJZW5kLAoJfSkKCWxvY2FsIFNwaW5ib3QgPSBwbGF5ZXI6Y3JlYXRlX21vZHVsZSh7CgkJdGl0bGUgPSAiU3BpbmJvdCIsCgkJZmxhZyA9ICJTcGluYm90IiwKCQlkZXNjcmlwdGlvbiA9ICJTcGlucyBQbGF5ZXIiLAoJCXNlY3Rpb24gPSAicmlnaHQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5TcGluYm90ID0gdmFsdWUKCQkJaWYgdmFsdWUgdGhlbgoJCQkJZ2V0Z2VudigpLnNwaW4gPSB0cnVlCgkJCQlnZXRnZW52KCkuc3BpblNwZWVkID0gZ2V0Z2VudigpLnNwaW5TcGVlZCBvciAxCgkJCQlsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKCQkJCWxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQoJCQkJbG9jYWwgQ2xpZW50ID0gUGxheWVycy5Mb2NhbFBsYXllcgoJCQkJbG9jYWwgZnVuY3Rpb24gc3BpbkNoYXJhY3RlcigpCgkJCQkJd2hpbGUgZ2V0Z2VudigpLnNwaW4gZG8KCQkJCQkJUnVuU2VydmljZS5IZWFydGJlYXQ6V2FpdCgpCgkJCQkJCWxvY2FsIGNoYXIgPSBDbGllbnQuQ2hhcmFjdGVyCgkJCQkJCWxvY2FsIGZ1bmNIUlAgPSBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKCQkJCQkJaWYgY2hhciBhbmQgZnVuY0hSUCB0aGVuCgkJCQkJCQlmdW5jSFJQLkNGcmFtZSAqPSBDRnJhbWUuQW5nbGVzKDAsIGdldGdlbnYoKS5zcGluU3BlZWQsIDApCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCQlpZiBub3QgZ2V0Z2VudigpLnNwaW5UaHJlYWQgdGhlbgoJCQkJCWdldGdlbnYoKS5zcGluVGhyZWFkID0gY29yb3V0aW5lLmNyZWF0ZShzcGluQ2hhcmFjdGVyKQoJCQkJCWNvcm91dGluZS5yZXN1bWUoZ2V0Z2VudigpLnNwaW5UaHJlYWQpCgkJCQllbmQKCQkJZWxzZQoJCQkJZ2V0Z2VudigpLnNwaW4gPSBmYWxzZQoJCQkJaWYgZ2V0Z2VudigpLnNwaW5UaHJlYWQgdGhlbgoJCQkJCWdldGdlbnYoKS5zcGluVGhyZWFkID0gbmlsCgkJCQllbmQKCQkJZW5kCgkJZW5kLAoJfSkKCVNwaW5ib3Q6Y3JlYXRlX3NsaWRlcih7CgkJdGl0bGUgPSAiU3BpbmJvdCBTcGVlZCIsCgkJZmxhZyA9ICJTcGluYm90X1NwZWVkIiwKCQltYXhpbXVtX3ZhbHVlID0gMTAwLAoJCW1pbmltdW1fdmFsdWUgPSAxLAoJCXZhbHVlID0gMSwKCQlyb3VuZF9udW1iZXIgPSB0cnVlLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5zcGluU3BlZWQgPSBtYXRoLnJhZCh2YWx1ZSkKCQllbmQsCgl9KQoJbG9jYWwgQ2FtZXJhVG9nZ2xlID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIkZpZWxkIG9mIFZpZXciLAoJCWZsYWcgPSAiRmllbGRfT2ZfVmlldyIsCgkJZGVzY3JpcHRpb24gPSAiQ2hhbmdlcyBDYW1lcmEgUE9WIiwKCQlzZWN0aW9uID0gImxlZnQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5DYW1lcmFFbmFibGVkID0gdmFsdWUKCQkJbG9jYWwgQ2FtZXJhID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5DdXJyZW50Q2FtZXJhCgkJCWlmIHZhbHVlIHRoZW4KCQkJCWdldGdlbnYoKS5DYW1lcmFGT1YgPSBnZXRnZW52KCkuQ2FtZXJhRk9WIG9yIDcwCgkJCQlDYW1lcmEuRmllbGRPZlZpZXcgPSBnZXRnZW52KCkuQ2FtZXJhRk9WCgkJCQlpZiBub3QgZ2V0Z2VudigpLkZPVkxvb3AgdGhlbgoJCQkJCWdldGdlbnYoKS5GT1ZMb29wID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQkJaWYgZ2V0Z2VudigpLkNhbWVyYUVuYWJsZWQgdGhlbgoJCQkJCQkJQ2FtZXJhLkZpZWxkT2ZWaWV3ID0gZ2V0Z2VudigpLkNhbWVyYUZPVgoJCQkJCQllbmQKCQkJCQllbmQpCgkJCQllbmQKCQkJZWxzZQoJCQkJQ2FtZXJhLkZpZWxkT2ZWaWV3ID0gNzAKCQkJCWlmIGdldGdlbnYoKS5GT1ZMb29wIHRoZW4KCQkJCQlnZXRnZW52KCkuRk9WTG9vcDpEaXNjb25uZWN0KCkKCQkJCQlnZXRnZW52KCkuRk9WTG9vcCA9IG5pbAoJCQkJZW5kCgkJCWVuZAoJCWVuZCwKCX0pCglDYW1lcmFUb2dnbGU6Y3JlYXRlX3NsaWRlcih7CgkJdGl0bGUgPSAiQ2FtZXJhIEZPViIsCgkJZmxhZyA9ICJDYW1lcmFfRk9WIiwKCQltYXhpbXVtX3ZhbHVlID0gMTIwLAoJCW1pbmltdW1fdmFsdWUgPSA1MCwKCQl2YWx1ZSA9IDcwLAoJCXJvdW5kX251bWJlciA9IHRydWUsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJZ2V0Z2VudigpLkNhbWVyYUZPViA9IHZhbHVlCgkJCWlmIGdldGdlbnYoKS5DYW1lcmFFbmFibGVkIHRoZW4KCQkJCWdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQ3VycmVudENhbWVyYS5GaWVsZE9mVmlldyA9IHZhbHVlCgkJCWVuZAoJCWVuZCwKCX0pCglsb2NhbCBBbmltYXRpb25zID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIkVtb3RlcyIsCgkJZmxhZyA9ICJFbW90ZXMiLAoJCWRlc2NyaXB0aW9uID0gIkN1c3RvbSBFbW90ZXMiLAoJCXNlY3Rpb24gPSAicmlnaHQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5BbmltYXRpb25zID0gdmFsdWUKCQkJaWYgdmFsdWUgdGhlbgoJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiQW5pbWF0aW9ucyJdID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJaWYgbm90IFBsYXllci5DaGFyYWN0ZXIgb3Igbm90IFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQgdGhlbgoJCQkJCQlyZXR1cm4KCQkJCQllbmQKCQkJCQlsb2NhbCBTcGVlZCA9IFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eS5NYWduaXR1ZGUKCQkJCQlpZiBTcGVlZCA+IDMwIHRoZW4KCQkJCQkJaWYgQW5pbWF0aW9uLnRyYWNrIGFuZCBub3QgZ2V0Z2VudigpLkxvb3BFbW90ZSB0aGVuCgkJCQkJCQlBbmltYXRpb24udHJhY2s6U3RvcCgpCgkJCQkJCQlBbmltYXRpb24udHJhY2s6RGVzdHJveSgpCgkJCQkJCQlBbmltYXRpb24udHJhY2sgPSBuaWwKCQkJCQkJZW5kCgkJCQkJZWxzZQoJCQkJCQlpZiBub3QgQW5pbWF0aW9uLnRyYWNrIGFuZCBBbmltYXRpb24uY3VycmVudCB0aGVuCgkJCQkJCQlBdXRvX1BhcnJ5LlBsYXlfQW5pbWF0aW9uKEFuaW1hdGlvbi5jdXJyZW50KQoJCQkJCQllbmQKCQkJCQllbmQKCQkJCWVuZCkKCQkJZWxzZQoJCQkJaWYgQW5pbWF0aW9uLnRyYWNrIHRoZW4KCQkJCQlBbmltYXRpb24udHJhY2s6U3RvcCgpCgkJCQkJQW5pbWF0aW9uLnRyYWNrOkRlc3Ryb3koKQoJCQkJCUFuaW1hdGlvbi50cmFjayA9IG5pbAoJCQkJZW5kCgkJCQlpZiBDb25uZWN0aW9uc19NYW5hZ2VyWyJBbmltYXRpb25zIl0gdGhlbgoJCQkJCUNvbm5lY3Rpb25zX01hbmFnZXJbIkFuaW1hdGlvbnMiXTpEaXNjb25uZWN0KCkKCQkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJBbmltYXRpb25zIl0gPSBuaWwKCQkJCWVuZAoJCQllbmQKCQllbmQsCgl9KQoJQW5pbWF0aW9uczpjcmVhdGVfY2hlY2tib3goewoJCXRpdGxlID0gIkxvb3AgRW1vdGUiLAoJCWZsYWcgPSAiTG9vcF9FbW90ZSIsCgkJZGVmYXVsdCA9IGZhbHNlLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5Mb29wRW1vdGUgPSB2YWx1ZQoJCWVuZCwKCX0pCglsb2NhbCBzZWxlY3RlZF9hbmltYXRpb24gPSBFbW90ZXNfRGF0YVsxXQoJbG9jYWwgQW5pbWF0aW9uQ2hvaWNlID0gQW5pbWF0aW9uczpjcmVhdGVfZHJvcGRvd24oewoJCXRpdGxlID0gIkFuaW1hdGlvbiBUeXBlIiwKCQlmbGFnID0gIlNlbGVjdGVkX0FuaW1hdGlvbiIsCgkJb3B0aW9ucyA9IEVtb3Rlc19EYXRhLAoJCW11bHRpX2Ryb3Bkb3duID0gZmFsc2UsCgkJbWF4aW11bV9vcHRpb25zID0gI0Vtb3Rlc19EYXRhLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCXNlbGVjdGVkX2FuaW1hdGlvbiA9IHZhbHVlCgkJCWlmIGdldGdlbnYoKS5BbmltYXRpb25zIHRoZW4KCQkJCUF1dG9fUGFycnkuUGxheV9BbmltYXRpb24odmFsdWUpCgkJCWVuZAoJCWVuZCwKCX0pCglBbmltYXRpb25DaG9pY2U6dXBkYXRlKHNlbGVjdGVkX2FuaW1hdGlvbikKCV9HLlBsYXllckNvc21ldGljc0NsZWFudXAgPSB7fQoJbG9jYWwgUGxheWVyQ29zbWV0aWNzID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIlBsYXllciBDb3NtZXRpY3MiLAoJCWZsYWcgPSAiUGxheWVyX0Nvc21ldGljcyIsCgkJZGVzY3JpcHRpb24gPSAiQXBwbHkgaGVhZGxlc3MgYW5kIGtvcmJsb3giLAoJCXNlY3Rpb24gPSAibGVmdCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKCQkJbG9jYWwgcGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCgkJCWxvY2FsIGxwID0gcGxheWVycy5Mb2NhbFBsYXllcgoJCQlsb2NhbCBmdW5jdGlvbiBhcHBseUtvcmJsb3goY2hhcmFjdGVyKQoJCQkJbG9jYWwgcmlnaHRMZWcgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0TGVnIikgb3IgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodCBMZWciKQoJCQkJaWYgbm90IHJpZ2h0TGVnIHRoZW4KCQkJCQl3YXJuKCJSaWdodCBsZWcgbm90IGZvdW5kIG9uIGNoYXJhY3RlciIpCgkJCQkJcmV0dXJuCgkJCQllbmQKCQkJCWZvciBfLCBjaGlsZCBpbiBwYWlycyhyaWdodExlZzpHZXRDaGlsZHJlbigpKSBkbwoJCQkJCWlmIGNoaWxkOklzQSgiU3BlY2lhbE1lc2giKSB0aGVuCgkJCQkJCWNoaWxkOkRlc3Ryb3koKQoJCQkJCWVuZAoJCQkJZW5kCgkJCQlsb2NhbCBzcGVjaWFsTWVzaCA9IEluc3RhbmNlLm5ldygiU3BlY2lhbE1lc2giKQoJCQkJc3BlY2lhbE1lc2guTWVzaElkID0gInJieGFzc2V0aWQ6Ly8xMDE4NTE2OTYiCgkJCQlzcGVjaWFsTWVzaC5UZXh0dXJlSWQgPSAicmJ4YXNzZXRpZDovLzExNTcyNzg2MyIKCQkJCXNwZWNpYWxNZXNoLlNjYWxlID0gVmVjdG9yMy5uZXcoMSwgMSwgMSkKCQkJCXNwZWNpYWxNZXNoLlBhcmVudCA9IHJpZ2h0TGVnCgkJCWVuZAoJCQlsb2NhbCBmdW5jdGlvbiBzYXZlUmlnaHRMZWdQcm9wZXJ0aWVzKGNoYXIpCgkJCQlpZiBjaGFyIHRoZW4KCQkJCQlsb2NhbCByaWdodExlZyA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0TGVnIikgb3IgY2hhcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHQgTGVnIikKCQkJCQlpZiByaWdodExlZyB0aGVuCgkJCQkJCWxvY2FsIG9yaWdpbmFsTWVzaCA9IHJpZ2h0TGVnOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiU3BlY2lhbE1lc2giKQoJCQkJCQlpZiBvcmlnaW5hbE1lc2ggdGhlbgoJCQkJCQkJX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5vcmlnaW5hbE1lc2hJZCA9IG9yaWdpbmFsTWVzaC5NZXNoSWQKCQkJCQkJCV9HLlBsYXllckNvc21ldGljc0NsZWFudXAub3JpZ2luYWxUZXh0dXJlSWQgPSBvcmlnaW5hbE1lc2guVGV4dHVyZUlkCgkJCQkJCQlfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLm9yaWdpbmFsU2NhbGUgPSBvcmlnaW5hbE1lc2guU2NhbGUKCQkJCQkJZWxzZQoJCQkJCQkJX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5oYWROb01lc2ggPSB0cnVlCgkJCQkJCWVuZAoJCQkJCQlfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLnJpZ2h0TGVnQ2hpbGRyZW4gPSB7fQoJCQkJCQlmb3IgXywgY2hpbGQgaW4gcGFpcnMocmlnaHRMZWc6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCQkJCWlmIGNoaWxkOklzQSgiU3BlY2lhbE1lc2giKSB0aGVuCgkJCQkJCQkJdGFibGUuaW5zZXJ0KF9HLlBsYXllckNvc21ldGljc0NsZWFudXAucmlnaHRMZWdDaGlsZHJlbiwgewoJCQkJCQkJCQlDbGFzc05hbWUgPSBjaGlsZC5DbGFzc05hbWUsCgkJCQkJCQkJCVByb3BlcnRpZXMgPSB7CgkJCQkJCQkJCQlNZXNoSWQgPSBjaGlsZC5NZXNoSWQsCgkJCQkJCQkJCQlUZXh0dXJlSWQgPSBjaGlsZC5UZXh0dXJlSWQsCgkJCQkJCQkJCQlTY2FsZSA9IGNoaWxkLlNjYWxlLAoJCQkJCQkJCQl9LAoJCQkJCQkJCX0pCgkJCQkJCQllbmQKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgkJCWxvY2FsIGZ1bmN0aW9uIHJlc3RvcmVSaWdodExlZyhjaGFyKQoJCQkJaWYgY2hhciB0aGVuCgkJCQkJbG9jYWwgcmlnaHRMZWcgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJSaWdodExlZyIpIG9yIGNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0IExlZyIpCgkJCQkJaWYgcmlnaHRMZWcgYW5kIF9HLlBsYXllckNvc21ldGljc0NsZWFudXAucmlnaHRMZWdDaGlsZHJlbiB0aGVuCgkJCQkJCWZvciBfLCBjaGlsZCBpbiBwYWlycyhyaWdodExlZzpHZXRDaGlsZHJlbigpKSBkbwoJCQkJCQkJaWYgY2hpbGQ6SXNBKCJTcGVjaWFsTWVzaCIpIHRoZW4KCQkJCQkJCQljaGlsZDpEZXN0cm95KCkKCQkJCQkJCWVuZAoJCQkJCQllbmQKCQkJCQkJaWYgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5oYWROb01lc2ggdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoJCQkJCQlmb3IgXywgY2hpbGREYXRhIGluIGlwYWlycyhfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLnJpZ2h0TGVnQ2hpbGRyZW4pIGRvCgkJCQkJCQlpZiBjaGlsZERhdGEuQ2xhc3NOYW1lID09ICJTcGVjaWFsTWVzaCIgdGhlbgoJCQkJCQkJCWxvY2FsIG5ld01lc2ggPSBJbnN0YW5jZS5uZXcoIlNwZWNpYWxNZXNoIikKCQkJCQkJCQluZXdNZXNoLk1lc2hJZCA9IGNoaWxkRGF0YS5Qcm9wZXJ0aWVzLk1lc2hJZAoJCQkJCQkJCW5ld01lc2guVGV4dHVyZUlkID0gY2hpbGREYXRhLlByb3BlcnRpZXMuVGV4dHVyZUlkCgkJCQkJCQkJbmV3TWVzaC5TY2FsZSA9IGNoaWxkRGF0YS5Qcm9wZXJ0aWVzLlNjYWxlCgkJCQkJCQkJbmV3TWVzaC5QYXJlbnQgPSByaWdodExlZwoJCQkJCQkJZW5kCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCQlpZiB2YWx1ZSB0aGVuCgkJCQlDb3NtZXRpY3NBY3RpdmUgPSB0cnVlCgkJCQlnZXRnZW52KCkuQ29uZmlnID0gewoJCQkJCUhlYWRsZXNzID0gdHJ1ZSwKCQkJCX0KCQkJCWlmIGxwLkNoYXJhY3RlciB0aGVuCgkJCQkJbG9jYWwgaGVhZCA9IGxwLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpCgkJCQkJaWYgaGVhZCBhbmQgZ2V0Z2VudigpLkNvbmZpZy5IZWFkbGVzcyB0aGVuCgkJCQkJCV9HLlBsYXllckNvc21ldGljc0NsZWFudXAuaGVhZFRyYW5zcGFyZW5jeSA9IGhlYWQuVHJhbnNwYXJlbmN5CgkJCQkJCWxvY2FsIGRlY2FsID0gaGVhZDpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkRlY2FsIikKCQkJCQkJaWYgZGVjYWwgdGhlbgoJCQkJCQkJX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5mYWNlRGVjYWxJZCA9IGRlY2FsLlRleHR1cmUKCQkJCQkJCV9HLlBsYXllckNvc21ldGljc0NsZWFudXAuZmFjZURlY2FsTmFtZSA9IGRlY2FsLk5hbWUKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQkJc2F2ZVJpZ2h0TGVnUHJvcGVydGllcyhscC5DaGFyYWN0ZXIpCgkJCQkJYXBwbHlLb3JibG94KGxwLkNoYXJhY3RlcikKCQkJCWVuZAoJCQkJX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5jaGFyYWN0ZXJBZGRlZENvbm4gPSBscC5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXIpCiAgICAKICAgCQkJCSBsb2NhbCBoZWFkID0gY2hhcjpXYWl0Rm9yQ2hpbGQoIkhlYWQiLCA1KQogICAgCQkJaWYgaGVhZCBhbmQgZ2V0Z2VudigpLkNvbmZpZy5IZWFkbGVzcyB0aGVuCiAgICAgICAgCQlfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLmhlYWRUcmFuc3BhcmVuY3kgPSBoZWFkLlRyYW5zcGFyZW5jeQogICAgICAgCQkJIGxvY2FsIGRlY2FsID0gaGVhZDpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkRlY2FsIikKICAgICAgIAkJIGlmIGRlY2FsIHRoZW4KICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5mYWNlRGVjYWxJZCA9IGRlY2FsLlRleHR1cmUKICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5mYWNlRGVjYWxOYW1lID0gZGVjYWwuTmFtZQogICAgICAgCSBlbmQKICAgIAllbmQKCiAgICAKICAgIAkJCQlsb2NhbCByaWdodExlZyA9IGNoYXI6V2FpdEZvckNoaWxkKCJSaWdodExlZyIsIDAuMSkgb3IgY2hhcjpXYWl0Rm9yQ2hpbGQoIlJpZ2h0IExlZyIsIDAuMSkKICAgCQkJIAkJaWYgcmlnaHRMZWcgdGhlbgogICAgICAgCQkgCQlhcHBseUtvcmJsb3goY2hhcikKICAJCSAgCQllbHNlCiAgICAgICAJCSAJCXdhcm4oIlJpZ2h0TGVnIG5vdCBmb3VuZCBhZnRlciByZXNwYXduISIpCiAgIAkJIAkJZW5kCgkJCWVuZCkKCQkJCWlmIGdldGdlbnYoKS5Db25maWcuSGVhZGxlc3MgdGhlbgoJCQkJCWhlYWRMb29wID0gdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCQkJCXdoaWxlIENvc21ldGljc0FjdGl2ZSBkbwoJCQkJCQkJbG9jYWwgY2hhciA9IGxwLkNoYXJhY3RlcgoJCQkJCQkJaWYgY2hhciB0aGVuCgkJCQkJCQkJbG9jYWwgaGVhZCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKQoJCQkJCQkJCWlmIGhlYWQgdGhlbgoJCQkJCQkJCQloZWFkLlRyYW5zcGFyZW5jeSA9IDEKCQkJCQkJCQkJbG9jYWwgZGVjYWwgPSBoZWFkOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiRGVjYWwiKQoJCQkJCQkJCQlpZiBkZWNhbCB0aGVuCgkJCQkJCQkJCQlkZWNhbDpEZXN0cm95KCkKCQkJCQkJCQkJZW5kCgkJCQkJCQkJZW5kCgkJCQkJCQllbmQKCQkJCQkJCXRhc2sud2FpdCgwLjEpCgkJCQkJCWVuZAoJCQkJCWVuZCkKCQkJCWVuZAoJCQllbHNlCgkJCQlDb3NtZXRpY3NBY3RpdmUgPSBmYWxzZQoJCQkJaWYgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5jaGFyYWN0ZXJBZGRlZENvbm4gdGhlbgoJCQkJCV9HLlBsYXllckNvc21ldGljc0NsZWFudXAuY2hhcmFjdGVyQWRkZWRDb25uOkRpc2Nvbm5lY3QoKQoJCQkJCV9HLlBsYXllckNvc21ldGljc0NsZWFudXAuY2hhcmFjdGVyQWRkZWRDb25uID0gbmlsCgkJCQllbmQKCQkJCWlmIGhlYWRMb29wIHRoZW4KCQkJCQl0YXNrLmNhbmNlbChoZWFkTG9vcCkKCQkJCQloZWFkTG9vcCA9IG5pbAoJCQkJZW5kCgkJCQlsb2NhbCBjaGFyID0gbHAuQ2hhcmFjdGVyCgkJCQlpZiBjaGFyIHRoZW4KCQkJCQlsb2NhbCBoZWFkID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpCgkJCQkJaWYgaGVhZCBhbmQgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5oZWFkVHJhbnNwYXJlbmN5IH49IG5pbCB0aGVuCgkJCQkJCWhlYWQuVHJhbnNwYXJlbmN5ID0gX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5oZWFkVHJhbnNwYXJlbmN5CgkJCQkJCWlmIF9HLlBsYXllckNvc21ldGljc0NsZWFudXAuZmFjZURlY2FsSWQgdGhlbgoJCQkJCQkJbG9jYWwgbmV3RGVjYWwgPSBoZWFkOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiRGVjYWwiKSBvciBJbnN0YW5jZS5uZXcoIkRlY2FsIiwgaGVhZCkKCQkJCQkJCW5ld0RlY2FsLk5hbWUgPSBfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLmZhY2VEZWNhbE5hbWUgb3IgImZhY2UiCgkJCQkJCQluZXdEZWNhbC5UZXh0dXJlID0gX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5mYWNlRGVjYWxJZAoJCQkJCQkJbmV3RGVjYWwuRmFjZSA9IEVudW0uTm9ybWFsSWQuRnJvbnQKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQkJcmVzdG9yZVJpZ2h0TGVnKGNoYXIpCgkJCQllbmQKCQkJCV9HLlBsYXllckNvc21ldGljc0NsZWFudXAgPSB7fQoJCQllbmQKCQllbmQsCgl9KQoJbG9jYWwgZmx5ID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIkZseSIsCgkJZmxhZyA9ICJGbHkiLAoJCWRlc2NyaXB0aW9uID0gIkFsbG93cyB0aGUgcGxheWVyIHRvIGZseSIsCgkJc2VjdGlvbiA9ICJyaWdodCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKCQkJaWYgdmFsdWUgdGhlbgoJCQkJZ2V0Z2VudigpLkZseUVuYWJsZWQgPSB0cnVlCgkJCQlsb2NhbCBjaGFyID0gUGxheWVyLkNoYXJhY3RlciBvciBQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgkJCQlsb2NhbCBocnAgPSBjaGFyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCgkJCQlsb2NhbCBodW1hbm9pZCA9IGNoYXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpCgkJCQlnZXRnZW52KCkuT3JpZ2luYWxTdGF0ZVR5cGUgPSBodW1hbm9pZDpHZXRTdGF0ZSgpCgkJCQlnZXRnZW52KCkuUmFnZG9sbEhhbmRsZXIgPSBodW1hbm9pZC5TdGF0ZUNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihvbGRTdGF0ZSwgbmV3U3RhdGUpCgkJCQkJaWYgZ2V0Z2VudigpLkZseUVuYWJsZWQgdGhlbgoJCQkJCQlpZiBuZXdTdGF0ZSA9PSBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlBoeXNpY3Mgb3IgbmV3U3RhdGUgPT0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5SYWdkb2xsIHRoZW4KCQkJCQkJCXRhc2suZGVmZXIoZnVuY3Rpb24oKQoJCQkJCQkJCWh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuR2V0dGluZ1VwKQoJCQkJCQkJCWh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuUnVubmluZykKCQkJCQkJCWVuZCkKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQllbmQpCgkJCQlsb2NhbCBib2R5R3lybyA9IEluc3RhbmNlLm5ldygiQm9keUd5cm8iKQoJCQkJYm9keUd5cm8uUCA9IDkwMDAwCgkJCQlib2R5R3lyby5NYXhUb3JxdWUgPSBWZWN0b3IzLm5ldyg5ZTksIDllOSwgOWU5KQoJCQkJYm9keUd5cm8uUGFyZW50ID0gaHJwCgkJCQlsb2NhbCBib2R5VmVsb2NpdHkgPSBJbnN0YW5jZS5uZXcoIkJvZHlWZWxvY2l0eSIpCgkJCQlib2R5VmVsb2NpdHkuVmVsb2NpdHkgPSBWZWN0b3IzLm5ldygwLCAwLCAwKQoJCQkJYm9keVZlbG9jaXR5Lk1heEZvcmNlID0gVmVjdG9yMy5uZXcoOWU5LCA5ZTksIDllOSkKCQkJCWJvZHlWZWxvY2l0eS5QYXJlbnQgPSBocnAKCQkJCWh1bWFub2lkLlBsYXRmb3JtU3RhbmQgPSB0cnVlCgkJCQlnZXRnZW52KCkuUmVzZXR0ZXJDb25uZWN0aW9uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJaWYgbm90IGdldGdlbnYoKS5GbHlFbmFibGVkIHRoZW4KCQkJCQkJcmV0dXJuCgkJCQkJZW5kCgkJCQkJaWYgYm9keUd5cm8gYW5kIGJvZHlHeXJvLlBhcmVudCB0aGVuCgkJCQkJCWJvZHlHeXJvLlAgPSA5MDAwMAoJCQkJCQlib2R5R3lyby5NYXhUb3JxdWUgPSBWZWN0b3IzLm5ldyg5ZTksIDllOSwgOWU5KQoJCQkJCWVuZAoJCQkJCWlmIGJvZHlWZWxvY2l0eSBhbmQgYm9keVZlbG9jaXR5LlBhcmVudCB0aGVuCgkJCQkJCWJvZHlWZWxvY2l0eS5NYXhGb3JjZSA9IFZlY3RvcjMubmV3KDllOSwgOWU5LCA5ZTkpCgkJCQkJZW5kCgkJCQkJaHVtYW5vaWQuUGxhdGZvcm1TdGFuZCA9IHRydWUKCQkJCQlpZiBub3QgYm9keUd5cm8uUGFyZW50IG9yIG5vdCBib2R5VmVsb2NpdHkuUGFyZW50IHRoZW4KCQkJCQkJaWYgYm9keUd5cm8gdGhlbgoJCQkJCQkJYm9keUd5cm86RGVzdHJveSgpCgkJCQkJCWVuZAoJCQkJCQlpZiBib2R5VmVsb2NpdHkgdGhlbgoJCQkJCQkJYm9keVZlbG9jaXR5OkRlc3Ryb3koKQoJCQkJCQllbmQKCQkJCQkJYm9keUd5cm8gPSBJbnN0YW5jZS5uZXcoIkJvZHlHeXJvIikKCQkJCQkJYm9keUd5cm8uUCA9IDkwMDAwCgkJCQkJCWJvZHlHeXJvLk1heFRvcnF1ZSA9IFZlY3RvcjMubmV3KDllOSwgOWU5LCA5ZTkpCgkJCQkJCWJvZHlHeXJvLlBhcmVudCA9IGhycAoJCQkJCQlib2R5VmVsb2NpdHkgPSBJbnN0YW5jZS5uZXcoIkJvZHlWZWxvY2l0eSIpCgkJCQkJCWJvZHlWZWxvY2l0eS5WZWxvY2l0eSA9IFZlY3RvcjMubmV3KDAsIDAsIDApCgkJCQkJCWJvZHlWZWxvY2l0eS5NYXhGb3JjZSA9IFZlY3RvcjMubmV3KDllOSwgOWU5LCA5ZTkpCgkJCQkJCWJvZHlWZWxvY2l0eS5QYXJlbnQgPSBocnAKCQkJCQllbmQKCQkJCWVuZCkKCQkJCWdldGdlbnYoKS5GbHlDb25uZWN0aW9uID0gUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJCWlmIG5vdCBnZXRnZW52KCkuRmx5RW5hYmxlZCB0aGVuCgkJCQkJCXJldHVybgoJCQkJCWVuZAoJCQkJCWxvY2FsIGNhbUNGID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lCgkJCQkJbG9jYWwgbW92ZURpciA9IFZlY3RvcjMubmV3KDAsIDAsIDApCgkJCQkJaWYgVXNlcklucHV0U2VydmljZTpJc0tleURvd24oRW51bS5LZXlDb2RlLlcpIHRoZW4KCQkJCQkJbW92ZURpciA9IG1vdmVEaXIgKyBjYW1DRi5Mb29rVmVjdG9yCgkJCQkJZW5kCgkJCQkJaWYgVXNlcklucHV0U2VydmljZTpJc0tleURvd24oRW51bS5LZXlDb2RlLlMpIHRoZW4KCQkJCQkJbW92ZURpciA9IG1vdmVEaXIgLSBjYW1DRi5Mb29rVmVjdG9yCgkJCQkJZW5kCgkJCQkJaWYgVXNlcklucHV0U2VydmljZTpJc0tleURvd24oRW51bS5LZXlDb2RlLkEpIHRoZW4KCQkJCQkJbW92ZURpciA9IG1vdmVEaXIgLSBjYW1DRi5SaWdodFZlY3RvcgoJCQkJCWVuZAoJCQkJCWlmIFVzZXJJbnB1dFNlcnZpY2U6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5EKSB0aGVuCgkJCQkJCW1vdmVEaXIgPSBtb3ZlRGlyICsgY2FtQ0YuUmlnaHRWZWN0b3IKCQkJCQllbmQKCQkJCQlpZiBVc2VySW5wdXRTZXJ2aWNlOklzS2V5RG93bihFbnVtLktleUNvZGUuRSkgdGhlbgoJCQkJCQltb3ZlRGlyID0gbW92ZURpciArIFZlY3RvcjMubmV3KDAsIDEsIDApCgkJCQkJZW5kCgkJCQkJaWYgVXNlcklucHV0U2VydmljZTpJc0tleURvd24oRW51bS5LZXlDb2RlLlEpIHRoZW4KCQkJCQkJbW92ZURpciA9IG1vdmVEaXIgLSBWZWN0b3IzLm5ldygwLCAxLCAwKQoJCQkJCWVuZAoJCQkJCWlmIG1vdmVEaXIuTWFnbml0dWRlID4gMCB0aGVuCgkJCQkJCW1vdmVEaXIgPSBtb3ZlRGlyLlVuaXQKCQkJCQllbmQKCQkJCQlib2R5VmVsb2NpdHkuVmVsb2NpdHkgPSBtb3ZlRGlyICogKGdldGdlbnYoKS5GbHlTcGVlZCBvciA1MCkKCQkJCQlib2R5R3lyby5DRnJhbWUgPSBjYW1DRgoJCQkJZW5kKQoJCQllbHNlCgkJCQlnZXRnZW52KCkuRmx5RW5hYmxlZCA9IGZhbHNlCgkJCQlpZiBnZXRnZW52KCkuRmx5Q29ubmVjdGlvbiB0aGVuCgkJCQkJZ2V0Z2VudigpLkZseUNvbm5lY3Rpb246RGlzY29ubmVjdCgpCgkJCQkJZ2V0Z2VudigpLkZseUNvbm5lY3Rpb24gPSBuaWwKCQkJCWVuZAoJCQkJaWYgZ2V0Z2VudigpLlJhZ2RvbGxIYW5kbGVyIHRoZW4KCQkJCQlnZXRnZW52KCkuUmFnZG9sbEhhbmRsZXI6RGlzY29ubmVjdCgpCgkJCQkJZ2V0Z2VudigpLlJhZ2RvbGxIYW5kbGVyID0gbmlsCgkJCQllbmQKCQkJCWlmIGdldGdlbnYoKS5SZXNldHRlckNvbm5lY3Rpb24gdGhlbgoJCQkJCWdldGdlbnYoKS5SZXNldHRlckNvbm5lY3Rpb246RGlzY29ubmVjdCgpCgkJCQkJZ2V0Z2VudigpLlJlc2V0dGVyQ29ubmVjdGlvbiA9IG5pbAoJCQkJZW5kCgkJCQlsb2NhbCBjaGFyID0gUGxheWVyLkNoYXJhY3RlcgoJCQkJaWYgY2hhciB0aGVuCgkJCQkJbG9jYWwgaHJwID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCgkJCQkJbG9jYWwgaHVtYW5vaWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCgkJCQkJaWYgaHVtYW5vaWQgdGhlbgoJCQkJCQlodW1hbm9pZC5QbGF0Zm9ybVN0YW5kID0gZmFsc2UKCQkJCQkJaWYgZ2V0Z2VudigpLk9yaWdpbmFsU3RhdGVUeXBlIHRoZW4KCQkJCQkJCWh1bWFub2lkOkNoYW5nZVN0YXRlKGdldGdlbnYoKS5PcmlnaW5hbFN0YXRlVHlwZSkKCQkJCQkJZW5kCgkJCQkJZW5kCgkJCQkJaWYgaHJwIHRoZW4KCQkJCQkJZm9yIF8sIHYgaW4gaXBhaXJzKGhycDpHZXRDaGlsZHJlbigpKSBkbwoJCQkJCQkJaWYgdjpJc0EoIkJvZHlHeXJvIikgb3IgdjpJc0EoIkJvZHlWZWxvY2l0eSIpIHRoZW4KCQkJCQkJCQl2OkRlc3Ryb3koKQoJCQkJCQkJZW5kCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCWVuZCwKCX0pCglmbHk6Y3JlYXRlX3NsaWRlcih7CgkJdGl0bGUgPSAiRmx5IFNwZWVkIiwKCQlmbGFnID0gIkZseV9TcGVlZCIsCgkJbWluaW11bV92YWx1ZSA9IDEwLAoJCW1heGltdW1fdmFsdWUgPSAyMDAsCgkJdmFsdWUgPSA1MCwKCQlyb3VuZF9udW1iZXIgPSB0cnVlLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IG51bWJlcikKCQkJZ2V0Z2VudigpLkZseVNwZWVkID0gdmFsdWUKCQllbmQsCgl9KQoJbG9jYWwgbG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCglsb2NhbCBTZWxlY3RlZFBsYXllckZvbGxvdyA9IG5pbAoJbG9jYWwgZm9sbG93RHJvcGRvd24KCWxvY2FsIGZ1bmN0aW9uIGdldFBsYXllck5hbWVzKCkKCQlsb2NhbCBuYW1lcyA9IHt9CgkJZm9yIF8sIHBsYXllciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCgkJCWlmIHBsYXllciB+PSBsb2NhbFBsYXllciB0aGVuCgkJCQl0YWJsZS5pbnNlcnQobmFtZXMsIHBsYXllci5OYW1lKQoJCQllbmQKCQllbmQKCQlyZXR1cm4gbmFtZXMKCWVuZAoJbG9jYWwgZnVuY3Rpb24gdXBkYXRlRm9sbG93VGFyZ2V0KCkKCQlsb2NhbCBhdmFpbGFibGVQbGF5ZXJzID0gZ2V0UGxheWVyTmFtZXMoKQoJCWlmICNhdmFpbGFibGVQbGF5ZXJzID4gMCB0aGVuCgkJCVNlbGVjdGVkUGxheWVyRm9sbG93ID0gYXZhaWxhYmxlUGxheWVyc1sxXQoJCQlpZiBmb2xsb3dEcm9wZG93biB0aGVuCgkJCQlmb2xsb3dEcm9wZG93bjp1cGRhdGUoU2VsZWN0ZWRQbGF5ZXJGb2xsb3cpCgkJCWVuZAoJCWVsc2UKCQkJU2VsZWN0ZWRQbGF5ZXJGb2xsb3cgPSBuaWwKCQllbmQKCWVuZAoJbG9jYWwgUGxheWVyRm9sbG93ID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIlBsYXllciBGb2xsb3ciLAoJCWZsYWcgPSAiUGxheWVyX0ZvbGxvdyIsCgkJZGVzY3JpcHRpb24gPSAiRm9sbG93cyB0aGUgc2VsZWN0ZWQgcGxheWVyIiwKCQlzZWN0aW9uID0gImxlZnQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWlmIHZhbHVlIHRoZW4KCQkJCWdldGdlbnYoKS5QbGF5ZXJGb2xsb3dFbmFibGVkID0gdHJ1ZQoJCQkJZ2V0Z2VudigpLlBsYXllckZvbGxvd0Nvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQlpZiBub3QgU2VsZWN0ZWRQbGF5ZXJGb2xsb3cgdGhlbgoJCQkJCQlyZXR1cm4KCQkJCQllbmQKCQkJCQlsb2NhbCB0YXJnZXRQbGF5ZXIgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKFNlbGVjdGVkUGxheWVyRm9sbG93KQoJCQkJCWlmIHRhcmdldFBsYXllciBhbmQgdGFyZ2V0UGxheWVyLkNoYXJhY3RlciBhbmQgdGFyZ2V0UGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydCB0aGVuCgkJCQkJCWxvY2FsIGNoYXIgPSBsb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJCQkJaWYgY2hhciB0aGVuCgkJCQkJCQlsb2NhbCBodW1hbm9pZCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKCQkJCQkJCWlmIGh1bWFub2lkIHRoZW4KCQkJCQkJCQlodW1hbm9pZDpNb3ZlVG8odGFyZ2V0UGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbikKCQkJCQkJCWVuZAoJCQkJCQllbmQKCQkJCQllbmQKCQkJCWVuZCkKCQkJZWxzZQoJCQkJZ2V0Z2VudigpLlBsYXllckZvbGxvd0VuYWJsZWQgPSBmYWxzZQoJCQkJaWYgZ2V0Z2VudigpLlBsYXllckZvbGxvd0Nvbm5lY3Rpb24gdGhlbgoJCQkJCWdldGdlbnYoKS5QbGF5ZXJGb2xsb3dDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQoJCQkJCWdldGdlbnYoKS5QbGF5ZXJGb2xsb3dDb25uZWN0aW9uID0gbmlsCgkJCQllbmQKCQkJZW5kCgkJZW5kLAoJfSkKCWxvY2FsIGluaXRpYWxPcHRpb25zID0gZ2V0UGxheWVyTmFtZXMoKQoJaWYgI2luaXRpYWxPcHRpb25zID4gMCB0aGVuCgkJZm9sbG93RHJvcGRvd24gPSBQbGF5ZXJGb2xsb3c6Y3JlYXRlX2Ryb3Bkb3duKHsKCQkJdGl0bGUgPSAiRm9sbG93IFRhcmdldCIsCgkJCWZsYWcgPSAiRm9sbG93X1RhcmdldCIsCgkJCW9wdGlvbnMgPSBpbml0aWFsT3B0aW9ucywKCQkJbXVsdGlfZHJvcGRvd24gPSBmYWxzZSwKCQkJbWF4aW11bV9vcHRpb25zID0gI2luaXRpYWxPcHRpb25zLAoJCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQkJaWYgdmFsdWUgdGhlbgoJCQkJCVNlbGVjdGVkUGxheWVyRm9sbG93ID0gdmFsdWUKCQkJCQlpZiBnZXRnZW52KCkuRm9sbG93Tm90aWZ5RW5hYmxlZCB0aGVuCgkJCQkJCUxpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CgkJCQkJCQl0aXRsZSA9ICJNb2R1bGUgTm90aWZpY2F0aW9uIiwKCQkJCQkJCXRleHQgPSAiTm93IGZvbGxvd2luZzogIiAuLiB2YWx1ZSwKCQkJCQkJCWR1cmF0aW9uID0gMywKCQkJCQkJfSkKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQsCgkJfSkKCQlTZWxlY3RlZFBsYXllckZvbGxvdyA9IGluaXRpYWxPcHRpb25zWzFdCgkJZm9sbG93RHJvcGRvd246dXBkYXRlKFNlbGVjdGVkUGxheWVyRm9sbG93KQoJCWdldGdlbnYoKS5Gb2xsb3dEcm9wZG93biA9IGZvbGxvd0Ryb3Bkb3duCgllbHNlCgkJU2VsZWN0ZWRQbGF5ZXJGb2xsb3cgPSBuaWwKCWVuZAoJbG9jYWwgbGFzdE9wdGlvbnNTdHJpbmcgPSB0YWJsZS5jb25jYXQoaW5pdGlhbE9wdGlvbnMsICIsIikKCWxvY2FsIHVwZGF0ZVRpbWVyID0gMAoJUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbihkdCkKCQl1cGRhdGVUaW1lciA9IHVwZGF0ZVRpbWVyICsgZHQKCQlpZiB1cGRhdGVUaW1lciA+PSAxMCB0aGVuCgkJCWxvY2FsIG5ld09wdGlvbnMgPSBnZXRQbGF5ZXJOYW1lcygpCgkJCXRhYmxlLnNvcnQobmV3T3B0aW9ucykKCQkJbG9jYWwgbmV3T3B0aW9uc1N0cmluZyA9IHRhYmxlLmNvbmNhdChuZXdPcHRpb25zLCAiLCIpCgkJCWlmIG5ld09wdGlvbnNTdHJpbmcgfj0gbGFzdE9wdGlvbnNTdHJpbmcgdGhlbgoJCQkJaWYgZm9sbG93RHJvcGRvd24gdGhlbgoJCQkJCWlmICNuZXdPcHRpb25zID4gMCB0aGVuCgkJCQkJCWlmIGZvbGxvd0Ryb3Bkb3duLnNldF9vcHRpb25zIHRoZW4KCQkJCQkJCWZvbGxvd0Ryb3Bkb3duOnNldF9vcHRpb25zKG5ld09wdGlvbnMpCgkJCQkJCWVsc2UKCQkJCQkJCWZvbGxvd0Ryb3Bkb3duLm1heGltdW1fb3B0aW9ucyA9ICNuZXdPcHRpb25zCgkJCQkJCWVuZAoJCQkJCQlpZiBub3QgdGFibGUuZmluZChuZXdPcHRpb25zLCBTZWxlY3RlZFBsYXllckZvbGxvdykgdGhlbgoJCQkJCQkJU2VsZWN0ZWRQbGF5ZXJGb2xsb3cgPSBuZXdPcHRpb25zWzFdCgkJCQkJCQlmb2xsb3dEcm9wZG93bjp1cGRhdGUoU2VsZWN0ZWRQbGF5ZXJGb2xsb3cpCgkJCQkJCWVuZAoJCQkJCWVsc2UKCQkJCQkJU2VsZWN0ZWRQbGF5ZXJGb2xsb3cgPSBuaWwKCQkJCQllbmQKCQkJCWVuZAoJCQkJbGFzdE9wdGlvbnNTdHJpbmcgPSBuZXdPcHRpb25zU3RyaW5nCgkJCWVuZAoJCQl1cGRhdGVUaW1lciA9IDAKCQllbmQKCWVuZCkKCVBsYXllckZvbGxvdzpjcmVhdGVfY2hlY2tib3goewoJCXRpdGxlID0gIk5vdGlmeSIsCgkJZmxhZyA9ICJGb2xsb3dfTm90aWZ5IiwKCQlkZWZhdWx0ID0gZmFsc2UsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJZ2V0Z2VudigpLkZvbGxvd05vdGlmeUVuYWJsZWQgPSB2YWx1ZQoJCWVuZCwKCX0pCglsb2NhbCBIaXRTb3VuZHMgPSBwbGF5ZXI6Y3JlYXRlX21vZHVsZSh7CgkJdGl0bGUgPSAiSGl0IFNvdW5kcyIsCgkJZmxhZyA9ICJIaXRfU291bmRzIiwKCQlkZXNjcmlwdGlvbiA9ICJUb2dnbGVzIGhpdCBzb3VuZHMiLAoJCXNlY3Rpb24gPSAicmlnaHQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWhpdF9Tb3VuZF9FbmFibGVkID0gdmFsdWUKCQllbmQsCgl9KQoJbG9jYWwgRm9sZGVyID0gSW5zdGFuY2UubmV3KCJGb2xkZXIiKQoJRm9sZGVyLk5hbWUgPSAiVXNlZnVsIFV0aWxpdHkiCglGb2xkZXIuUGFyZW50ID0gd29ya3NwYWNlCglsb2NhbCBoaXRfU291bmQgPSBJbnN0YW5jZS5uZXcoIlNvdW5kIiwgRm9sZGVyKQoJaGl0X1NvdW5kLlZvbHVtZSA9IDYKCWxvY2FsIGhpdFNvdW5kT3B0aW9ucyA9IHsKCQkiTWVkYWwiLAoJCSJGYXRhbGl0eSIsCgkJIlNrZWV0IiwKCQkiU3dpdGNoZXMiLAoJCSJSdXN0IEhlYWRzaG90IiwKCQkiTmV2ZXJsb3NlIFNvdW5kIiwKCQkiQnViYmxlIiwKCQkiTGFzZXIiLAoJCSJTdGV2ZSIsCgkJIkNhbGwgb2YgRHV0eSIsCgkJIkJhdCIsCgkJIlRGMiBDcml0aWNhbCIsCgkJIlNhYmVyIiwKCQkiQmFtZXdhcmUiLAoJfQoJbG9jYWwgaGl0U291bmRJZHMgPSB7CgkJTWVkYWwgPSAicmJ4YXNzZXRpZDovLzY2MDczMzY3MTgiLAoJCUZhdGFsaXR5ID0gInJieGFzc2V0aWQ6Ly82NjA3MTEzMjU1IiwKCQlTa2VldCA9ICJyYnhhc3NldGlkOi8vNjYwNzIwNDUwMSIsCgkJU3dpdGNoZXMgPSAicmJ4YXNzZXRpZDovLzY2MDcxNzMzNjMiLAoJCVsiUnVzdCBIZWFkc2hvdCJdID0gInJieGFzc2V0aWQ6Ly8xMzg3NTAzMzEzODcwNjQiLAoJCVsiTmV2ZXJsb3NlIFNvdW5kIl0gPSAicmJ4YXNzZXRpZDovLzExMDE2ODcyMzQ0NzE1MyIsCgkJQnViYmxlID0gInJieGFzc2V0aWQ6Ly82NTM0OTQ3NTg4IiwKCQlMYXNlciA9ICJyYnhhc3NldGlkOi8vNzgzNzQ2MTMzMSIsCgkJU3RldmUgPSAicmJ4YXNzZXRpZDovLzQ5NjUwODM5OTciLAoJCVsiQ2FsbCBvZiBEdXR5Il0gPSAicmJ4YXNzZXRpZDovLzU5NTIxMjAzMDEiLAoJCUJhdCA9ICJyYnhhc3NldGlkOi8vMzMzMzkwNzM0NyIsCgkJWyJURjIgQ3JpdGljYWwiXSA9ICJyYnhhc3NldGlkOi8vMjk2MTAyNzM0IiwKCQlTYWJlciA9ICJyYnhhc3NldGlkOi8vODQxNTY3ODgxMyIsCgkJQmFtZXdhcmUgPSAicmJ4YXNzZXRpZDovLzMxMjQzMzE4MjAiLAoJfQoJSGl0U291bmRzOmNyZWF0ZV9zbGlkZXIoewoJCXRpdGxlID0gIlZvbHVtZSIsCgkJZmxhZyA9ICJIaXRTb3VuZFZvbHVtZSIsCgkJbWluaW11bV92YWx1ZSA9IDEsCgkJbWF4aW11bV92YWx1ZSA9IDEwLAoJCXZhbHVlID0gNSwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQloaXRfU291bmQuVm9sdW1lID0gdmFsdWUKCQllbmQsCgl9KQoJSGl0U291bmRzOmNyZWF0ZV9kcm9wZG93bih7CgkJdGl0bGUgPSAiSGl0IFNvdW5kIFR5cGUiLAoJCWZsYWcgPSAiaGl0X3NvdW5kX3R5cGUiLAoJCW9wdGlvbnMgPSBoaXRTb3VuZE9wdGlvbnMsCgkJbWF4aW11bV9vcHRpb25zID0gI2hpdFNvdW5kT3B0aW9ucywKCQltdWx0aV9kcm9wZG93biA9IGZhbHNlLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24oc2VsZWN0ZWRPcHRpb24pCgkJCWlmIGhpdFNvdW5kSWRzW3NlbGVjdGVkT3B0aW9uXSB0aGVuCgkJCQloaXRfU291bmQuU291bmRJZCA9IGhpdFNvdW5kSWRzW3NlbGVjdGVkT3B0aW9uXQoJCQllbHNlCgkJCQl3YXJuKCJJbnZhbGlkIGhpdCBzb3VuZCBzZWxlY3Rpb246ICIgLi4gdG9zdHJpbmcoc2VsZWN0ZWRPcHRpb24pKQoJCQllbmQKCQllbmQsCgl9KQoJUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5QYXJyeVN1Y2Nlc3MuT25DbGllbnRFdmVudDpDb25uZWN0KGZ1bmN0aW9uKCkKCQlpZiBoaXRfU291bmRfRW5hYmxlZCB0aGVuCgkJCWhpdF9Tb3VuZDpQbGF5KCkKCQllbmQKCWVuZCkKCWxvY2FsIHNvdW5kT3B0aW9ucyA9IHsKCQlbIkVleXVoIl0gPSAicmJ4YXNzZXRpZDovLzE2MTkwNzgyMTgxIiwKCQlbIlN3ZWVwIl0gPSAicmJ4YXNzZXRpZDovLzEwMzUwODkzNjY1ODU1MyIsCgkJWyJCb3VuY2UiXSA9ICJyYnhhc3NldGlkOi8vMTM0ODE4ODgyODIxNjYwIiwKCQlbIkV2ZXJ5Ym9keSBXYW50cyBUbyBSdWxlIFRoZSBXb3JsZCJdID0gInJieGFzc2V0aWQ6Ly84NzIwOTUyNzAzNDY3MCIsCgkJWyJNaXNzaW5nIE1vbmV5Il0gPSAicmJ4YXNzZXRpZDovLzEzNDY2ODE5NDEyODAzNyIsCgkJWyJTb3VyIEdyYXBlcyJdID0gInJieGFzc2V0aWQ6Ly8xMTc4MjAzOTIxNzIyOTEiLAoJCVsiRXJ3YWNoZW4iXSA9ICJyYnhhc3NldGlkOi8vMTI0ODUzNjEyODgxNzcyIiwKCQlbIkdyYXNwIHRoZSBMaWdodCJdID0gInJieGFzc2V0aWQ6Ly84OTU0OTE1NTY4OTM5NyIsCgkJWyJCZXlvbmQgdGhlIFNoYWRvd3MiXSA9ICJyYnhhc3NldGlkOi8vMTIwNzI5NzkyNTI5OTc4IiwKCQlbIlJpc2UgdG8gdGhlIEhvcml6b24iXSA9ICJyYnhhc3NldGlkOi8vNzI1NzMyNjYyNjgzMTMiLAoJCVsiRWNob2VzIG9mIHRoZSBDYW5keSBLaW5nZG9tIl0gPSAicmJ4YXNzZXRpZDovLzEwMzA0MDQ3NzMzMzU5MCIsCgkJWyJTcGVlZCJdID0gInJieGFzc2V0aWQ6Ly8xMjU1NTAyNTM4OTU4OTMiLAoJCVsiTG8tZmkgQ2hpbGwgQSJdID0gInJieGFzc2V0aWQ6Ly85MDQzODg3MDkxIiwKCQlbIkxvLWZpIEFtYmllbnQiXSA9ICJyYnhhc3NldGlkOi8vMTI5Nzc1Nzc2OTg3NTIzIiwKCQlbIlRlYXJzIGluIHRoZSBSYWluIl0gPSAicmJ4YXNzZXRpZDovLzEyOTcxMDg0NTAzODI2MyIsCgl9Cglsb2NhbCBjdXJyZW50U291bmQgPSBJbnN0YW5jZS5uZXcoIlNvdW5kIikKCWN1cnJlbnRTb3VuZC5Wb2x1bWUgPSAzCgljdXJyZW50U291bmQuTG9vcGVkID0gZmFsc2UKCWN1cnJlbnRTb3VuZC5QYXJlbnQgPSBnYW1lOkdldFNlcnZpY2UoIlNvdW5kU2VydmljZSIpCglsb2NhbCBzb3VuZE1vZHVsZQoJbG9jYWwgZnVuY3Rpb24gcGxheVNvdW5kQnlJZChzb3VuZElkKQoJCWN1cnJlbnRTb3VuZDpTdG9wKCkKCQljdXJyZW50U291bmQuU291bmRJZCA9IHNvdW5kSWQKCQljdXJyZW50U291bmQ6UGxheSgpCgllbmQKCWxvY2FsIHNlbGVjdGVkU291bmQgPSAiRWV5dWgiCglsb2NhbCBzb3VuZE1vZHVsZSA9IHdvcmxkOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIlNvdW5kIENvbnRyb2xsZXIiLAoJCWZsYWcgPSAic291bmRfY29udHJvbGxlciIsCgkJZGVzY3JpcHRpb24gPSAiQ29udHJvbCBiYWNrZ3JvdW5kIG11c2ljIGFuZCBzb3VuZHMiLAoJCXNlY3Rpb24gPSAibGVmdCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJZ2V0Z2VudigpLnNvdW5kbW9kdWxlID0gdmFsdWUKCQkJaWYgdmFsdWUgdGhlbgoJCQkJcGxheVNvdW5kQnlJZChzb3VuZE9wdGlvbnNbc2VsZWN0ZWRTb3VuZF0pCgkJCWVsc2UKCQkJCWN1cnJlbnRTb3VuZDpTdG9wKCkKCQkJZW5kCgkJZW5kLAoJfSkKCXNvdW5kTW9kdWxlOmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiTG9vcCBTb25nIiwKCQlmbGFnID0gIkxvb3BTb25nIiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQljdXJyZW50U291bmQuTG9vcGVkID0gdmFsdWUKCQllbmQsCgl9KQoJc291bmRNb2R1bGU6Y3JlYXRlX3NsaWRlcih7CgkJdGl0bGUgPSAiVm9sdW1lIiwKCQlmbGFnID0gIkhpdFNvdW5kVm9sdW1lIiwKCQltaW5pbXVtX3ZhbHVlID0gMSwKCQltYXhpbXVtX3ZhbHVlID0gMTAsCgkJdmFsdWUgPSAzLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWN1cnJlbnRTb3VuZC5Wb2x1bWUgPSB2YWx1ZQoJCWVuZCwKCX0pCglzb3VuZE1vZHVsZTpjcmVhdGVfZGl2aWRlcih7fSkKCXNvdW5kTW9kdWxlOmNyZWF0ZV9kcm9wZG93bih7CgkJdGl0bGUgPSAiU2VsZWN0IFNvdW5kIiwKCQlmbGFnID0gInNvdW5kX3NlbGVjdGlvbiIsCgkJb3B0aW9ucyA9IHsKCQkJIkVleXVoIiwKCQkJIlN3ZWVwIiwKCQkJIkJvdW5jZSIsCgkJCSJFdmVyeWJvZHkgV2FudHMgVG8gUnVsZSBUaGUgV29ybGQiLAoJCQkiTWlzc2luZyBNb25leSIsCgkJCSJTb3VyIEdyYXBlcyIsCgkJCSJFcndhY2hlbiIsCgkJCSJHcmFzcCB0aGUgTGlnaHQiLAoJCQkiQmV5b25kIHRoZSBTaGFkb3dzIiwKCQkJIlJpc2UgdG8gdGhlIEhvcml6b24iLAoJCQkiRWNob2VzIG9mIHRoZSBDYW5keSBLaW5nZG9tIiwKCQkJIlNwZWVkIiwKCQkJIkxvLWZpIENoaWxsIEEiLAoJCQkiTG8tZmkgQW1iaWVudCIsCgkJCSJUZWFycyBpbiB0aGUgUmFpbiIsCgkJfSwKCQltdWx0aV9kcm9wZG93biA9IGZhbHNlLAoJCW1heGltdW1fb3B0aW9ucyA9IDE1LAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCXNlbGVjdGVkU291bmQgPSB2YWx1ZQoJCQlpZiBnZXRnZW52KCkuc291bmRtb2R1bGUgdGhlbgoJCQkJcGxheVNvdW5kQnlJZChzb3VuZE9wdGlvbnNbdmFsdWVdKQoJCQllbmQKCQllbmQsCgl9KQoJbG9jYWwgV29ybGRGaWx0ZXIgPSB3b3JsZDpjcmVhdGVfbW9kdWxlKHsKCQl0aXRsZSA9ICJGaWx0ZXIiLAoJCWZsYWcgPSAiRmlsdGVyIiwKCQlkZXNjcmlwdGlvbiA9ICJUb2dnbGVzIGN1c3RvbSB3b3JsZCBmaWx0ZXIgZWZmZWN0cyIsCgkJc2VjdGlvbiA9ICJyaWdodCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJZ2V0Z2VudigpLldvcmxkRmlsdGVyRW5hYmxlZCA9IHZhbHVlCgkJCWlmIG5vdCB2YWx1ZSB0aGVuCgkJCQlpZiBnYW1lLkxpZ2h0aW5nOkZpbmRGaXJzdENoaWxkKCJDdXN0b21BdG1vc3BoZXJlIikgdGhlbgoJCQkJCWdhbWUuTGlnaHRpbmcuQ3VzdG9tQXRtb3NwaGVyZTpEZXN0cm95KCkKCQkJCWVuZAoJCQkJZ2FtZS5MaWdodGluZy5Gb2dFbmQgPSAxMDAwMDAKCQkJCWdhbWUuTGlnaHRpbmcuQ29sb3JDb3JyZWN0aW9uLlRpbnRDb2xvciA9IENvbG9yMy5uZXcoMSwgMSwgMSkKCQkJCWdhbWUuTGlnaHRpbmcuQ29sb3JDb3JyZWN0aW9uLlNhdHVyYXRpb24gPSAwCgkJCWVuZAoJCWVuZCwKCX0pCglXb3JsZEZpbHRlcjpjcmVhdGVfY2hlY2tib3goewoJCXRpdGxlID0gIkVuYWJsZSBBdG1vc3BoZXJlIiwKCQlmbGFnID0gIldvcmxkX0ZpbHRlcl9BdG1vc3BoZXJlIiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlnZXRnZW52KCkuQXRtb3NwaGVyZUVuYWJsZWQgPSB2YWx1ZQoJCQlpZiB2YWx1ZSB0aGVuCgkJCQlpZiBub3QgZ2FtZS5MaWdodGluZzpGaW5kRmlyc3RDaGlsZCgiQ3VzdG9tQXRtb3NwaGVyZSIpIHRoZW4KCQkJCQlsb2NhbCBhdG1vc3BoZXJlID0gSW5zdGFuY2UubmV3KCJBdG1vc3BoZXJlIikKCQkJCQlhdG1vc3BoZXJlLk5hbWUgPSAiQ3VzdG9tQXRtb3NwaGVyZSIKCQkJCQlhdG1vc3BoZXJlLlBhcmVudCA9IGdhbWUuTGlnaHRpbmcKCQkJCWVuZAoJCQllbHNlCgkJCQlpZiBnYW1lLkxpZ2h0aW5nOkZpbmRGaXJzdENoaWxkKCJDdXN0b21BdG1vc3BoZXJlIikgdGhlbgoJCQkJCWdhbWUuTGlnaHRpbmcuQ3VzdG9tQXRtb3NwaGVyZTpEZXN0cm95KCkKCQkJCWVuZAoJCQllbmQKCQllbmQsCgl9KQoJV29ybGRGaWx0ZXI6Y3JlYXRlX3NsaWRlcih7CgkJdGl0bGUgPSAiQXRtb3NwaGVyZSBEZW5zaXR5IiwKCQlmbGFnID0gIldvcmxkX0ZpbHRlcl9BdG1vc3BoZXJlX1NsaWRlciIsCgkJbWluaW11bV92YWx1ZSA9IDAsCgkJbWF4aW11bV92YWx1ZSA9IDEsCgkJdmFsdWUgPSAwLjUsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJaWYgZ2V0Z2VudigpLkF0bW9zcGhlcmVFbmFibGVkIGFuZCBnYW1lLkxpZ2h0aW5nOkZpbmRGaXJzdENoaWxkKCJDdXN0b21BdG1vc3BoZXJlIikgdGhlbgoJCQkJZ2FtZS5MaWdodGluZy5DdXN0b21BdG1vc3BoZXJlLkRlbnNpdHkgPSB2YWx1ZQoJCQllbmQKCQllbmQsCgl9KQoJV29ybGRGaWx0ZXI6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJFbmFibGUgRm9nIiwKCQlmbGFnID0gIldvcmxkX0ZpbHRlcl9Gb2ciLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5Gb2dFbmFibGVkID0gdmFsdWUKCQkJaWYgbm90IHZhbHVlIHRoZW4KCQkJCWdhbWUuTGlnaHRpbmcuRm9nRW5kID0gMTAwMDAwCgkJCWVuZAoJCWVuZCwKCX0pCglXb3JsZEZpbHRlcjpjcmVhdGVfc2xpZGVyKHsKCQl0aXRsZSA9ICJGb2cgRGlzdGFuY2UiLAoJCWZsYWcgPSAiV29ybGRfRmlsdGVyX0ZvZ19TbGlkZXIiLAoJCW1pbmltdW1fdmFsdWUgPSA1MCwKCQltYXhpbXVtX3ZhbHVlID0gMTAwMDAsCgkJdmFsdWUgPSAxMDAwLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWlmIGdldGdlbnYoKS5Gb2dFbmFibGVkIHRoZW4KCQkJCWdhbWUuTGlnaHRpbmcuRm9nRW5kID0gdmFsdWUKCQkJZW5kCgkJZW5kLAoJfSkKCVdvcmxkRmlsdGVyOmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiRW5hYmxlIFNhdHVyYXRpb24iLAoJCWZsYWcgPSAiV29ybGRfRmlsdGVyX1NhdHVyYXRpb24iLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5TYXR1cmF0aW9uRW5hYmxlZCA9IHZhbHVlCgkJCWlmIG5vdCB2YWx1ZSB0aGVuCgkJCQlnYW1lLkxpZ2h0aW5nLkNvbG9yQ29ycmVjdGlvbi5TYXR1cmF0aW9uID0gMAoJCQllbmQKCQllbmQsCgl9KQoJV29ybGRGaWx0ZXI6Y3JlYXRlX3NsaWRlcih7CgkJdGl0bGUgPSAiU2F0dXJhdGlvbiBMZXZlbCIsCgkJZmxhZyA9ICJXb3JsZF9GaWx0ZXJfU2F0dXJhdGlvbl9TbGlkZXIiLAoJCW1pbmltdW1fdmFsdWUgPSAtMSwKCQltYXhpbXVtX3ZhbHVlID0gMSwKCQl2YWx1ZSA9IDAsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJaWYgZ2V0Z2VudigpLlNhdHVyYXRpb25FbmFibGVkIHRoZW4KCQkJCWdhbWUuTGlnaHRpbmcuQ29sb3JDb3JyZWN0aW9uLlNhdHVyYXRpb24gPSB2YWx1ZQoJCQllbmQKCQllbmQsCgl9KQoJV29ybGRGaWx0ZXI6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJFbmFibGUgSHVlIiwKCQlmbGFnID0gIldvcmxkX0ZpbHRlcl9IdWUiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5IdWVFbmFibGVkID0gdmFsdWUKCQkJaWYgbm90IHZhbHVlIHRoZW4KCQkJCWdhbWUuTGlnaHRpbmcuQ29sb3JDb3JyZWN0aW9uLlRpbnRDb2xvciA9IENvbG9yMy5uZXcoMSwgMSwgMSkKCQkJZW5kCgkJZW5kLAoJfSkKCVdvcmxkRmlsdGVyOmNyZWF0ZV9zbGlkZXIoewoJCXRpdGxlID0gIkh1ZSBTaGlmdCIsCgkJZmxhZyA9ICJXb3JsZF9GaWx0ZXJfSHVlX1NsaWRlciIsCgkJbWluaW11bV92YWx1ZSA9IC0xLAoJCW1heGltdW1fdmFsdWUgPSAxLAoJCXZhbHVlID0gMCwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlpZiBnZXRnZW52KCkuSHVlRW5hYmxlZCB0aGVuCgkJCQlnYW1lLkxpZ2h0aW5nLkNvbG9yQ29ycmVjdGlvbi5UaW50Q29sb3IgPSBDb2xvcjMuZnJvbUhTVih2YWx1ZSwgMSwgMSkKCQkJZW5kCgkJZW5kLAoJfSkKCWxvY2FsIEJhbGxUcmFpbCA9IHdvcmxkOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIkJhbGwgVHJhaWwiLAoJCWZsYWcgPSAiQmFsbF9UcmFpbCIsCgkJZGVzY3JpcHRpb24gPSAiVG9nZ2xlcyBiYWxsIHRyYWlsIGVmZmVjdHMiLAoJCXNlY3Rpb24gPSAibGVmdCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJZ2V0Z2VudigpLkJhbGxUcmFpbEVuYWJsZWQgPSB2YWx1ZQoJCWVuZCwKCX0pCglCYWxsVHJhaWw6Y3JlYXRlX3NsaWRlcih7CgkJdGl0bGUgPSAiQmFsbCBUcmFpbCBIdWUiLAoJCWZsYWcgPSAiQmFsbF9UcmFpbF9IdWUiLAoJCW1pbmltdW1fdmFsdWUgPSAwLAoJCW1heGltdW1fdmFsdWUgPSAzNjAsCgkJdmFsdWUgPSAwLAoJCXJvdW5kX251bWJlciA9IHRydWUsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJaWYgbm90IGdldGdlbnYoKS5CYWxsVHJhaWxSYWluYm93RW5hYmxlZCB0aGVuCgkJCQlsb2NhbCBuZXdDb2xvciA9IENvbG9yMy5mcm9tSFNWKHZhbHVlIC8gMzYwLCAxLCAxKQoJCQkJZ2V0Z2VudigpLkJhbGxUcmFpbENvbG9yID0gbmV3Q29sb3IKCQkJZW5kCgkJZW5kLAoJfSkKCUJhbGxUcmFpbDpjcmVhdGVfY2hlY2tib3goewoJCXRpdGxlID0gIlJhaW5ib3cgVHJhaWwiLAoJCWZsYWcgPSAiQmFsbF9UcmFpbF9SYWluYm93IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlnZXRnZW52KCkuQmFsbFRyYWlsUmFpbmJvd0VuYWJsZWQgPSB2YWx1ZQoJCWVuZCwKCX0pCglCYWxsVHJhaWw6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJQYXJ0aWNsZSBFbWl0dGVyIiwKCQlmbGFnID0gIkJhbGxfVHJhaWxfUGFydGljbGUiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5CYWxsVHJhaWxQYXJ0aWNsZUVuYWJsZWQgPSB2YWx1ZQoJCWVuZCwKCX0pCglCYWxsVHJhaWw6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJHbG93IEVmZmVjdCIsCgkJZmxhZyA9ICJCYWxsX1RyYWlsX0dsb3ciLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5CYWxsVHJhaWxHbG93RW5hYmxlZCA9IHZhbHVlCgkJZW5kLAoJfSkKCWxvY2FsIGh1ZSA9IDAKCWxvY2FsIHRyYWNrZWRCYWxscyA9IHt9Cglsb2NhbCBmdW5jdGlvbiBjbGVhckVmZmVjdHMoYmFsbCkKCQlsb2NhbCB0cmFpbCA9IGJhbGw6RmluZEZpcnN0Q2hpbGQoIlRyYWlsIikKCQlpZiB0cmFpbCB0aGVuCgkJCXRyYWlsOkRlc3Ryb3koKQoJCWVuZAoJCWxvY2FsIGVtaXR0ZXIgPSBiYWxsOkZpbmRGaXJzdENoaWxkKCJQYXJ0aWNsZUVtaXR0ZXIiKQoJCWlmIGVtaXR0ZXIgdGhlbgoJCQllbWl0dGVyOkRlc3Ryb3koKQoJCWVuZAoJCWxvY2FsIGdsb3cgPSBiYWxsOkZpbmRGaXJzdENoaWxkKCJCYWxsR2xvdyIpCgkJaWYgZ2xvdyB0aGVuCgkJCWdsb3c6RGVzdHJveSgpCgkJZW5kCgkJbG9jYWwgYXR0MCA9IGJhbGw6RmluZEZpcnN0Q2hpbGQoIkF0dGFjaG1lbnQwIikKCQlpZiBhdHQwIHRoZW4KCQkJYXR0MDpEZXN0cm95KCkKCQllbmQKCQlsb2NhbCBhdHQxID0gYmFsbDpGaW5kRmlyc3RDaGlsZCgiQXR0YWNobWVudDEiKQoJCWlmIGF0dDEgdGhlbgoJCQlhdHQxOkRlc3Ryb3koKQoJCWVuZAoJZW5kCglsb2NhbCBmdW5jdGlvbiBhcHBseUVmZmVjdHMoYmFsbCkKCQlpZiBub3QgZ2V0Z2VudigpLkJhbGxUcmFpbEVuYWJsZWQgdGhlbgoJCQlpZiB0cmFja2VkQmFsbHNbYmFsbF0gdGhlbgoJCQkJY2xlYXJFZmZlY3RzKGJhbGwpCgkJCQl0cmFja2VkQmFsbHNbYmFsbF0gPSBuaWwKCQkJZW5kCgkJCXJldHVybgoJCWVuZAoJCWlmIHRyYWNrZWRCYWxsc1tiYWxsXSB0aGVuCgkJCWxvY2FsIHRyYWlsID0gYmFsbDpGaW5kRmlyc3RDaGlsZCgiVHJhaWwiKQoJCQlpZiB0cmFpbCB0aGVuCgkJCQlpZiBnZXRnZW52KCkuQmFsbFRyYWlsUmFpbmJvd0VuYWJsZWQgdGhlbgoJCQkJCWxvY2FsIGNvbG9yID0gQ29sb3IzLmZyb21IU1YoaHVlIC8gMzYwLCAxLCAxKQoJCQkJCXRyYWlsLkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXcoY29sb3IpCgkJCQkJZ2V0Z2VudigpLkJhbGxUcmFpbENvbG9yID0gY29sb3IKCQkJCWVsc2UKCQkJCQl0cmFpbC5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3KGdldGdlbnYoKS5CYWxsVHJhaWxDb2xvciBvciBDb2xvcjMubmV3KDEsIDEsIDEpKQoJCQkJZW5kCgkJCWVuZAoJCQlyZXR1cm4KCQllbmQKCQl0cmFja2VkQmFsbHNbYmFsbF0gPSB0cnVlCgkJbG9jYWwgdHJhaWwgPSBJbnN0YW5jZS5uZXcoIlRyYWlsIikKCQl0cmFpbC5OYW1lID0gIlRyYWlsIgoJCWxvY2FsIGF0dDAgPSBJbnN0YW5jZS5uZXcoIkF0dGFjaG1lbnQiKQoJCWF0dDAuTmFtZSA9ICJBdHRhY2htZW50MCIKCQlhdHQwLlBvc2l0aW9uID0gVmVjdG9yMy5uZXcoMCwgYmFsbC5TaXplLlkgLyAyLCAwKQoJCWF0dDAuUGFyZW50ID0gYmFsbAoJCWxvY2FsIGF0dDEgPSBJbnN0YW5jZS5uZXcoIkF0dGFjaG1lbnQiKQoJCWF0dDEuTmFtZSA9ICJBdHRhY2htZW50MSIKCQlhdHQxLlBvc2l0aW9uID0gVmVjdG9yMy5uZXcoMCwgLWJhbGwuU2l6ZS5ZIC8gMiwgMCkKCQlhdHQxLlBhcmVudCA9IGJhbGwKCQl0cmFpbC5BdHRhY2htZW50MCA9IGF0dDAKCQl0cmFpbC5BdHRhY2htZW50MSA9IGF0dDEKCQl0cmFpbC5MaWZldGltZSA9IDAuNAoJCXRyYWlsLldpZHRoU2NhbGUgPSBOdW1iZXJTZXF1ZW5jZS5uZXcoMC41KQoJCXRyYWlsLlRyYW5zcGFyZW5jeSA9IE51bWJlclNlcXVlbmNlLm5ldyh7CgkJCU51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIDApLAoJCQlOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCAxKSwKCQl9KQoJCXRyYWlsLkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXcoZ2V0Z2VudigpLkJhbGxUcmFpbENvbG9yIG9yIENvbG9yMy5uZXcoMSwgMSwgMSkpCgkJdHJhaWwuUGFyZW50ID0gYmFsbAoJCWlmIGdldGdlbnYoKS5CYWxsVHJhaWxQYXJ0aWNsZUVuYWJsZWQgdGhlbgoJCQlsb2NhbCBlbWl0dGVyID0gSW5zdGFuY2UubmV3KCJQYXJ0aWNsZUVtaXR0ZXIiKQoJCQllbWl0dGVyLk5hbWUgPSAiUGFydGljbGVFbWl0dGVyIgoJCQllbWl0dGVyLlJhdGUgPSAxMDAKCQkJZW1pdHRlci5MaWZldGltZSA9IE51bWJlclJhbmdlLm5ldygwLjUsIDEpCgkJCWVtaXR0ZXIuU3BlZWQgPSBOdW1iZXJSYW5nZS5uZXcoMCwgMSkKCQkJZW1pdHRlci5TaXplID0gTnVtYmVyU2VxdWVuY2UubmV3KHsKCQkJCU51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIDAuNSksCgkJCQlOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCAwKSwKCQkJfSkKCQkJZW1pdHRlci5UcmFuc3BhcmVuY3kgPSBOdW1iZXJTZXF1ZW5jZS5uZXcoewoJCQkJTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgMCksCgkJCQlOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCAxKSwKCQkJfSkKCQkJZW1pdHRlci5QYXJlbnQgPSBiYWxsCgkJZW5kCgkJaWYgZ2V0Z2VudigpLkJhbGxUcmFpbEdsb3dFbmFibGVkIHRoZW4KCQkJbG9jYWwgZ2xvdyA9IEluc3RhbmNlLm5ldygiUG9pbnRMaWdodCIpCgkJCWdsb3cuTmFtZSA9ICJCYWxsR2xvdyIKCQkJZ2xvdy5SYW5nZSA9IDE1CgkJCWdsb3cuQnJpZ2h0bmVzcyA9IDIKCQkJZ2xvdy5QYXJlbnQgPSBiYWxsCgkJZW5kCgllbmQKCWdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKCQlodWUgPSAoaHVlICsgMSkgJSAzNjAKCQlmb3IgXywgYmFsbCBpbiBwYWlycyhBdXRvX1BhcnJ5LkdldF9CYWxscygpKSBkbwoJCQlhcHBseUVmZmVjdHMoYmFsbCkKCQllbmQKCWVuZCkKCWxvY2FsIGJpbGxib2FyZExhYmVscyA9IHt9Cglsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKCWxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQoJbG9jYWwgcGxyID0gUGxheWVycy5Mb2NhbFBsYXllcgoJZ2V0Z2VudigpLkFiaWxpdHlFU1AgPSB0cnVlCglsb2NhbCBiaWxsYm9hcmRMYWJlbHMgPSB7fQoJZnVuY3Rpb24gcW9sUGxheWVyTmFtZVZpc2liaWxpdHkoKQoJCWxvY2FsIGZ1bmN0aW9uIGNyZWF0ZUJpbGxib2FyZEd1aShwKQoJCQlsb2NhbCBjaGFyYWN0ZXIgPSBwLkNoYXJhY3RlcgoJCQl3aGlsZSBub3QgKGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyLlBhcmVudCkgZG8KCQkJCXRhc2sud2FpdCgpCgkJCQljaGFyYWN0ZXIgPSBwLkNoYXJhY3RlcgoJCQllbmQKCQkJbG9jYWwgaGVhZCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkhlYWQiKQoJCQlsb2NhbCBiaWxsYm9hcmRHdWkgPSBJbnN0YW5jZS5uZXcoIkJpbGxib2FyZEd1aSIpCgkJCWJpbGxib2FyZEd1aS5OYW1lID0gIkFiaWxpdHlCaWxsYm9hcmQiCgkJCWJpbGxib2FyZEd1aS5BZG9ybmVlID0gaGVhZAoJCQliaWxsYm9hcmRHdWkuU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDAsIDAsIDI1KQoJCQliaWxsYm9hcmRHdWkuU3R1ZHNPZmZzZXQgPSBWZWN0b3IzLm5ldygwLCAzLCAwKQoJCQliaWxsYm9hcmRHdWkuQWx3YXlzT25Ub3AgPSB0cnVlCgkJCWJpbGxib2FyZEd1aS5QYXJlbnQgPSBoZWFkCgkJCWxvY2FsIHRleHRMYWJlbCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKCQkJdGV4dExhYmVsLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCkKCQkJdGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAyNTUsIDI1NSkKCQkJdGV4dExhYmVsLlRleHRTaXplID0gMTIKCQkJdGV4dExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuU291cmNlU2Fuc1NlbWlib2xkCgkJCXRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQoJCQl0ZXh0TGFiZWwuVGV4dFdyYXBwZWQgPSBmYWxzZQoJCQl0ZXh0TGFiZWwuVGV4dFRydW5jYXRlID0gRW51bS5UZXh0VHJ1bmNhdGUuQXRFbmQKCQkJdGV4dExhYmVsLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5DZW50ZXIKCQkJdGV4dExhYmVsLlRleHRZQWxpZ25tZW50ID0gRW51bS5UZXh0WUFsaWdubWVudC5DZW50ZXIKCQkJdGV4dExhYmVsLlRleHRTY2FsZWQgPSBmYWxzZQoJCQl0ZXh0TGFiZWwuVGV4dCA9ICIiCgkJCXRleHRMYWJlbC5QYXJlbnQgPSBiaWxsYm9hcmRHdWkKCQkJYmlsbGJvYXJkTGFiZWxzW3BdID0gdGV4dExhYmVsCgkJCWxvY2FsIGh1bWFub2lkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCgkJCWlmIGh1bWFub2lkIHRoZW4KCQkJCWh1bWFub2lkLkRpc3BsYXlEaXN0YW5jZVR5cGUgPSBFbnVtLkh1bWFub2lkRGlzcGxheURpc3RhbmNlVHlwZS5Ob25lCgkJCWVuZAoJCQlSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCWlmIG5vdCBjaGFyYWN0ZXIgb3Igbm90IGNoYXJhY3Rlci5QYXJlbnQgdGhlbgoJCQkJCWJpbGxib2FyZEd1aTpEZXN0cm95KCkKCQkJCQliaWxsYm9hcmRMYWJlbHNbcF0gPSBuaWwKCQkJCQlyZXR1cm4KCQkJCWVuZAoJCQkJaWYgZ2V0Z2VudigpLkFiaWxpdHlFU1AgdGhlbgoJCQkJCXRleHRMYWJlbC5WaXNpYmxlID0gdHJ1ZQoJCQkJCWxvY2FsIGFiaWxpdHlOYW1lID0gcDpHZXRBdHRyaWJ1dGUoIkVxdWlwcGVkQWJpbGl0eSIpCgkJCQkJaWYgYWJpbGl0eU5hbWUgdGhlbgoJCQkJCQl0ZXh0TGFiZWwuVGV4dCA9IHAuRGlzcGxheU5hbWUgLi4gIiBbIiAuLiB0b3N0cmluZyhhYmlsaXR5TmFtZSkgLi4gIl0iCgkJCQkJZWxzZQoJCQkJCQl0ZXh0TGFiZWwuVGV4dCA9IHAuRGlzcGxheU5hbWUgLi4gIiBbPz8/XSIKCQkJCQllbmQKCQkJCWVsc2UKCQkJCQl0ZXh0TGFiZWwuVmlzaWJsZSA9IGZhbHNlCgkJCQllbmQKCQkJZW5kKQoJCWVuZAoJCWZvciBfLCBwIGluIFBsYXllcnM6R2V0UGxheWVycygpIGRvCgkJCWlmIHAgfj0gcGxyIHRoZW4KCQkJCXAuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJY3JlYXRlQmlsbGJvYXJkR3VpKHApCgkJCQllbmQpCgkJCQljcmVhdGVCaWxsYm9hcmRHdWkocCkKCQkJZW5kCgkJZW5kCgkJUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKG5ld1BsYXllcikKCQkJbmV3UGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJY3JlYXRlQmlsbGJvYXJkR3VpKG5ld1BsYXllcikKCQkJZW5kKQoJCWVuZCkKCWVuZAoJcW9sUGxheWVyTmFtZVZpc2liaWxpdHkoKQoJbG9jYWwgQWJpbGl0eUVTUCA9IHdvcmxkOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIkFiaWxpdHkgRVNQIiwKCQlmbGFnID0gIkFiaWxpdHlFU1AiLAoJCWRlc2NyaXB0aW9uID0gIkRpc3BsYXlzIFBsYXllciBBYmlsaXRpZXMiLAoJCXNlY3Rpb24gPSAicmlnaHQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5BYmlsaXR5RVNQID0gdmFsdWUKCQkJZm9yIF8sIGxhYmVsIGluIHBhaXJzKGJpbGxib2FyZExhYmVscykgZG8KCQkJCWxhYmVsLlZpc2libGUgPSB2YWx1ZQoJCQllbmQKCQllbmQsCgl9KQoJbG9jYWwgQ3VzdG9tU2t5ID0gd29ybGQ6Y3JlYXRlX21vZHVsZSh7CgkJdGl0bGUgPSAiQ3VzdG9tIFNreSIsCgkJZmxhZyA9ICJDdXN0b21fU2t5IiwKCQlkZXNjcmlwdGlvbiA9ICJUb2dnbGVzIGEgY3VzdG9tIHNreWJveCIsCgkJc2VjdGlvbiA9ICJyaWdodCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJbG9jYWwgTGlnaHRpbmcgPSBnYW1lLkxpZ2h0aW5nCgkJCWxvY2FsIFNreSA9IExpZ2h0aW5nOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiU2t5IikKCQkJaWYgdmFsdWUgdGhlbgoJCQkJaWYgbm90IFNreSB0aGVuCgkJCQkJU2t5ID0gSW5zdGFuY2UubmV3KCJTa3kiLCBMaWdodGluZykKCQkJCWVuZAoJCQllbHNlCgkJCQlpZiBTa3kgdGhlbgoJCQkJCWxvY2FsIGRlZmF1bHRTa3lib3hJZHMgPQoJCQkJCQl7ICI1OTEwNTg4MjMiLCAiNTkxMDU5ODc2IiwgIjU5MTA1ODEwNCIsICI1OTEwNTc4NjEiLCAiNTkxMDU3NjI1IiwgIjU5MTA1OTY0MiIgfQoJCQkJCWxvY2FsIHNreUZhY2VzID0geyAiU2t5Ym94QmsiLCAiU2t5Ym94RG4iLCAiU2t5Ym94RnQiLCAiU2t5Ym94TGYiLCAiU2t5Ym94UnQiLCAiU2t5Ym94VXAiIH0KCQkJCQlmb3IgaW5kZXgsIGZhY2UgaW4gaXBhaXJzKHNreUZhY2VzKSBkbwoJCQkJCQlTa3lbZmFjZV0gPSAicmJ4YXNzZXRpZDovLyIgLi4gZGVmYXVsdFNreWJveElkc1tpbmRleF0KCQkJCQllbmQKCQkJCQlMaWdodGluZy5HbG9iYWxTaGFkb3dzID0gdHJ1ZQoJCQkJZW5kCgkJCWVuZAoJCWVuZCwKCX0pCglDdXN0b21Ta3k6Y3JlYXRlX2Ryb3Bkb3duKHsKCQl0aXRsZSA9ICJTZWxlY3QgU2t5IiwKCQlmbGFnID0gImN1c3RvbV9za3lfc2VsZWN0b3IiLAoJCW9wdGlvbnMgPSB7CgkJCSJEZWZhdWx0IiwKCQkJIlZhcG9yd2F2ZSIsCgkJCSJSZWRzaGlmdCIsCgkJCSJEZXNlcnQiLAoJCQkiRGFCYWJ5IiwKCQkJIk1pbmVjcmFmdCIsCgkJCSJTcG9uZ2VCb2IiLAoJCQkiU2tpYmlkaSIsCgkJCSJCbGF6ZSIsCgkJCSJQdXNzeSBDYXQiLAoJCQkiQW1vbmcgVXMiLAoJCQkiU3BhY2UgV2F2ZSIsCgkJCSJTcGFjZSBXYXZlMiIsCgkJCSJUdXJxdW9pc2UgV2F2ZSIsCgkJCSJEYXJrIE5pZ2h0IiwKCQkJIkJyaWdodCBQaW5rIiwKCQkJIldoaXRlIEdhbGF4eSIsCgkJCSJCbHVlIEdhbGF4eSIsCgkJfSwKCQltdWx0aV9kcm9wZG93biA9IGZhbHNlLAoJCW1heGltdW1fb3B0aW9ucyA9IDE4LAoJCWNhbGxiYWNrID0gZnVuY3Rpb24oc2VsZWN0ZWRPcHRpb24pCgkJCWxvY2FsIHNreWJveERhdGEgPSBuaWwKCQkJaWYgc2VsZWN0ZWRPcHRpb24gPT0gIkRlZmF1bHQiIHRoZW4KCQkJCXNreWJveERhdGEgPSB7ICI1OTEwNTg4MjMiLCAiNTkxMDU5ODc2IiwgIjU5MTA1ODEwNCIsICI1OTEwNTc4NjEiLCAiNTkxMDU3NjI1IiwgIjU5MTA1OTY0MiIgfQoJCQllbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIlZhcG9yd2F2ZSIgdGhlbgoJCQkJc2t5Ym94RGF0YSA9IHsgIjE0MTc0OTQwMzAiLCAiMTQxNzQ5NDE0NiIsICIxNDE3NDk0MjUzIiwgIjE0MTc0OTQ0MDIiLCAiMTQxNzQ5NDQ5OSIsICIxNDE3NDk0NjQzIiB9CgkJCWVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiUmVkc2hpZnQiIHRoZW4KCQkJCXNreWJveERhdGEgPSB7ICI0MDE2NjQ4MzkiLCAiNDAxNjY0ODYyIiwgIjQwMTY2NDk2MCIsICI0MDE2NjQ4ODEiLCAiNDAxNjY0OTAxIiwgIjQwMTY2NDkzNiIgfQoJCQllbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIkRlc2VydCIgdGhlbgoJCQkJc2t5Ym94RGF0YSA9IHsgIjEwMTM4NTIiLCAiMTAxMzg1MyIsICIxMDEzODUwIiwgIjEwMTM4NTEiLCAiMTAxMzg0OSIsICIxMDEzODU0IiB9CgkJCWVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiRGFCYWJ5IiB0aGVuCgkJCQlza3lib3hEYXRhID0geyAiNzI0NTQxODQ3MiIsICI3MjQ1NDE4NDcyIiwgIjcyNDU0MTg0NzIiLCAiNzI0NTQxODQ3MiIsICI3MjQ1NDE4NDcyIiwgIjcyNDU0MTg0NzIiIH0KCQkJZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJNaW5lY3JhZnQiIHRoZW4KCQkJCXNreWJveERhdGEgPSB7ICIxODc2NTQ1MDAzIiwgIjE4NzY1NDQzMzEiLCAiMTg3NjU0Mjk0MSIsICIxODc2NTQzMzkyIiwgIjE4NzY1NDM3NjQiLCAiMTg3NjU0NDY0MiIgfQoJCQllbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIlNwb25nZUJvYiIgdGhlbgoJCQkJc2t5Ym94RGF0YSA9IHsgIjc2MzMxNzgxNjYiLCAiNzYzMzE3ODE2NiIsICI3NjMzMTc4MTY2IiwgIjc2MzMxNzgxNjYiLCAiNzYzMzE3ODE2NiIsICI3NjMzMTc4MTY2IiB9CgkJCWVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiU2tpYmlkaSIgdGhlbgoJCQkJc2t5Ym94RGF0YSA9CgkJCQkJeyAiMTQ5NTIyNTYxMTMiLCAiMTQ5NTIyNTYxMTMiLCAiMTQ5NTIyNTYxMTMiLCAiMTQ5NTIyNTYxMTMiLCAiMTQ5NTIyNTYxMTMiLCAiMTQ5NTIyNTYxMTMiIH0KCQkJZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJCbGF6ZSIgdGhlbgoJCQkJc2t5Ym94RGF0YSA9IHsgIjE1MDkzOTAyMiIsICIxNTA5MzkwMzgiLCAiMTUwOTM5MDQ3IiwgIjE1MDkzOTA1NiIsICIxNTA5MzkwNjMiLCAiMTUwOTM5MDgyIiB9CgkJCWVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiUHVzc3kgQ2F0IiB0aGVuCgkJCQlza3lib3hEYXRhID0KCQkJCQl7ICIxMTE1NDQyMjkwMiIsICIxMTE1NDQyMjkwMiIsICIxMTE1NDQyMjkwMiIsICIxMTE1NDQyMjkwMiIsICIxMTE1NDQyMjkwMiIsICIxMTE1NDQyMjkwMiIgfQoJCQllbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIkFtb25nIFVzIiB0aGVuCgkJCQlza3lib3hEYXRhID0geyAiNTc1MjQ2MzE5MCIsICI1NzUyNDYzMTkwIiwgIjU3NTI0NjMxOTAiLCAiNTc1MjQ2MzE5MCIsICI1NzUyNDYzMTkwIiwgIjU3NTI0NjMxOTAiIH0KCQkJZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJTcGFjZSBXYXZlIiB0aGVuCgkJCQlza3lib3hEYXRhID0KCQkJCQl7ICIxNjI2MjM1NjU3OCIsICIxNjI2MjM1ODAyNiIsICIxNjI2MjM2MDQ2OSIsICIxNjI2MjM2MjAwMyIsICIxNjI2MjM2Mzg3MyIsICIxNjI2MjM2NjAxNiIgfQoJCQllbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIlNwYWNlIFdhdmUyIiB0aGVuCgkJCQlza3lib3hEYXRhID0geyAiMTIzMzE1ODQyMCIsICIxMjMzMTU4ODM4IiwgIjEyMzMxNTcxMDUiLCAiMTIzMzE1NzY0MCIsICIxMjMzMTU3OTk1IiwgIjEyMzMxNTkxNTgiIH0KCQkJZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJUdXJxdW9pc2UgV2F2ZSIgdGhlbgoJCQkJc2t5Ym94RGF0YSA9IHsgIjQ3OTc0ODk0IiwgIjQ3OTc0NjkwIiwgIjQ3OTc0ODIxIiwgIjQ3OTc0Nzc2IiwgIjQ3OTc0ODU5IiwgIjQ3OTc0OTA5IiB9CgkJCWVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiRGFyayBOaWdodCIgdGhlbgoJCQkJc2t5Ym94RGF0YSA9IHsgIjYyODU3MTkzMzgiLCAiNjI4NTcyMTA3OCIsICI2Mjg1NzIyOTY0IiwgIjYyODU3MjQ2ODIiLCAiNjI4NTcyNjMzNSIsICI2Mjg1NzMwNjM1IiB9CgkJCWVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiQnJpZ2h0IFBpbmsiIHRoZW4KCQkJCXNreWJveERhdGEgPSB7ICIyNzEwNDI1MTYiLCAiMjcxMDc3MjQzIiwgIjI3MTA0MjU1NiIsICIyNzEwNDIzMTAiLCAiMjcxMDQyNDY3IiwgIjI3MTA3Nzk1OCIgfQoJCQllbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIldoaXRlIEdhbGF4eSIgdGhlbgoJCQkJc2t5Ym94RGF0YSA9IHsgIjU1NDA3OTg0NTYiLCAiNTU0MDc5OTg5NCIsICI1NTQwODAxNzc5IiwgIjU1NDA4MDExOTIiLCAiNTU0MDc5OTEwOCIsICI1NTQwODAwNjM1IiB9CgkJCWVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiQmx1ZSBHYWxheHkiIHRoZW4KCQkJCXNreWJveERhdGEgPQoJCQkJCXsgIjE0OTYxNDk1NjczIiwgIjE0OTYxNDk0NDkyIiwgIjE0OTYxNDkyODQ0IiwgIjE0OTYxNDkxMjk4IiwgIjE0OTYxNDkwNDM5IiwgIjE0OTYxNDg5NTA4IiB9CgkJCWVuZAoJCQlpZiBub3Qgc2t5Ym94RGF0YSB0aGVuCgkJCQl3YXJuKCJTa3kgb3B0aW9uIG5vdCBmb3VuZDogIiAuLiB0b3N0cmluZyhzZWxlY3RlZE9wdGlvbikpCgkJCQlyZXR1cm4KCQkJZW5kCgkJCWxvY2FsIExpZ2h0aW5nID0gZ2FtZS5MaWdodGluZwoJCQlsb2NhbCBTa3kgPSBMaWdodGluZzpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlNreSIpIG9yIEluc3RhbmNlLm5ldygiU2t5IiwgTGlnaHRpbmcpCgkJCWxvY2FsIHNreUZhY2VzID0geyAiU2t5Ym94QmsiLCAiU2t5Ym94RG4iLCAiU2t5Ym94RnQiLCAiU2t5Ym94TGYiLCAiU2t5Ym94UnQiLCAiU2t5Ym94VXAiIH0KCQkJZm9yIGluZGV4LCBmYWNlIGluIGlwYWlycyhza3lGYWNlcykgZG8KCQkJCVNreVtmYWNlXSA9ICJyYnhhc3NldGlkOi8vIiAuLiBza3lib3hEYXRhW2luZGV4XQoJCQllbmQKCQkJTGlnaHRpbmcuR2xvYmFsU2hhZG93cyA9IGZhbHNlCgkJZW5kLAoJfSkKCWxvY2FsIEFiaWxpdHlFeHBsb2l0ID0gd29ybGQ6Y3JlYXRlX21vZHVsZSh7CgkJdGl0bGUgPSAiQWJpbGl0eSBFeHBsb2l0IiwKCQlmbGFnID0gIkFiaWxpdHlFeHBsb2l0IiwKCQlkZXNjcmlwdGlvbiA9ICJBYmlsaXR5IEV4cGxvaXQiLAoJCXNlY3Rpb24gPSAicmlnaHQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5BYmlsaXR5RXhwbG9pdCA9IHZhbHVlCgkJZW5kLAoJfSkKCUFiaWxpdHlFeHBsb2l0OmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiVGh1bmRlciBEYXNoIE5vIENvb2xkb3duIiwKCQlmbGFnID0gIlRodW5kZXJEYXNoTm9Db29sZG93biIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJZ2V0Z2VudigpLlRodW5kZXJEYXNoTm9Db29sZG93biA9IHZhbHVlCgkJCWlmIGdldGdlbnYoKS5BYmlsaXR5RXhwbG9pdCBhbmQgZ2V0Z2VudigpLlRodW5kZXJEYXNoTm9Db29sZG93biB0aGVuCgkJCQlsb2NhbCB0aHVuZGVyTW9kdWxlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCgkJCQkJOldhaXRGb3JDaGlsZCgiU2hhcmVkIikKCQkJCQk6V2FpdEZvckNoaWxkKCJBYmlsaXRpZXMiKQoJCQkJCTpXYWl0Rm9yQ2hpbGQoIlRodW5kZXIgRGFzaCIpCgkJCQlsb2NhbCBtb2QgPSByZXF1aXJlKHRodW5kZXJNb2R1bGUpCgkJCQltb2QuY29vbGRvd24gPSAwCgkJCQltb2QuY29vbGRvd25SZWR1Y3Rpb25QZXJVcGdyYWRlID0gMAoJCQllbmQKCQllbmQsCgl9KQoJQWJpbGl0eUV4cGxvaXQ6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJDb250aW51aXR5IFplcm8gRXhwbG9pdCIsCgkJZmxhZyA9ICJDb250aW51aXR5WmVyb0V4cGxvaXQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCWdldGdlbnYoKS5Db250aW51aXR5WmVyb0V4cGxvaXQgPSB2YWx1ZQoJCQlpZiBnZXRnZW52KCkuQWJpbGl0eUV4cGxvaXQgYW5kIGdldGdlbnYoKS5Db250aW51aXR5WmVyb0V4cGxvaXQgdGhlbgoJCQkJbG9jYWwgQ29udGludWl0eVplcm9SZW1vdGUgPQoJCQkJCWdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIlVzZUNvbnRpbnVpdHlQb3J0YWwiKQoJCQkJbG9jYWwgb2xkTmFtZWNhbGwKCQkJCW9sZE5hbWVjYWxsID0gaG9va21ldGFtZXRob2QoZ2FtZSwgIl9fbmFtZWNhbGwiLCBmdW5jdGlvbihzZWxmLCAuLi4pCgkJCQkJbG9jYWwgbWV0aG9kID0gZ2V0bmFtZWNhbGxtZXRob2QoKQoJCQkJCWlmIHNlbGYgPT0gQ29udGludWl0eVplcm9SZW1vdGUgYW5kIG1ldGhvZCA9PSAiRmlyZVNlcnZlciIgdGhlbgoJCQkJCQlyZXR1cm4gb2xkTmFtZWNhbGwoCgkJCQkJCQlzZWxmLAoJCQkJCQkJQ0ZyYW1lLm5ldyg5ZTE3LCA5ZTE2LCA5ZTE1LCA5ZTE0LCA5ZTEzLCA5ZTEyLCA5ZTExLCA5ZTEwLCA5ZTksIDllOCwgOWU3LCA5ZTYpLAoJCQkJCQkJcGxheWVyLk5hbWUKCQkJCQkJKQoJCQkJCWVuZAoJCQkJCXJldHVybiBvbGROYW1lY2FsbChzZWxmLCAuLi4pCgkJCQllbmQpCgkJCWVuZAoJCWVuZCwKCX0pCiAgICBsb2NhbCBpbW1vcnRhbGl0eSA9IG1pc2M6Y3JlYXRlX21vZHVsZSh7CiAgICB0aXRsZSA9ICJTZW1pIEltbW9ydGFsaXR5ICFCRVRBISIsCiAgICBmbGFnID0gIkltbW9ydGFsIiwKICAgIGRlc2NyaXB0aW9uID0gIkxldCdzIHlvdSBob2xkIHRoZSBiYWxsIE5PVCBGT1JFVkVSISIsCiAgICBzZWN0aW9uID0gIiIsCiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQpsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikKbG9jYWwgVGVsZXBvcnRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJUZWxlcG9ydFNlcnZpY2UiKQoKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIFBsYXllckd1aSA9IExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiUGxheWVyR3VpIikKCgppZiBQbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIkJhbGxzLmxvbCIpIHRoZW4KICAgIFBsYXllckd1aVsiQmFsbHMubG9sIl06RGVzdHJveSgpCmVuZAppZiBQbGF5ZXJHdWk6RmluZEZpcnN0Q2hpbGQoIlRvZ2dsZUd1aSIpIHRoZW4KICAgIFBsYXllckd1aVsiVG9nZ2xlR3VpIl06RGVzdHJveSgpCmVuZAoKCmxvY2FsIFNlbWlJbW1vcnRhbGl0eSA9IEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIikKU2VtaUltbW9ydGFsaXR5Lk5hbWUgPSAiU2VtaUltbW9ydGFsaXR5IgpTZW1pSW1tb3J0YWxpdHkuUGFyZW50ID0gUGxheWVyR3VpClNlbWlJbW1vcnRhbGl0eS5SZXNldE9uU3Bhd24gPSBUcnVlClNlbWlJbW1vcnRhbGl0eS5aSW5kZXhCZWhhdmlvciA9IEVudW0uWkluZGV4QmVoYXZpb3IuU2libGluZwoKbG9jYWwgSW1tb3J0YWxpdHkgPSBJbnN0YW5jZS5uZXcoIkZyYW1lIikKSW1tb3J0YWxpdHkuTmFtZSA9ICJJbW1vcnRhbGl0eSIKSW1tb3J0YWxpdHkuUGFyZW50ID0gU2VtaUltbW9ydGFsaXR5CkltbW9ydGFsaXR5LkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQig0MCwgNDAsIDQwKQpJbW1vcnRhbGl0eS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC4zCkltbW9ydGFsaXR5LkJvcmRlclNpemVQaXhlbCA9IDAKSW1tb3J0YWxpdHkuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4wNTcsIDAsIDAuMDc4LCAwKQpJbW1vcnRhbGl0eS5TaXplID0gVURpbTIubmV3KDAsIDEzOSwgMCwgODkpCgpsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQpVSUNvcm5lci5QYXJlbnQgPSBJbW1vcnRhbGl0eQoKbG9jYWwgVGl0bGUgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpClRpdGxlLk5hbWUgPSAiVGl0bGUiClRpdGxlLlBhcmVudCA9IEltbW9ydGFsaXR5ClRpdGxlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxClRpdGxlLlNpemUgPSBVRGltMi5uZXcoMCwgMTM5LCAwLCAyOSkKVGl0bGUuRm9udCA9IEVudW0uRm9udC5Tb3VyY2VTYW5zClRpdGxlLlRleHQgPSAiU2VtaSBJbW1vcnRhbCIKVGl0bGUuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpClRpdGxlLlRleHRTY2FsZWQgPSB0cnVlClRpdGxlLlRleHRXcmFwcGVkID0gdHJ1ZQoKbG9jYWwgUHJvbW90aW9uID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQpQcm9tb3Rpb24uTmFtZSA9ICJQcm9tb3Rpb24iClByb21vdGlvbi5QYXJlbnQgPSBJbW1vcnRhbGl0eQpQcm9tb3Rpb24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKUHJvbW90aW9uLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIC0wLjMyNSwgMCkKUHJvbW90aW9uLlNpemUgPSBVRGltMi5uZXcoMCwgMTM5LCAwLCAyOSkKUHJvbW90aW9uLkZvbnQgPSBFbnVtLkZvbnQuU291cmNlU2FucwpQcm9tb3Rpb24uVGV4dCA9ICJodHRwczovL2Rpc2NvcmQuZ2cvOGhqRVRHRG5WRSIKUHJvbW90aW9uLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQpQcm9tb3Rpb24uVGV4dFNjYWxlZCA9IHRydWUKUHJvbW90aW9uLlRleHRXcmFwcGVkID0gdHJ1ZQoKbG9jYWwgQWN0aXZhdGlvbiA9IEluc3RhbmNlLm5ldygiVGV4dEJ1dHRvbiIpCkFjdGl2YXRpb24uTmFtZSA9ICJBY3RpdmF0aW9uIgpBY3RpdmF0aW9uLlBhcmVudCA9IEltbW9ydGFsaXR5CkFjdGl2YXRpb24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKQWN0aXZhdGlvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAwLCAwLjMyNiwgMCkKQWN0aXZhdGlvbi5TaXplID0gVURpbTIubmV3KDAsIDEzOSwgMCwgNjApCkFjdGl2YXRpb24uRm9udCA9IEVudW0uRm9udC5Tb3VyY2VTYW5zCkFjdGl2YXRpb24uVGV4dCA9ICJPRkYiCkFjdGl2YXRpb24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMCwgMCkKQWN0aXZhdGlvbi5UZXh0U2NhbGVkID0gdHJ1ZQpBY3RpdmF0aW9uLlRleHRXcmFwcGVkID0gdHJ1ZQoKCmxvY2FsIGlzQWN0aXZlID0gZmFsc2UKbG9jYWwgZnVuY3Rpb24gdG9nZ2xlKCkKICAgIGlzQWN0aXZlID0gbm90IGlzQWN0aXZlCiAgICBpZiBpc0FjdGl2ZSB0aGVuCiAgICAgICAgQWN0aXZhdGlvbi5UZXh0ID0gIk9OIgogICAgICAgIEFjdGl2YXRpb24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDI1NSwgMCkKICAgIGVsc2UKICAgICAgICBBY3RpdmF0aW9uLlRleHQgPSAiT0ZGIgogICAgICAgIEFjdGl2YXRpb24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMCwgMCkKICAgIGVuZAplbmQKQWN0aXZhdGlvbi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KHRvZ2dsZSkKCgpkbwogICAgbG9jYWwgVHdlZW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKQoJCQkJbG9jYWwgVXNlcklucHV0U2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpCgoJCQkJbG9jYWwgZnVuY3Rpb24gbWFrZURyYWdnYWJsZShmcmFtZSkKCQkJCQlsb2NhbCBkcmFnZ2luZyA9IGZhbHNlCgkJCQkJbG9jYWwgZHJhZ0lucHV0LCBkcmFnU3RhcnQsIHN0YXJ0UG9zCgoJCQkJCWxvY2FsIGZ1bmN0aW9uIHVwZGF0ZShpbnB1dCkKCQkJCQkJbG9jYWwgZGVsdGEgPSBpbnB1dC5Qb3NpdGlvbiAtIGRyYWdTdGFydAoJCQkJCQlsb2NhbCBuZXdQb3MgPSBVRGltMi5uZXcoCgkJCQkJCQlzdGFydFBvcy5YLlNjYWxlLAoJCQkJCQkJc3RhcnRQb3MuWC5PZmZzZXQgKyBkZWx0YS5YLAoJCQkJCQkJc3RhcnRQb3MuWS5TY2FsZSwKCQkJCQkJCXN0YXJ0UG9zLlkuT2Zmc2V0ICsgZGVsdGEuWQoJCQkJCQkpCgkJCQkJCQoJCQkJCQlUd2VlblNlcnZpY2U6Q3JlYXRlKGZyYW1lLCBUd2VlbkluZm8ubmV3KDAuMiwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CgkJCQkJCQlQb3NpdGlvbiA9IG5ld1BvcwoJCQkJCQl9KTpQbGF5KCkKCQkJCQllbmQKCgkJCQkJZnJhbWUuQWN0aXZlID0gdHJ1ZQoJCQkJCWZyYW1lLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dCkKCQkJCQkJaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIHRoZW4KCQkJCQkJCWRyYWdnaW5nID0gdHJ1ZQoJCQkJCQkJZHJhZ1N0YXJ0ID0gaW5wdXQuUG9zaXRpb24KCQkJCQkJCXN0YXJ0UG9zID0gZnJhbWUuUG9zaXRpb24KCgkJCQkJCQlpbnB1dC5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJCQkJCWlmIGlucHV0LlVzZXJJbnB1dFN0YXRlID09IEVudW0uVXNlcklucHV0U3RhdGUuRW5kIHRoZW4KCQkJCQkJCQkJZHJhZ2dpbmcgPSBmYWxzZQoJCQkJCQkJCWVuZAoJCQkJCQkJZW5kKQoJCQkJCQllbmQKCQkJCQllbmQpCgoJCQkJCWZyYW1lLklucHV0Q2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKGlucHV0KQoJCQkJCQlpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZU1vdmVtZW50IHRoZW4KCQkJCQkJCWRyYWdJbnB1dCA9IGlucHV0CgkJCQkJCWVuZAoJCQkJCWVuZCkKCgkJCQkJVXNlcklucHV0U2VydmljZS5JbnB1dENoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihpbnB1dCkKCQkJCQkJaWYgaW5wdXQgPT0gZHJhZ0lucHV0IGFuZCBkcmFnZ2luZyB0aGVuCgkJCQkJCQl1cGRhdGUoaW5wdXQpCgkJCQkJCWVuZAoJCQkJCWVuZCkKCQkJCWVuZAoKCQkJCQoJCQkJbWFrZURyYWdnYWJsZShJbW1vcnRhbGl0eSkKCQkJZW5kCgoKbG9jYWwgZnVuY3Rpb24gUmFuZG9tTnVtYmVyUmFuZ2UoYSkKICAgIHJldHVybiBtYXRoLnJhbmRvbSgtYSAqIDkwMDAwMDA5MjkyOTI5Mzk5OTQ5OTQ5NDk2MDAwLCBhICogLTFlOSkgLyA1ZTgKZW5kCmxvY2FsIGZ1bmN0aW9uIFJhbmRvbVZlY3RvclJhbmdlKGEsIGIsIGMpCiAgICByZXR1cm4gVmVjdG9yMy5uZXcoUmFuZG9tTnVtYmVyUmFuZ2UoYSksIFJhbmRvbU51bWJlclJhbmdlKGIpLCBSYW5kb21OdW1iZXJSYW5nZShjKSkKZW5kCgoKbG9jYWwgRGVzeW5jVHlwZXMgPSB7fQoKClJ1blNlcnZpY2UuU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgIGlmIGlzQWN0aXZlIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0OlNldE5ldHdvcmtPd25lcihMb2NhbFBsYXllcikKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICBpZiBpc0FjdGl2ZSBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgRGVzeW5jVHlwZXNbMV0gPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICBEZXN5bmNUeXBlc1syXSA9IExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkFzc2VtYmx5TGluZWFyVmVsb2NpdHkKCiAgICAgICAgbG9jYWwgU3Bvb2ZUaGlzID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgbG9jYWwgaG9yaXpvbnRhbE9zY2lsbGF0aW9uID0gbWF0aC5zaW4odGljaygpICogNjApICogNTUKICAgICAgICBsb2NhbCB2ZXJ0aWNhbE9zY2lsbGF0aW9uID0gbWF0aC5zaW4odGljaygpICogMjUpICogMTUKICAgICAgICBTcG9vZlRoaXMgPSBTcG9vZlRoaXMgKiBDRnJhbWUubmV3KGhvcml6b250YWxPc2NpbGxhdGlvbiwgdmVydGljYWxPc2NpbGxhdGlvbiwgMCkgKiBDRnJhbWUuQW5nbGVzKAogICAgICAgICAgICBtYXRoLnJhZChSYW5kb21OdW1iZXJSYW5nZSgxMDAwKSksCiAgICAgICAgICAgIG1hdGgucmFkKFJhbmRvbU51bWJlclJhbmdlKDEwMDApKSwKICAgICAgICAgICAgbWF0aC5yYWQoUmFuZG9tTnVtYmVyUmFuZ2UoMTAwMCkpCiAgICAgICAgKQoKICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBTcG9vZlRoaXMKICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gRGVzeW5jVHlwZXNbMl0gKyBWZWN0b3IzLm5ldygKICAgICAgICAgICAgbWF0aC5jb3ModGljaygpICogOCkgKiA2MDAwLAogICAgICAgICAgICBtYXRoLmNvcyh0aWNrKCkgKiA4KSAqIDYwMDAsCiAgICAgICAgICAgIDAKICAgICAgICApCgogICAgICAgIFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpXYWl0KCkKCiAgICAgICAgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gRGVzeW5jVHlwZXNbMV0KICAgICAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gRGVzeW5jVHlwZXNbMl0KICAgIGVuZAplbmQpCgoKbG9jYWwgb2xkSW5kZXgKb2xkSW5kZXggPSBob29rbWV0YW1ldGhvZChnYW1lLCAiX19pbmRleCIsIG5ld2NjbG9zdXJlKGZ1bmN0aW9uKHNlbGYsIGtleSkKICAgIGlmIGlzQWN0aXZlIGFuZCBub3QgY2hlY2tjYWxsZXIoKSB0aGVuCiAgICAgICAgaWYga2V5ID09ICJDRnJhbWUiIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgaWYgc2VsZiA9PSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gRGVzeW5jVHlwZXNbMV0gb3IgQ0ZyYW1lLm5ldygpCiAgICAgICAgICAgIGVsc2VpZiBzZWxmID09IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBEZXN5bmNUeXBlc1sxXSBhbmQgRGVzeW5jVHlwZXNbMV0gKyBWZWN0b3IzLm5ldygwLCBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5TaXplIC8gMiArIDAuNSwgMCkgb3IgQ0ZyYW1lLm5ldygpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gb2xkSW5kZXgoc2VsZiwga2V5KQplbmQpKQogICAgZW5kLAp9KQoKbG9jYWwgaW1tb3J0YWxpdHl2MiA9IG1pc2M6Y3JlYXRlX21vZHVsZSh7CiAgICB0aXRsZSA9ICJTZW1pIEltbW9ydGFsaXR5IFYyICFCRVRBISIsCiAgICBmbGFnID0gIkltbW9ydGFsdjIiLAogICAgZGVzY3JpcHRpb24gPSAiTGV0J3MgeW91IGhvbGQgdGhlIGJhbGwgTk9UIEZPUkVWRVIhIiwKICAgIHNlY3Rpb24gPSAicmlnaHQiLAogICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICBsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKICAgICAgICBsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciBvciBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICAgICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQoKICAgICAgICBsb2NhbCB3b3Jrc3BhY2UgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpCiAgICAgICAgbG9jYWwgbWFwRm9sZGVyID0gd29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJNYXAiKQogICAgICAgIGlmIG5vdCBtYXBGb2xkZXIgdGhlbgogICAgICAgICAgICBtYXBGb2xkZXIgPSBJbnN0YW5jZS5uZXcoIkZvbGRlciIpCiAgICAgICAgICAgIG1hcEZvbGRlci5OYW1lID0gIk1hcCIKICAgICAgICAgICAgbWFwRm9sZGVyLlBhcmVudCA9IHdvcmtzcGFjZQogICAgICAgIGVuZAoKICAgICAKICAgICAgICBsb2NhbCBwbGF5ZXJQYXJ0ID0gd29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJQbGF5ZXJNYXBQYXJ0IikKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZW5hYmxlTWFwKCkKICAgICAgICAgICAgZm9yIF8sIG9iaiBpbiBwYWlycyhtYXBGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgIGlmIG9iajpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIG9iai5UcmFuc3BhcmVuY3kgPSAwLjUKICAgICAgICAgICAgICAgICAgICBvYmouQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3QgcGxheWVyUGFydCBvciBub3QgcGxheWVyUGFydC5QYXJlbnQgdGhlbgogICAgICAgICAgICAgICAgcGxheWVyUGFydCA9IEluc3RhbmNlLm5ldygiUGFydCIpCiAgICAgICAgICAgICAgICBwbGF5ZXJQYXJ0Lk5hbWUgPSAiUGxheWVyTWFwUGFydCIKICAgICAgICAgICAgICAgIHBsYXllclBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDUwMCwgMSwgNTAwKQogICAgICAgICAgICAgICAgcGxheWVyUGFydC5Qb3NpdGlvbiA9IGh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBWZWN0b3IzLm5ldygwLCAyMCwgMCkKICAgICAgICAgICAgICAgIHBsYXllclBhcnQuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBwbGF5ZXJQYXJ0Lk1hdGVyaWFsID0gRW51bS5NYXRlcmlhbC5TbW9vdGhQbGFzdGljCiAgICAgICAgICAgICAgICBwbGF5ZXJQYXJ0LkNvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIHBsYXllclBhcnQuUGFyZW50ID0gd29ya3NwYWNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBkaXNhYmxlTWFwKCkKICAgICAgICAgICAgZm9yIF8sIG9iaiBpbiBwYWlycyhtYXBGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgIGlmIG9iajpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIG9iai5UcmFuc3BhcmVuY3kgPSAwCiAgICAgICAgICAgICAgICAgICAgb2JqLkNhbkNvbGxpZGUgPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBwbGF5ZXJQYXJ0IGFuZCBwbGF5ZXJQYXJ0LlBhcmVudCB0aGVuCiAgICAgICAgICAgICAgICBwbGF5ZXJQYXJ0OkRlc3Ryb3koKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAKICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgIGVuYWJsZU1hcCgpCiAgICAgICAgZWxzZQogICAgICAgICAgICBkaXNhYmxlTWFwKCkKICAgICAgICBlbmQKICAgIGVuZCwKfSkKCgoJbG9jYWwgU2tpbkNoYW5nZXIgPSBtaXNjOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIlNraW4gQ2hhbmdlciIsCgkJZmxhZyA9ICJTa2luQ2hhbmdlciIsCgkJZGVzY3JpcHRpb24gPSAiU2tpbiBDaGFuZ2VyIiwKCQlzZWN0aW9uID0gImxlZnQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgkJCWdldGdlbnYoKS5za2luQ2hhbmdlciA9IHZhbHVlCgkJCWlmIHZhbHVlIHRoZW4KCQkJCWdldGdlbnYoKS51cGRhdGVTd29yZCgpCgkJCWVuZAoJCWVuZCwKCX0pCglTa2luQ2hhbmdlcjpjaGFuZ2Vfc3RhdGUoZmFsc2UpCglTa2luQ2hhbmdlcjpjcmVhdGVfcGFyYWdyYXBoKHsKCQl0aXRsZSA9ICJFdmVyeW9uZSBjYW4gc2VlIGFuaW1hdGlvbnMiLAoJCXRleHQgPSAiIiwKCX0pCglsb2NhbCBza2luY2hhbmdlcnRleHRib3ggPSBTa2luQ2hhbmdlcjpjcmVhdGVfdGV4dGJveCh7CgkJdGl0bGUgPSAi77+sIFNraW4gTmFtZSAoQ2FzZSBTZW5zaXRpdmUpIO+/rCIsCgkJcGxhY2Vob2xkZXIgPSAiRW50ZXIgU3dvcmQgU2tpbiBOYW1lLi4uICIsCgkJZmxhZyA9ICJTa2luQ2hhbmdlclRleHRib3giLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odGV4dCkKCQkJZ2V0Z2VudigpLnN3b3JkTW9kZWwgPSB0ZXh0CgkJCWdldGdlbnYoKS5zd29yZEFuaW1hdGlvbnMgPSB0ZXh0CgkJCWdldGdlbnYoKS5zd29yZEZYID0gdGV4dAoJCQlpZiBnZXRnZW52KCkuc2tpbkNoYW5nZXIgdGhlbgoJCQkJZ2V0Z2VudigpLnVwZGF0ZVN3b3JkKCkKCQkJZW5kCgkJZW5kLAoJfSkKCWxvY2FsIEF1dG9QbGF5TW9kdWxlID0ge30KCUF1dG9QbGF5TW9kdWxlLkNPTkZJRyA9IHsKCQlERUZBVUxUX0RJU1RBTkNFID0gMzAsCgkJTVVMVElQTElFUl9USFJFU0hPTEQgPSA3MCwKCQlUUkFWRVJTSU5HID0gMjUsCgkJRElSRUNUSU9OID0gMSwKCQlKVU1QX1BFUkNFTlRBR0UgPSA1MCwKCQlET1VCTEVfSlVNUF9QRVJDRU5UQUdFID0gNTAsCgkJSlVNUElOR19FTkFCTEVEID0gZmFsc2UsCgkJTU9WRU1FTlRfRFVSQVRJT04gPSAwLjgsCgkJT0ZGU0VUX0ZBQ1RPUiA9IDAuNywKCQlHRU5FUkFUSU9OX1RIUkVTSE9MRCA9IDAuMjUsCgl9CglBdXRvUGxheU1vZHVsZS5iYWxsID0gbmlsCglBdXRvUGxheU1vZHVsZS5sb2JieUNob2ljZSA9IG5pbAoJQXV0b1BsYXlNb2R1bGUuYW5pbWF0aW9uQ2FjaGUgPSBuaWwKCUF1dG9QbGF5TW9kdWxlLmRvdWJsZUp1bXBlZCA9IGZhbHNlCglBdXRvUGxheU1vZHVsZS5FTEFQU0VEID0gMAoJQXV0b1BsYXlNb2R1bGUuQ09OVFJPTF9QT0lOVCA9IG5pbAoJQXV0b1BsYXlNb2R1bGUuTEFTVF9HRU5FUkFUSU9OID0gMAoJQXV0b1BsYXlNb2R1bGUuc2lnbmFscyA9IHt9CglkbwoJCWxvY2FsIGdldFNlcnZpY2VGdW5jdGlvbiA9IGdhbWUuR2V0U2VydmljZQoJCWxvY2FsIGZ1bmN0aW9uIGdldENsb25lcmVmUGVybWlzc2lvbigpCgkJCWxvY2FsIHBlcm1pc3Npb24gPSBjbG9uZXJlZihnZXRTZXJ2aWNlRnVuY3Rpb24oZ2FtZSwgIlJlcGxpY2F0ZWRGaXJzdCIpKQoJCQlyZXR1cm4gcGVybWlzc2lvbgoJCWVuZAoJCUF1dG9QbGF5TW9kdWxlLmNsb25lcmVmUGVybWlzc2lvbiA9IGdldENsb25lcmVmUGVybWlzc2lvbigpCgkJaWYgbm90IEF1dG9QbGF5TW9kdWxlLmNsb25lcmVmUGVybWlzc2lvbiB0aGVuCgkJCXdhcm4oImNsb25lcmVmIGlzIG5vdCBhdmFpbGFibGUgb24geW91ciBleGVjdXRvciEgVGhlcmUgaXMgYSByaXNrIG9mIGdldHRpbmcgZGV0ZWN0ZWQuIikKCQllbmQKCQlmdW5jdGlvbiBBdXRvUGxheU1vZHVsZS5maW5kQ2FjaGVkU2VydmljZShzZWxmLCBuYW1lKQoJCQlmb3IgaW5kZXgsIHZhbHVlIGluIHNlbGYgZG8KCQkJCWlmIHZhbHVlLk5hbWUgPT0gbmFtZSB0aGVuCgkJCQkJcmV0dXJuIHZhbHVlCgkJCQllbmQKCQkJZW5kCgkJCXJldHVybgoJCWVuZAoJCWZ1bmN0aW9uIEF1dG9QbGF5TW9kdWxlLmdldFNlcnZpY2Uoc2VsZiwgbmFtZSkKCQkJbG9jYWwgY2FjaGVkU2VydmljZSA9IEF1dG9QbGF5TW9kdWxlLmZpbmRDYWNoZWRTZXJ2aWNlKHNlbGYsIG5hbWUpCgkJCWlmIGNhY2hlZFNlcnZpY2UgdGhlbgoJCQkJcmV0dXJuIGNhY2hlZFNlcnZpY2UKCQkJZW5kCgkJCWxvY2FsIHNlcnZpY2UgPSBnZXRTZXJ2aWNlRnVuY3Rpb24oZ2FtZSwgbmFtZSkKCQkJaWYgQXV0b1BsYXlNb2R1bGUuY2xvbmVyZWZQZXJtaXNzaW9uIHRoZW4KCQkJCXNlcnZpY2UgPSBjbG9uZXJlZihzZXJ2aWNlKQoJCQllbmQKCQkJdGFibGUuaW5zZXJ0KHNlbGYsIHNlcnZpY2UpCgkJCXJldHVybiBzZXJ2aWNlCgkJZW5kCgkJQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZSA9IHNldG1ldGF0YWJsZSh7fSwgewoJCQlfX2luZGV4ID0gQXV0b1BsYXlNb2R1bGUuZ2V0U2VydmljZSwKCQl9KQoJZW5kCglBdXRvUGxheU1vZHVsZS5wbGF5ZXJIZWxwZXIgPSB7CgkJaXNBbGl2ZSA9IGZ1bmN0aW9uKHBsYXllcikKCQkJbG9jYWwgY2hhcmFjdGVyID0gbmlsCgkJCWlmIHBsYXllciBhbmQgcGxheWVyOklzQSgiUGxheWVyIikgdGhlbgoJCQkJY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgoJCQllbmQKCQkJaWYgbm90IGNoYXJhY3RlciB0aGVuCgkJCQlyZXR1cm4gZmFsc2UKCQkJZW5kCgkJCWxvY2FsIHJvb3RQYXJ0ID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKCQkJbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKCQkJaWYgbm90IHJvb3RQYXJ0IG9yIG5vdCBodW1hbm9pZCB0aGVuCgkJCQlyZXR1cm4gZmFsc2UKCQkJZW5kCgkJCXJldHVybiBodW1hbm9pZC5IZWFsdGggPiAwCgkJZW5kLAoJCWluTG9iYnkgPSBmdW5jdGlvbihjaGFyYWN0ZXIpCgkJCWlmIG5vdCBjaGFyYWN0ZXIgdGhlbgoJCQkJcmV0dXJuIGZhbHNlCgkJCWVuZAoJCQlyZXR1cm4gY2hhcmFjdGVyLlBhcmVudCA9PSBBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLldvcmtzcGFjZS5EZWFkCgkJZW5kLAoJCW9uR3JvdW5kID0gZnVuY3Rpb24oY2hhcmFjdGVyKQoJCQlpZiBub3QgY2hhcmFjdGVyIHRoZW4KCQkJCXJldHVybiBmYWxzZQoJCQllbmQKCQkJcmV0dXJuIGNoYXJhY3Rlci5IdW1hbm9pZC5GbG9vck1hdGVyaWFsIH49IEVudW0uTWF0ZXJpYWwuQWlyCgkJZW5kLAoJfQoJZnVuY3Rpb24gQXV0b1BsYXlNb2R1bGUuaXNMaW1pdGVkKCkKCQlsb2NhbCBwYXNzZWRUaW1lID0gdGljaygpIC0gQXV0b1BsYXlNb2R1bGUuTEFTVF9HRU5FUkFUSU9OCgkJcmV0dXJuIHBhc3NlZFRpbWUgPCBBdXRvUGxheU1vZHVsZS5DT05GSUcuR0VORVJBVElPTl9USFJFU0hPTEQKCWVuZAoJZnVuY3Rpb24gQXV0b1BsYXlNb2R1bGUucGVyY2VudGFnZUNoZWNrKGxpbWl0KQoJCWlmIEF1dG9QbGF5TW9kdWxlLmlzTGltaXRlZCgpIHRoZW4KCQkJcmV0dXJuIGZhbHNlCgkJZW5kCgkJbG9jYWwgcGVyY2VudGFnZSA9IG1hdGgucmFuZG9tKDEwMCkKCQlBdXRvUGxheU1vZHVsZS5MQVNUX0dFTkVSQVRJT04gPSB0aWNrKCkKCQlyZXR1cm4gbGltaXQgPj0gcGVyY2VudGFnZQoJZW5kCglBdXRvUGxheU1vZHVsZS5iYWxsVXRpbHMgPSB7CgkJZ2V0QmFsbCA9IGZ1bmN0aW9uKCkKCQkJZm9yIF8sIG9iamVjdCBpbiBBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLldvcmtzcGFjZS5CYWxsczpHZXRDaGlsZHJlbigpIGRvCgkJCQlpZiBvYmplY3Q6R2V0QXR0cmlidXRlKCJyZWFsQmFsbCIpIHRoZW4KCQkJCQlBdXRvUGxheU1vZHVsZS5iYWxsID0gb2JqZWN0CgkJCQkJcmV0dXJuCgkJCQllbmQKCQkJZW5kCgkJCUF1dG9QbGF5TW9kdWxlLmJhbGwgPSBuaWwKCQllbmQsCgkJZ2V0RGlyZWN0aW9uID0gZnVuY3Rpb24oKQoJCQlpZiBub3QgQXV0b1BsYXlNb2R1bGUuYmFsbCB0aGVuCgkJCQlyZXR1cm4KCQkJZW5kCgkJCWxvY2FsIGRpcmVjdGlvbiA9ICgKCQkJCUF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgoJCQkJLSBBdXRvUGxheU1vZHVsZS5iYWxsLlBvc2l0aW9uCgkJCSkuVW5pdAoJCQlyZXR1cm4gZGlyZWN0aW9uCgkJZW5kLAoJCWdldFZlbG9jaXR5ID0gZnVuY3Rpb24oKQoJCQlpZiBub3QgQXV0b1BsYXlNb2R1bGUuYmFsbCB0aGVuCgkJCQlyZXR1cm4KCQkJZW5kCgkJCWxvY2FsIHpvb21pZXMgPSBBdXRvUGxheU1vZHVsZS5iYWxsOkZpbmRGaXJzdENoaWxkKCJ6b29taWVzIikKCQkJaWYgbm90IHpvb21pZXMgdGhlbgoJCQkJcmV0dXJuCgkJCWVuZAoJCQlyZXR1cm4gem9vbWllcy5WZWN0b3JWZWxvY2l0eQoJCWVuZCwKCQlnZXRTcGVlZCA9IGZ1bmN0aW9uKCkKCQkJbG9jYWwgdmVsb2NpdHkgPSBBdXRvUGxheU1vZHVsZS5iYWxsVXRpbHMuZ2V0VmVsb2NpdHkoKQoJCQlpZiBub3QgdmVsb2NpdHkgdGhlbgoJCQkJcmV0dXJuCgkJCWVuZAoJCQlyZXR1cm4gdmVsb2NpdHkuTWFnbml0dWRlCgkJZW5kLAoJCWlzRXhpc3RpbmcgPSBmdW5jdGlvbigpCgkJCXJldHVybiBBdXRvUGxheU1vZHVsZS5iYWxsIH49IG5pbAoJCWVuZCwKCX0KCUF1dG9QbGF5TW9kdWxlLmxlcnAgPSBmdW5jdGlvbihzdGFydCwgZmluaXNoLCBhbHBoYSkKCQlyZXR1cm4gc3RhcnQgKyAoZmluaXNoIC0gc3RhcnQpICogYWxwaGEKCWVuZAoJQXV0b1BsYXlNb2R1bGUucXVhZHJhdGljID0gZnVuY3Rpb24oc3RhcnQsIG1pZGRsZSwgZmluaXNoLCBhbHBoYSkKCQlsb2NhbCBmaXJzdExlcnAgPSBBdXRvUGxheU1vZHVsZS5sZXJwKHN0YXJ0LCBtaWRkbGUsIGFscGhhKQoJCWxvY2FsIHNlY29uZExlcnAgPSBBdXRvUGxheU1vZHVsZS5sZXJwKG1pZGRsZSwgZmluaXNoLCBhbHBoYSkKCQlyZXR1cm4gQXV0b1BsYXlNb2R1bGUubGVycChmaXJzdExlcnAsIHNlY29uZExlcnAsIGFscGhhKQoJZW5kCglBdXRvUGxheU1vZHVsZS5nZXRDYW5kaWRhdGVzID0gZnVuY3Rpb24obWlkZGxlLCB0aGV0YSwgb2Zmc2V0TGVuZ3RoKQoJCWxvY2FsIGZpcnN0Q2FuZGl0YXRlWCA9IG1hdGguY29zKHRoZXRhICsgbWF0aC5waSAvIDIpCgkJbG9jYWwgZmlyc3RDYW5kaXRhdGVaID0gbWF0aC5zaW4odGhldGEgKyBtYXRoLnBpIC8gMikKCQlsb2NhbCBmaXJzdENhbmRpZGF0ZSA9IG1pZGRsZSArIFZlY3RvcjMubmV3KGZpcnN0Q2FuZGl0YXRlWCwgMCwgZmlyc3RDYW5kaXRhdGVaKSAqIG9mZnNldExlbmd0aAoJCWxvY2FsIHNlY29uZENhbmRpdGF0ZVggPSBtYXRoLmNvcyh0aGV0YSAtIG1hdGgucGkgLyAyKQoJCWxvY2FsIHNlY29uZENhbmRpdGF0ZVogPSBtYXRoLnNpbih0aGV0YSAtIG1hdGgucGkgLyAyKQoJCWxvY2FsIHNlY29uZENhbmRpZGF0ZSA9IG1pZGRsZSArIFZlY3RvcjMubmV3KHNlY29uZENhbmRpdGF0ZVgsIDAsIHNlY29uZENhbmRpdGF0ZVopICogb2Zmc2V0TGVuZ3RoCgkJcmV0dXJuIGZpcnN0Q2FuZGlkYXRlLCBzZWNvbmRDYW5kaWRhdGUKCWVuZAoJQXV0b1BsYXlNb2R1bGUuZ2V0Q29udHJvbFBvaW50ID0gZnVuY3Rpb24oc3RhcnQsIGZpbmlzaCkKCQlsb2NhbCBtaWRkbGUgPSAoc3RhcnQgKyBmaW5pc2gpICogMC41CgkJbG9jYWwgZGlmZmVyZW5jZSA9IHN0YXJ0IC0gZmluaXNoCgkJaWYgZGlmZmVyZW5jZS5NYWduaXR1ZGUgPCA1IHRoZW4KCQkJcmV0dXJuIGZpbmlzaAoJCWVuZAoJCWxvY2FsIHRoZXRhID0gbWF0aC5hdGFuMihkaWZmZXJlbmNlLlosIGRpZmZlcmVuY2UuWCkKCQlsb2NhbCBvZmZzZXRMZW5ndGggPSBkaWZmZXJlbmNlLk1hZ25pdHVkZSAqIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5PRkZTRVRfRkFDVE9SCgkJbG9jYWwgZmlyc3RDYW5kaWRhdGUsIHNlY29uZENhbmRpZGF0ZSA9IEF1dG9QbGF5TW9kdWxlLmdldENhbmRpZGF0ZXMobWlkZGxlLCB0aGV0YSwgb2Zmc2V0TGVuZ3RoKQoJCWxvY2FsIGRvdFZhbHVlID0gc3RhcnQgLSBtaWRkbGUKCQlpZiAoZmlyc3RDYW5kaWRhdGUgLSBtaWRkbGUpOkRvdChkb3RWYWx1ZSkgPCAwIHRoZW4KCQkJcmV0dXJuIGZpcnN0Q2FuZGlkYXRlCgkJZWxzZQoJCQlyZXR1cm4gc2Vjb25kQ2FuZGlkYXRlCgkJZW5kCgllbmQKCUF1dG9QbGF5TW9kdWxlLmdldEN1cnZlID0gZnVuY3Rpb24oc3RhcnQsIGZpbmlzaCwgZGVsdGEpCgkJQXV0b1BsYXlNb2R1bGUuRUxBUFNFRCA9IEF1dG9QbGF5TW9kdWxlLkVMQVBTRUQgKyBkZWx0YQoJCWxvY2FsIHRpbWVFbGFwc2VkID0gbWF0aC5jbGFtcChBdXRvUGxheU1vZHVsZS5FTEFQU0VEIC8gQXV0b1BsYXlNb2R1bGUuQ09ORklHLk1PVkVNRU5UX0RVUkFUSU9OLCAwLCAxKQoJCWlmIHRpbWVFbGFwc2VkID49IDEgdGhlbgoJCQlsb2NhbCBkaXN0YW5jZSA9IChzdGFydCAtIGZpbmlzaCkuTWFnbml0dWRlCgkJCWlmIGRpc3RhbmNlID49IDEwIHRoZW4KCQkJCUF1dG9QbGF5TW9kdWxlLkVMQVBTRUQgPSAwCgkJCWVuZAoJCQlBdXRvUGxheU1vZHVsZS5DT05UUk9MX1BPSU5UID0gbmlsCgkJCXJldHVybiBmaW5pc2gKCQllbmQKCQlpZiBub3QgQXV0b1BsYXlNb2R1bGUuQ09OVFJPTF9QT0lOVCB0aGVuCgkJCUF1dG9QbGF5TW9kdWxlLkNPTlRST0xfUE9JTlQgPSBBdXRvUGxheU1vZHVsZS5nZXRDb250cm9sUG9pbnQoc3RhcnQsIGZpbmlzaCkKCQllbmQKCQlhc3NlcnQoQXV0b1BsYXlNb2R1bGUuQ09OVFJPTF9QT0lOVCwgIkNPTlRST0xfUE9JTlQ6IFZlY3RvcjMgZXhwZWN0ZWQsIGdvdCBuaWwiKQoJCXJldHVybiBBdXRvUGxheU1vZHVsZS5xdWFkcmF0aWMoc3RhcnQsIEF1dG9QbGF5TW9kdWxlLkNPTlRST0xfUE9JTlQsIGZpbmlzaCwgdGltZUVsYXBzZWQpCgllbmQKCUF1dG9QbGF5TW9kdWxlLm1hcCA9IHsKCQlnZXRGbG9vciA9IGZ1bmN0aW9uKCkKCQkJbG9jYWwgZmxvb3IgPSBBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLldvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiRkxPT1IiKQoJCQlpZiBub3QgZmxvb3IgdGhlbgoJCQkJZm9yIF8sIHBhcnQgaW4gcGFpcnMoQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5Xb3Jrc3BhY2U6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCQlpZiBwYXJ0OklzQSgiTWVzaFBhcnQiKSBvciBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCgkJCQkJCWxvY2FsIHNpemUgPSBwYXJ0LlNpemUKCQkJCQkJaWYgc2l6ZS5YID4gNTAgYW5kIHNpemUuWiA+IDUwIGFuZCBwYXJ0LlBvc2l0aW9uLlkgPCA1IHRoZW4KCQkJCQkJCXJldHVybiBwYXJ0CgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCQlyZXR1cm4gZmxvb3IKCQllbmQsCgl9CglBdXRvUGxheU1vZHVsZS5nZXRSYW5kb21Qb3NpdGlvbiA9IGZ1bmN0aW9uKCkKCQlsb2NhbCBmbG9vciA9IEF1dG9QbGF5TW9kdWxlLm1hcC5nZXRGbG9vcigpCgkJaWYgbm90IGZsb29yIG9yIG5vdCBBdXRvUGxheU1vZHVsZS5iYWxsVXRpbHMuaXNFeGlzdGluZygpIHRoZW4KCQkJcmV0dXJuCgkJZW5kCgkJbG9jYWwgYmFsbERpcmVjdGlvbiA9IEF1dG9QbGF5TW9kdWxlLmJhbGxVdGlscy5nZXREaXJlY3Rpb24oKSAqIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5ESVJFQ1RJT04KCQlsb2NhbCBiYWxsU3BlZWQgPSBBdXRvUGxheU1vZHVsZS5iYWxsVXRpbHMuZ2V0U3BlZWQoKQoJCWxvY2FsIHNwZWVkVGhyZXNob2xkID0gbWF0aC5taW4oYmFsbFNwZWVkIC8gMTAsIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5NVUxUSVBMSUVSX1RIUkVTSE9MRCkKCQlsb2NhbCBzcGVlZE11bHRpcGxpZXIgPSBBdXRvUGxheU1vZHVsZS5DT05GSUcuREVGQVVMVF9ESVNUQU5DRSArIHNwZWVkVGhyZXNob2xkCgkJbG9jYWwgbmVnYXRpdmVEaXJlY3Rpb24gPSBiYWxsRGlyZWN0aW9uICogc3BlZWRNdWx0aXBsaWVyCgkJbG9jYWwgY3VycmVudFRpbWUgPSBvcy50aW1lKCkgLyAxLjIKCQlsb2NhbCBzaW5lID0gbWF0aC5zaW4oY3VycmVudFRpbWUpICogQXV0b1BsYXlNb2R1bGUuQ09ORklHLlRSQVZFUlNJTkcKCQlsb2NhbCBjb3NpbmUgPSBtYXRoLmNvcyhjdXJyZW50VGltZSkgKiBBdXRvUGxheU1vZHVsZS5DT05GSUcuVFJBVkVSU0lORwoJCWxvY2FsIHRyYXZlcnNpbmcgPSBWZWN0b3IzLm5ldyhzaW5lLCAwLCBjb3NpbmUpCgkJbG9jYWwgZmluYWxQb3NpdGlvbiA9IGZsb29yLlBvc2l0aW9uICsgbmVnYXRpdmVEaXJlY3Rpb24gKyB0cmF2ZXJzaW5nCgkJcmV0dXJuIGZpbmFsUG9zaXRpb24KCWVuZAoJQXV0b1BsYXlNb2R1bGUubG9iYnkgPSB7CgkJaXNDaG9vc2VyQXZhaWxhYmxlID0gZnVuY3Rpb24oKQoJCQlyZXR1cm4gQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5Xb3Jrc3BhY2UuU3Bhd24uTmV3UGxheWVyQ291bnRlci5HVUkuU3VyZmFjZUd1aS5Ub3AuT3B0aW9ucy5WaXNpYmxlCgkJZW5kLAoJCXVwZGF0ZUNob2ljZSA9IGZ1bmN0aW9uKGNob2ljZSkKCQkJQXV0b1BsYXlNb2R1bGUubG9iYnlDaG9pY2UgPSBjaG9pY2UKCQllbmQsCgkJZ2V0TWFwQ2hvaWNlID0gZnVuY3Rpb24oKQoJCQlsb2NhbCBjaG9pY2UgPSBBdXRvUGxheU1vZHVsZS5sb2JieUNob2ljZSBvciBtYXRoLnJhbmRvbSgxLCAzKQoJCQlsb2NhbCBjb2xsaWRlciA9CgkJCQlBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLldvcmtzcGFjZS5TcGF3bi5OZXdQbGF5ZXJDb3VudGVyLkNvbGxpZGVyczpGaW5kRmlyc3RDaGlsZChjaG9pY2UpCgkJCXJldHVybiBjb2xsaWRlcgoJCWVuZCwKCQlnZXRQYWRQb3NpdGlvbiA9IGZ1bmN0aW9uKCkKCQkJaWYgbm90IEF1dG9QbGF5TW9kdWxlLmxvYmJ5LmlzQ2hvb3NlckF2YWlsYWJsZSgpIHRoZW4KCQkJCUF1dG9QbGF5TW9kdWxlLmxvYmJ5Q2hvaWNlID0gbmlsCgkJCQlyZXR1cm4KCQkJZW5kCgkJCWxvY2FsIGNob2ljZSA9IEF1dG9QbGF5TW9kdWxlLmxvYmJ5LmdldE1hcENob2ljZSgpCgkJCWlmIG5vdCBjaG9pY2UgdGhlbgoJCQkJcmV0dXJuCgkJCWVuZAoJCQlyZXR1cm4gY2hvaWNlLlBvc2l0aW9uLCBjaG9pY2UuTmFtZQoJCWVuZCwKCX0KCUF1dG9QbGF5TW9kdWxlLm1vdmVtZW50ID0gewoJCXJlbW92ZUNhY2hlID0gZnVuY3Rpb24oKQoJCQlpZiBBdXRvUGxheU1vZHVsZS5hbmltYXRpb25DYWNoZSB0aGVuCgkJCQlBdXRvUGxheU1vZHVsZS5hbmltYXRpb25DYWNoZSA9IG5pbAoJCQllbmQKCQllbmQsCgkJY3JlYXRlSnVtcFZlbG9jaXR5ID0gZnVuY3Rpb24ocGxheWVyKQoJCQlsb2NhbCBtYXhGb3JjZSA9IG1hdGguaHVnZQoJCQlsb2NhbCB2ZWxvY2l0eSA9IEluc3RhbmNlLm5ldygiQm9keVZlbG9jaXR5IikKCQkJdmVsb2NpdHkuTWF4Rm9yY2UgPSBWZWN0b3IzLm5ldyhtYXhGb3JjZSwgbWF4Rm9yY2UsIG1heEZvcmNlKQoJCQl2ZWxvY2l0eS5WZWxvY2l0eSA9IFZlY3RvcjMubmV3KDAsIDgwLCAwKQoJCQl2ZWxvY2l0eS5QYXJlbnQgPSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQKCQkJQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5EZWJyaXM6QWRkSXRlbSh2ZWxvY2l0eSwgMC4wMDEpCgkJCUF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Eb3VibGVKdW1wOkZpcmVTZXJ2ZXIoKQoJCWVuZCwKCQlwbGF5SnVtcEFuaW1hdGlvbiA9IGZ1bmN0aW9uKHBsYXllcikKCQkJaWYgbm90IEF1dG9QbGF5TW9kdWxlLmFuaW1hdGlvbkNhY2hlIHRoZW4KCQkJCWxvY2FsIGRvdWJsZUp1bXBBbmltYXRpb24gPQoJCQkJCUF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUmVwbGljYXRlZFN0b3JhZ2UuQXNzZXRzLlR1dG9yaWFsLkFuaW1hdGlvbnMuRG91YmxlSnVtcAoJCQkJQXV0b1BsYXlNb2R1bGUuYW5pbWF0aW9uQ2FjaGUgPSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkFuaW1hdG9yOkxvYWRBbmltYXRpb24oZG91YmxlSnVtcEFuaW1hdGlvbikKCQkJZW5kCgkJCWlmIEF1dG9QbGF5TW9kdWxlLmFuaW1hdGlvbkNhY2hlIHRoZW4KCQkJCUF1dG9QbGF5TW9kdWxlLmFuaW1hdGlvbkNhY2hlOlBsYXkoKQoJCQllbmQKCQllbmQsCgkJZG91YmxlSnVtcCA9IGZ1bmN0aW9uKHBsYXllcikKCQkJaWYgQXV0b1BsYXlNb2R1bGUuZG91YmxlSnVtcGVkIHRoZW4KCQkJCXJldHVybgoJCQllbmQKCQkJaWYgbm90IEF1dG9QbGF5TW9kdWxlLnBlcmNlbnRhZ2VDaGVjayhBdXRvUGxheU1vZHVsZS5DT05GSUcuRE9VQkxFX0pVTVBfUEVSQ0VOVEFHRSkgdGhlbgoJCQkJcmV0dXJuCgkJCWVuZAoJCQlBdXRvUGxheU1vZHVsZS5kb3VibGVKdW1wZWQgPSB0cnVlCgkJCUF1dG9QbGF5TW9kdWxlLm1vdmVtZW50LmNyZWF0ZUp1bXBWZWxvY2l0eShwbGF5ZXIpCgkJCUF1dG9QbGF5TW9kdWxlLm1vdmVtZW50LnBsYXlKdW1wQW5pbWF0aW9uKHBsYXllcikKCQllbmQsCgkJanVtcCA9IGZ1bmN0aW9uKHBsYXllcikKCQkJaWYgbm90IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5KVU1QSU5HX0VOQUJMRUQgdGhlbgoJCQkJcmV0dXJuCgkJCWVuZAoJCQlpZiBub3QgQXV0b1BsYXlNb2R1bGUucGxheWVySGVscGVyLm9uR3JvdW5kKHBsYXllci5DaGFyYWN0ZXIpIHRoZW4KCQkJCUF1dG9QbGF5TW9kdWxlLm1vdmVtZW50LmRvdWJsZUp1bXAocGxheWVyKQoJCQkJcmV0dXJuCgkJCWVuZAoJCQlpZiBub3QgQXV0b1BsYXlNb2R1bGUucGVyY2VudGFnZUNoZWNrKEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5KVU1QX1BFUkNFTlRBR0UpIHRoZW4KCQkJCXJldHVybgoJCQllbmQKCQkJQXV0b1BsYXlNb2R1bGUuZG91YmxlSnVtcGVkID0gZmFsc2UKCQkJcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkp1bXBpbmcpCgkJZW5kLAoJCW1vdmUgPSBmdW5jdGlvbihwbGF5ZXIsIHBsYXllclBvc2l0aW9uKQoJCQlwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmVUbyhwbGF5ZXJQb3NpdGlvbikKCQllbmQsCgkJc3RvcCA9IGZ1bmN0aW9uKHBsYXllcikKCQkJbG9jYWwgcGxheWVyUG9zaXRpb24gPSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24KCQkJcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlVG8ocGxheWVyUG9zaXRpb24pCgkJZW5kLAoJfQoJQXV0b1BsYXlNb2R1bGUuc2lnbmFsID0gewoJCWNvbm5lY3QgPSBmdW5jdGlvbihuYW1lLCBjb25uZWN0aW9uLCBjYWxsYmFjaykKCQkJaWYgbm90IG5hbWUgdGhlbgoJCQkJbmFtZSA9IEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuSHR0cFNlcnZpY2U6R2VuZXJhdGVHVUlEKCkKCQkJZW5kCgkJCUF1dG9QbGF5TW9kdWxlLnNpZ25hbHNbbmFtZV0gPSBjb25uZWN0aW9uOkNvbm5lY3QoY2FsbGJhY2spCgkJCXJldHVybiBBdXRvUGxheU1vZHVsZS5zaWduYWxzW25hbWVdCgkJZW5kLAoJCWRpc2Nvbm5lY3QgPSBmdW5jdGlvbihuYW1lKQoJCQlpZiBub3QgbmFtZSBvciBub3QgQXV0b1BsYXlNb2R1bGUuc2lnbmFsc1tuYW1lXSB0aGVuCgkJCQlyZXR1cm4KCQkJZW5kCgkJCUF1dG9QbGF5TW9kdWxlLnNpZ25hbHNbbmFtZV06RGlzY29ubmVjdCgpCgkJCUF1dG9QbGF5TW9kdWxlLnNpZ25hbHNbbmFtZV0gPSBuaWwKCQllbmQsCgkJc3RvcCA9IGZ1bmN0aW9uKCkKCQkJZm9yIG5hbWUsIGNvbm5lY3Rpb24gaW4gcGFpcnMoQXV0b1BsYXlNb2R1bGUuc2lnbmFscykgZG8KCQkJCWlmIHR5cGVvZihjb25uZWN0aW9uKSB+PSAiUkJYU2NyaXB0Q29ubmVjdGlvbiIgdGhlbgoJCQkJCWNvbnRpbnVlCgkJCQllbmQKCQkJCWNvbm5lY3Rpb246RGlzY29ubmVjdCgpCgkJCQlBdXRvUGxheU1vZHVsZS5zaWduYWxzW25hbWVdID0gbmlsCgkJCWVuZAoJCWVuZCwKCX0KCUF1dG9QbGF5TW9kdWxlLmZpbmRQYXRoID0gZnVuY3Rpb24oaW5Mb2JieSwgZGVsdGEpCgkJbG9jYWwgcm9vdFBvc2l0aW9uID0gQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uCgkJaWYgaW5Mb2JieSB0aGVuCgkJCWxvY2FsIHBhZFBvc2l0aW9uLCBwYWROdW1iZXIgPSBBdXRvUGxheU1vZHVsZS5sb2JieS5nZXRQYWRQb3NpdGlvbigpCgkJCWxvY2FsIGNob2ljZSA9IHRvbnVtYmVyKHBhZE51bWJlcikKCQkJaWYgY2hvaWNlIHRoZW4KCQkJCUF1dG9QbGF5TW9kdWxlLmxvYmJ5LnVwZGF0ZUNob2ljZShjaG9pY2UpCgkJCQlpZiBnZXRnZW52KCkuQXV0b1ZvdGUgdGhlbgoJCQkJCWdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQoJCQkJCQk6V2FpdEZvckNoaWxkKCJQYWNrYWdlcyIpCgkJCQkJCTpXYWl0Rm9yQ2hpbGQoIl9JbmRleCIpCgkJCQkJCTpXYWl0Rm9yQ2hpbGQoInNsZWl0bmlja19uZXRAMC4xLjAiKQoJCQkJCQk6V2FpdEZvckNoaWxkKCJuZXQiKQoJCQkJCQk6V2FpdEZvckNoaWxkKCJSRS9VcGRhdGVWb3RlcyIpCgkJCQkJCTpGaXJlU2VydmVyKCJGRkEiKQoJCQkJZW5kCgkJCWVuZAoJCQlpZiBub3QgcGFkUG9zaXRpb24gdGhlbgoJCQkJcmV0dXJuCgkJCWVuZAoJCQlyZXR1cm4gQXV0b1BsYXlNb2R1bGUuZ2V0Q3VydmUocm9vdFBvc2l0aW9uLCBwYWRQb3NpdGlvbiwgZGVsdGEpCgkJZW5kCgkJbG9jYWwgcmFuZG9tUG9zaXRpb24gPSBBdXRvUGxheU1vZHVsZS5nZXRSYW5kb21Qb3NpdGlvbigpCgkJaWYgbm90IHJhbmRvbVBvc2l0aW9uIHRoZW4KCQkJcmV0dXJuCgkJZW5kCgkJcmV0dXJuIEF1dG9QbGF5TW9kdWxlLmdldEN1cnZlKHJvb3RQb3NpdGlvbiwgcmFuZG9tUG9zaXRpb24sIGRlbHRhKQoJZW5kCglBdXRvUGxheU1vZHVsZS5mb2xsb3dQYXRoID0gZnVuY3Rpb24oZGVsdGEpCgkJaWYgbm90IEF1dG9QbGF5TW9kdWxlLnBsYXllckhlbHBlci5pc0FsaXZlKEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUGxheWVycy5Mb2NhbFBsYXllcikgdGhlbgoJCQlBdXRvUGxheU1vZHVsZS5tb3ZlbWVudC5yZW1vdmVDYWNoZSgpCgkJCXJldHVybgoJCWVuZAoJCWxvY2FsIGluTG9iYnkgPSBBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlBhcmVudAoJCQk9PSBBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLldvcmtzcGFjZS5EZWFkCgkJbG9jYWwgcGF0aCA9IEF1dG9QbGF5TW9kdWxlLmZpbmRQYXRoKGluTG9iYnksIGRlbHRhKQoJCWlmIG5vdCBwYXRoIHRoZW4KCQkJQXV0b1BsYXlNb2R1bGUubW92ZW1lbnQuc3RvcChBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLlBsYXllcnMuTG9jYWxQbGF5ZXIpCgkJCXJldHVybgoJCWVuZAoJCUF1dG9QbGF5TW9kdWxlLm1vdmVtZW50Lm1vdmUoQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5QbGF5ZXJzLkxvY2FsUGxheWVyLCBwYXRoKQoJCUF1dG9QbGF5TW9kdWxlLm1vdmVtZW50Lmp1bXAoQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5QbGF5ZXJzLkxvY2FsUGxheWVyKQoJZW5kCglBdXRvUGxheU1vZHVsZS5maW5pc2hUaHJlYWQgPSBmdW5jdGlvbigpCgkJQXV0b1BsYXlNb2R1bGUuc2lnbmFsLmRpc2Nvbm5lY3QoImF1dG8tcGxheSIpCgkJQXV0b1BsYXlNb2R1bGUuc2lnbmFsLmRpc2Nvbm5lY3QoInN5bmNocm9uaXplIikKCQlpZiBub3QgQXV0b1BsYXlNb2R1bGUucGxheWVySGVscGVyLmlzQWxpdmUoQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5QbGF5ZXJzLkxvY2FsUGxheWVyKSB0aGVuCgkJCXJldHVybgoJCWVuZAoJCUF1dG9QbGF5TW9kdWxlLm1vdmVtZW50LnN0b3AoQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5QbGF5ZXJzLkxvY2FsUGxheWVyKQoJZW5kCglBdXRvUGxheU1vZHVsZS5ydW5UaHJlYWQgPSBmdW5jdGlvbigpCgkJQXV0b1BsYXlNb2R1bGUuc2lnbmFsLmNvbm5lY3QoCgkJCSJhdXRvLXBsYXkiLAoJCQlBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLlJ1blNlcnZpY2UuUG9zdFNpbXVsYXRpb24sCgkJCUF1dG9QbGF5TW9kdWxlLmZvbGxvd1BhdGgKCQkpCgkJQXV0b1BsYXlNb2R1bGUuc2lnbmFsLmNvbm5lY3QoCgkJCSJzeW5jaHJvbml6ZSIsCgkJCUF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUnVuU2VydmljZS5Qb3N0U2ltdWxhdGlvbiwKCQkJQXV0b1BsYXlNb2R1bGUuYmFsbFV0aWxzLmdldEJhbGwKCQkpCgllbmQKCglsb2NhbCBBdXRvUGxheSA9IHBsYXllcjpjcmVhdGVfbW9kdWxlKHsKCQl0aXRsZSA9ICJBdXRvIFBsYXkiLAoJCWZsYWcgPSAiQXV0b1BsYXkiLAoJCWRlc2NyaXB0aW9uID0gIkF1dG9tYXRpY2FsbHkgUGxheXMgR2FtZSIsCgkJc2VjdGlvbiA9ICJsZWZ0IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlpZiB2YWx1ZSB0aGVuCgkJCQlBdXRvUGxheU1vZHVsZS5ydW5UaHJlYWQoKQoJCQllbHNlCgkJCQlBdXRvUGxheU1vZHVsZS5maW5pc2hUaHJlYWQoKQoJCQllbmQKCQllbmQsCgl9KQoJbG9jYWwgQW50aUFGSyA9IEF1dG9QbGF5OmNyZWF0ZV9jaGVja2JveCh7CgkJdGl0bGUgPSAiQW50aSBBRksiLAoJCWZsYWcgPSAiQXV0b1BsYXlBbnRpQUZLIiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlpZiB2YWx1ZSB0aGVuCgkJCQlsb2NhbCBHQyA9IGdldGNvbm5lY3Rpb25zIG9yIGdldF9zaWduYWxfY29ucwoJCQkJaWYgR0MgdGhlbgoJCQkJCWZvciBpLCB2IGluIHBhaXJzKEdDKFBsYXllcnMuTG9jYWxQbGF5ZXIuSWRsZWQpKSBkbwoJCQkJCQlpZiB2WyJEaXNhYmxlIl0gdGhlbgoJCQkJCQkJdlsiRGlzYWJsZSJdKHYpCgkJCQkJCWVsc2VpZiB2WyJEaXNjb25uZWN0Il0gdGhlbgoJCQkJCQkJdlsiRGlzY29ubmVjdCJdKHYpCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZWxzZQoJCQkJCWxvY2FsIFZpcnR1YWxVc2VyID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpKQoJCQkJCVBsYXllcnMuTG9jYWxQbGF5ZXIuSWRsZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJCVZpcnR1YWxVc2VyOkNhcHR1cmVDb250cm9sbGVyKCkKCQkJCQkJVmlydHVhbFVzZXI6Q2xpY2tCdXR0b24yKFZlY3RvcjIubmV3KCkpCgkJCQkJZW5kKQoJCQkJZW5kCgkJCWVuZAoJCWVuZCwKCX0pCglBbnRpQUZLOmNoYW5nZV9zdGF0ZSh0cnVlKQoJQXV0b1BsYXk6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJFbmFibGUgSnVtcGluZyIsCgkJZmxhZyA9ICJqdW1waW5nX2VuYWJsZWQiLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCUF1dG9QbGF5TW9kdWxlLkNPTkZJRy5KVU1QSU5HX0VOQUJMRUQgPSB2YWx1ZQoJCWVuZCwKCX0pCglBdXRvUGxheTpjcmVhdGVfY2hlY2tib3goewoJCXRpdGxlID0gIkF1dG8gVm90ZSIsCgkJZmxhZyA9ICJBdXRvVm90ZSIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJZ2V0Z2VudigpLkF1dG9Wb3RlID0gdmFsdWUKCQllbmQsCgl9KQoJQXV0b1BsYXk6Y3JlYXRlX2RpdmlkZXIoe30pCglBdXRvUGxheTpjcmVhdGVfc2xpZGVyKHsKCQl0aXRsZSA9ICJEaXN0YW5jZSBGcm9tIEJhbGwiLAoJCWZsYWcgPSAiZGVmYXVsdF9kaXN0YW5jZSIsCgkJbWF4aW11bV92YWx1ZSA9IDEwMCwKCQltaW5pbXVtX3ZhbHVlID0gNSwKCQl2YWx1ZSA9IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5ERUZBVUxUX0RJU1RBTkNFLAoJCXJvdW5kX251bWJlciA9IHRydWUsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJQXV0b1BsYXlNb2R1bGUuQ09ORklHLkRFRkFVTFRfRElTVEFOQ0UgPSB2YWx1ZQoJCWVuZCwKCX0pCglBdXRvUGxheTpjcmVhdGVfc2xpZGVyKHsKCQl0aXRsZSA9ICJTcGVlZCBNdWx0aXBsaWVyIiwKCQlmbGFnID0gIm11bHRpcGxpZXJfdGhyZXNob2xkIiwKCQltYXhpbXVtX3ZhbHVlID0gMjAwLAoJCW1pbmltdW1fdmFsdWUgPSAxMCwKCQl2YWx1ZSA9IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5NVUxUSVBMSUVSX1RIUkVTSE9MRCwKCQlyb3VuZF9udW1iZXIgPSB0cnVlLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCUF1dG9QbGF5TW9kdWxlLkNPTkZJRy5NVUxUSVBMSUVSX1RIUkVTSE9MRCA9IHZhbHVlCgkJZW5kLAoJfSkKCUF1dG9QbGF5OmNyZWF0ZV9zbGlkZXIoewoJCXRpdGxlID0gIlRyYW5zdmVyc2luZyIsCgkJZmxhZyA9ICJ0cmF2ZXJzaW5nIiwKCQltYXhpbXVtX3ZhbHVlID0gMTAwLAoJCW1pbmltdW1fdmFsdWUgPSAwLAoJCXZhbHVlID0gQXV0b1BsYXlNb2R1bGUuQ09ORklHLlRSQVZFUlNJTkcsCgkJcm91bmRfbnVtYmVyID0gdHJ1ZSwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlBdXRvUGxheU1vZHVsZS5DT05GSUcuVFJBVkVSU0lORyA9IHZhbHVlCgkJZW5kLAoJfSkKCUF1dG9QbGF5OmNyZWF0ZV9zbGlkZXIoewoJCXRpdGxlID0gIkRpcmVjdGlvbiIsCgkJZmxhZyA9ICJEaXJlY3Rpb24iLAoJCW1heGltdW1fdmFsdWUgPSAxLAoJCW1pbmltdW1fdmFsdWUgPSAtMSwKCQl2YWx1ZSA9IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5ESVJFQ1RJT04sCgkJcm91bmRfbnVtYmVyID0gZmFsc2UsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJQXV0b1BsYXlNb2R1bGUuQ09ORklHLkRJUkVDVElPTiA9IHZhbHVlCgkJZW5kLAoJfSkKCUF1dG9QbGF5OmNyZWF0ZV9zbGlkZXIoewoJCXRpdGxlID0gIk9mZnNldCBGYWN0b3IiLAoJCWZsYWcgPSAiT2Zmc2V0RmFjdG9yIiwKCQltYXhpbXVtX3ZhbHVlID0gMSwKCQltaW5pbXVtX3ZhbHVlID0gMC4xLAoJCXZhbHVlID0gQXV0b1BsYXlNb2R1bGUuQ09ORklHLk9GRlNFVF9GQUNUT1IsCgkJcm91bmRfbnVtYmVyID0gZmFsc2UsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJQXV0b1BsYXlNb2R1bGUuQ09ORklHLk9GRlNFVF9GQUNUT1IgPSB2YWx1ZQoJCWVuZCwKCX0pCglBdXRvUGxheTpjcmVhdGVfc2xpZGVyKHsKCQl0aXRsZSA9ICJNb3ZlbWVudCBEdXJhdGlvbiIsCgkJZmxhZyA9ICJNb3ZlbWVudER1cmF0aW9uIiwKCQltYXhpbXVtX3ZhbHVlID0gMSwKCQltaW5pbXVtX3ZhbHVlID0gMC4xLAoJCXZhbHVlID0gQXV0b1BsYXlNb2R1bGUuQ09ORklHLk1PVkVNRU5UX0RVUkFUSU9OLAoJCXJvdW5kX251bWJlciA9IGZhbHNlLAoJCWNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCgkJCUF1dG9QbGF5TW9kdWxlLkNPTkZJRy5NT1ZFTUVOVF9EVVJBVElPTiA9IHZhbHVlCgkJZW5kLAoJfSkKCUF1dG9QbGF5OmNyZWF0ZV9zbGlkZXIoewoJCXRpdGxlID0gIkdlbmVyYXRpb24gVGhyZXNob2xkIiwKCQlmbGFnID0gIkdlbmVyYXRpb25UaHJlc2hvbGQiLAoJCW1heGltdW1fdmFsdWUgPSAwLjUsCgkJbWluaW11bV92YWx1ZSA9IDAuMSwKCQl2YWx1ZSA9IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5HRU5FUkFUSU9OX1RIUkVTSE9MRCwKCQlyb3VuZF9udW1iZXIgPSBmYWxzZSwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlBdXRvUGxheU1vZHVsZS5DT05GSUcuR0VORVJBVElPTl9USFJFU0hPTEQgPSB2YWx1ZQoJCWVuZCwKCX0pCglBdXRvUGxheTpjcmVhdGVfc2xpZGVyKHsKCQl0aXRsZSA9ICJKdW1wIENoYW5jZSIsCgkJZmxhZyA9ICJqdW1wX3BlcmNlbnRhZ2UiLAoJCW1heGltdW1fdmFsdWUgPSAxMDAsCgkJbWluaW11bV92YWx1ZSA9IDAsCgkJdmFsdWUgPSBBdXRvUGxheU1vZHVsZS5DT05GSUcuSlVNUF9QRVJDRU5UQUdFLAoJCXJvdW5kX251bWJlciA9IHRydWUsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKCQkJQXV0b1BsYXlNb2R1bGUuQ09ORklHLkpVTVBfUEVSQ0VOVEFHRSA9IHZhbHVlCgkJZW5kLAoJfSkKCUF1dG9QbGF5OmNyZWF0ZV9zbGlkZXIoewoJCXRpdGxlID0gIkRvdWJsZSBKdW1wIENoYW5jZSIsCgkJZmxhZyA9ICJkb3VibGVfanVtcF9wZXJjZW50YWdlIiwKCQltYXhpbXVtX3ZhbHVlID0gMTAwLAoJCW1pbmltdW1fdmFsdWUgPSAwLAoJCXZhbHVlID0gQXV0b1BsYXlNb2R1bGUuQ09ORklHLkRPVUJMRV9KVU1QX1BFUkNFTlRBR0UsCgkJcm91bmRfbnVtYmVyID0gdHJ1ZSwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlBdXRvUGxheU1vZHVsZS5DT05GSUcuRE9VQkxFX0pVTVBfUEVSQ0VOVEFHRSA9IHZhbHVlCgkJZW5kLAoJfSkKbG9jYWwgVmVsb2NpdHlHdWkgCmxvY2FsIHVwZGF0ZUNvbm4KbG9jYWwgcGVha1ZlbG9jaXR5ID0gMAoKbG9jYWwgQmFsbFN0YXRzID0gbWlzYzpjcmVhdGVfbW9kdWxlKHsKICAgIHRpdGxlID0gIkJhbGwgU3RhdHMiLAogICAgZmxhZyA9ICJiYWxsU3RhdHMiLAogICAgZGVzY3JpcHRpb24gPSAiRGlzcGxheXMgdGhlIGN1cnJlbnQgYmFsbCBzcGVlZCBhbmQgcGVhayB2ZWxvY2l0eSIsCiAgICBzZWN0aW9uID0gImxlZnQiLAogICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgIGlmIG5vdCBWZWxvY2l0eUd1aSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKCiAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFZlbG9jaXR5R3VpID0gSW5zdGFuY2UubmV3KCJTY3JlZW5HdWkiKQogICAgICAgICAgICAgICAgbG9jYWwgVmVsb2NpdHlGcmFtZSA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgICAgICAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIikKICAgICAgICAgICAgICAgIGxvY2FsIFVJR3JhZGllbnQgPSBJbnN0YW5jZS5uZXcoIlVJR3JhZGllbnQiKQogICAgICAgICAgICAgICAgbG9jYWwgSW1hZ2VCdXR0b24gPSBJbnN0YW5jZS5uZXcoIkltYWdlQnV0dG9uIikKICAgICAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyXzIgPSBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIikKICAgICAgICAgICAgICAgIGxvY2FsIFBlYWtWZWxvY2l0eSA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgICAgICAgICAgICAgIGxvY2FsIFZlbG9jaXR5ID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQoKICAgICAgICAgICAgICAgIFZlbG9jaXR5R3VpLk5hbWUgPSAiVmVsb2NpdHlHdWkiCiAgICAgICAgICAgICAgICBWZWxvY2l0eUd1aS5QYXJlbnQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJQbGF5ZXJHdWkiKQogICAgICAgICAgICAgICAgVmVsb2NpdHlHdWkuUmVzZXRPblNwYXduID0gZmFsc2UKCiAgICAgICAgICAgICAgICBWZWxvY2l0eUZyYW1lLk5hbWUgPSAiVmVsb2NpdHlGcmFtZSIKICAgICAgICAgICAgICAgIFZlbG9jaXR5RnJhbWUuUGFyZW50ID0gVmVsb2NpdHlHdWkKICAgICAgICAgICAgICAgIFZlbG9jaXR5RnJhbWUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDcwLCA3MCwgNzApCiAgICAgICAgICAgICAgICBWZWxvY2l0eUZyYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjMKICAgICAgICAgICAgICAgIFZlbG9jaXR5RnJhbWUuU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDAsIDAsIDEwMCkKICAgICAgICAgICAgICAgIFZlbG9jaXR5RnJhbWUuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4yLCAwLCAwLjE4LCAwKQogICAgICAgICAgICAgICAgVUlDb3JuZXIuUGFyZW50ID0gVmVsb2NpdHlGcmFtZQoKCgkJCQlVSUdyYWRpZW50LkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7Q29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLjAwLCBDb2xvcjMuZnJvbVJHQig0MiwgNDMsIDQ3KSksIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMS4wMCwgQ29sb3IzLmZyb21SR0IoNDIsIDQzLCA0NykpfQoJCQkJVUlHcmFkaWVudC5UcmFuc3BhcmVuY3kgPSBOdW1iZXJTZXF1ZW5jZS5uZXd7TnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMC4wMCwgMS4wMCksIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDEuMDAsIDEuMDApfQoJCQkJVUlHcmFkaWVudC5QYXJlbnQgPSBWZWxvY2l0eUZyYW1lCgoJCQkJSW1hZ2VCdXR0b24uUGFyZW50ID0gVmVsb2NpdHlGcmFtZQoJCQkJSW1hZ2VCdXR0b24uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCgkJCQlJbWFnZUJ1dHRvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMS4wMDAKCQkJCUltYWdlQnV0dG9uLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCgkJCQlJbWFnZUJ1dHRvbi5Cb3JkZXJTaXplUGl4ZWwgPSAwCgkJCQlJbWFnZUJ1dHRvbi5TaXplID0gVURpbTIubmV3KDAsIDIwMCwgMCwgMTAwKQoJCQkJSW1hZ2VCdXR0b24uSW1hZ2UgPSAicmJ4YXNzZXRpZDovLzEwMTQ5NzM2ODg2IgoJCQkJSW1hZ2VCdXR0b24uQWN0aXZlID0gZmFsc2UKCgkJCQlsb2NhbCBzdHJva2UgPSBJbnN0YW5jZS5uZXcoIlVJU3Ryb2tlIikKCQkJCXN0cm9rZS5QYXJlbnQgPSBJbWFnZUJ1dHRvbgoJCQkJc3Ryb2tlLkNvbG9yID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKCQkJCXN0cm9rZS5UaGlja25lc3MgPSAzCgkJCQlzdHJva2UuQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCgoJCQkJVUlDb3JuZXJfMi5QYXJlbnQgPSBJbWFnZUJ1dHRvbgoKCQkJCVBlYWtWZWxvY2l0eS5OYW1lID0gIlBlYWtWZWxvY2l0eSIKCQkJCVBlYWtWZWxvY2l0eS5QYXJlbnQgPSBJbWFnZUJ1dHRvbgoJCQkJUGVha1ZlbG9jaXR5LkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQoJCQkJUGVha1ZlbG9jaXR5LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLjAwMAoJCQkJUGVha1ZlbG9jaXR5LkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCgkJCQlQZWFrVmVsb2NpdHkuQm9yZGVyU2l6ZVBpeGVsID0gMAoJCQkJUGVha1ZlbG9jaXR5LlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAuNSwgMCkKCQkJCVBlYWtWZWxvY2l0eS5TaXplID0gVURpbTIubmV3KDAsIDIwMCwgMCwgNTApCgkJCQlQZWFrVmVsb2NpdHkuRm9udCA9IEVudW0uRm9udC5Tb3VyY2VTYW5zCgkJCQlQZWFrVmVsb2NpdHkuVGV4dCA9ICJQZWFrIFZlbG9jaXR5OiIKCQkJCVBlYWtWZWxvY2l0eS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKCQkJCVBlYWtWZWxvY2l0eS5UZXh0U2NhbGVkID0gdHJ1ZQoJCQkJUGVha1ZlbG9jaXR5LlRleHRTaXplID0gMTQuMDAwCgkJCQlQZWFrVmVsb2NpdHkuVGV4dFdyYXBwZWQgPSB0cnVlCgoJCQkJVmVsb2NpdHkuTmFtZSA9ICJWZWxvY2l0eSIKCQkJCVZlbG9jaXR5LlBhcmVudCA9IEltYWdlQnV0dG9uCgkJCQlWZWxvY2l0eS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKCQkJCVZlbG9jaXR5LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLjAwMAoJCQkJVmVsb2NpdHkuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKCQkJCVZlbG9jaXR5LkJvcmRlclNpemVQaXhlbCA9IDAKCQkJCVZlbG9jaXR5LlNpemUgPSBVRGltMi5uZXcoMCwgMjAwLCAwLCA1MCkKCQkJCVZlbG9jaXR5LkZvbnQgPSBFbnVtLkZvbnQuU291cmNlU2FucwoJCQkJVmVsb2NpdHkuVGV4dCA9ICJWZWxvY2l0eSIKCQkJCVZlbG9jaXR5LlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQoJCQkJVmVsb2NpdHkuVGV4dFNjYWxlZCA9IHRydWUKCQkJCVZlbG9jaXR5LlRleHRTaXplID0gMTQuMDAwCgkJCQlWZWxvY2l0eS5UZXh0V3JhcHBlZCA9IHRydWUKCiAgICAgICAgICAgICAgIAlsb2NhbCBUd2VlblNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCgkJCQlsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikKCgkJCQlsb2NhbCBmdW5jdGlvbiBtYWtlRHJhZ2dhYmxlKGZyYW1lKQoJCQkJCWxvY2FsIGRyYWdnaW5nID0gZmFsc2UKCQkJCQlsb2NhbCBkcmFnSW5wdXQsIGRyYWdTdGFydCwgc3RhcnRQb3MKCgkJCQkJbG9jYWwgZnVuY3Rpb24gdXBkYXRlKGlucHV0KQoJCQkJCQlsb2NhbCBkZWx0YSA9IGlucHV0LlBvc2l0aW9uIC0gZHJhZ1N0YXJ0CgkJCQkJCWxvY2FsIG5ld1BvcyA9IFVEaW0yLm5ldygKCQkJCQkJCXN0YXJ0UG9zLlguU2NhbGUsCgkJCQkJCQlzdGFydFBvcy5YLk9mZnNldCArIGRlbHRhLlgsCgkJCQkJCQlzdGFydFBvcy5ZLlNjYWxlLAoJCQkJCQkJc3RhcnRQb3MuWS5PZmZzZXQgKyBkZWx0YS5ZCgkJCQkJCSkKCQkJCQkJCgkJCQkJCVR3ZWVuU2VydmljZTpDcmVhdGUoZnJhbWUsIFR3ZWVuSW5mby5uZXcoMC4yLCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKCQkJCQkJCVBvc2l0aW9uID0gbmV3UG9zCgkJCQkJCX0pOlBsYXkoKQoJCQkJCWVuZAoKCQkJCQlmcmFtZS5BY3RpdmUgPSB0cnVlCgkJCQkJZnJhbWUuSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0KQoJCQkJCQlpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgdGhlbgoJCQkJCQkJZHJhZ2dpbmcgPSB0cnVlCgkJCQkJCQlkcmFnU3RhcnQgPSBpbnB1dC5Qb3NpdGlvbgoJCQkJCQkJc3RhcnRQb3MgPSBmcmFtZS5Qb3NpdGlvbgoKCQkJCQkJCWlucHV0LkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJCQkJaWYgaW5wdXQuVXNlcklucHV0U3RhdGUgPT0gRW51bS5Vc2VySW5wdXRTdGF0ZS5FbmQgdGhlbgoJCQkJCQkJCQlkcmFnZ2luZyA9IGZhbHNlCgkJCQkJCQkJZW5kCgkJCQkJCQllbmQpCgkJCQkJCWVuZAoJCQkJCWVuZCkKCgkJCQkJZnJhbWUuSW5wdXRDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQpCgkJCQkJCWlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlTW92ZW1lbnQgdGhlbgoJCQkJCQkJZHJhZ0lucHV0ID0gaW5wdXQKCQkJCQkJZW5kCgkJCQkJZW5kKQoKCQkJCQlVc2VySW5wdXRTZXJ2aWNlLklucHV0Q2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKGlucHV0KQoJCQkJCQlpZiBpbnB1dCA9PSBkcmFnSW5wdXQgYW5kIGRyYWdnaW5nIHRoZW4KCQkJCQkJCXVwZGF0ZShpbnB1dCkKCQkJCQkJZW5kCgkJCQkJZW5kKQoJCQkJZW5kCgoJCQkJCgkJCQltYWtlRHJhZ2dhYmxlKEltYWdlQnV0dG9uKQoKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdXBkYXRlQ29ubiA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQmFsbHMgPSBBdXRvX1BhcnJ5LkdldF9CYWxscygpIG9yIHt9CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3BlZWRTaG93biA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIEJhbGwgaW4gaXBhaXJzKEJhbGxzKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB6b29taWVzID0gQmFsbDpGaW5kRmlyc3RDaGlsZCgiem9vbWllcyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHpvb21pZXMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3BlZWQgPSB6b29taWVzLlZlY3RvclZlbG9jaXR5Lk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVsb2NpdHkuVGV4dCA9ICgiVmVsb2NpdHk6ICUuMmYiKTpmb3JtYXQoc3BlZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzcGVlZCA+IHBlYWtWZWxvY2l0eSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVha1ZlbG9jaXR5ID0gc3BlZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQZWFrVmVsb2NpdHkuVGV4dCA9ICgiUGVhayBWZWxvY2l0eTogJS4yZiIpOmZvcm1hdChwZWFrVmVsb2NpdHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwZWVkU2hvd24gPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc3BlZWRTaG93biB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFZlbG9jaXR5LlRleHQgPSAiVmVsb2NpdHk6IDAuMCIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiB1cGRhdGVDb25uIHRoZW4KICAgICAgICAgICAgICAgIHVwZGF0ZUNvbm46RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICB1cGRhdGVDb25uID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBWZWxvY2l0eUd1aSB0aGVuCiAgICAgICAgICAgICAgICBWZWxvY2l0eUd1aTpEZXN0cm95KCkKICAgICAgICAgICAgICAgIFZlbG9jaXR5R3VpID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBwZWFrVmVsb2NpdHkgPSAwCiAgICAgICAgZW5kCiAgICBlbmQsCn0pCgoJbG9jYWwgdmlzdWFsUGFydAoJbG9jYWwgVmlzdWFsaXNlciA9IG1pc2M6Y3JlYXRlX21vZHVsZSh7CgkJdGl0bGUgPSAiVmlzdWFsaXNlciIsCgkJZmxhZyA9ICJWaXN1YWxpc2VyIiwKCQlkZXNjcmlwdGlvbiA9ICJQYXJyeSBSYW5nZSBWaXN1YWxpc2VyIiwKCQlzZWN0aW9uID0gInJpZ2h0IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQoJCQlpZiB2YWx1ZSB0aGVuCgkJCQlpZiBub3QgdmlzdWFsUGFydCB0aGVuCgkJCQkJdmlzdWFsUGFydCA9IEluc3RhbmNlLm5ldygiUGFydCIpCgkJCQkJdmlzdWFsUGFydC5OYW1lID0gIlZpc3VhbGlzZXJQYXJ0IgoJCQkJCXZpc3VhbFBhcnQuU2hhcGUgPSBFbnVtLlBhcnRUeXBlLkJhbGwKCQkJCQl2aXN1YWxQYXJ0Lk1hdGVyaWFsID0gRW51bS5NYXRlcmlhbC5Gb3JjZUZpZWxkCgkJCQkJdmlzdWFsUGFydC5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCgkJCQkJdmlzdWFsUGFydC5UcmFuc3BhcmVuY3kgPSAwCgkJCQkJdmlzdWFsUGFydC5DYXN0U2hhZG93ID0gZmFsc2UKCQkJCQl2aXN1YWxQYXJ0LkFuY2hvcmVkID0gdHJ1ZQoJCQkJCXZpc3VhbFBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCgkJCQkJdmlzdWFsUGFydC5QYXJlbnQgPSB3b3Jrc3BhY2UKCQkJCWVuZAoJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiVmlzdWFsaXNlciJdID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQlsb2NhbCBjaGFyYWN0ZXIgPSBQbGF5ZXIuQ2hhcmFjdGVyCgkJCQkJbG9jYWwgSHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKCQkJCQlpZiBIdW1hbm9pZFJvb3RQYXJ0IGFuZCB2aXN1YWxQYXJ0IHRoZW4KCQkJCQkJdmlzdWFsUGFydC5DRnJhbWUgPSBIdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQoJCQkJCWVuZAoJCQkJCWlmIGdldGdlbnYoKS5WaXN1YWxpc2VyUmFpbmJvdyB0aGVuCgkJCQkJCWxvY2FsIGh1ZSA9ICh0aWNrKCkgJSA1KSAvIDUKCQkJCQkJdmlzdWFsUGFydC5Db2xvciA9IENvbG9yMy5mcm9tSFNWKGh1ZSwgMSwgMSkKCQkJCQllbHNlCgkJCQkJCWxvY2FsIGh1ZVZhbCA9IGdldGdlbnYoKS5WaXN1YWxpc2VySHVlIG9yIDAKCQkJCQkJdmlzdWFsUGFydC5Db2xvciA9IENvbG9yMy5mcm9tSFNWKGh1ZVZhbCAvIDM2MCwgMSwgMSkKCQkJCQllbmQKCQkJCQlsb2NhbCBzcGVlZCA9IDAKCQkJCQlsb2NhbCBtYXhTcGVlZCA9IDM1MAoJCQkJCWxvY2FsIEJhbGxzID0gQXV0b19QYXJyeS5HZXRfQmFsbHMoKQoJCQkJCWZvciBfLCBCYWxsIGluIHBhaXJzKEJhbGxzKSBkbwoJCQkJCQlpZiBCYWxsIGFuZCBCYWxsOkZpbmRGaXJzdENoaWxkKCJ6b29taWVzIikgdGhlbgoJCQkJCQkJbG9jYWwgVmVsb2NpdHkgPSBCYWxsLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkKCQkJCQkJCXNwZWVkID0gbWF0aC5taW4oVmVsb2NpdHkuTWFnbml0dWRlLCBtYXhTcGVlZCkgLyA2LjUKCQkJCQkJCWJyZWFrCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJCWxvY2FsIHNpemUgPSBtYXRoLm1heChzcGVlZCwgNi41KQoJCQkJCWlmIHZpc3VhbFBhcnQgdGhlbgoJCQkJCQl2aXN1YWxQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyhzaXplLCBzaXplLCBzaXplKQoJCQkJCWVuZAoJCQkJZW5kKQoJCQllbHNlCgkJCQlpZiBDb25uZWN0aW9uc19NYW5hZ2VyWyJWaXN1YWxpc2VyIl0gdGhlbgoJCQkJCUNvbm5lY3Rpb25zX01hbmFnZXJbIlZpc3VhbGlzZXIiXTpEaXNjb25uZWN0KCkKCQkJCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJWaXN1YWxpc2VyIl0gPSBuaWwKCQkJCWVuZAoJCQkJaWYgdmlzdWFsUGFydCB0aGVuCgkJCQkJdmlzdWFsUGFydDpEZXN0cm95KCkKCQkJCQl2aXN1YWxQYXJ0ID0gbmlsCgkJCQllbmQKCQkJZW5kCgkJZW5kLAoJfSkKCVZpc3VhbGlzZXI6Y3JlYXRlX2NoZWNrYm94KHsKCQl0aXRsZSA9ICJSYWluYm93IiwKCQlmbGFnID0gIlZpc3VhbGlzZXJSYWluYm93IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlnZXRnZW52KCkuVmlzdWFsaXNlclJhaW5ib3cgPSB2YWx1ZQoJCWVuZCwKCX0pCglWaXN1YWxpc2VyOmNyZWF0ZV9zbGlkZXIoewoJCXRpdGxlID0gIkNvbG9yIEh1ZSIsCgkJZmxhZyA9ICJWaXN1YWxpc2VySHVlIiwKCQltaW5pbXVtX3ZhbHVlID0gMCwKCQltYXhpbXVtX3ZhbHVlID0gMzYwLAoJCXZhbHVlID0gMCwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQoJCQlnZXRnZW52KCkuVmlzdWFsaXNlckh1ZSA9IHZhbHVlCgkJZW5kLAoJfSkKCWxvY2FsIERpc2FibGVRdWFudHVtRWZmZWN0cyA9IHdvcmxkOmNyZWF0ZV9tb2R1bGUoewoJCXRpdGxlID0gIkRpc2FibGUgUXVhbnR1bSBBcmVuYSBFZmZlY3RzIiwKCQlmbGFnID0gIk5vUXVhbnR1bUVmZmVjdHMiLAoJCWRlc2NyaXB0aW9uID0gIkRpc2FibGVzIFF1YW50dW0gQXJlbmEgZWZmZWN0cy4iLAoJCXNlY3Rpb24gPSAibGVmdCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKCQkJZ2V0Z2VudigpLk5vUXVhbnR1bUVmZmVjdHMgPSB2YWx1ZQoJCQlpZiB2YWx1ZSB0aGVuCgkJCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJCQlsb2NhbCBxdWFudHVtZngKCQkJCQl3aGlsZSB0YXNrLndhaXQoKSBhbmQgZ2V0Z2VudigpLk5vUXVhbnR1bUVmZmVjdHMgYW5kIG5vdCBxdWFudHVtZnggZG8KCQkJCQkJZm9yIF8sIHYgaW4gZ2V0Y29ubmVjdGlvbnMoUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5RdWFudHVtQXJlbmEuT25DbGllbnRFdmVudCkgZG8KCQkJCQkJCXF1YW50dW1meCA9IHYKCQkJCQkJCXY6RGlzYWJsZSgpCgkJCQkJCWVuZAoJCQkJCWVuZAoJCQkJZW5kKQoJCQllbmQKCQllbmQsCgl9KQoJbG9jYWwgTm9fUmVuZGVyID0gbWlzYzpjcmVhdGVfbW9kdWxlKHsKCQl0aXRsZSA9ICJObyBSZW5kZXIiLAoJCWZsYWcgPSAiTm9fUmVuZGVyIiwKCQlkZXNjcmlwdGlvbiA9ICJEaXNhYmxlcyByZW5kZXJpbmcgb2YgZWZmZWN0cyIsCgkJc2VjdGlvbiA9ICJyaWdodCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKCQkJUGxheWVyLlBsYXllclNjcmlwdHMuRWZmZWN0U2NyaXB0cy5DbGllbnRGWC5EaXNhYmxlZCA9IHN0YXRlCgkJCWlmIHN0YXRlIHRoZW4KCQkJCUNvbm5lY3Rpb25zX01hbmFnZXJbIk5vIFJlbmRlciJdID0gd29ya3NwYWNlLlJ1bnRpbWUuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKFZhbHVlKQoJCQkJCURlYnJpczpBZGRJdGVtKFZhbHVlLCAwKQoJCQkJZW5kKQoJCQllbHNlCgkJCQlpZiBDb25uZWN0aW9uc19NYW5hZ2VyWyJObyBSZW5kZXIiXSB0aGVuCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiTm8gUmVuZGVyIl06RGlzY29ubmVjdCgpCgkJCQkJQ29ubmVjdGlvbnNfTWFuYWdlclsiTm8gUmVuZGVyIl0gPSBuaWwKCQkJCWVuZAoJCQllbmQKCQllbmQsCgl9KQpsb2NhbCBzcG9vZkNvbm5lY3Rpb24KCmxvY2FsIHBpbmdzcG9vZmVyID0gbWlzYzpjcmVhdGVfbW9kdWxlKHsKICAgIHRpdGxlID0gIlBpbmcgU3Bvb2ZlciIsCiAgICBmbGFnID0gInBpbmdfc3Bvb2ZlciIsCiAgICBkZXNjcmlwdGlvbiA9ICJMb2NrcyB5b3VyIHBpbmcgZGlzcGxheSB0byBhIGZha2UgbnVtYmVyIiwKICAgIHNlY3Rpb24gPSAibGVmdCIsCiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgaWYgbm90IHNwb29mQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBzcG9vZkNvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZmFrZVBpbmcgPSB0b251bWJlcihMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzWyJwaW5nX3RleHQiXSkgb3IgOTk5CiAgICAgICAgICAgICAgICAgICAgZmFrZVBpbmcgPSB0b3N0cmluZyhtYXRoLmZsb29yKGZha2VQaW5nKSkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9ibG94R3VpID0gQ29yZUd1aTpGaW5kRmlyc3RDaGlsZCgiUm9ibG94R3VpIikKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgcm9ibG94R3VpIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBwZXJmU3RhdHMgPSByb2Jsb3hHdWk6RmluZEZpcnN0Q2hpbGQoIlBlcmZvcm1hbmNlU3RhdHMiKQogICAgICAgICAgICAgICAgICAgIGlmIHBlcmZTdGF0cyB0aGVuCiAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgY2hpbGQgaW4gaXBhaXJzKHBlcmZTdGF0czpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGQ6SXNBKCJUZXh0TGFiZWwiKSBhbmQgY2hpbGQuVGV4dDptYXRjaCgiJWQrIG1zIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLlRleHQgPSBmYWtlUGluZyAuLiAiIG1zIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiBzcG9vZkNvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICAgICAgc3Bvb2ZDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgc3Bvb2ZDb25uZWN0aW9uID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCByb2Jsb3hHdWkgPSBDb3JlR3VpOkZpbmRGaXJzdENoaWxkKCJSb2Jsb3hHdWkiKQogICAgICAgICAgICBpZiByb2Jsb3hHdWkgYW5kIHJvYmxveEd1aTpGaW5kRmlyc3RDaGlsZCgiRmFrZVBpbmdMYWJlbCIpIHRoZW4KICAgICAgICAgICAgICAgIHJvYmxveEd1aS5GYWtlUGluZ0xhYmVsOkRlc3Ryb3koKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCwKfSkKCnBpbmdzcG9vZmVyOmNyZWF0ZV90ZXh0Ym94KHsKICAgIHRpdGxlID0gIlNwb29mZWQgUGluZyIsCiAgICBwbGFjZWhvbGRlciA9ICJFbnRlciBmYWtlIHBpbmcgbnVtYmVyKSIsCiAgICBmbGFnID0gInBpbmdfdGV4dCIsCiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHRleHQpCgkJCiAgICAgICAgbG9jYWwgbnVtID0gdG9udW1iZXIodGV4dCkKICAgICAgICBpZiBudW0gYW5kIG51bSA+PSAwIHRoZW4KICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1sicGluZ190ZXh0Il0gPSB0b3N0cmluZyhtYXRoLmZsb29yKG51bSkpCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCWxvY2FsIEN1c3RvbUFubm91bmNlciA9IG1pc2M6Y3JlYXRlX21vZHVsZSh7CgkJdGl0bGUgPSAiQ3VzdG9tIEFubm91bmNlciIsCgkJZmxhZyA9ICJDdXN0b21fQW5ub3VuY2VyIiwKCQlkZXNjcmlwdGlvbiA9ICJDdXN0b21pemUgdGhlIGdhbWUgYW5ub3VuY2VtZW50cyIsCgkJc2VjdGlvbiA9ICJyaWdodCIsCgkJY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKCQkJaWYgdmFsdWUgdGhlbgoJCQkJbG9jYWwgQW5ub3VuY2VyID0gUGxheWVyLlBsYXllckd1aTpXYWl0Rm9yQ2hpbGQoImFubm91bmNlciIpCgkJCQlsb2NhbCBXaW5uZXIgPSBBbm5vdW5jZXI6RmluZEZpcnN0Q2hpbGQoIldpbm5lciIpCgkJCQlpZiBXaW5uZXIgdGhlbgoJCQkJCVdpbm5lci5UZXh0ID0gTGlicmFyeS5fY29uZmlnLl9mbGFnc1siYW5ub3VuY2VyX3RleHQiXSBvciAiaHR0cHM6Ly9kaXNjb3JkLmdnL0tIUE1CYnREVUYiCgkJCQllbmQKCQkJCUFubm91bmNlci5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oVmFsdWUpCgkJCQkJaWYgVmFsdWUuTmFtZSA9PSAiV2lubmVyIiB0aGVuCgkJCQkJCVZhbHVlLkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihQcm9wZXJ0eSkKCQkJCQkJCWlmIFByb3BlcnR5ID09ICJUZXh0IiBhbmQgTGlicmFyeS5fY29uZmlnLl9mbGFnc1siQ3VzdG9tX0Fubm91bmNlciJdIHRoZW4KCQkJCQkJCQlWYWx1ZS5UZXh0ID0gTGlicmFyeS5fY29uZmlnLl9mbGFnc1siYW5ub3VuY2VyX3RleHQiXSBvciAiaHR0cHM6Ly9kaXNjb3JkLmdnL0tIUE1CYnREVUYiCgkJCQkJCQllbmQKCQkJCQkJZW5kKQoJCQkJCQlpZiBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzWyJDdXN0b21fQW5ub3VuY2VyIl0gdGhlbgoJCQkJCQkJVmFsdWUuVGV4dCA9IExpYnJhcnkuX2NvbmZpZy5fZmxhZ3NbImFubm91bmNlcl90ZXh0Il0gb3IgImh0dHBzOi8vZGlzY29yZC5nZy9LSFBNQmJ0RFVGIgoJCQkJCQllbmQKCQkJCQllbmQKCQkJCWVuZCkKCQkJZW5kCgkJZW5kLAoJfSkKCUN1c3RvbUFubm91bmNlcjpjcmVhdGVfdGV4dGJveCh7CgkJdGl0bGUgPSAiQ3VzdG9tIEFubm91bmNlbWVudCBUZXh0IiwKCQlwbGFjZWhvbGRlciA9ICJFbnRlciBjdXN0b20gYW5ub3VuY2VyIHRleHQuLi4gIiwKCQlmbGFnID0gImFubm91bmNlcl90ZXh0IiwKCQljYWxsYmFjayA9IGZ1bmN0aW9uKHRleHQpCgkJCUxpYnJhcnkuX2NvbmZpZy5fZmxhZ3NbImFubm91bmNlcl90ZXh0Il0gPSB0ZXh0CgkJCWlmIExpYnJhcnkuX2NvbmZpZy5fZmxhZ3NbIkN1c3RvbV9Bbm5vdW5jZXIiXSB0aGVuCgkJCQlsb2NhbCBBbm5vdW5jZXIgPSBQbGF5ZXIuUGxheWVyR3VpOldhaXRGb3JDaGlsZCgiYW5ub3VuY2VyIikKCQkJCWxvY2FsIFdpbm5lciA9IEFubm91bmNlcjpGaW5kRmlyc3RDaGlsZCgiV2lubmVyIikKCQkJCWlmIFdpbm5lciB0aGVuCgkJCQkJV2lubmVyLlRleHQgPSB0ZXh0CgkJCQllbmQKCQkJZW5kCgkJZW5kLAoJfSkKZW5kClJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuUGFycnlTdWNjZXNzQWxsLk9uQ2xpZW50RXZlbnQ6Q29ubmVjdChmdW5jdGlvbihfLCByb290KQoJaWYgcm9vdC5QYXJlbnQgYW5kIHJvb3QuUGFyZW50IH49IFBsYXllci5DaGFyYWN0ZXIgdGhlbgoJCWlmIHJvb3QuUGFyZW50LlBhcmVudCB+PSB3b3Jrc3BhY2UuQWxpdmUgdGhlbgoJCQlyZXR1cm4KCQllbmQKCWVuZAoJQXV0b19QYXJyeS5DbG9zZXN0X1BsYXllcigpCglsb2NhbCBCYWxsID0gQXV0b19QYXJyeS5HZXRfQmFsbCgpCglpZiBub3QgQmFsbCB0aGVuCgkJcmV0dXJuCgllbmQKCWxvY2FsIFRhcmdldF9EaXN0YW5jZSA9IChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uIC0gQ2xvc2VzdF9FbnRpdHkuUHJpbWFyeVBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQoJbG9jYWwgRGlzdGFuY2UgPSAoUGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbiAtIEJhbGwuUG9zaXRpb24pLk1hZ25pdHVkZQoJbG9jYWwgRGlyZWN0aW9uID0gKFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24gLSBCYWxsLlBvc2l0aW9uKS5Vbml0Cglsb2NhbCBEb3QgPSBEaXJlY3Rpb246RG90KEJhbGwuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eS5Vbml0KQoJbG9jYWwgQ3VydmVfRGV0ZWN0ZWQgPSBBdXRvX1BhcnJ5LklzX0N1cnZlZCgpCglpZiBUYXJnZXRfRGlzdGFuY2UgPCAxNSBhbmQgRGlzdGFuY2UgPCAxNSBhbmQgRG90ID4gMCB0aGVuCgkJaWYgQ3VydmVfRGV0ZWN0ZWQgdGhlbgoJCQlBdXRvX1BhcnJ5LlBhcnJ5KFNlbGVjdGVkX1BhcnJ5X1R5cGUpCgkJZW5kCgllbmQKCWlmIG5vdCBHcmFiX1BhcnJ5IHRoZW4KCQlyZXR1cm4KCWVuZAoJR3JhYl9QYXJyeTpTdG9wKCkKZW5kKQpSZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLlBhcnJ5U3VjY2Vzcy5PbkNsaWVudEV2ZW50OkNvbm5lY3QoZnVuY3Rpb24oKQoJaWYgUGxheWVyLkNoYXJhY3Rlci5QYXJlbnQgfj0gd29ya3NwYWNlLkFsaXZlIHRoZW4KCQlyZXR1cm4KCWVuZAoJaWYgbm90IEdyYWJfUGFycnkgdGhlbgoJCXJldHVybgoJZW5kCglHcmFiX1BhcnJ5OlN0b3AoKQplbmQpCndvcmtzcGFjZS5CYWxscy5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oKQoJUGFycmllZCA9IGZhbHNlCmVuZCkKd29ya3NwYWNlLkJhbGxzLkNoaWxkUmVtb3ZlZDpDb25uZWN0KGZ1bmN0aW9uKFZhbHVlKQoJUGFycmllcyA9IDAKCVBhcnJpZWQgPSBmYWxzZQoJaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsiVGFyZ2V0IENoYW5nZSJdIHRoZW4KCQlDb25uZWN0aW9uc19NYW5hZ2VyWyJUYXJnZXQgQ2hhbmdlIl06RGlzY29ubmVjdCgpCgkJQ29ubmVjdGlvbnNfTWFuYWdlclsiVGFyZ2V0IENoYW5nZSJdID0gbmlsCgllbmQKZW5kKQoKZnVuY3Rpb24gU2VuZE1lc3NhZ2VFTUJFRCh1cmwsIGVtYmVkKQogICAgbG9jYWwgaHR0cCA9IGdhbWU6R2V0U2VydmljZSgiSHR0cFNlcnZpY2UiKQogICAgbG9jYWwgaGVhZGVycyA9IHsKICAgICAgICBbIkNvbnRlbnQtVHlwZSJdID0gImFwcGxpY2F0aW9uL2pzb24iCiAgICB9CiAgICBsb2NhbCBkYXRhID0gewogICAgICAgIFsiZW1iZWRzIl0gPSB7CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFsidGl0bGUiXSA9IGVtYmVkLnRpdGxlLAogICAgICAgICAgICAgICAgWyJkZXNjcmlwdGlvbiJdID0gZW1iZWQuZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBbImNvbG9yIl0gPSBlbWJlZC5jb2xvciwKICAgICAgICAgICAgICAgIFsiZmllbGRzIl0gPSBlbWJlZC5maWVsZHMsCiAgICAgICAgICAgICAgICBbImZvb3RlciJdID0gewogICAgICAgICAgICAgICAgICAgIFsidGV4dCJdID0gZW1iZWQuZm9vdGVyLnRleHQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGxvY2FsIGJvZHkgPSBodHRwOkpTT05FbmNvZGUoZGF0YSkKICAgIGxvY2FsIHJlc3BvbnNlID0gcmVxdWVzdCh7CiAgICAgICAgVXJsID0gdXJsLAogICAgICAgIE1ldGhvZCA9ICJQT1NUIiwKICAgICAgICBIZWFkZXJzID0gaGVhZGVycywKICAgICAgICBCb2R5ID0gYm9keQogICAgfSkKZW5kCgpsb2NhbCB1cmwgPSAiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTQxNDQzNDk5MDM4MDQyMTI5MS9iMnAtX1V2akFWYm9va0hkMGdubjZ4dHU0ZG9vQWszTHN2akZmN1ZsVjZpUjBsV0xJeE1CUFk4Z1pZS0RESklwcmZVZyIKbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIGV4ZWN1dG9yTmFtZSA9ICJVbmtub3duIgoKaWYgaWRlbnRpZnlleGVjdXRvciB0aGVuCiAgICBleGVjdXRvck5hbWUgPSBpZGVudGlmeWV4ZWN1dG9yKCkKZWxzZWlmIGdldGV4ZWN1dG9ybmFtZSB0aGVuCiAgICBleGVjdXRvck5hbWUgPSBnZXRleGVjdXRvcm5hbWUoKQplbmQKCmxvY2FsIGVtYmVkID0gewogICAgWyJ0aXRsZSJdID0gIiBMb2dzICIsCiAgICBbImRlc2NyaXB0aW9uIl0gPSAiTG9ncyIsCiAgICBbImNvbG9yIl0gPSAxMTY3NDE0NiwKICAgIFsiZmllbGRzIl0gPSB7CiAgICAgICAgewogICAgICAgICAgICBbIm5hbWUiXSA9ICIgUGxheWVyIEluZm8iLAogICAgICAgICAgICBbInZhbHVlIl0gPSAiVXNlcm5hbWU6ICIgLi4gcGxheWVyLk5hbWUgLi4gIlxuRGlzcGxheSBOYW1lOiAiIC4uIHBsYXllci5EaXNwbGF5TmFtZSAuLiAiXG5QbGF5ZXIgSUQ6ICIgLi4gcGxheWVyLlVzZXJJZCAuLiAiXG5FeGVjdXRvcjogIiAuLiBleGVjdXRvck5hbWUgLi4gIlxuIEV4ZWN1dGVyIiwKICAgICAgICAgICAgWyJpbmxpbmUiXSA9IGZhbHNlCiAgICAgICAgfQogICAgfSwKICAgIFsiZm9vdGVyIl0gPSB7CiAgICAgICAgWyJ0ZXh0Il0gPSAiIPCdkIHOseGlo+Glo/Cdl4wu4aWj4rG64aWjIGlzIHRoZSBiZXN0IiwKICAgIH0sCiAgICBbInRpbWVzdGFtcCJdID0gb3MuZGF0ZSgiISVZLSVtLSVkVCVIOiVNOiVTWiIpCn0KClNlbmRNZXNzYWdlRU1CRUQodXJsLCBlbWJlZCkKCm1haW46bG9hZCgpCgpsb2NhbCBDb3JlR3VpID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikKbG9jYWwgQmFsbHNHdWkgPSBDb3JlR3VpOldhaXRGb3JDaGlsZCgiQmFsbHMiLCA2MCkKCmlmIG5vdCBCYWxsc0d1aSB0aGVuCiAgICB3YXJuKCJDb3VsZCBub3QgZmluZCB0aGUgJ0JhbGxzJyBHVUkuIFRoZSBvcmlnaW5hbCBzY3JpcHQgbWF5IGhhdmUgZmFpbGVkIHRvIGxvYWQuIikKICAgIHJldHVybgplbmQKCmxvY2FsIENvbnRhaW5lciA9IEJhbGxzR3VpOldhaXRGb3JDaGlsZCgiQ29udGFpbmVyIiwgMzApCgppZiBub3QgQ29udGFpbmVyIHRoZW4KICAgIHdhcm4oIkNvdWxkIG5vdCBmaW5kIHRoZSAnQ29udGFpbmVyJyBmcmFtZS4gVGhlIG9yaWdpbmFsIHNjcmlwdCBtYXkgaGF2ZSBmYWlsZWQgdG8gbG9hZC4iKQogICAgcmV0dXJuCmVuZAoKbG9jYWwgVEhFTUUgPSB7CiAgICBCQUNLR1JPVU5EID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksICAgICAgLS0gUHVyZSBibGFjayBiYWNrZ3JvdW5kCiAgICBURVhUID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksICAgICAgLS0gUHVyZSB3aGl0ZSB0ZXh0CiAgICBBQ0NFTlQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSwgICAgICAgICAgLS0gQmxhY2sgYWNjZW50IChmb3IgZ3JhZGllbnRzL3N0cm9rZXMpCiAgICBTVFJPS0UgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSAgICAgICAgICAgLS0gQmxhY2sgc3Ryb2tlCn0KCmxvY2FsIGZ1bmN0aW9uIGFwcGx5VGhlbWUob2JqZWN0KQogICAgaWYgb2JqZWN0OklzQSgiVGV4dExhYmVsIikgb3Igb2JqZWN0OklzQSgiVGV4dEJ1dHRvbiIpIG9yIG9iamVjdDpJc0EoIlRleHRCb3giKSB0aGVuCiAgICAgICAgb2JqZWN0LlRleHRDb2xvcjMgPSBUSEVNRS5URVhUCiAgICAgICAgb2JqZWN0LlRleHRUcmFuc3BhcmVuY3kgPSAwCiAgICBlbmQKCiAgICBpZiBvYmplY3Q6SXNBKCJGcmFtZSIpIG9yIG9iamVjdDpJc0EoIlNjcm9sbGluZ0ZyYW1lIikgdGhlbgogICAgICAgIGlmIG9iamVjdC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5IDwgMSB0aGVuCiAgICAgICAgICAgIG9iamVjdC5CYWNrZ3JvdW5kQ29sb3IzID0gVEhFTUUuQkFDS0dST1VORAogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgb2JqZWN0OklzQSgiVUlTdHJva2UiKSB0aGVuCiAgICAgICAgb2JqZWN0LkNvbG9yID0gVEhFTUUuU1RST0tFCiAgICAgICAgb2JqZWN0LlRoaWNrbmVzcyA9IDEKICAgIGVuZAoKICAgIGlmIG9iamVjdDpJc0EoIlVJR3JhZGllbnQiKSB0aGVuCiAgICAgICAgbG9jYWwgY29sb3JLZXlzID0ge30KICAgICAgICBmb3IgaSwga2V5IGluIGlwYWlycyhvYmplY3QuQ29sb3IuS2V5cG9pbnRzKSBkbwogICAgICAgICAgICB0YWJsZS5pbnNlcnQoY29sb3JLZXlzLCBDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KGtleS5UaW1lLCBUSEVNRS5CQUNLR1JPVU5EKSkKICAgICAgICBlbmQKICAgICAgICBvYmplY3QuQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ldyhjb2xvcktleXMpCiAgICBlbmQKCiAgICBpZiBvYmplY3Q6SXNBKCJJbWFnZUxhYmVsIikgb3Igb2JqZWN0OklzQSgiSW1hZ2VCdXR0b24iKSB0aGVuCiAgICAgICAgb2JqZWN0LkltYWdlQ29sb3IzID0gVEhFTUUuVEVYVAogICAgZW5kCgogICAgaWYgb2JqZWN0Lk5hbWUgPT0gIkNsaWVudE5hbWUiIHRoZW4KICAgICAgICBvYmplY3QuVGV4dCA9ICIgICAgICIKICAgICAgICBvYmplY3QuVGV4dENvbG9yMyA9IFRIRU1FLlRFWFQKICAgIGVuZAplbmQKCmZvciBfLCBkZXNjZW5kYW50IGluIGlwYWlycyhDb250YWluZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgIHBjYWxsKGFwcGx5VGhlbWUsIGRlc2NlbmRhbnQpCmVuZAoKQ29udGFpbmVyLkRlc2NlbmRhbnRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGRlc2NlbmRhbnQpCiAgICBwY2FsbChhcHBseVRoZW1lLCBkZXNjZW5kYW50KQplbmQpCg==)))()